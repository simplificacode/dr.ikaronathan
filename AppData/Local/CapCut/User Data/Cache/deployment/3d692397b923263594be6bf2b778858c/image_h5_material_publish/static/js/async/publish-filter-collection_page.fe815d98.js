"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[960],{42983:(e,t,o)=>{o.d(t,{Ab:()=>l});let l=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e}({})},69836:(e,t,o)=>{o.d(t,{Bo:()=>g,LU:()=>v,ir:()=>C});var l=o(50959),i=o(84875),a=o.n(i),r=o(45599),s=o(82346),n=o(96426),c=o(85083),d=o(88623),u=o(84997),m=o(40699),p=o(96305),_=o(11527);const f=e=>{const{className:t}=e,{t:o}=(0,r.$)(),{handleMouseEnter:l}=(0,u.S)();return(0,_.jsxs)("div",{className:a()(p.Z.root,t),children:[(0,_.jsx)(s.a,{className:p.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,_.jsx)("div",{className:p.Z.text,onMouseEnter:l,children:o("pc_stickers_release_in_web")})]})},h=e=>{const{className:t,tooltip:o}=e,{t:i}=(0,r.$)(),{handleMouseEnter:s}=(0,u.w)({content:o,className:p.Z.tooltip}),c=(0,l.useRef)(null),{setIsMarqueeLoopRunning:d,reactNode:f}=(0,m.J)({text:i("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>c.current});return(0,_.jsxs)("div",{className:a()(p.Z.root,t,p.Z.error),onMouseEnter:e=>{d(!0),s(e)},onMouseLeave:()=>d(!1),children:[(0,_.jsx)(n.r,{className:p.Z.icon}),(0,_.jsx)("div",{ref:c,className:p.Z.text,children:f})]})},g=e=>{const{className:t,text:o}=e,{handleMouseEnter:l}=(0,u.S)();return(0,_.jsxs)("div",{className:a()(p.Z.root,t,p.Z.checked),children:[(0,_.jsx)(d.r,{className:p.Z.icon}),(0,_.jsx)("div",{className:p.Z.text,onMouseEnter:l,children:o})]})},v=e=>{const{className:t}=e,{t:o}=(0,r.$)(),{handleMouseEnter:l}=(0,u.S)();return(0,_.jsxs)("div",{className:a()(p.Z.root,t),children:[(0,_.jsx)("div",{className:a()(p.Z.icon,p.Z.yellowIcon),children:(0,_.jsx)("div",{className:p.Z.yellowPoint})}),(0,_.jsx)("div",{className:p.Z.text,onMouseEnter:l,children:o("pc_stickers_release_editing_web")}),(0,_.jsx)(c.r,{className:p.Z.icon})]})},C=e=>{const{className:t,loading:o,invalid:l,errorToolip:i,isInfoComplete:a,title:r}=e;return o?(0,_.jsx)(f,{className:t}):l?(0,_.jsx)(h,{className:t,tooltip:i}):a?(0,_.jsx)(g,{className:t,text:r}):(0,_.jsx)(v,{className:t})}},95218:(e,t,o)=>{o.d(t,{Cz:()=>a,KD:()=>m,Mc:()=>n,Mn:()=>d,OQ:()=>r,Pc:()=>f,S8:()=>s,Tb:()=>u,ZV:()=>p,Zk:()=>_,dr:()=>h,t2:()=>c});var l=o(73224),i=o(60209);const a=3,r=10,s=24,n=24,c=80,d=120,u=20971520,m="#BB984B",p={[i.nb.File]:{[i.id.Format]:l.I18n.t("pc_filter_form"),[i.id.MaxFileSize]:l.I18n.t("pc_filter_size_eight_m"),[i.id.CollectionNum]:l.I18n.t("pc_filter_collection_number")},[i.nb.Cover]:{[i.id.CoverCopyright]:l.I18n.t("pc_filter_original_cover_copyright"),[i.id.CoverLut]:l.I18n.t("pc_filter_lut_match"),[i.id.CoverFormat]:l.I18n.t("pc_filter_file_format"),[i.id.CoverMinImageSize]:l.I18n.t("pc_filter_pixel_size"),[i.id.CoverMaxFileSize]:l.I18n.t("pc_filter_file_size_ten_m")}},_={accept:"cube-3dl",multiple:!0,thumbnailSize:210,maxFileSize:20971520},f={accept:"png-jpg-jpeg",thumbnailSize:210,maxFileSize:10485760,minImageSize:720},h="ImportFilter"},62760:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Lt});var l=o(50959),i=o(23479),a=o(45599),r=o(12904),s=o(21130),n=o(9608),c=o(60209),d=o(18882);const u=function(e){return null==e};var m=o(24507),p=o(95297);const _=function(e,t,o,l){var i=o.length,a=i,r=!l;if(null==e)return!a;for(e=Object(e);i--;){var s=o[i];if(r&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<a;){var n=(s=o[i])[0],c=e[n],d=s[1];if(r&&s[2]){if(void 0===c&&!(n in e))return!1}else{var u=new m.Z;if(l)var _=l(c,d,n,e,t,u);if(!(void 0===_?(0,p.Z)(d,c,3,l,u):_))return!1}}return!0};var f=o(82433);const h=function(e){return e==e&&!(0,f.Z)(e)};var g=o(77251);const v=function(e){for(var t=(0,g.Z)(e),o=t.length;o--;){var l=t[o],i=e[l];t[o]=[l,i,h(i)]}return t};const C=function(e,t){return function(o){return null!=o&&(o[e]===t&&(void 0!==t||e in Object(o)))}};const y=function(e){var t=v(e);return 1==t.length&&t[0][2]?C(t[0][0],t[0][1]):function(o){return o===e||_(o,e,t)}};var b=o(54029),S=o(90177),x=o(61070),I=o(13383);const F=function(e,t){return(0,x.Z)(e)&&h(t)?C((0,I.Z)(e),t):function(o){var l=(0,b.Z)(o,e);return void 0===l&&l===t?(0,S.Z)(o,e):(0,p.Z)(t,l,3)}};var L=o(76402),M=o(56052);const w=function(e){return function(t){return null==t?void 0:t[e]}};var N=o(49084);const j=function(e){return function(t){return(0,N.Z)(t,e)}};const U=function(e){return(0,x.Z)(e)?w((0,I.Z)(e)):j(e)};const A=function(e){return"function"==typeof e?e:null==e?L.Z:"object"==typeof e?(0,M.Z)(e)?F(e[0],e[1]):y(e):U(e)};const P=function(e){if("function"!=typeof e)throw new TypeError("Expected a function");return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}};var k=o(28019),T=o(62304),Z=o(96842);const E=function(e,t){if(null==e)return{};var o=(0,k.Z)((0,Z.Z)(e),(function(e){return[e]}));return t=A(t),(0,T.Z)(e,o,(function(e,o){return t(e,o[0])}))};const R=function(e,t){return E(e,P(A(t)))};var z=o(93639),O=o(61022),W=o(66589),q=o(84736),V=o(73224),D=o(42983),B=o(59787),$=o(82665),Y=o(50279),G=o(25807),J=o(8129),K=o(2555),Q=o(94435);function H(e){return Boolean(e.id)}class X{constructor(){(0,B.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const o of(0,$.Z)(e,10)){const e=await Promise.all(o.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:o,onResult:l,onUpdateResult:i}=e,a=JSON.parse(JSON.stringify(e.req));let r=this.itemMap.get(o);if(null!==(t=r)&&void 0!==t&&t.promise&&(0,Y.Z)(r.req,a))try{return await r.promise}catch(s){(0,J.c6)("[MaterialPublishService] publish failed, start to retry",{id:o})}return r={promise:null,id:o,req:a,onResult:l,onUpdateResult:i},this.itemMap.set(o,r),r.promise=this.publishImpl(r),r.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),o=async(o,l)=>{try{const r={error:o,errorText:this.getErrorText(o),time:Math.round(performance.now()-t),resourceId:l};var i,a;if(H(e.req))await(null===(i=e.onUpdateResult)||void 0===i?void 0:i.call(e,{req:e.req,...r}));else await(null===(a=e.onResult)||void 0===a?void 0:a.call(e,{req:e.req,...r}))}catch(r){(0,J.RF)("[MaterialPublishService] callOnResult failed",r)}};let l;try{l=await this.postOrUpdate(e)}catch(i){throw e.promise=null,o(i,""),i}return await o(null,l.resource_id),l}async postOrUpdate(e){return H(e.req)?(await(0,Q.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,Q.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new K.B).timeout(5e3)])}catch(t){(0,J.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const o=performance.now(),l=new K.B,i={count:50,effect_types:t,uid:G.$.userInfo.uid,cursor:0};for(;performance.now()-o<5e3;){const t=await(0,Q.Js)(i).catch((()=>null));if(null!=t&&t.effect_item_list){const o=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>o.has(e))))return}await l.timeout(500)}}}var ee=o(1946),te=o(60251),oe=o(39486),le=o(82186),ie=o(893),ae=o(54847),re=o(57609),se=o(2514),ne=o(67078),ce=o(539),de=o(95218),ue=o(99181),me=o(56714),pe=o(17941),_e=o(21919),fe=o(46309),he=o(3718),ge=o(51654),ve=o(18370);const Ce=(0,l.createContext)(null),ye=()=>(0,l.useContext)(Ce);var be=o(11527);const Se=(0,i.Pi)((({className:e})=>{var t,o;const l=(0,d.$Y)(),i=ye(),a=i.materialListStore.selectedMaterial;return(0,be.jsx)(n.v,{className:e,groups:l,initGroup:c.nb.File,activeGroup:c.nb.File,resetExpandedGroupKey:null!==(t=null==a||null===(o=a.payload)||void 0===o?void 0:o.localId)&&void 0!==t?t:null,getStatus:e=>{var t;return e.key===c.id.CollectionNum&&!i.isFilterCountValid&&i.hasTriggeredImport?"error":"mainForm"!==i.mainFormLayout?"init":i.isCollectionCoverCardSelected?"success":a?null!==(t=a.payload)&&void 0!==t&&null!==(t=t.unmetRequirements)&&void 0!==t&&t.includes(e.key)?"error":"success":"init"}})}));var xe=o(38803),Ie=o(36775);const Fe=(0,i.Pi)((({className:e})=>{const t=ye(),{t:o}=(0,a.$)(),i=(0,l.useRef)(null),r=(0,l.useMemo)((()=>t.materialListStore.materialList.length),[t.materialListStore.materialList]),s=(0,l.useMemo)((()=>t.isAllReadyPublish),[t.isAllReadyPublish]);return(0,be.jsxs)(be.Fragment,{children:[(0,be.jsx)(xe.Z,{className:e,leftText:o("pc_sticker_import_zero_to_hundred_web",{X:r,Y:t.maxTotalCount}),isPublishDisabled:!s,isPublishing:t.isPublishing,needConfirmModalOnClose:t.needConfirmModalOnClose,onPublish:()=>t.uploadAndPublish(i.current)}),(0,be.jsx)(Ie.q,{ref:i,uploadStats:t.materialListStore.uploadStats,onRetryUpload:t.retryUpload,onCancel:t.isAllUploadedWatcher.stop,onShowUploadFail:t.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:t.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var Le=o(12390),Me=o(82725),we=o(84875),Ne=o.n(we),je=o(74474),Ue=o(99826);const Ae="root-CyHG0U",Pe="container-gVo1aR",ke="cardDragWrapper-zJCxOO",Te="card-Gf3Uuf",Ze="hover-right-r4hcXu",Ee="hover-left-eC5Wkd",Re=(0,i.Pi)((()=>{const e=ye(),{materialListStore:t}=e,o=(0,l.useCallback)(((e,o)=>{t.selectedId!==e.payload.localId&&t.selectMaterial(e.payload.localId)}),[t.selectMaterial]),i=(0,l.useCallback)(((t,o)=>{var l;return(0,be.jsx)(Ue.Z,{className:Ne()(Te,{[Ze]:"right"===o,[Ee]:"left"===o}),material:t,onClick:e.selectMaterial,isSelected:e.materialListStore.selectedId===t.payload.localId,onRemove:e.materialListStore.removeMaterial,onReimport:e.reimport},null===(l=t.payload)||void 0===l?void 0:l.localId)}),[e.reimport,e.selectMaterial,e.materialListStore.removeMaterial,e.materialListStore.selectedId]);return(0,be.jsx)("div",{className:Ae,children:(0,be.jsx)("div",{className:Pe,children:(0,be.jsx)(je.y,{list:t.materialList,renderCard:i,onMoveCard:t.dragInsert,className:ke,getId:e=>e.payload.localId,scrollAreaRef:e.materialListStore.scrollAreaRef,onCardClick:o})})})}));var ze=o(2237);const Oe="root-GNdXWA",We="coverWrapper-m2s_kd",qe="box-vldsSe",Ve="img-M22_Hp",De="editCover-TbZjiP",Be="disabled-hWdY5N",$e="icon-n04zn6";var Ye=o(84997);const Ge=(0,i.Pi)((e=>{const t=ye(),{t:o}=(0,a.$)(),{payload:i}=t.collection,r=((0,l.useMemo)((()=>{const e=t.materialListStore.materialList.length;return e<=t.maxTotalCount&&e>=t.getImportMinMaxCount().minCount&&!t.collection.payload.filterImg}),[t.materialListStore.materialList,t.collection.payload.filterImg]),(()=>{const{succeeded:e,pending:o,failed:l}=t.materialListStore.uploadStats;return e+o<de.Cz?{tooltip:null,percent:null}:null})()),{handleMouseEnter:s}=(0,Ye.w)({content:null==r?void 0:r.tooltip,cursor:"not-allowed"});return(0,be.jsx)("div",{className:Oe,children:(0,be.jsx)("div",{className:We,children:(0,be.jsxs)("div",{className:qe,children:[i.filterImg?(0,be.jsx)("img",{className:Ve,src:i.filterImg}):(0,be.jsx)(ze.t,{className:$e,iconWidth:28}),(0,be.jsx)("div",{className:Ne()(De,r&&Be),onMouseEnter:null!=r&&r.tooltip?s:void 0,onClick:e=>{r?e.stopPropagation():t.openFilterCollectionCoverEditor()},children:o("pc_stickers_release_cover_edit_web")})]})})})}));var Je=o(70252),Ke=(o(15443),o(63541)),Qe=o(76199),He=o(95471),Xe=o(45033),et=o(53803);const tt="root-Wz5Kiy",ot="input-V8uRBu",lt="businessCheckbox-HQ78x3",it=(0,i.Pi)((()=>{const{t:e}=(0,a.$)(),t=ye(),{formApi:o}=t;(0,l.useLayoutEffect)((()=>(null==o||o.reset(),null==o||o.setValues(t.collection,{isOverride:!0}),()=>{const e=null==o?void 0:o.getValues();e&&t.updateCollectionForm({is_vip:e.is_vip||!1,common_data:{...t.collection.common_data,title:e.common_data.title||"",description:e.common_data.description,is_original:e.common_data.is_original||!1,is_business:e.common_data.is_business||!1}})})),[]);const i=(e,o)=>{t.updateCollectionForm({common_data:{...t.collection.common_data,[o]:e}})},{getDisplayLength:r}=(0,Xe._)();return(0,be.jsxs)("div",{className:tt,children:[(0,be.jsx)(Ge,{}),(0,be.jsx)(Je.l,{fieldClassName:ot,label:e("pc_filter_collection_name"),field:"common_data.title",maxLength:de.Mc,allowEnter:!1,placeholder:e("pc_stickers_release_xy_name_web",{X:1,Y:r(de.Mc)}),rules:[{required:!0,message:""}],onChange:e=>i(e,"title")}),(0,be.jsx)(Je.l,{fieldClassName:ot,label:e("pc_filter_collection_description"),field:"common_data.description",maxLength:de.Mn,allowEnter:!1,placeholder:e("pc_stickers_release_xy_details_web",{X:1,Y:r(de.Mn)}),rules:[{required:!0,message:""}],onChange:e=>i(e,"description")}),!1,(0,be.jsx)(Ke.Z,{children:(0,be.jsxs)("div",{className:et.Z.authGroup,children:[(0,be.jsx)(Ke._,{text:e("pc_template_authorize_range_web")}),(0,be.jsxs)("div",{className:et.Z.right,children:[(0,be.jsx)(Qe.l,{noLabel:!0,field:"is_vip",sendLogService:t.sendLogServ}),(0,be.jsx)(He.R,{fieldClassName:lt,noLabel:!0,field:"common_data.is_business",vipField:"is_vip",authorSignService:t.authorSignService,getAuthFileUploadService:()=>t.authFileUploadServiceManager.ensure(t.collection.payload.localId),sendLogService:t.sendLogServ})]})]})})]})}));var at=o(69836);const rt="root-W9YKLd",st="selected-MfKVC9",nt="cover-Sg1bSx",ct="icon-NjGS_M",dt="textInfo-zYCck9",ut="title-PHGLK_",mt="description-W4AGHI",pt="statusBar-wU3FIA",_t="checkedStatusBar-YMzSep",ft=({className:e,selected:t,coverSrc:o,title:l,description:i,isInfoComplete:r,onClick:s})=>{const{t:n}=(0,a.$)(),{handleMouseEnter:c}=(0,Ye.S)();return(0,be.jsxs)("div",{className:Ne()(e,rt,t&&st),onClick:s,children:[(0,be.jsx)("div",{className:nt,children:o?(0,be.jsx)("img",{className:ct,src:o}):(0,be.jsx)(ze.t,{className:ct,iconWidth:28})}),(0,be.jsxs)("div",{className:dt,children:[(0,be.jsx)("div",{className:ut,onMouseEnter:c,children:l||n("pc_stickers_release_group_name_web")}),(0,be.jsx)("div",{className:mt,onMouseEnter:c,children:i||n("pc_stickers_release_details_recommend_web")})]}),r?(0,be.jsx)(at.Bo,{className:_t,text:n("pc_stickers_release_finish_fill_web")}):(0,be.jsx)(at.LU,{className:pt})]})},ht=(0,i.Pi)((e=>{const{className:t}=e,o=ye(),{common_data:{title:l,description:i},payload:a}=o.collection;return(0,be.jsx)(ft,{className:t,selected:o.isCollectionCoverCardSelected,coverSrc:null==a?void 0:a.filterImg,title:l,description:i||"",isInfoComplete:Boolean(l&&i),onClick:o.selectCollectionCoverCard})}));var gt=o(60681);const vt="collectionCard-SdYl10",Ct=(0,i.Pi)((({className:e})=>{const t=ye(),{t:o}=(0,a.$)(),i=(0,l.useCallback)((()=>t.isCollectionCoverCardSelected?(0,be.jsx)(it,{}):t.materialListStore.selectedMaterial&&(0,be.jsx)(gt.Z,{material:t.materialListStore.selectedMaterial,materialListStore:t.materialListStore,formApi:t.formApi,collectionId:t.collection.payload.localId})),[t.isCollectionCoverCardSelected,t.materialListStore.selectedMaterial,t.materialListStore,t.formApi]);return(0,s.pg)(t),(0,Le.O)({className:e,layout:t.mainFormLayout,uploadAreaProps:{titleForUploadArea:o("pc_sticker_release_drag_web"),titleForMainForm:o("pc_stickers_release_drag_in_web"),subTitle:".cube/.3dl",draggingTitle:o("pc_sticker_release_mouse_web"),disabled:t.isImportDisabled,disabledTooltip:"",onClick:t.openFilterPicker,onDrop:t.uploadDroppedAudioFiles},setFormApi:t.setFormApi,renderImportArea:e=>(0,be.jsxs)(be.Fragment,{children:[e,(0,be.jsx)(ht,{className:vt}),(0,be.jsx)(Re,{})]}),renderFormArea:i,scrollAreaRef:t.materialListStore.scrollAreaRef,onRetry:Me.cb})}));var yt=o(65546);const bt="page-nEVnn2",St="content-j9aRoI",xt="requirement-PCZk_y",It="mainForm-CMsd0V",Ft="footer-cJesUg",Lt=(0,i.Pi)((()=>{const e=function(){const e=(0,ie.WQ)(),t=(0,le.WQ)(e),o=new te.l,i=new me.v({itemType:D.Ab.FilterCollection}),a=(0,ce.G)({watch:()=>r.isAllUploaded}),r=(0,O.fv)((()=>({uploadConfigService:new oe.w,formApi:null,setFormApi:e=>{r.formApi=e},sendLogServ:i,authorSignService:new re.I({signScene:he.d.BusinessArtist}),authFileUploadServiceManager:new se.r({}),performanceTimingCollector:(0,ve.uY)(),isPublishing:!1,setIsPublishing:(0,W.aD)((e=>r.isPublishing=e)),mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return t.isImportLoading?"loading":"uploadArea"===r.mainFormLayoutAfterLoading&&ae.appModel.isInitFailed?"error":r.mainFormLayoutAfterLoading},get isFilterCountValid(){const e=r.materialListStore.materialList.length;return e>=de.Cz&&e<=de.OQ},collection:{effect_type:D.Ab.FilterCollection,common_data:{title:"",description:"",tags:[],source:Q.r0.UserPostPcCollection,is_original:!1,is_business:!1,web_extra:"",icon:{image_uri:""}},is_vip:!1,payload:{hasEverSelected:!1,localId:(0,ee.V)("filter-collection"),filterImg:"",isUploadFailed:!1,error:"",temporary:{Thumbnail:"",Upload:""}}},updateCollectionForm:(0,W.aD)((e=>{Object.assign(r.collection,e)})),pubServ:new X,isCollectionCoverCardSelected:!1,selectMaterial(t){r.isCollectionCoverCardSelected&&(r.isCollectionCoverCardSelected=!1),e.selectMaterial(t)},selectCollectionCoverCard(){e.selectMaterial(null),r.isCollectionCoverCardSelected=!0,r.collection.payload.hasEverSelected=!0},get maxTotalCount(){return de.OQ},get isImportDisabled(){return e.materialList.length>=r.maxTotalCount},get needConfirmModalOnClose(){return e.materialList.length>0},materialListStore:e,importLoadingStore:t,getImportMinMaxCount(){const t=e.materialList.length;return{minCount:Math.max(1,de.Cz-t),maxCount:Math.max(0,r.maxTotalCount-t),maxTotalCount:r.maxTotalCount}},get isAllReadyPublish(){var t,o;return e.materialList.length>=de.Cz&&e.materialList.length<=r.maxTotalCount&&e.isReadyToPublish&&r.collection.payload.filterImg&&(null===(t=r.collection.common_data)||void 0===t?void 0:t.title)&&(null===(o=r.collection.common_data)||void 0===o?void 0:o.description)},handleLoading(){r.materialListStore.materialList.length&&"uploadArea"===r.mainFormLayoutAfterLoading&&(t.showImportLoading(),r.selectCollectionCoverCard(),r.mainFormLayoutAfterLoading="mainForm",r.collection.is_vip=(0,pe.K)(_e.YW.OriginalForSubscription))},hasTriggeredImport:!1,openFilterPicker(){o.lock(de.dr,(async()=>{i.sendUploadActionLog(r),await e.openFilterPicker({...r.getImportMinMaxCount(),source:Q.r0.UserPostPcCollection,collectionId:r.collection.payload.localId}),r.hasTriggeredImport=!0,r.handleLoading()}))},uploadDroppedAudioFiles(){o.lock(de.dr,(async()=>{i.sendUploadActionLog(r),await e.uploadDroppedFilterFiles({...r.getImportMinMaxCount(),source:Q.r0.UserPostPcCollection,collectionId:r.collection.payload.localId}),r.hasTriggeredImport=!0,r.handleLoading()}))},reimport(t){o.lock(de.dr,(async()=>{await e.reimportFilterFilePicker({...r.getImportMinMaxCount(),source:Q.r0.UserPostPcCollection,oldId:t.payload.localId}),r.handleLoading()}))},async openFilterCollectionCoverEditor(){const t=await ue.Z.openFilterCollectionCoverImage({...await r.uploadConfigService.getUploadConfigs("openFilterCollectionCoverImage"),filters:e.materialList.map((e=>({id:e.payload.localId}))),collectionId:r.collection.payload.localId});"Success"===t.result&&(0,W.z)((()=>{r.collection.payload.filterImg="",r.collection.common_data.icon.image_uri="",r.collection.payload.temporary.Thumbnail=t.temporaryId,r.collection.payload.temporary.Upload=t.temporaryId})),"Error"===t.result&&(r.collection.payload.isUploadFailed=!0,r.collection.payload.error=t.error)},get isAllUploaded(){const{pending:e,failed:t}=r.materialListStore.uploadStats,o=Boolean(r.collection.common_data.icon.image_uri);return!e&&!t&&o},sendUploadProgressModalShowErrorLog(){const e=r.materialListStore.materialList.filter((e=>e.payload.isUploadFailed)).map((e=>({error_report:e.payload.error,collection_detail:"collection_material"})));r.collection.payload.isUploadFailed&&e.push({collection_detail:"collection_cover",error_report:r.collection.payload.error}),i.sendMaterialPublishErrorLog(e)},async retryUpload(){const e=r.materialListStore.materialList.filter((e=>e.payload.isUploadFailed)),t=r.collection.payload.isUploadFailed?[r.collection.payload.localId]:[];return r.materialListStore.retryUpload(e,t)},isAllUploadedWatcher:a,asyncFormData(){var t;const o=null===(t=r.formApi)||void 0===t?void 0:t.getValues();if(o)if(r.isCollectionCoverCardSelected)r.updateCollectionForm({is_vip:o.is_vip||!1,common_data:{...r.collection.common_data,title:o.common_data.title||"",description:o.common_data.description,is_original:o.common_data.is_original||!1,is_business:o.common_data.is_business||!1}});else{const t=r.materialListStore.selectedMaterial;if(!t)return;e.updateFormState(t,{is_vip:o.is_vip||!1,common_data:{...t.common_data,title:o.common_data.title||"",description:o.common_data.description,is_original:o.common_data.is_original||!1,is_business:o.common_data.is_business||!1}})}},async uploadAndPublish(e){r.asyncFormData(),i.sendPageActionLog({action:"publish"}),r.isAllUploaded||(await r.retryUpload(),null==e||e.show(),await r.isAllUploadedWatcher.start());try{await r.publishImpl()}finally{null==e||e.hide()}},async publishImpl(){try{r.setIsPublishing(!0);const{collection:t}=r,o=e.materialList.map((e=>{const o=(0,ne.pn)({isVip:t.is_vip,isBusiness:t.common_data.is_business});return{id:e.payload.localId,req:{...(0,z.Z)(e,["payload"]),...o.root,common_data:{...e.common_data,is_original:t.common_data.is_original,...o.commonData}},onResult:t=>{i.sendMaterialPublishLog({publishResult:t,filter:e,logPrefix:"[CollectionStore]"})}}}));(0,J.c6)("[CollectionStore] filters publish start",{ids:o.map((e=>e.id))});const l=(await r.pubServ.batchPublish(o)).map((e=>e.resource_id));(0,J.c6)("[CollectionStore] filters publish done",{resourceIdList:l});const a=(0,ne.pn)({isVip:t.is_vip,isBusiness:t.common_data.is_business,authFiles:r.authFileUploadServiceManager.getUploadedFiles(t.payload.localId)}),{resource_id:s}=await r.pubServ.publish({id:t.payload.localId,req:{...(0,z.Z)(t,["payload"]),...a.root,common_data:{...t.common_data,...a.commonData},collection_info:{resource_id_list:l}},onResult:e=>{i.sendMaterialCollectionPublishLog({publishResult:e,collection:t})}});await r.pubServ.pollUntilAllInEffectList({ids:[s],types:[D.Ab.FilterCollection]}),(0,J.c6)("[CollectionStore] poll done"),q.FN.success(V.I18n.t("pc_filter_release_successful")),(0,fe.ZM)({effect_type:D.Ab.FilterCollection}),setTimeout((()=>(0,fe.Nt)({item_type:D.Ab.FilterCollection})),1e3)}catch(t){q.FN.error(V.I18n.t("pc_sticker_release_failed_retry_web")),(0,J.RF)("[CollectionStore] publish fail",t)}finally{r.setIsPublishing(!1)}},handleCollectionProcessResult(e){if(e.collectionId===r.collection.payload.localId){if("Success"===e.result)switch(e.type){case"Thumbnail":const{base64:t}=e;(0,W.z)((()=>{r.collection.payload.filterImg=`data:;base64,${t}`}));break;case"Upload":const{uri:o}=e;r.collection.common_data.icon.image_uri=o;break;default:return}"Error"===e.result&&(r.collection.payload.isUploadFailed=!0,"Upload"===e.type&&(r.collection.common_data.icon.image_uri=""))}},handleFilterFileProcessResult(t){r.handleCollectionProcessResult(t);const o=e.getMaterial(t.id);if(!o)return;const l=t.temporaryId===o.payload.temporary[t.type];if("Success"===t.result)switch(t.type){case"Thumbnail":if(!l)return;const{base64:i}=t;e.updateFormState(o,{payload:{...o.payload,filterImg:`data:;base64,${i}`}});break;case"FilterImg":if(!l)return;const{sourceUri:a,filterUri:r}=t;e.updateUploadResp(o,{sourceUri:a,filterUri:r});break;case"FilterFile":const{fileUri:s}=t;e.updateUploadResp(o,{fileUri:s});break;default:return}if("Error"===t.result){if("FilterImg"===t.type&&l){const{sourceUri:l,filterUri:i}=t;e.updateUploadResp(o,R({sourceUri:l,filterUri:i},u))}e.updateFormState(o,{payload:{...o.payload,isUploadFailed:!0}})}}})));return(0,ge.u)({watch:()=>r.needConfirmModalOnClose}),(0,l.useEffect)((()=>{window.store=r;const e=ue.Z.registerFilterFileProcessResultEvent(r.handleFilterFileProcessResult);return r.authorSignService.init(),r.performanceTimingCollector.addRenderTiming(ve.Pk),()=>{e(),t.destroy()}}),[]),r}(),{t}=(0,a.$)(),{selectedMaterial:o}=e.materialListStore;(0,l.useMemo)((()=>e.materialListStore.materialList.length?e.isCollectionCoverCardSelected?e.collection:o:null),[e.isCollectionCoverCardSelected,e.collection,o]);return(0,r.F)({title:t("pc_filter_release_collection"),pid:"filter-publish-collection"}),(0,yt.d)(),(0,s.t9)(e.sendLogServ),(0,be.jsx)(Ce.Provider,{value:e,children:(0,be.jsxs)("div",{className:bt,children:[(0,be.jsxs)("div",{className:St,children:[(0,be.jsx)(Se,{className:xt}),(0,be.jsx)(Ct,{className:It})]}),(0,be.jsx)(Fe,{className:Ft})]})})}))}}]);