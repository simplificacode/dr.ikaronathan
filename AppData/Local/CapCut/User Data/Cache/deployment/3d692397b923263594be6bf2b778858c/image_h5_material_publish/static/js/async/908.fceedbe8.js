"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[908],{28747:(e,t,s)=>{s.d(t,{u:()=>A});var n=s(50959),r=s(10422),l=s(84736),a=s(26800),i=s(68277),c=s(45599),o=s(23479),u=s(25807),d=s(69905),m=s(60251),p=s(8129),f=s(86439),g=s(94435),v=s(16743),h=s(84875),w=s.n(h);const _="tag-ZaY7YS",x="selected-umR1Vs",b="disabled-A37DzB";var E=s(11527);const y=({className:e,value:t,selected:s,disabled:n,onClick:r})=>(0,E.jsx)(l.Vp,{className:w()(e,_,s&&x,n&&b),color:s?"cyan":void 0,onClick:()=>null==r?void 0:r(t),children:t},t),N="block-smxiey",Z="title-aqS4Cg",j="content-IyBLdN",S="loading-QuFv_G",I="text-ukrQOj",k=({className:e,title:t,loading:s,loadingText:r,value:a,options:i,onSelect:c})=>{const o=(0,n.useCallback)((e=>a.includes(e)),[a]),u=(0,n.useMemo)((()=>i.filter((e=>!a.includes(e)))),[a,i]);return 0===u.length?null:(0,E.jsxs)("div",{className:w()([N,e]),children:[(0,E.jsx)("p",{className:Z,children:t}),(0,E.jsx)("div",{className:j,children:s?(0,E.jsxs)("div",{className:S,children:[(0,E.jsx)("span",{className:I,children:r}),(0,E.jsx)(l.yC,{size:"small"})]}):u.map((e=>(0,E.jsx)(y,{selected:o(e),value:e,onClick:()=>c(e)},e)))})]})},R=(0,o.Pi)((({value:e,onSelect:t})=>{const[s,r]=(0,n.useState)([]),{t:l}=(0,c.$)();return(0,n.useEffect)((()=>{const e=(0,d.cF)(d.Qt.TagEachUser,u.$.userInfo.uid).get();r(e)}),[u.$.userInfo.uid,e]),(0,E.jsx)(k,{title:l("pc_recently_used_web"),value:e,options:s,onSelect:t})})),M=((0,o.Pi)((({title:e,uri:t,value:s,itemType:r,onSelect:l})=>{const[o,u]=(0,n.useState)([]),[d,m]=(0,n.useState)([]),[p,f]=(0,n.useState)(!1),v=(0,n.useRef)({}),{t:h}=(0,c.$)(),w=(0,n.useMemo)((()=>[...d,...o]),[o,d]),_=(0,a.Z)((e=>{const{title:t,uri:s}=e;return t?v.current.cvid&&v.current.uri===s?{cvid:v.current.cvid,title:t}:s?{image_uri:s,title:t}:null:null})),x=(0,n.useCallback)((async()=>{try{f(!0);const s=_({title:e,uri:t});await Promise.all([s&&(0,g.Uz)(s).then((e=>{m(e.cv_tags),v.current.cvid=e.cvid,s.image_uri&&(v.current.uri=s.image_uri)})),!v.current.selfConfigTagsReady&&(0,g.On)({effect_type:r}).then((e=>{u(e.rec_tags),v.current.selfConfigTagsReady=!0}))])}finally{f(!1)}}),[e,t,r]);return(0,i.Z)(x,500,[x]),(0,n.useEffect)((()=>{x()}),[]),(0,E.jsx)(k,{title:h("recommend_signature_web"),loading:p,loadingText:h("loading_web"),value:s,options:w,onSelect:l})})),"tagSelect-KEPqcU"),T="dropItem-bpnHuZ",C="suggestListDropdown-fV0lMc",L=(0,o.Pi)((({recommendConfig:e,value:t=[],itemType:s,disabled:o,disableRecommend:h,disableLatest:w,onChange:_,placeholder:x,max:b=15,temporaryId:N,ignoreAddTagOnBlurSelector:Z})=>{const j=(0,n.useRef)(!1),[S,I]=(0,n.useState)(""),[k,L]=(0,n.useState)(""),A=(0,n.useRef)(!1),q=A.current?k:S,[P,U]=(0,n.useState)([]),[$,F]=(0,n.useState)([]),{t:O}=(0,c.$)(),B=e=>(0,d.cF)(d.Qt.TagEachUser,u.$.userInfo.uid).set("add",[e]),D=(0,a.Z)((e=>{F(S?e:[])}));(0,i.Z)((async()=>{if(!s||!S)return;const e=await(0,g.EO)({query:S,count:10}),t=(null==e?void 0:e.sug_tags)||[];D(t)}),500,[S,s]),(0,n.useEffect)((()=>{S||F([])}),[S]);const J=(0,n.useCallback)((e=>{if(b&&e.length>b)return l.FN.error(O("pc_stickers_release_max_tag_web",{X:b})),void(null==_||_(e.slice(0,b)));null==_||_(e)}),[_]),Q=(0,a.Z)((e=>{t.includes(e)||J([...t,e])})),V=(0,n.useMemo)((()=>new m.l),[]),z=(0,a.Z)((async e=>{const s=await V.lock("",(async()=>{if(t.includes(e))return!0;let s=!1;try{const t=await(0,g._K)({words:e,scene:g.Xb.Tag});s=!1===(null==t?void 0:t.is_hit)}catch(n){return(0,p.RF)("[TagSelect] call checkAntiDirt failed",n,{tag:e}),l.FN.error(O("pc_tag_retry_web")),!1}return s?(Q(e),!0):((0,p.c6)("[TagSelect] checkAntiDirt not passed",{tag:e}),l.FN.error(O("pc_tag_illegal_fail_web")),!1)}));return null!=s&&s})),Y=(0,a.Z)((e=>{if(0===e.length)return;const s=t.filter((t=>!e.includes(t)));J(s)})),G=(0,n.useRef)(null),{saveSelectionIfNeeded:H}=(0,v.u)({getInputElem:()=>{var e;return null===(e=G.current)||void 0===e?void 0:e.inputRef.current}}),K=e=>{const t=(0,f.aF)(e,30);H(t),I(t)},X=(0,a.Z)((e=>{K(""),t.includes(e)?Y([e]):(Q(e),B(e))})),W=e=>{const t=P.includes(e);U(t?P.filter((t=>t!==e)):[...P,e])},ee=(0,a.Z)((()=>{Y(P),U([])})),te=(0,a.Z)((()=>G.current&&G.current.inputRef.current&&G.current.tagInputRef.current?{tagInput:G.current,tagInputElem:G.current.tagInputRef.current,inputElem:G.current.inputRef.current}:null)),se=(0,a.Z)((e=>{const t=te();return!!(t&&e&&e instanceof Element)&&e.closest(".semi-tagInput")===t.tagInputElem})),ne=(0,a.Z)((e=>!!(e&&e instanceof Element)&&null!==e.closest(".semi-tag"))),re=(0,a.Z)((e=>{const t=e.target,s=te();if(!s||!se(t))return;const{tagInput:n,tagInputElem:r,inputElem:l}=s,{selectionStart:a,selectionEnd:i}=l;return P.length>0&&ne(t)?(ee(),null==l||l.setSelectionRange(0,0),void n.focus()):void 0})),le=(0,a.Z)((e=>{const t=e.target;te()&&se(t)&&ne(t)&&(se(e.relatedTarget)&&ne(e.relatedTarget)||U([]))}));(0,n.useEffect)((()=>{const e=e=>{"Delete"===e.code||"Backspace"===e.code?(j.current=!0,re(e)):j.current=!1};return window.addEventListener("keydown",e,!0),window.addEventListener("blur",le,!0),()=>{window.removeEventListener("keydown",e,!0),window.removeEventListener("blur",le,!0)}}),[]);const ae=(0,a.Z)((e=>{e.replace(/ {1,}/g,"")===S.replace(/ {1,}/g,"")&&K("")})),ie=async e=>{const[t]=e;Promise.resolve().then((()=>K(S)));const s=t.replace(/ {1,}/g,"");if(0===s.length)return;await z(s)&&(B(s),ae(S))},ce=async e=>{if(A.current)return void L(e);const t=e.replace(/ {1,}$/,""),s=t.replace(/ {1,}/g,"");if(K(t),t===e||!t||j.current)return;await z(s)&&(B(s),ae(S))};(0,n.useEffect)((()=>{var e;const t=null===(e=G.current)||void 0===e?void 0:e.inputRef.current;if(!t)return;const s=()=>{A.current=!0,L(t.value)},n=()=>(0,r.unstable_batchedUpdates)((()=>{A.current=!1,L(""),ce(t.value)}));return t.addEventListener("compositionstart",s),t.addEventListener("compositionend",n),()=>{t.removeEventListener("compositionstart",s),t.removeEventListener("compositionend",n)}}),[]);(0,n.useEffect)((()=>{N&&I("")}),[N]);return(0,E.jsxs)("div",{className:M,children:[(0,E.jsx)(l.Lt,{position:"bottomLeft",trigger:"focus",className:C,style:{maxHeight:200,overflow:"scroll"},render:(0,E.jsx)(l.Lt.Menu,{children:$.map((e=>(0,E.jsx)(l.Lt.Item,{className:T,onClick:()=>X(e),children:e},e)))}),children:(0,E.jsx)(l.EG,{ref:G,inputValue:q,onInputChange:ce,value:t,placeholder:x,renderTagItem:(e,t,s)=>(0,E.jsx)(y,{value:e,selected:P.includes(e),disabled:o,onClick:W},e),onAdd:ie,onBlur:e=>{if(e.relatedTarget&&e.relatedTarget instanceof Element){const t=[`.${C}`,Z].filter((e=>e)).join(",");if(null!==e.relatedTarget.closest(t)||ne(e.relatedTarget))return}ie([S])},disabled:o})}),!1,!o&&!w&&(0,E.jsx)(R,{value:t,onSelect:X})]})})),A=(0,l.Q2)(L)},68954:(e,t,s)=>{s.d(t,{S8:()=>r});var n=s(42983);n.Ab.Emoticons,n.Ab.Sticker,n.Ab.StickerCollection,n.Ab.Filter,n.Ab.FilterCollection,n.Ab.Video,n.Ab.AudioEffect;const r=40},69836:(e,t,s)=>{s.d(t,{ir:()=>_});var n=s(50959),r=s(84875),l=s.n(r),a=s(45599),i=s(82346),c=s(96426),o=s(85083),u=s(88623),d=s(84997),m=s(40699),p=s(96305),f=s(11527);const g=e=>{const{className:t}=e,{t:s}=(0,a.$)(),{handleMouseEnter:n}=(0,d.S)();return(0,f.jsxs)("div",{className:l()(p.Z.root,t),children:[(0,f.jsx)(i.a,{className:p.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,f.jsx)("div",{className:p.Z.text,onMouseEnter:n,children:s("pc_stickers_release_in_web")})]})},v=e=>{const{className:t,tooltip:s}=e,{t:r}=(0,a.$)(),{handleMouseEnter:i}=(0,d.w)({content:s,className:p.Z.tooltip}),o=(0,n.useRef)(null),{setIsMarqueeLoopRunning:u,reactNode:g}=(0,m.J)({text:r("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>o.current});return(0,f.jsxs)("div",{className:l()(p.Z.root,t,p.Z.error),onMouseEnter:e=>{u(!0),i(e)},onMouseLeave:()=>u(!1),children:[(0,f.jsx)(c.r,{className:p.Z.icon}),(0,f.jsx)("div",{ref:o,className:p.Z.text,children:g})]})},h=e=>{const{className:t,text:s}=e,{handleMouseEnter:n}=(0,d.S)();return(0,f.jsxs)("div",{className:l()(p.Z.root,t,p.Z.checked),children:[(0,f.jsx)(u.r,{className:p.Z.icon}),(0,f.jsx)("div",{className:p.Z.text,onMouseEnter:n,children:s})]})},w=e=>{const{className:t}=e,{t:s}=(0,a.$)(),{handleMouseEnter:n}=(0,d.S)();return(0,f.jsxs)("div",{className:l()(p.Z.root,t),children:[(0,f.jsx)("div",{className:l()(p.Z.icon,p.Z.yellowIcon),children:(0,f.jsx)("div",{className:p.Z.yellowPoint})}),(0,f.jsx)("div",{className:p.Z.text,onMouseEnter:n,children:s("pc_stickers_release_editing_web")}),(0,f.jsx)(o.r,{className:p.Z.icon})]})},_=e=>{const{className:t,loading:s,invalid:n,errorToolip:r,isInfoComplete:l,title:a}=e;return s?(0,f.jsx)(g,{className:t}):n?(0,f.jsx)(v,{className:t,tooltip:r}):l?(0,f.jsx)(h,{className:t,text:a}):(0,f.jsx)(w,{className:t})}},31086:(e,t,s)=>{s.d(t,{Z:()=>m,f:()=>u});var n=s(59787),r=s(82665),l=s(50279),a=s(25807),i=s(8129),c=s(2555),o=s(94435);const u=10;function d(e){return Boolean(e.id)}class m{constructor(){(0,n.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const s of(0,r.Z)(e,u)){const e=await Promise.all(s.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:s,onResult:n,onUpdateResult:r}=e,a=JSON.parse(JSON.stringify(e.req));let c=this.itemMap.get(s);if(null!==(t=c)&&void 0!==t&&t.promise&&(0,l.Z)(c.req,a))try{return await c.promise}catch(o){(0,i.c6)("[MaterialPublishService] publish failed, start to retry",{id:s})}return c={promise:null,id:s,req:a,onResult:n,onUpdateResult:r},this.itemMap.set(s,c),c.promise=this.publishImpl(c),c.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),s=async(s,n)=>{try{const a={error:s,errorText:this.getErrorText(s),time:Math.round(performance.now()-t),resourceId:n};var r,l;if(d(e.req))await(null===(r=e.onUpdateResult)||void 0===r?void 0:r.call(e,{req:e.req,...a}));else await(null===(l=e.onResult)||void 0===l?void 0:l.call(e,{req:e.req,...a}))}catch(a){(0,i.RF)("[MaterialPublishService] callOnResult failed",a)}};let n;try{n=await this.postOrUpdate(e)}catch(r){throw e.promise=null,s(r,""),r}return await s(null,n.resource_id),n}async postOrUpdate(e){return d(e.req)?(await(0,o.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,o.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new c.B).timeout(5e3)])}catch(t){(0,i.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const s=performance.now(),n=new c.B,r={count:50,effect_types:t,uid:a.$.userInfo.uid,cursor:0};for(;performance.now()-s<5e3;){const t=await(0,o.Js)(r).catch((()=>null));if(null!=t&&t.effect_item_list){const s=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>s.has(e))))return}await n.timeout(500)}}}}}]);