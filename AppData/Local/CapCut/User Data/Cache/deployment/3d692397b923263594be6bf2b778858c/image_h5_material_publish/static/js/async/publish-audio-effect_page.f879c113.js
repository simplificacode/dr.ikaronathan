"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[829],{42983:(e,i,a)=>{a.d(i,{Ab:()=>o});let o=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e}({})},81441:(e,i,a)=>{a.r(i),a.d(i,{default:()=>li});var o=a(23479),l=a(45599),t=a(50959),s=a(9608),r=a(73224);let n=function(e){return e.File="file",e}({}),d=function(e){return e.Format="format",e.FileDuration="fileDuration",e.RecommendFileSize="RecommendFileSize",e}({});const c={[n.File]:{[d.Format]:r.I18n.t("pc_sound_form"),[d.FileDuration]:r.I18n.t("pc_filter_time_limit"),[d.RecommendFileSize]:r.I18n.t("pc_filter_file_size_ten_m")}},u=100,p=10485760,m="ImportAudio";var A=a(93639),g=a(61022),f=a(66589),v=a(84736),h=a(42983),F=a(54847),_=a(60251),y=a(97311),x=a(68954),b=a(17941),C=a(21919),S=a(74235),w=a(94435);const L=e=>{const{id:i,path:a,duration:o,size:l=0}=e,t=(0,y.lm)(a),s=[];["mp3","wav"].includes(t)||s.push(d.Format),l>p&&s.push(d.RecommendFileSize),o>60&&s.push(d.FileDuration);const r=(0,S.YB)(a,{maxLength:x.S8});return{effect_type:h.Ab.AudioEffect,common_data:{title:r,description:"",tags:[],source:w.r0.UserPostPc,is_original:!1,is_business:!1,web_extra:"",icon:{image_uri:"",width:200,height:200},file:{file_uri:"",file_md5:"",size:l}},is_vip:(0,b.K)(C.YW.OriginalForSubscription),payload:{hasEverSelected:!1,itemId:void 0,unmetRequirements:s,localId:i,path:a,fileBase64:"",isUploadFailed:!1,uploadFailedText:""},audio:{audio_id:"",duration:o}}};var I=a(39486),E=a(8129),k=a(31086),R=a(21130),U=a(57609),j=a(2514),P=a(67078),N=a(539),M=a(98052);const B=new class{async openAudioFilePicker(e){(0,E.c6)("[JSB] openAudioFilePicker req --\x3e",{...(0,A.Z)(e,["objectUploadConfig","imageUploadConfig","videoUploadConfig"])});const i=await(e=>M.Jn.call("openAudioFilePicker",e))(e);return(0,E.c6)("[JSB] openAudioFilePicker resp <--",i),i}async uploadDroppedAudioFiles(e){var i;(0,E.c6)("[JSB] uploadDroppedAudioFiles req --\x3e",{...(0,A.Z)(e,["objectUploadConfig","imageUploadConfig","videoUploadConfig"])});const a=await(e=>M.Jn.call("uploadDroppedAudioFiles",e))(e);return(0,E.c6)("[JSB] uploadDroppedAudioFiles resp <--",{imagesCount:null==a||null===(i=a.audios)||void 0===i?void 0:i.length}),a}registerAudioFileProcessResultEvent(e){return(e=>{const i=i=>{i.data&&e(i.data)};return M.Jn.on("audioFileProcessResult",i),()=>M.Jn.off("audioFileProcessResult",i)})((i=>{(0,E.c6)(`[JSB] audioFileProcessResult {${null==i?void 0:i.id}}`,i),e(i)}))}async cancelAudioUpload(e){(0,E.c6)("[JSB] cancelAudioUploadRequest req --\x3e",{...e}),await(e=>M.Jn.call("cancelAudioUpload",e))(e)}};var T=a(46309),D=a(3718),W=a(51654),z=a(18370);const O=(0,t.createContext)(null),Q=()=>(0,t.useContext)(O);var V=a(11527);const Y=(0,o.Pi)((({className:e})=>{var i,a;const{t:o}=(0,l.$)(),r=(0,t.useMemo)((()=>{return[{key:n.File,title:o("pc_sound_specification"),instructions:(e=n.File,Object.entries(c[e]).map((([e,i])=>({key:e,title:i}))))}];var e}),[]),d=Q().selectedAudio;return(0,V.jsx)(s.v,{className:e,groups:r,initGroup:n.File,activeGroup:n.File,resetExpandedGroupKey:null!==(i=null==d||null===(a=d.payload)||void 0===a?void 0:a.localId)&&void 0!==i?i:null,getStatus:e=>{var i;return d?null!==(i=d.payload)&&void 0!==i&&null!==(i=i.unmetRequirements)&&void 0!==i&&i.includes(e.key)?"error":"success":"init"}})}));var Z=a(38803),q=a(36775);const K=(0,o.Pi)((({className:e})=>{const i=Q(),{t:a}=(0,l.$)(),o=(0,t.useRef)(null),s=(0,t.useMemo)((()=>i.audioList.length),[i.audioList]);return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(Z.Z,{className:e,leftText:a("pc_sticker_import_zero_to_hundred_web",{X:s,Y:u}),isPublishDisabled:!i.isAllReadyPublish,isPublishing:i.isPublishing,needConfirmModalOnClose:i.needConfirmModalOnClose,onPublish:()=>i.uploadAndPublish(o.current),beforeCancel:()=>{var e;return null===(e=i.audioRef.current)||void 0===e?void 0:e.pause()}}),(0,V.jsx)(q.q,{ref:o,uploadStats:i.uploadStats,onRetryUpload:i.retryUpload,onCancel:i.isAllUploadedWatcher.stop,onShowUploadFail:i.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:i.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var J=a(12390),G=a(82725),H=a(26800),$=a(84875),X=a.n($),ee=a(74474);var ie=a(36983),ae=a(69836),oe=a(503),le=a(79679);const te="root-l5vahz",se="statusBar-oVVULl",re="contextMenuItem-ELwi1D",ne=(0,o.Pi)((({className:e,audio:i,isSelected:a,onClick:o,onReimport:t,onRemove:s})=>{var r,d;const{t:u}=(0,l.$)(),{common_data:p,payload:m}=i,A=m.fileBase64,g=Boolean(null==m||null===(r=m.unmetRequirements)||void 0===r?void 0:r.length),f=Boolean(p.title&&(null===(d=p.tags)||void 0===d?void 0:d.length)),{handleContextMenu:v}=(0,le.D)({content:(0,V.jsx)(oe.m,{items:[{key:"reimport",render:({key:e,className:a})=>Boolean(g)&&(0,V.jsx)("div",{className:X()(a,re),onClick:()=>t(i),children:u("pc_material_release_import_again")},e)},{key:"remove",render:({key:e,className:a})=>(0,V.jsx)("div",{className:X()(a,re),onClick:()=>s(i),children:u("pc_material_release_delete")},e)}]})});return(0,V.jsxs)("div",{className:X()(e,te),onClick:()=>{o(i.payload.localId)},children:[(0,V.jsx)(ie.Y,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAK/SURBVHgB7Z0xbhNBGIXfOiYQiAFRBNLQcQA4ABegRIIDpEWipKCloEWCMgegoEWihQPQE/oIOgMxEEzM/zwzhJDYsvOKnZXeJ72ss+vq0//PjFbr2Qb/MZlMzsbhfGQt0och+znDpml+/3uhKR9CHD9fjlyIfM85gCH9HLrZQxI54YWpwCzvKpKwrzwFcxL0RImU+YkSe/kCK28c+QLLmwfdfIuwjS/xRC+qbwVpzNuDWRRKXOd80cSfK0it+wNmGdjKB2zhVaT2NcvBgluzwNPDcbDfg5GwQBELFLFAEQsUsUARCxSxQBELFLFAEQsUsUARCxSxQBELFLFAEQsUsUARCxSxQBELFLFAEQsU6YLA25E3kceRa6iMLgi8ERlE7kReRLZQEV1q4buR90gCXyFVZut0SeBu5EnkUf5/HRXQxUd43+VUgWdhEQsUqamFb0buI826HO92Ii9ROTUI5GTwNHIL6QF3jm9c71EmZ9odVEwNArksobxnOFpxm5HnqGS5Mou2x8BSads43q5s4wdIVVktbQss1fV6xnVKrGbJchJtCxzk4+6c78y71jptCyztuTnnO5yVP6BS2hZYWvfejOscI9nmH1EpbQvkL344+3IieYijt6u4LuTdF7bwNiqFv1S6HsfPaJctHN6mojCuDQc4nIlrHQc3ahFIOA6yEstdlrc5NVOVwC6y4ZsJIhYoYoEiFihigSIWKGKBIhYoYoEiFihigSIWKGKBIhYoYoEiFihigSIWKGKBIhYoYoEiFihigSIUyN0rV2CWhc72KZAbbp+DWZYzkV8UOELaBrmBWZSyIfew1zTNT+R9kWEWhfJG4W5cJpEhUk9ToitxNnRzEenh/GE5MWUymW4Lz+3Ny67mY3h75AKLi/ME33BRXkYwfVHDsWoLkbRLkRwkV2EIC4mT7SgPeX/5A5B3gyFEXzzuAAAAAElFTkSuQmCC",isSelected:a,isInvalid:Boolean(g),size:80,onContextMenu:e=>{v(e),o(i.payload.localId)}}),(0,V.jsx)(ae.ir,{className:se,loading:!A,invalid:g,errorToolip:g&&(null===(h=i.payload)||void 0===h||null===(h=h.unmetRequirements)||void 0===h?void 0:h.map((e=>{const i=c[n.File][e];return i?(0,V.jsx)("div",{children:i},e):null}))),isInfoComplete:f,title:p.title})]});var h})),de="root-vGN3fF",ce="container-Z43yJw",ue="cardDragWrapper-tHHY7g",pe="audioCard-Jqin4l",me="hover-right-UhQwRW",Ae="hover-left-glFzow",ge=(0,o.Pi)((()=>{const e=Q(),i=(0,H.Z)(((i,a)=>{e.selectedId!==i.payload.localId&&e.selectMaterial(i.payload.localId)})),a=(0,H.Z)(((i,a)=>{var o;return(0,V.jsx)(ne,{className:X()(pe,{[me]:"right"===a,[Ae]:"left"===a}),audio:i,onClick:e.selectMaterial,isSelected:e.selectedId===i.payload.localId,onRemove:e.removeAudio,onReimport:e.reimportAudio},null===(o=i.payload)||void 0===o?void 0:o.localId)}));return(0,V.jsx)("div",{className:de,children:(0,V.jsx)("div",{className:ce,children:(0,V.jsx)(ee.y,{list:e.audioList,renderCard:a,onMoveCard:e.dragInsert,className:ue,getId:e=>e.payload.localId,scrollAreaRef:e.scrollAreaRef,onCardClick:i})})})}));var fe,ve,he,Fe,_e,ye=a(70252),xe=a(28747),be=(a(15443),a(76199)),Ce=a(95471),Se=a(45033),we=a(63541);function Le(){return Le=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Le.apply(this,arguments)}const Ie=e=>t.createElement("svg",Le({xmlns:"http://www.w3.org/2000/svg",width:18,height:18,fill:"none",viewBox:"0 0 18 18"},e),fe||(fe=t.createElement("circle",{cx:9,cy:9,r:9,fill:"#29292D",opacity:.5})),ve||(ve=t.createElement("path",{fill:"#FAFAFA",fillRule:"evenodd",d:"M6.975 12.15v-6.3 6.3Z",clipRule:"evenodd"})),he||(he=t.createElement("path",{stroke:"#FAFAFA",strokeLinejoin:"bevel",strokeWidth:1.62,d:"M6.975 12.15v-6.3"})),Fe||(Fe=t.createElement("path",{fill:"#FAFAFA",fillRule:"evenodd",d:"M11.025 12.15v-6.3 6.3Z",clipRule:"evenodd"})),_e||(_e=t.createElement("path",{stroke:"#FAFAFA",strokeLinejoin:"bevel",strokeWidth:1.62,d:"M11.025 12.15v-6.3"})));var Ee,ke;function Re(){return Re=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Re.apply(this,arguments)}const Ue=e=>t.createElement("svg",Re({xmlns:"http://www.w3.org/2000/svg",width:18,height:18,fill:"none",viewBox:"0 0 18 18"},e),Ee||(Ee=t.createElement("circle",{cx:9,cy:9,r:9,fill:"#29292D",opacity:.5})),ke||(ke=t.createElement("path",{fill:"#FAFAFA",fillRule:"evenodd",stroke:"#FAFAFA",strokeLinejoin:"bevel",strokeWidth:1.35,d:"m12.375 9-5.25 3.375v-6.75L12.375 9Z",clipRule:"evenodd"}))),je="icon-box-YEUJAD",Pe="content-lkyAWs",Ne="iconWraper-YgV3wS",Me="icon-HXRhiF",Be="desc-JTU6u4",Te="text-aeq8p1",De="time-Y_QjIl",We=e=>`${`${Math.floor(e/60)}`.padStart(2,"0")}:${`${Math.floor(e%60)}`.padStart(2,"0")}`,ze=({audio:e,audioRef:i})=>{const{fileBase64:a}=e.payload,[o,l]=(0,t.useState)(!1),[s,r]=(0,t.useState)("00:00"),[n,d]=(0,t.useState)(0),c=(0,t.useMemo)((()=>We(n)),[n]),u=(0,t.useMemo)((()=>{var i;return(0,S.Bc)((null===(i=e.payload)||void 0===i?void 0:i.path)||"")}),[e]);return(0,t.useEffect)((()=>{if(i.current)return l(!1),r("00:00"),i.current.load(),()=>{var e;null===(e=i.current)||void 0===e||e.pause()}}),[a,i]),(0,V.jsxs)("div",{className:je,children:[(0,V.jsxs)("audio",{ref:i,onCanPlay:()=>{var e;d(null===(e=i.current)||void 0===e?void 0:e.duration)},onEnded:()=>l(!1),onPause:()=>l(!1),onTimeUpdate:()=>{var e;const a=We((null===(e=i.current)||void 0===e?void 0:e.currentTime)||0);r(a)},children:[(0,V.jsx)("source",{src:`data:audio/x-mpeg;base64,${a}`}),(0,V.jsx)("source",{src:`data:audio/wav;base64,${a}`})]}),(0,V.jsxs)("div",{className:Pe,onClick:()=>{var e,a;o?null===(e=i.current)||void 0===e||e.pause():null===(a=i.current)||void 0===a||a.play(),l(!o)},children:[o?(0,V.jsx)("div",{className:Ne,children:(0,V.jsx)(Ie,{className:Me})}):(0,V.jsx)("div",{className:Me,children:(0,V.jsx)(Ue,{})}),(0,V.jsxs)("div",{className:Be,children:[(0,V.jsx)("div",{className:Te,children:u}),(0,V.jsxs)("div",{className:De,children:[s," | ",c]})]})]})]})};var Oe=a(53803);const Qe="root-F4oZT7",Ve="label-JWNfR2",Ye="useAll-UNQhcm",Ze="input-K5QDCm",qe="businessCheckbox-gZGrLh",Ke=(0,o.Pi)((({audio:e})=>{const{t:i}=(0,l.$)(),a=Q();(0,t.useLayoutEffect)((()=>{var i,o;return null===(i=a.formApi)||void 0===i||i.reset(),null===(o=a.formApi)||void 0===o||o.setValues(e,{isOverride:!0}),()=>a.syncFormData(e)}),[e]);const{getDisplayLength:o}=(0,Se._)(),s=(i,o)=>{a.updateFormState(e,{common_data:{...e.common_data,[o]:i}})};return(0,V.jsxs)("div",{className:Qe,children:[(0,V.jsx)(ze,{audio:e,audioRef:a.audioRef}),(0,V.jsx)(ye.l,{fieldClassName:Ze,label:i("pc_filter_voice_effect_name"),field:"common_data.title",maxLength:x.S8,placeholder:i("pc_stickers_release_xy_name_web",{X:1,Y:o(x.S8)}),allowEnter:!1,rules:[{required:!0,message:""}],onChange:e=>s(e,"title")}),(0,V.jsxs)("div",{className:Ve,children:[(0,V.jsx)(xe.u,{fieldClassName:Ze,label:i("pc_stickers_release_tag_set_web"),placeholder:i("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"common_data.tags",itemType:h.Ab.AudioEffect,recommendConfig:{title:e.common_data.title},rules:[{required:!0,message:""}],onChange:e=>s(e,"tags"),temporaryId:e.payload.localId}),(0,V.jsx)("span",{className:Ye,onClick:()=>{var e;const{tags:i}=(null===(e=a.formApi)||void 0===e?void 0:e.getValue("common_data"))||{};null!=i&&i.length&&a.applyForTags({tags:i})},children:i("pc_material_release_apply_all")})]}),!1,(0,V.jsx)(we.Z,{onClickUseAll:()=>{var e;const i=null===(e=a.formApi)||void 0===e?void 0:e.getValues();i&&a.applyAuthSettingsToAll({isVip:i.is_vip,isOriginal:i.common_data.is_original,isBusiness:i.common_data.is_business})},children:(0,V.jsxs)("div",{className:Oe.Z.authGroup,children:[(0,V.jsx)(we._,{text:i("pc_template_authorize_range_web")}),(0,V.jsxs)("div",{className:Oe.Z.right,children:[(0,V.jsx)(be.l,{noLabel:!0,field:"is_vip",sendLogService:a.sendLogServ}),(0,V.jsx)(Ce.R,{fieldClassName:qe,noLabel:!0,field:"common_data.is_business",vipField:"is_vip",authorSignService:a.authorSignService,getAuthFileUploadService:()=>a.authFileUploadServiceManager.ensure(e.payload.localId),sendLogService:a.sendLogServ})]})]})})]})})),Je=(0,o.Pi)((({className:e})=>{const i=Q(),{t:a}=(0,l.$)(),o=(0,t.useCallback)((()=>i.selectedAudio&&(0,V.jsx)(Ke,{audio:i.selectedAudio})),[i.selectedAudio]),s=(0,t.useMemo)((()=>i.audioList.length>=u),[i.audioList]);return(0,R.pg)({mainFormLayout:i.mainFormLayout,sendLogServ:i.sendLogServ}),(0,J.O)({className:e,layout:i.mainFormLayout,uploadAreaProps:{titleForUploadArea:a("pc_material_release_click"),titleForMainForm:a("pc_stickers_release_drag_in_web"),subTitle:".mp3/.wav",draggingTitle:a("pc_sticker_release_mouse_web"),disabled:s,disabledTooltip:"",onClick:i.openAudioPicker,onDrop:i.droppedAudioFiles},setFormApi:i.setFormApi,renderImportArea:e=>(0,V.jsxs)(V.Fragment,{children:[e,(0,V.jsx)(ge,{})]}),renderFormArea:o,scrollAreaRef:i.scrollAreaRef,onRetry:G.cb})}));var Ge=a(12904),He=a(65546);const $e="page-1cbeHL",Xe="content-Y3uYfw",ei="requirement-zgTG7N",ii="mainForm-CN2Z8q",ai="footer-Klb8rU",oi=(0,o.Pi)((()=>{const e=function(){const{t:e}=(0,l.$)(),i=new _.l,a=new I.w,o=new R.D5({itemType:h.Ab.AudioEffect}),s=(0,N.G)({watch:()=>r.isAllUploaded}),r=(0,g.fv)((()=>({audioList:[],formApi:null,isPublishing:!1,pubServ:new k.Z,sendLogServ:o,authorSignService:new U.I({signScene:D.d.BusinessArtist}),authFileUploadServiceManager:new j.r({}),scrollAreaRef:(0,t.createRef)(),audioRef:(0,t.createRef)(),performanceTimingCollector:(0,z.uY)(),mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return"uploadArea"===r.mainFormLayoutAfterLoading&&F.appModel.isInitFailed?"error":r.mainFormLayoutAfterLoading},get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1}},get importMinMaxCount(){const e=r.audioList.length;return{minCount:1,maxCount:Math.max(0,u-e),maxTotalCount:u}},get needConfirmModalOnClose(){return r.audioList.length>0},selectedId:"",get selectedAudio(){return r.selectedId?r.getAudio(r.selectedId):null},getAudio:e=>{var i;return null!==(i=r.audioList.find((i=>{var a;return(null===(a=i.payload)||void 0===a?void 0:a.localId)===e})))&&void 0!==i?i:null},getAudioIndex:e=>r.audioList.findIndex((i=>{var a;return(null===(a=i.payload)||void 0===a?void 0:a.localId)===e})),selectMaterial(e){r.selectedId=e,r.selectedAudio&&(r.selectedAudio.payload.hasEverSelected=!0)},updateFormState(e,i){Object.assign(e,i)},setIsPublishing:(0,f.aD)((e=>r.isPublishing=e)),setFormApi:(0,f.aD)((e=>r.formApi=e)),applyForTags:({tags:e})=>{r.audioList.forEach((i=>{i.common_data.tags=e}))},applyAuthSettingsToAll:({isOriginal:e,isBusiness:i,isVip:a})=>{r.audioList.forEach((o=>{o.is_vip=Boolean(a),o.common_data.is_original=Boolean(e),o.common_data.is_business=Boolean(i)}))},dragInsert(e,i){const a=r.audioList.splice(e,1),o=e>i?i+1:i;r.audioList.splice(o,0,...a)},addAudios(e){0!==e.length&&(r.audioList=[...r.audioList,...e],r.selectMaterial(e[0].payload.localId),"uploadArea"===r.mainFormLayoutAfterLoading&&(r.mainFormLayoutAfterLoading="mainForm"))},async removeAudio(e){await B.cancelAudioUpload({id:e.payload.localId}),r.audioList=r.audioList.filter((i=>{var a,o;return(null===(a=i.payload)||void 0===a?void 0:a.localId)!==(null===(o=e.payload)||void 0===o?void 0:o.localId)}))},getUploadParams:async(e,i)=>(await a.refreshUploadConfigsIfNeeded({when:i,logPrefix:"[AudioStore]"}),{...await a.getUploadConfigs("openAudioPicker"),accept:"mp3-wav",maxFileDuration:60,maxFileSize:p,...e}),async handleAudioFileProcessResult(e){const i=r.getAudio(e.id);if(i)if("Success"===e.result)switch(e.type){case"AudioBase64":i.payload.fileBase64=e.base64;break;case"AudioFile":const{audio_id:a,size:o,file_uri:l}=e;i.audio.audio_id=a,i.common_data.file={file_md5:"",size:o,file_uri:l};break;default:return}else"Error"===e.result&&"AudioFile"===e.type&&(i.payload.isUploadFailed=!0,i.payload.uploadFailedText=e.error||"")},initAudios({audios:e}){if(!e.length)return[];const i=[];for(const a of e){const e=L(a);i.push(e)}return i},async openAudioPicker(){i.lock(m,(async()=>{try{o.sendPageActionLog({action:"mainForm"===r.mainFormLayout?"upload_more":"upload"});const e=await r.getUploadParams({...r.importMinMaxCount,multiple:!0},"openAudioPicker"),i=await B.openAudioFilePicker(e),a=r.initAudios(i);r.addAudios(a)}catch(e){(0,E.RF)("openAudioFilePicker jsb failed ",e,{action:"openAudioPicker"})}}))},async droppedAudioFiles(){i.lock(m,(async()=>{try{o.sendPageActionLog({action:"mainForm"===r.mainFormLayout?"upload_more":"upload"});const e=await r.getUploadParams({...r.importMinMaxCount,multiple:!0},"droppedAudioFiles"),i=await B.uploadDroppedAudioFiles(e),a=r.initAudios(i);r.addAudios(a)}catch(e){(0,E.RF)("uploadDroppedAudioFiles jsb failed ",e,{action:"droppedAudioFiles"})}}))},async reimportAudio(e){i.lock(m,(async()=>{var i;await B.cancelAudioUpload({id:e.payload.localId});const a=await r.getUploadParams({minCount:1,maxCount:1,maxTotalCount:1,multiple:!1},"reimportAudio"),o=await B.openAudioFilePicker(a),l=L(o.audios[0]),t=r.getAudioIndex(e.payload.localId);-1!==t&&(r.audioList[t]=l,r.selectMaterial(null===(i=l.payload)||void 0===i?void 0:i.localId))}))},isAllUploadedWatcher:s,async retryUpload(){const e=r.audioList.filter((e=>e.payload.isUploadFailed)).map((e=>e.payload.localId));if(!e.length)return;e.forEach((e=>{const i=r.getAudio(e);i&&(i.payload.isUploadFailed=!1)}));const i=await r.getUploadParams({multiple:!0,minCount:1,maxCount:e.length,maxTotalCount:e.length,retryUploadIds:e},"retryUpload");await B.openAudioFilePicker(i)},sendUploadProgressModalShowErrorLog(){const e=r.audioList.filter((e=>e.payload.isUploadFailed)).map((e=>({error_report:e.payload.uploadFailedText})));o.sendMaterialPublishErrorLog(e)},get uploadStats(){let e=0,i=0,a=0;return r.audioList.forEach((o=>{var l;o.payload.isUploadFailed?i+=1:(null===(l=o.common_data.file)||void 0===l?void 0:l.file_uri)&&o.audio.audio_id?e+=1:a+=1})),{pending:a,succeeded:e,failed:i}},get isAllReadyPublish(){const e=r.audioList.every((e=>{var i,a;return e.common_data.title&&(null===(i=e.common_data.tags)||void 0===i?void 0:i.length)&&!(null!==(a=e.payload.unmetRequirements)&&void 0!==a&&a.length)}));return r.audioList.length>0&&e},get isAllUploaded(){const{pending:e,failed:i}=r.uploadStats;return!e&&!i},syncFormData(e){var i;const a=null===(i=r.formApi)||void 0===i?void 0:i.getValues();e&&a&&r.updateFormState(e,{is_vip:a.is_vip||!1,common_data:{...e.common_data,title:a.common_data.title||"",tags:a.common_data.tags||[],is_original:a.common_data.is_original||!1,is_business:a.common_data.is_business||!1}})},async uploadAndPublish(e){var i;o.sendPageActionLog({action:"publish"}),null===(i=r.audioRef.current)||void 0===i||i.pause(),r.selectedAudio&&r.syncFormData(r.selectedAudio),r.isAllUploaded||(await r.retryUpload(),null==e||e.show(),await r.isAllUploadedWatcher.start());try{await r.publishImpl()}finally{null==e||e.hide()}},async publishImpl(){try{r.setIsPublishing(!0);const i=r.audioList.map((e=>{const i=(0,P.pn)({isVip:e.is_vip,isBusiness:e.common_data.is_business,authFiles:r.authFileUploadServiceManager.getUploadedFiles(e.payload.localId)});return{id:e.payload.localId,req:{...(0,A.Z)(e,["payload"]),...i.root,common_data:{...e.common_data,...i.commonData}},onResult:i=>{const{req:a,error:l,errorText:t,time:s,resourceId:n}=i;l||r.updateFormState(e,{payload:{...e.payload,itemId:n}}),o.sendMaterialPublishStatusLog({status:l?"fail":"success",time:s,error_type:t,publishParams:a,path:e.payload.path})}}}));(0,E.c6)("[AudioStore] audios publish start",{ids:i.map((e=>e.id))});const a=(await r.pubServ.batchPublish(i)).map((e=>e.resource_id));(0,E.c6)("[AudioStore] audios publish done",{resourceIdList:a}),await r.pubServ.pollUntilAllInEffectList({ids:a.slice(-k.f),types:[h.Ab.AudioEffect]}),(0,E.c6)("[AudioStore] poll done"),v.FN.success(e("pc_filter_release_successful")),(0,T.ZM)({effect_type:h.Ab.AudioEffect}),setTimeout((()=>(0,T.Nt)({item_type:h.Ab.AudioEffect})),1e3)}catch(i){v.FN.error(e("pc_sticker_release_failed_retry_web")),(0,E.RF)("[AudioStore] publish fail",i)}finally{r.setIsPublishing(!1)}}})));return(0,W.u)({watch:()=>r.needConfirmModalOnClose}),(0,t.useEffect)((()=>{window.store=r,a.uploadConfigsCache.update(),r.authorSignService.init(),r.performanceTimingCollector.addRenderTiming(z.Pk)}),[]),(0,t.useEffect)((()=>{const e=B.registerAudioFileProcessResultEvent(r.handleAudioFileProcessResult),i=(0,T.ih)((()=>{var e;return null===(e=r.audioRef.current)||void 0===e?void 0:e.pause()}));return()=>{e(),i()}}),[]),r}(),{t:i}=(0,l.$)();return(0,Ge.F)({title:i("pc_filter_voice_effect"),pid:"audio-publish-single"}),(0,He.d)(),(0,R.t9)(e.sendLogServ),(0,V.jsx)(O.Provider,{value:e,children:(0,V.jsxs)("div",{className:$e,children:[(0,V.jsxs)("div",{className:Xe,children:[(0,V.jsx)(Y,{className:ei}),(0,V.jsx)(Je,{className:ii})]}),(0,V.jsx)(K,{className:ai})]})})})),li=()=>(0,V.jsx)(oi,{})},74235:(e,i,a)=>{a.d(i,{Bc:()=>s,YB:()=>t,xB:()=>l});var o=a(86439);function l(e){const{len:i,i18n:a}=e,[o]=(a.language||"").split("-");return"zh"===o?Math.floor(i/2):i}function t(e,i){const a=e.split(/[\\/]/g).pop().replace(/\.\w+?$/g,"");return(0,o.aF)(a,null==i?void 0:i.maxLength)}function s(e){return e.replace(/^.*[\\\/]/,"")}}}]);