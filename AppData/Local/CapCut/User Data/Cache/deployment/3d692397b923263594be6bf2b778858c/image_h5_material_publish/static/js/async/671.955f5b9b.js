"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[671],{82186:(e,i,l)=>{l.d(i,{WQ:()=>s});var o=l(50959),a=l(66589),t=l(61022),r=l(2555);const n=1e4;function s(e){const i=(0,t.fv)((()=>({isImportLoading:!1,hideImportLoadingTimer:new r.B,notifyImportLoadingFinish:null,showImportLoading:async()=>{i.isImportLoading=!0,await Promise.race([new Promise((e=>i.notifyImportLoadingFinish=e)),i.hideImportLoadingTimer.timeout(n)]),(0,a.z)((()=>{i.isImportLoading=!1}))},finishImportLoadingFinishIfNeeded:()=>{i.isImportLoading&&i.notifyImportLoadingFinish&&(i.notifyImportLoadingFinish(),i.notifyImportLoadingFinish=null)},destroy:()=>{i.hideImportLoadingTimer.cancel()}})));return(0,o.useEffect)((()=>{const l=(0,a.EH)((()=>{e.isAllReady&&i.finishImportLoadingFinishIfNeeded()}));return()=>{l()}}),[]),i}},99826:(e,i,l)=>{l.d(i,{Z:()=>_});var o=l(84875),a=l.n(o),t=l(23479),r=l(45599),n=l(36983),s=l(69836),d=l(503),c=l(79679),p=l(60209),u=l(95218);const m="root-bPt1FS",g="statusBar-HPGgP6",v="contextMenuItem-HpV5Jn";var f=l(11527);const _=(0,t.Pi)((({className:e,material:i,isSelected:l,onClick:o,onReimport:t,onRemove:_})=>{var F;const{t:h}=(0,r.$)(),{common_data:y}=i,I=i.payload.filterImg,C=Boolean(null===(F=i.payload)||void 0===F||null===(F=F.unmetRequirements)||void 0===F?void 0:F.length),b=Boolean(y.title&&y.description),{handleContextMenu:x}=(0,c.D)({content:(0,f.jsx)(d.m,{items:[{key:"reimport",render:({key:e,className:l})=>Boolean(C)&&(0,f.jsx)("div",{className:a()(l,v),onClick:()=>t(i),children:h("pc_stickers_release_again_web")},e)},{key:"remove",render:({key:e,className:l})=>(0,f.jsx)("div",{className:a()(l,v),onClick:()=>_(i),children:h("pc_stickers_release_delete_web")},e)}]})});return(0,f.jsxs)("div",{className:a()(e,m),onClick:()=>{var e;o(null===(e=i.payload)||void 0===e?void 0:e.localId)},children:[(0,f.jsx)(n.Y,{src:i.payload.filterImg,isSelected:l,isInvalid:Boolean(C),size:80,onContextMenu:e=>{var l;x(e),o(null===(l=i.payload)||void 0===l?void 0:l.localId)}}),(0,f.jsx)(s.ir,{className:g,loading:!I,invalid:C,errorToolip:C&&(null===(L=i.payload)||void 0===L||null===(L=L.unmetRequirements)||void 0===L?void 0:L.map((e=>{const i=u.ZV[p.nb.File][e]||u.ZV[p.nb.Cover][e];return i?(0,f.jsx)("div",{children:i},e):null}))),isInfoComplete:b,title:y.title})]});var L}))},60681:(e,i,l)=>{l.d(i,{Z:()=>S});var o=l(50959),a=l(23479),t=l(45599),r=l(84736),n=(l(42983),l(70252)),s=(l(15443),l(76199)),d=l(95471),c=l(45033),p=l(63541),u=l(2237),m=l(95218),g=l(53803),v=l(94435);const f="root-qPd6XE",_="coverWrapper-YHEPdi",F="box-Tn50Wt",h="img-MkfnN9",y="tag-rTNBT4",I="editCover-cZ6Noe",C="input-ixM0l_",b="icon-nenuZE",x="businessCheckbox-RcPes0";var L=l(11527);const S=(0,a.Pi)((({material:e,materialListStore:i,formApi:l,collectionId:a,authProps:S})=>{var k;const{t:P}=(0,t.$)(),{payload:U}=e,{value:w}=(0,r.tL)("common_data.title");(0,o.useMemo)((()=>e.common_data.source===v.r0.UserPostPc),[e]);(0,o.useLayoutEffect)((()=>(null==l||l.reset(),null==l||l.setValues(e,{isOverride:!0}),()=>{const o=null==l?void 0:l.getValues();o&&i.updateFormState(e,{is_vip:o.is_vip||!1,common_data:{...e.common_data,title:o.common_data.title||"",description:o.common_data.description,is_original:o.common_data.is_original||!1,is_business:o.common_data.is_business||!1}})})),[e]);const{getDisplayLength:M}=(0,c._)(),E=(l,o)=>{i.updateFormState(e,{common_data:{...e.common_data,[o]:l}})};return(0,L.jsxs)("div",{className:f,children:[(0,L.jsx)("div",{className:_,children:(0,L.jsxs)("div",{className:F,children:[U.filterImg?(0,L.jsx)("img",{className:h,src:U.filterImg}):(0,L.jsx)(u.t,{className:b,iconWidth:28}),(0,L.jsx)("div",{className:y,style:{backgroundColor:null===(k=e.filter)||void 0===k?void 0:k.desc_background_color},children:w}),(0,L.jsx)("div",{className:I,onClick:async()=>{i.openFilterCoverEditor(e,a)},children:P("pc_stickers_release_cover_edit_web")})]})}),(0,L.jsx)(n.l,{fieldClassName:C,label:P("pc_filter_title"),field:"common_data.title",maxLength:m.S8,placeholder:P("pc_stickers_release_xy_name_web",{X:1,Y:M(m.S8)}),allowEnter:!1,rules:[{required:!0,message:""}],onChange:e=>E(e,"title")}),(0,L.jsx)(n.l,{fieldClassName:C,label:P("pc_filter_setting_describe"),field:"common_data.description",maxLength:m.t2,placeholder:P("pc_stickers_release_xy_details_web",{X:1,Y:M(m.t2)}),allowEnter:!1,rules:[{required:!0,message:""}],onChange:e=>E(e,"description")}),!1,S&&(0,L.jsx)(p.Z,{onClickUseAll:()=>{const e=null==l?void 0:l.getValues();e&&i.applyAuthSettingsToAll({isVip:e.is_vip,isOriginal:e.common_data.is_original,isBusiness:e.common_data.is_business})},children:(0,L.jsxs)("div",{className:g.Z.authGroup,children:[(0,L.jsx)(p._,{text:P("pc_template_authorize_range_web")}),(0,L.jsxs)("div",{className:g.Z.right,children:[(0,L.jsx)(s.l,{noLabel:!0,field:"is_vip",sendLogService:S.sendLogServ}),(0,L.jsx)(d.R,{fieldClassName:x,noLabel:!0,field:"common_data.is_business",vipField:"is_vip",authorSignService:S.authorSignService,getAuthFileUploadService:()=>S.authFileUploadServiceManager.ensure(U.localId),sendLogService:S.sendLogServ})]})]})})]})}))},56714:(e,i,l)=>{l.d(i,{v:()=>t});var o=l(21130),a=l(8129);class t extends o.D5{sendUploadActionLog(e){const{mainFormLayout:i}=e,l="mainForm"===i?"upload_more":"upload";this.sendPageActionLog({action:l})}sendMaterialPublishLog({publishResult:e,filter:i,logPrefix:l}){this.sendMaterialPublishStatusLog({...e,publishParams:i,status:e.error?"fail":"success",cover_type:i.payload.coverEditType,path:i.payload.path},{material_size:i.payload.size}),e.error?(0,a.RF)(`${l} filter publish failed`,e.error,{id:i.payload.localId}):(0,a.c6)(`${l} filter publish success`,{id:i.payload.localId,resourceId:e.resourceId})}sendMaterialCollectionPublishLog({publishResult:e,collection:i}){this.sendMaterialPublishStatusLog({...e,cover_type:"online_generated",publishParams:i,status:e.error?"fail":"success",path:"",resolution:"720x720"}),e.error?(0,a.RF)("[CollectionStore] collection publish failed",e.error,{id:i.payload.localId}):(0,a.c6)("[CollectionStore] collection publish success",{id:i.payload.localId,resourceId:e.resourceId}),(0,a.c6)("[CollectionStore] collection publish done",{resourceId:e.resourceId})}}},99181:(e,i,l)=>{l.d(i,{Z:()=>s});var o=l(23073),a=l(93639),t=l(98052);var r=l(8129),n=l(1946);const s=new class{async openFilterFilePicker(e){const i={...e,temporaryId:(0,n.V)("single")};(0,r.c6)("[JSB] openFilterFilePicker req --\x3e",{...(0,a.Z)(i,[])});const l=await(e=>t.Jn.call("openFilterFilePicker",e))(i);return(0,r.c6)("[JSB] openFilterFilePicker resp <--",(0,a.Z)(l,["filterImg"])),l}async uploadDroppedFilterFiles(e){var i;const l={...e,temporaryId:(0,n.V)("single")};(0,r.c6)("[JSB] uploadDroppedFilterFiles req --\x3e",{...(0,a.Z)(l,[])});const o=await(e=>t.Jn.call("uploadDroppedFilterFiles",e))(l);return(0,r.c6)("[JSB] uploadDroppedFilterFiles resp <--",{imagesCount:null==o||null===(i=o.filters)||void 0===i?void 0:i.length}),o}registerFilterFileProcessResultEvent(e){return(e=>{const i=i=>{i.data&&e(i.data)};return t.Jn.on("FilterFileProcessResult",i),()=>t.Jn.off("FilterFileProcessResult",i)})((i=>{(0,r.c6)(`[JSB] FilterFileProcessResult ${null==i?void 0:i.type} {${null==i?void 0:i.id}}`,{...(0,o.Z)(i,["result","uri","error","fileUri","sourceUri","filterUri","temporaryId","id","collectionId"])}),e(i)}))}async openFilterCollectionCoverImage(e){const i={...e,temporaryId:(0,n.V)("collection")};(0,r.c6)("[JSB] openFilterCollectionCoverImage req --\x3e",{...(0,a.Z)(i,[])});const l=await(e=>t.Jn.call("openFilterCollectionCoverImage",e))(i);return(0,r.c6)("[JSB] openFilterCollectionCoverImage resp <--",(0,a.Z)(l,["filterImg"])),l}async openFilterCoverImage(e){const i={...e,temporaryId:(0,n.V)("single")};(0,r.c6)("[JSB] openFilterCoverImage req --\x3e",{...(0,a.Z)(i,[])});const l=await(e=>t.Jn.call("openFilterCoverImage",e))(i);return(0,r.c6)("[JSB] openFilterCoverImage resp <--",(0,a.Z)(l,["filterImg"])),l}async cancelFilterUpload(e){(0,r.c6)("[JSB] cancelFilterUpload req --\x3e",e),await(e=>t.Jn.call("cancelFilterUpload",e))(e),(0,r.c6)("[JSB] cancelFilterUpload resp <--")}}},893:(e,i,l)=>{l.d(i,{WQ:()=>v});var o=l(23073),a=l(93639),t=l(50959),r=l(61022),n=l(42983),s=l(39486),d=l(99181),c=l(18882),p=l(95218),u=l(17941),m=l(21919),g=l(74235);function v(){const e=(0,r.fv)((()=>({uploadConfigService:new s.w,materialList:[],scrollAreaRef:(0,t.createRef)(),get hasMaterials(){return this.materialList.length>0},selectedId:null,get selectedMaterial(){return e.selectedId?e.getMaterial(e.selectedId):null},get isAllReady(){return e.materialList.length>0&&e.materialList.every((e=>e.payload.filterImg))},addMaterials(i){i.length&&(e.materialList=[...e.materialList,...i],e.materialList.length===i.length&&(e.selectedId=i[0].payload.localId))},getMaterial:i=>{var l;return null!==(l=e.materialList.find((e=>{var l;return(null===(l=e.payload)||void 0===l?void 0:l.localId)===i})))&&void 0!==l?l:null},selectMaterial(i){e.selectedId=i,e.selectedMaterial&&(e.selectedMaterial.payload.hasEverSelected=!0)},updateThumbnailSrc(e,i){e.payload.filterImg=i},updateUploadedData(e,i){i.fileUri&&(e.filter={...e.filter,original_file_uri:i.fileUri})},updateUnmetRequirements(e,i){e.payload.unmetRequirements=i,e.payload.hasCheckedRequirements=!0},makeInitForm:({payload:e,source:i,title:l,format:o,is_vip:a})=>({effect_type:n.Ab.Filter,common_data:{title:l,description:"",tags:[],source:i,is_original:!1,is_business:!1,web_extra:"",icon:{image_uri:""},format:o},is_vip:a,payload:{hasEverSelected:!1,itemId:void 0,unmetRequirements:[],hasCheckedRequirements:!1,isUploadFailed:!1,localId:"",filterImg:"",size:0,path:"",error:"",temporary:{FilterFile:"",Thumbnail:"",FilterImg:""},coverEditType:void 0,...e},filter:{desc_background_color:p.KD,original_image:{image_uri:(0,c.c_)()},original_file_uri:""}}),updateFormState(e,i){Object.assign(e,i)},updateUploadResp(e,{fileUri:i,sourceUri:l,filterUri:o,uri:a}){i&&(e.filter={...e.filter,original_file_uri:i}),l&&(e.filter={...e.filter,original_image:{image_uri:l}}),a&&(e.filter={...e.filter,original_image:{image_uri:a}}),o&&(e.common_data.icon.image_uri=o)},reimportMaterial(i,l){const o=e.materialList.findIndex((e=>e.payload.localId===i));-1!==o&&(e.materialList[o]=l)},removeMaterial(i){e.materialList=e.materialList.filter((e=>e.payload.localId!==i.payload.localId)),d.Z.cancelFilterUpload({id:i.payload.localId})},applyAuthSettingsToAll:({isOriginal:i,isBusiness:l,isVip:o})=>{e.materialList.forEach((e=>{e.is_vip=Boolean(o),e.common_data.is_original=Boolean(i),e.common_data.is_business=Boolean(l)}))},dragInsert(i,l){const o=e.materialList.splice(i,1),a=i>l?l+1:l;e.materialList.splice(a,0,...o)},get isReadyToPublish(){return e.materialList.every((e=>{var i,l,o;return 0===(null===(i=e.payload.unmetRequirements)||void 0===i?void 0:i.length)&&(null===(l=e.common_data)||void 0===l?void 0:l.title)&&(null===(o=e.common_data)||void 0===o?void 0:o.description)&&e.payload.filterImg}))},get uploadStats(){let i=0,l=0,o=0;return e.materialList.forEach((e=>{var a,t,r;if(e.payload.isUploadFailed)return void(l+=1);(null===(a=e.common_data.icon)||void 0===a?void 0:a.image_uri)&&(null===(t=e.filter)||void 0===t?void 0:t.original_file_uri)&&(null===(r=e.filter)||void 0===r||null===(r=r.original_image)||void 0===r?void 0:r.image_uri)?i+=1:o+=1})),{pending:o,succeeded:i,failed:l}},collectLogData:()=>e.materialList.map((e=>{const i=(0,a.Z)(e.payload,"filterImg");return{...e,payload:i}})),async openFilterCoverEditor(i,l){var o;const a=await d.Z.openFilterCoverImage({...await e.uploadConfigService.getUploadConfigs("openFilterCoverImage"),...p.Pc,id:i.payload.localId,tagColor:null===(o=i.filter)||void 0===o?void 0:o.desc_background_color,title:i.common_data.title,filters:e.materialList.map((e=>({id:e.payload.localId}))),collectionId:l});"Success"===a.result&&(a.isUseAll?e.materialList.forEach((e=>{e.filter={...e.filter,desc_background_color:a.tagColor},e.payload.temporary={...e.payload.temporary,FilterImg:a.temporaryId,Thumbnail:a.temporaryId},e.payload.coverEditType=a.coverEditType})):(i.filter={...i.filter,desc_background_color:a.tagColor},i.payload.temporary={...i.payload.temporary,FilterImg:a.temporaryId,Thumbnail:a.temporaryId},i.payload.coverEditType=a.coverEditType)),"Error"===a.result&&(i.payload.isUploadFailed=!0,i.payload.error=a.error)},handleFilePickerResp(i,l){const a=(0,u.K)(m.YW.OriginalForSubscription);return i.filters.map((i=>{const t=(0,c.td)(i.path,i.size),r=(0,g.YB)(i.path,{maxLength:p.S8}),n={FilterFile:i.temporaryId,FilterImg:i.temporaryId,Thumbnail:i.temporaryId};return e.makeInitForm({payload:{localId:i.id,...(0,o.Z)(i,["size","path","error"]),...t,temporary:n,isUploadFailed:"Error"===i.result},source:l,title:r,format:t.fileType,is_vip:a})}))},async refreshUploadConfigsIfNeeded(i){await e.uploadConfigService.refreshUploadConfigsIfNeeded({when:i,logPrefix:"[FilterStore]"})},async openFilterPicker({maxTotalCount:i,maxCount:l,minCount:o,source:a,collectionId:t}){await e.refreshUploadConfigsIfNeeded("openFilterFilePicker");const r=await d.Z.openFilterFilePicker({...await e.uploadConfigService.getUploadConfigs("openFilterPicker"),...p.Zk,minCount:o,maxCount:l,maxTotalCount:i,collectionId:t}),n=e.handleFilePickerResp(r,a);e.addMaterials(n)},async reimportFilterFilePicker({maxTotalCount:i,maxCount:l,minCount:o,source:a,oldId:t,collectionId:r}){await e.refreshUploadConfigsIfNeeded("openFilterFilePicker");const n=await d.Z.openFilterFilePicker({...await e.uploadConfigService.getUploadConfigs("openFilterPicker"),...p.Zk,minCount:o,maxCount:l,maxTotalCount:i,multiple:!1,collectionId:r}),s=e.handleFilePickerResp(n,a);s[0]&&(e.reimportMaterial(t,s[0]),d.Z.cancelFilterUpload({id:t}))},async uploadDroppedFilterFiles({maxTotalCount:i,maxCount:l,minCount:o,source:a,collectionId:t}){await e.refreshUploadConfigsIfNeeded("uploadDroppedFilterFiles");const r=await d.Z.uploadDroppedFilterFiles({...await e.uploadConfigService.getUploadConfigs("uploadDroppedFilterFiles"),...p.Zk,minCount:o,maxCount:l,maxTotalCount:i,collectionId:t}),n=e.handleFilePickerResp(r,a);e.addMaterials(n)},async retryUpload(i,l){if(!(i.length+l.length))return;const o=i.map((e=>e.payload.localId));o.forEach((i=>{const l=e.getMaterial(i);l&&(l.payload.isUploadFailed=!1)}));await d.Z.openFilterFilePicker({...await e.uploadConfigService.getUploadConfigs("openFilterPicker"),...p.Zk,minCount:1,maxCount:i.length,maxTotalCount:i.length,retryUploadIds:[...o,...l]})}})));return e}},18882:(e,i,l)=>{l.d(i,{$Y:()=>p,c_:()=>c,td:()=>d});var o=l(50959),a=l(45599),t=l(97311),r=l(54847),n=l(60209),s=l(95218);const d=(e,i)=>{const l=[];i>s.Tb&&l.push(n.id.MaxFileSize);let o="";try{o=function(e){const i=(0,t.lm)(e);if("cube"===i)return n.FU.CUBE;if("3dl"===i)return n.FU.THREEDL;throw new Error(`Unsupported suffix ${i}`)}(e)}catch(a){l.push(n.id.Format)}return{unmetRequirements:l,fileType:o}},c=()=>r.appModel.debugInfo.useBOE?"tos-boei18n-i-9ove8i7dyj/1760c449404c48e79f65500872fbf75c":"tos-maliva-i-dwpf7vt6ri-us/c7ea4ddb53394986a5d524457a5c66ef";function p(){const{t:e}=(0,a.$)(),i=e=>Object.entries(s.ZV[e]).map((([e,i])=>({key:e,title:i})));return(0,o.useMemo)((()=>[{key:n.nb.File,title:e("pc_filter_specification"),instructions:i(n.nb.File)},{key:n.nb.Cover,title:e("pc_filter_cover_description"),instructions:i(n.nb.Cover)}]),[])}},60209:(e,i,l)=>{l.d(i,{FU:()=>a,id:()=>o,nb:()=>t});let o=function(e){return e.Format="format",e.MaxFileSize="maxFileSize",e.CollectionNum="collectionNum",e.CoverCopyright="coverCopyright",e.CoverLut="coverLut",e.CoverFormat="coverFormat",e.CoverMinImageSize="coverMinImageSize",e.CoverMaxFileSize="coverMaxFileSize",e}({}),a=function(e){return e.CUBE="cube",e.THREEDL="3dl",e}({}),t=function(e){return e.File="file",e.Cover="cover",e}({})},74235:(e,i,l)=>{l.d(i,{YB:()=>t,xB:()=>a});var o=l(86439);function a(e){const{len:i,i18n:l}=e,[o]=(l.language||"").split("-");return"zh"===o?Math.floor(i/2):i}function t(e,i){const l=e.split(/[\\/]/g).pop().replace(/\.\w+?$/g,"");return(0,o.aF)(l,null==i?void 0:i.maxLength)}}}]);