"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[839],{42983:(e,t,a)=>{a.d(t,{Ab:()=>i,qG:()=>i});let i=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e}({})},69836:(e,t,a)=>{a.d(t,{ir:()=>b});var i=a(50959),r=a(84875),l=a.n(r),o=a(45599),s=a(82346),n=a(96426),c=a(85083),d=a(88623),u=a(84997),m=a(40699),p=a(96305),h=a(11527);const g=e=>{const{className:t}=e,{t:a}=(0,o.$)(),{handleMouseEnter:i}=(0,u.S)();return(0,h.jsxs)("div",{className:l()(p.Z.root,t),children:[(0,h.jsx)(s.a,{className:p.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,h.jsx)("div",{className:p.Z.text,onMouseEnter:i,children:a("pc_stickers_release_in_web")})]})},f=e=>{const{className:t,tooltip:a}=e,{t:r}=(0,o.$)(),{handleMouseEnter:s}=(0,u.w)({content:a,className:p.Z.tooltip}),c=(0,i.useRef)(null),{setIsMarqueeLoopRunning:d,reactNode:g}=(0,m.J)({text:r("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>c.current});return(0,h.jsxs)("div",{className:l()(p.Z.root,t,p.Z.error),onMouseEnter:e=>{d(!0),s(e)},onMouseLeave:()=>d(!1),children:[(0,h.jsx)(n.r,{className:p.Z.icon}),(0,h.jsx)("div",{ref:c,className:p.Z.text,children:g})]})},_=e=>{const{className:t,text:a}=e,{handleMouseEnter:i}=(0,u.S)();return(0,h.jsxs)("div",{className:l()(p.Z.root,t,p.Z.checked),children:[(0,h.jsx)(d.r,{className:p.Z.icon}),(0,h.jsx)("div",{className:p.Z.text,onMouseEnter:i,children:a})]})},S=e=>{const{className:t}=e,{t:a}=(0,o.$)(),{handleMouseEnter:i}=(0,u.S)();return(0,h.jsxs)("div",{className:l()(p.Z.root,t),children:[(0,h.jsx)("div",{className:l()(p.Z.icon,p.Z.yellowIcon),children:(0,h.jsx)("div",{className:p.Z.yellowPoint})}),(0,h.jsx)("div",{className:p.Z.text,onMouseEnter:i,children:a("pc_stickers_release_editing_web")}),(0,h.jsx)(c.r,{className:p.Z.icon})]})},b=e=>{const{className:t,loading:a,invalid:i,errorToolip:r,isInfoComplete:l,title:o}=e;return a?(0,h.jsx)(g,{className:t}):i?(0,h.jsx)(f,{className:t,tooltip:r}):l?(0,h.jsx)(_,{className:t,text:o}):(0,h.jsx)(S,{className:t})}},95218:(e,t,a)=>{a.d(t,{KD:()=>c,Pc:()=>m,S8:()=>o,Tb:()=>n,ZV:()=>d,Zk:()=>u,dr:()=>p,iq:()=>l,t2:()=>s});var i=a(73224),r=a(60209);const l=30,o=24,s=80,n=20971520,c="#BB984B",d={[r.nb.File]:{[r.id.Format]:i.I18n.t("pc_filter_form"),[r.id.MaxFileSize]:i.I18n.t("pc_filter_size_eight_m"),[r.id.CollectionNum]:i.I18n.t("pc_filter_collection_number")},[r.nb.Cover]:{[r.id.CoverCopyright]:i.I18n.t("pc_filter_original_cover_copyright"),[r.id.CoverLut]:i.I18n.t("pc_filter_lut_match"),[r.id.CoverFormat]:i.I18n.t("pc_filter_file_format"),[r.id.CoverMinImageSize]:i.I18n.t("pc_filter_pixel_size"),[r.id.CoverMaxFileSize]:i.I18n.t("pc_filter_file_size_ten_m")}},u={accept:"cube-3dl",multiple:!0,thumbnailSize:210,maxFileSize:20971520},m={accept:"png-jpg-jpeg",thumbnailSize:210,maxFileSize:10485760,minImageSize:720},p="ImportFilter"},17421:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_e});var i=a(23479),r=a(45599),l=a(21130),o=a(12904),s=a(9608),n=a(60209),c=a(18882),d=a(93639),u=a(50959),m=a(61022),p=a(66589),h=a(84736),g=a(73224),f=a(54847),_=a(893),S=a(82186),b=a(39486),v=a(60251),y=a(42983),F=a(59787),L=a(82665),x=a(50279),M=a(25807),I=a(8129),C=a(2555),w=a(94435);function A(e){return Boolean(e.id)}class P{constructor(){(0,F.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const a of(0,L.Z)(e,10)){const e=await Promise.all(a.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:a,onResult:i,onUpdateResult:r}=e,l=JSON.parse(JSON.stringify(e.req));let o=this.itemMap.get(a);if(null!==(t=o)&&void 0!==t&&t.promise&&(0,x.Z)(o.req,l))try{return await o.promise}catch(s){(0,I.c6)("[MaterialPublishService] publish failed, start to retry",{id:a})}return o={promise:null,id:a,req:l,onResult:i,onUpdateResult:r},this.itemMap.set(a,o),o.promise=this.publishImpl(o),o.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),a=async(a,i)=>{try{const o={error:a,errorText:this.getErrorText(a),time:Math.round(performance.now()-t),resourceId:i};var r,l;if(A(e.req))await(null===(r=e.onUpdateResult)||void 0===r?void 0:r.call(e,{req:e.req,...o}));else await(null===(l=e.onResult)||void 0===l?void 0:l.call(e,{req:e.req,...o}))}catch(o){(0,I.RF)("[MaterialPublishService] callOnResult failed",o)}};let i;try{i=await this.postOrUpdate(e)}catch(r){throw e.promise=null,a(r,""),r}return await a(null,i.resource_id),i}async postOrUpdate(e){return A(e.req)?(await(0,w.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,w.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new C.B).timeout(5e3)])}catch(t){(0,I.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const a=performance.now(),i=new C.B,r={count:50,effect_types:t,uid:M.$.userInfo.uid,cursor:0};for(;performance.now()-a<5e3;){const t=await(0,w.Js)(r).catch((()=>null));if(null!=t&&t.effect_item_list){const a=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>a.has(e))))return}await i.timeout(500)}}}var N=a(57609),U=a(2514),T=a(67078),j=a(539),k=a(95218),R=a(99181),Z=a(56714),E=a(46309),q=a(3718),D=a(51654),z=a(18370);const O=(0,u.createContext)(null),W=()=>(0,u.useContext)(O);var G=a(11527);const V=(0,i.Pi)((({className:e})=>{var t,a;const i=(0,c.$Y)(),r=W().materialListStore.selectedMaterial;return(0,G.jsx)(s.v,{className:e,groups:i,initGroup:n.nb.File,activeGroup:n.nb.File,resetExpandedGroupKey:null!==(t=null==r||null===(a=r.payload)||void 0===a?void 0:a.localId)&&void 0!==t?t:null,getStatus:e=>{var t;return r?null!==(t=r.payload)&&void 0!==t&&null!==(t=t.unmetRequirements)&&void 0!==t&&t.includes(e.key)?"error":"success":"init"}})}));var $=a(38803),B=a(36775);const J=(0,i.Pi)((({className:e})=>{const t=W(),{t:a}=(0,r.$)(),i=(0,u.useRef)(null),l=(0,u.useMemo)((()=>t.materialListStore.materialList.length),[t.materialListStore.materialList]),o=(0,u.useMemo)((()=>t.isAllReadyPublish),[t.isAllReadyPublish]);return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)($.Z,{className:e,leftText:a("pc_sticker_import_zero_to_hundred_web",{X:l,Y:t.maxTotalCount}),isPublishDisabled:!o,isPublishing:t.isPublishing,needConfirmModalOnClose:t.needConfirmModalOnClose,onPublish:()=>t.uploadAndPublish(i.current)}),(0,G.jsx)(B.q,{ref:i,uploadStats:t.materialListStore.uploadStats,onRetryUpload:t.retryUpload,onCancel:t.isAllUploadedWatcher.stop,onShowUploadFail:t.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:t.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var X=a(23073),Y=a(12390),K=a(82725),Q=a(74474),H=a(84875),ee=a.n(H),te=a(99826);const ae="root-WXT7id",ie="container-fzoSrD",re="cardDragWrapper-G4KMNQ",le="card-DaDLFa",oe="hover-right-MOxz48",se="hover-left-A_1gm_",ne=(0,i.Pi)((()=>{const e=W(),{materialListStore:t}=e,a=(0,u.useCallback)(((e,a)=>{t.selectedId!==e.payload.localId&&t.selectMaterial(e.payload.localId)}),[t.selectMaterial]),i=(0,u.useCallback)(((t,a)=>{var i;return(0,G.jsx)(te.Z,{className:ee()(le,{[oe]:"right"===a,[se]:"left"===a}),material:t,onClick:e.materialListStore.selectMaterial,isSelected:e.materialListStore.selectedId===t.payload.localId,onRemove:e.materialListStore.removeMaterial,onReimport:e.reimport},null===(i=t.payload)||void 0===i?void 0:i.localId)}),[e.reimport,e.materialListStore.selectMaterial,e.materialListStore.removeMaterial,e.materialListStore.selectedId]);return(0,G.jsx)("div",{className:ae,children:(0,G.jsx)("div",{className:ie,children:(0,G.jsx)(Q.y,{list:t.materialList,renderCard:i,onMoveCard:t.dragInsert,className:re,getId:e=>e.payload.localId,scrollAreaRef:e.materialListStore.scrollAreaRef,onCardClick:a})})})}));var ce=a(60681);const de=(0,i.Pi)((({className:e})=>{const t=W(),{t:a}=(0,r.$)(),i=(0,u.useCallback)((()=>t.materialListStore.selectedMaterial&&(0,G.jsx)(ce.Z,{material:t.materialListStore.selectedMaterial,materialListStore:t.materialListStore,formApi:t.formApi,authProps:(0,X.Z)(t,"authorSignService","authFileUploadServiceManager","sendLogServ")})),[t.materialListStore.selectedMaterial,t.materialListStore,t.formApi]);return(0,l.pg)(t),(0,Y.O)({className:e,layout:t.mainFormLayout,uploadAreaProps:{titleForUploadArea:a("pc_sticker_release_drag_web"),titleForMainForm:a("pc_stickers_release_drag_in_web"),subTitle:".cube/.3dl",draggingTitle:a("pc_sticker_release_mouse_web"),disabled:t.isImportDisabled,disabledTooltip:"",onClick:t.openFilterPicker,onDrop:t.uploadDroppedAudioFiles},setFormApi:t.setFormApi,renderImportArea:e=>(0,G.jsxs)(G.Fragment,{children:[e,(0,G.jsx)(ne,{})]}),renderFormArea:i,scrollAreaRef:t.materialListStore.scrollAreaRef,onRetry:K.cb})}));var ue=a(65546);const me="page-V3sPge",pe="content-XEi3Mp",he="requirement-wXJ3Fh",ge="mainForm-oqhmIl",fe="footer-WOGAqV",_e=(0,i.Pi)((()=>{const e=function(){const e=(0,_.WQ)(),t=(0,S.WQ)(e),a=new v.l,i=new Z.v({itemType:y.qG.Filter}),r=(0,j.G)({watch:()=>l.isAllUploaded}),l=(0,m.fv)((()=>({uploadConfigService:new b.w,formApi:null,setFormApi:e=>{l.formApi=e},isPublishing:!1,sendLogServ:i,authorSignService:new N.I({signScene:q.d.BusinessArtist}),authFileUploadServiceManager:new U.r({}),performanceTimingCollector:(0,z.uY)(),setIsPublishing:(0,p.aD)((e=>l.isPublishing=e)),mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return t.isImportLoading?"loading":"uploadArea"===l.mainFormLayoutAfterLoading&&f.appModel.isInitFailed?"error":l.mainFormLayoutAfterLoading},pubServ:new P,get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1}},get maxTotalCount(){return k.iq},get isImportDisabled(){return e.materialList.length>=k.iq},get needConfirmModalOnClose(){return e.materialList.length>0},materialListStore:e,importLoadingStore:t,getImportMinMaxCount(){const t=e.materialList.length;return{minCount:1,maxCount:Math.max(0,l.maxTotalCount-t),maxTotalCount:l.maxTotalCount}},get isAllReadyPublish(){return e.materialList.length&&e.isReadyToPublish},handleLoading(){l.materialListStore.materialList.length&&"uploadArea"===l.mainFormLayoutAfterLoading&&(t.showImportLoading(),l.mainFormLayoutAfterLoading="mainForm")},openFilterPicker(){a.lock(k.dr,(async()=>{i.sendUploadActionLog(l),await e.openFilterPicker({...l.getImportMinMaxCount(),source:w.r0.UserPostPc}),l.handleLoading()}))},uploadDroppedAudioFiles(){a.lock(k.dr,(async()=>{i.sendUploadActionLog(l),await e.uploadDroppedFilterFiles({...l.getImportMinMaxCount(),source:w.r0.UserPostPc}),l.handleLoading()}))},reimport(t){a.lock(k.dr,(async()=>{await e.reimportFilterFilePicker({...l.getImportMinMaxCount(),source:w.r0.UserPostPc,oldId:t.payload.localId}),l.handleLoading()}))},get isAllUploaded(){const{pending:e,failed:t}=l.materialListStore.uploadStats;return!e&&!t},sendUploadProgressModalShowErrorLog(){const e=l.materialListStore.materialList.filter((e=>e.payload.isUploadFailed)).map((e=>({error_report:e.payload.error})));i.sendMaterialPublishErrorLog(e)},async retryUpload(){const e=l.materialListStore.materialList.filter((e=>e.payload.isUploadFailed));return l.materialListStore.retryUpload(e,[])},isAllUploadedWatcher:r,asyncFormData(){var t;const a=null===(t=l.formApi)||void 0===t?void 0:t.getValues(),i=l.materialListStore.selectedMaterial;i&&a&&e.updateFormState(i,{is_vip:a.is_vip||!1,common_data:{...i.common_data,title:a.common_data.title||"",description:a.common_data.description,is_original:a.common_data.is_original||!1,is_business:a.common_data.is_business||!1}})},async uploadAndPublish(e){l.asyncFormData(),i.sendPageActionLog({action:"publish"}),l.isAllUploaded||(await l.retryUpload(),null==e||e.show(),await l.isAllUploadedWatcher.start());try{await l.publishImpl()}finally{null==e||e.hide()}},async publishImpl(){try{l.setIsPublishing(!0);const t=e.materialList.map((e=>{const t=(0,T.pn)({isVip:e.is_vip,isBusiness:e.common_data.is_business,authFiles:l.authFileUploadServiceManager.getUploadedFiles(e.payload.localId)});return{id:e.payload.localId,req:{...(0,d.Z)(e,["payload"]),...t.root,common_data:{...e.common_data,...t.commonData}},onResult:t=>{i.sendMaterialPublishLog({publishResult:t,filter:e,logPrefix:"[SingleStore]"})}}}));(0,I.c6)("[SingleStore] stickers publish start",{ids:t.map((e=>e.id))});const a=(await l.pubServ.batchPublish(t)).map((e=>e.resource_id));(0,I.c6)("[SingleStore] filters publish done",{resourceIdList:a}),await l.pubServ.pollUntilAllInEffectList({ids:a.slice(-10),types:[y.qG.Filter]}),(0,I.c6)("[SingleStore] poll done"),h.FN.success(g.I18n.t("pc_filter_release_successful")),(0,E.ZM)({effect_type:y.qG.Filter}),setTimeout((()=>(0,E.Nt)({item_type:y.qG.Filter})),1e3)}catch(t){h.FN.error(g.I18n.t("pc_sticker_release_failed_retry_web")),(0,I.RF)("Filter [SingleStore] publish fail",t)}finally{l.setIsPublishing(!1)}},handleFilterFileProcessResult(t){const a=e.getMaterial(t.id);if(!a)return;const i=t.temporaryId===a.payload.temporary[t.type];if("Success"===t.result)switch(t.type){case"Thumbnail":if(!i)return;const{base64:r}=t;e.updateFormState(a,{payload:{...a.payload,filterImg:`data:;base64,${r}`}});break;case"FilterImg":if(!i)return;const{sourceUri:l,filterUri:o}=t;e.updateUploadResp(a,{sourceUri:l,filterUri:o});break;case"FilterFile":const{fileUri:s}=t;e.updateUploadResp(a,{fileUri:s});break;default:return}else e.updateFormState(a,{payload:{...a.payload,isUploadFailed:!0}})}})));return(0,D.u)({watch:()=>l.needConfirmModalOnClose}),(0,u.useEffect)((()=>{window.store=l;const e=R.Z.registerFilterFileProcessResultEvent(l.handleFilterFileProcessResult);return l.authorSignService.init(),l.performanceTimingCollector.addRenderTiming(z.Pk),()=>{e(),t.destroy()}}),[]),l}(),{t}=(0,r.$)();return(0,o.F)({title:t("pc_filter_release_item"),pid:"filter-publish-single"}),(0,ue.d)(),(0,l.t9)(e.sendLogServ),(0,G.jsx)(O.Provider,{value:e,children:(0,G.jsxs)("div",{className:me,children:[(0,G.jsxs)("div",{className:pe,children:[(0,G.jsx)(V,{className:he}),(0,G.jsx)(de,{className:ge})]}),(0,G.jsx)(J,{className:fe})]})})}))}}]);