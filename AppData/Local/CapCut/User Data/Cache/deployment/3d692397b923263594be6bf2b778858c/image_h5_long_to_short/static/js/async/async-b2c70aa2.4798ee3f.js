"use strict";(self.webpackChunksmart_tools=self.webpackChunksmart_tools||[]).push([["8583"],{228672:function(e,t,n){var r,i,o,a,s,u,l,h,c,d,p,f,_,v,y,g,m,C=n(23049),w=n(843111),b=n(561975),T=n(789786),k=n(376236);e=n.hmd(e);var I=n(499845),E="",P=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,b.Pz)(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,b.cI)(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),S=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return(0,b.r3)(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),x=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new P(t)}}catch(e){}return new S},N=x("localStorage"),R=x("sessionStorage"),D=new k.Yd("@firebase/database"),A=(o=1,function(){return o++}),O=function(e){var t=(0,b.dS)(e),n=new b.gQ;n.update(t);var r=n.digest();return b.US.encodeByteArray(r)},F=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",r=0;r<e.length;r++){var i=e[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=F.apply(null,i):"object"==typeof i?n+=(0,b.Pz)(i):n+=i,n+=" "}return n},q=null,L=!0,M=function(e,t){(0,b.hu)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(D.logLevel=k.in.VERBOSE,q=D.log.bind(D),t&&R.set("logging_enabled",!0)):"function"==typeof e?q=e:(q=null,R.remove("logging_enabled"))},W=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===L&&(L=!1,null===q&&!0===R.get("logging_enabled")&&M(!0)),q){var n=F.apply(null,e);q(n)}},j=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];W.apply(void 0,(0,T.ev)([e],(0,T.CR)(t)))}},U=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+F.apply(void 0,(0,T.ev)([],(0,T.CR)(e)));D.error(n)},B=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+F.apply(void 0,(0,T.ev)([],(0,T.CR)(e)));throw D.error(n),Error(n)},z=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+F.apply(void 0,(0,T.ev)([],(0,T.CR)(e)));D.warn(n)},H=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&z("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},V=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Q=function(e){if((0,b.Yr)()||"complete"===document.readyState)e();else{var t=!1,n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}t||(t=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},Y="[MIN_NAME]",K="[MAX_NAME]",G=function(e,t){if(e===t)return 0;if(e===Y||t===K)return -1;if(t===Y||e===K)return 1;var n=er(e),r=er(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},$=function(e,t){return e===t?0:e<t?-1:1},Z=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+(0,b.Pz)(t))},X=function(e){if("object"!=typeof e||null===e)return(0,b.Pz)(e);var t=[];for(var n in e)t.push(n);t.sort();for(var r="{",i=0;i<t.length;i++)0!==i&&(r+=","),r+=(0,b.Pz)(t[i])+":"+X(e[t[i]]);return r+"}"},J=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function ee(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var et=function(e){(0,b.hu)(!V(e),"Invalid JSON number"),0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,r=Math.round(e*Math.pow(2,52-i)-4503599627370496)):(n=0,r=Math.round(e/5e-324)));var t,n,r,i,o,a=[];for(o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();var s=a.join(""),u="";for(o=0;o<64;o+=8){var l=parseInt(s.substr(o,8),2).toString(16);1===l.length&&(l="0"+l),u+=l}return u.toLowerCase()},en=RegExp("^-?(0*)\\d{1,10}$"),er=function(e){if(en.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},ei=function(e){try{e()}catch(e){setTimeout(function(){throw z("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},eo=function(e,t){var n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n},ea=function(){function e(e,t){var n=this;this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(function(e){return n.appCheck=e})}return e.prototype.getToken=function(e){return this.appCheck?this.appCheck.getToken(e):Promise.resolve(null)},e.prototype.addTokenChangeListener=function(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(function(t){return t.addTokenListener(e)})},e.prototype.notifyForInvalidToken=function(){z('Provided AppCheck credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly.')},e}(),es=function(){function e(e,t,n){var r=this;this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.get().then(function(e){return r.auth_=e})}return e.prototype.getToken=function(e){return this.auth_?this.auth_.getToken(e).catch(function(e){return e&&"auth/token-not-initialized"===e.code?(W("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)}):Promise.resolve(null)},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):(setTimeout(function(){return e(null)},0),this.authProvider_.get().then(function(t){return t.addAuthTokenListener(e)}))},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then(function(t){return t.removeAuthTokenListener(e)})},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',z(e)},e}(),eu=function(){function e(e){this.accessToken=e}return e.prototype.getToken=function(e){return Promise.resolve({accessToken:this.accessToken})},e.prototype.addTokenChangeListener=function(e){e(this.accessToken)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.OWNER="owner",e}(),el=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,eh="websocket",ec="long_polling",ed=function(){function e(e,t,n,r,i,o,a){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===a&&(a=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=N.get("host:"+e)||this._host}return e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},set:function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&N.set("host:"+this._host,this.internalHost))},enumerable:!1,configurable:!0}),e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return""+e+this.host+"/"+t},e}();function ep(e,t,n){if((0,b.hu)("string"==typeof t,"typeof type must == string"),(0,b.hu)("object"==typeof n,"typeof params must == object"),t===eh)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===ec)r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);var r,i=[];return ee(n,function(e,t){i.push(e+"="+t)}),r+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ef=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),(0,b.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return(0,b.p$)(this.counters_)},e}(),e_={},ev={};function ey(e){var t=e.toString();return e_[t]||(e_[t]=new ef),e_[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var eg=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=this;this.pendingResponses[this.currentResponseNum]&&"break"!==function(){var e=r.pendingResponses[r.currentResponseNum];delete r.pendingResponses[r.currentResponseNum];for(var t=function(t){e[t]&&ei(function(){n.onMessage_(e[t])})},i=0;i<e.length;++i)t(i);if(r.currentResponseNum===r.closeAfterResponse)return r.onClose&&(r.onClose(),r.onClose=null),"break";r.currentResponseNum++}(););},e}(),em="start",eC=function(){function e(e,t,n,r,i,o,a){var s=this;this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=j(e),this.stats_=ey(t),this.urlFn=function(e){return s.appCheckToken&&(e.ac=s.appCheckToken),ep(t,ec,e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new eg(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(3e4)),Q(function(){if(!n.isClosed_){n.scriptTagHolder=new ew(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,T.CR)(e,5),i=r[0],o=r[1],a=r[2];if(r[3],r[4],n.incrementIncomingBytes_(e),n.scriptTagHolder){if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,i===em)n.id=o,n.password=a;else if("close"===i)o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,function(){n.onClosed_()})):n.onClosed_();else throw Error("Unrecognized command received: "+i)}},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,T.CR)(e,2),i=r[0],o=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(i,o)},function(){n.onClosed_()},n.urlFn);var e={};e[em]="t",e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),n.applicationId&&(e.p=n.applicationId),n.appCheckToken&&(e.ac=n.appCheckToken),"undefined"!=typeof location&&location.hostname&&el.test(location.hostname)&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,function(){})}})},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!(0,b.Yr)()&&(!!e.forceAllow_||!e.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI))},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=(0,b.Pz)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=J((0,b.h$)(t),1840),r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!(0,b.Yr)()){this.myDisconnFrame=document.createElement("iframe");var n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=(0,b.Pz)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),ew=function(){function e(t,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,b.Yr)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=A(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var o="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(o='<script>document.domain="'+document.domain+'";</script>');var a="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(e){W("frame writing exception"),e.stack&&W(e.stack),W(e)}}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||W("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(e,function(){clearTimeout(i),r()})},e.prototype.addTag=function(e,t){var n=this;(0,b.Yr)()?this.doNodeLongPoll(e,t):setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){W("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(e){}},Math.floor(1))},e}(),eb=null;"undefined"!=typeof MozWebSocket?eb=MozWebSocket:"undefined"!=typeof WebSocket&&(eb=WebSocket);var eT=function(){function e(t,n,r,i,o,a,s){this.connId=t,this.applicationId=r,this.appCheckToken=i,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=j(this.connId),this.stats_=ey(n),this.connURL=e.connectionURL_(n,a,s,i),this.nodeAdmin=n.nodeAdmin}return e.connectionURL_=function(e,t,n,r){var i={};return i.v="5",!(0,b.Yr)()&&"undefined"!=typeof location&&location.hostname&&el.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),ep(e,eh,i)},e.prototype.open=function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,N.set("previous_websocket_failure",!0);try{if((0,b.Yr)()){var r=this.nodeAdmin?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+E+"/"+I.platform+"/"+r,"X-Firebase-GMPID":this.applicationId||""}};this.nodeAdmin?i.headers.Authorization=this.authToken||"":i.headers["X-Firebase-AppCheck"]=this.appCheckToken||"";var o=I.env,a=0===this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new eb(this.connURL,[],i)}else{var i={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new eb(this.connURL,[],i)}}catch(e){this.log_("Error instantiating WebSocket.");var s=e.message||e.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()}},e.prototype.start=function(){},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&4.4>parseFloat(n[1])&&(t=!0)}return!t&&null!==eb&&!e.forceDisallow_},e.previouslyFailed=function(){return N.isInMemoryStorage||!0===N.get("previous_websocket_failure")},e.prototype.markConnectionHealthy=function(){N.remove("previous_websocket_failure")},e.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=(0,b.cI)(t);this.onMessage(n)}},e.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},e.prototype.extractFrameCount_=function(e){if((0,b.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},e.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},e.prototype.send=function(e){this.resetKeepAlive();var t=(0,b.Pz)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=J(t,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},e.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},e.prototype.onClosed_=function(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},e.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},e.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()},Math.floor(45e3))},e.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e}(),ek=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[eC,eT]},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var n,r,i=eT&&eT.isAvailable(),o=i&&!eT.previouslyFailed();if(t.webSocketOnly&&(i||z("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[eT];else{var a=this.transports_=[];try{for(var s=(0,T.XA)(e.ALL_TRANSPORTS),u=s.next();!u.done;u=s.next()){var l=u.value;l&&l.isAvailable()&&a.push(l)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),eI=function(){function e(e,t,n,r,i,o,a,s,u,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=s,this.onKill_=u,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=j("c:"+this.id+":"),this.transportManager_=new ek(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){e.conn_&&e.conn_.open(n,r)},Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=eo(function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))},Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){this.sendData_({t:"d",d:e})},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=Z("t",e),n=Z("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=Z("t",e),n=Z("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=Z("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?U("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):U("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&z("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),eo(function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())},Math.floor(6e4))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):eo(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(N.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),eE=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.refreshAppCheckToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),eP=function(){function e(e){this.allowedEvents_=e,this.listeners_={},(0,b.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=(0,T.ev)([],(0,T.CR)(this.listeners_[e])),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context)){r.splice(i,1);return}},e.prototype.validateEventType_=function(e){(0,b.hu)(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},e}(),eS=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||(0,b.uI)()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}return(0,T.ZT)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return(0,b.hu)("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(eP),ex=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e}();function eN(){return new ex("")}function eR(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function eD(e){return e.pieces_.length-e.pieceNum_}function eA(e){var t=e.pieceNum_;return t<e.pieces_.length&&t++,new ex(e.pieces_,t)}function eO(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function eF(e,t){return void 0===t&&(t=0),e.pieces_.slice(e.pieceNum_+t)}function eq(e){if(e.pieceNum_>=e.pieces_.length)return null;for(var t=[],n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new ex(t,0)}function eL(e,t){for(var n=[],r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof ex)for(var r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else for(var i=t.split("/"),r=0;r<i.length;r++)i[r].length>0&&n.push(i[r]);return new ex(n,0)}function eM(e){return e.pieceNum_>=e.pieces_.length}function eW(e,t){var n=eR(e),r=eR(t);if(null===n)return t;if(n===r)return eW(eA(e),eA(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function ej(e,t){for(var n=eF(e,0),r=eF(t,0),i=0;i<n.length&&i<r.length;i++){var o=G(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1}function eU(e,t){if(eD(e)!==eD(t))return!1;for(var n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function eB(e,t){var n=e.pieceNum_,r=t.pieceNum_;if(eD(e)>eD(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}var ez=function(e,t){this.errorPrefix_=t,this.parts_=eF(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=(0,b.ug)(this.parts_[n]);eH(this)};function eH(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+eV(e))}function eV(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var eQ=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",t="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))},!1),r}return(0,T.ZT)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return(0,b.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(eP),eY=function(e){function t(n,r,i,o,a,s,u,l){var h=e.call(this)||this;if(h.repoInfo_=n,h.applicationId_=r,h.onDataUpdate_=i,h.onConnectStatus_=o,h.onServerInfoUpdate_=a,h.authTokenProvider_=s,h.appCheckTokenProvider_=u,h.authOverride_=l,h.id=t.nextPersistentConnectionId_++,h.log_=j("p:"+h.id+":"),h.interruptReasons_={},h.listens=new Map,h.outstandingPuts_=[],h.outstandingGets_=[],h.outstandingPutCount_=0,h.outstandingGetCount_=0,h.onDisconnectRequestQueue_=[],h.connected_=!1,h.reconnectDelay_=1e3,h.maxReconnectDelay_=3e5,h.securityDebugCallback_=null,h.lastSessionId=null,h.establishConnectionTimer_=null,h.visible_=!1,h.requestCBHash_={},h.requestNumber_=0,h.realtime_=null,h.authToken_=null,h.appCheckToken_=null,h.forceTokenRefresh_=!1,h.invalidAuthTokenCount_=0,h.invalidAppCheckTokenCount_=0,h.firstConnection_=!0,h.lastConnectionAttemptTime_=null,h.lastConnectionEstablishedTime_=null,l&&!(0,b.Yr)())throw Error("Auth override specified in options, but not supported on non Node.js platforms");return h.scheduleConnect_(0),eQ.getInstance().on("visible",h.onVisible_,h),-1===n.host.indexOf("fblocal")&&eS.getInstance().on("online",h.onOnline_,h),h}return(0,T.ZT)(t,e),t.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_((0,b.Pz)(i)),(0,b.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},t.prototype.get=function(e){var t=this,n=new b.BH,r={p:e._path.toString(),q:e._queryObject},i={action:"g",request:r,onComplete:function(e){var i=e.d;"ok"===e.s?(t.onDataUpdate_(r.p,i,!1,null),n.resolve(i)):n.reject(i)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;var o=this.outstandingGets_.length-1;return this.connected_||setTimeout(function(){var e=t.outstandingGets_[o];void 0!==e&&i===e&&(delete t.outstandingGets_[o],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),t.log_("get "+o+" timed out on connection"),n.reject(Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(o),n.promise},t.prototype.listen=function(e,t,n,r){var i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),(0,b.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,b.hu)(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},t.prototype.sendGet_=function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})},t.prototype.sendListen_=function(e){var n=this,r=e.query,i=r._path.toString(),o=r._queryIdentifier;this.log_("Listen on "+i+" for "+o);var a={p:i};e.tag&&(a.q=r._queryObject,a.t=e.tag),a.h=e.hashFn(),this.sendRequest("q",a,function(a){var s=a.d,u=a.s;t.warnOnListenWarnings_(s,r),(n.listens.get(i)&&n.listens.get(i).get(o))===e&&(n.log_("listen response",a),"ok"!==u&&n.removeListen_(i,o),e.onComplete&&e.onComplete(u,s))})},t.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&(0,b.r3)(e,"w")){var n=(0,b.DV)(e,"w");Array.isArray(n)&&~n.indexOf("no_index")&&z('Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ".indexOn": "'+t._queryParams.getIndex().toString()+'" at '+t._path.toString()+" to your security rules for better performance.")}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||(0,b.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},t.prototype.refreshAppCheckToken=function(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},function(){})},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=(0,b.w9)(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))})}},t.prototype.tryAppCheck=function(){var e=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},function(t){var n=t.s,r=t.d||"error";"ok"===n?e.invalidAppCheckTokenCount_=0:e.onAppCheckRevoked_(n,r)})},t.prototype.unlisten=function(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),(0,b.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},t.prototype.onDisconnectPut=function(e,t,n){this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},t.prototype.onDisconnectMerge=function(e,t,n){this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},t.prototype.onDisconnectCancel=function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,function(e){r&&setTimeout(function(){r(e.s,e.d)},Math.floor(0))})},t.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},t.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},t.prototype.putInternal=function(e,t,n,r,i){var o={p:t,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)})},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}})}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+(0,b.Pz)(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)},t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):U("Unrecognized action received from server: "+(0,b.Pz)(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;(0,b.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){t.establishConnectionTimer_=null,t.establishConnection_()},Math.floor(e))},t.prototype.onVisible_=function(e){!e||this.visible_||this.reconnectDelay_!==this.maxReconnectDelay_||(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());var e=new Date().getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){return(0,T.mG)(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,l,h,c,d,p,f,_=this;return(0,T.Jh)(this,function(v){switch(v.label){case 0:if(!this.shouldReconnect_())return[3,4];this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null,e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+t.nextConnectionId_++,o=this.lastSessionId,a=!1,s=null,u=function(){s?s.close():(a=!0,r())},l=function(e){(0,b.hu)(s,"sendRequest call when we're not connected not allowed."),s.sendRequest(e)},this.realtime_={close:u,sendRequest:l},h=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,v.label=1;case 1:return v.trys.push([1,3,,4]),[4,Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)])];case 2:return d=(c=T.CR.apply(void 0,[v.sent(),2]))[0],p=c[1],a?W("getToken() completed but was canceled"):(W("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=p&&p.token,s=new eI(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,function(e){z(e+" ("+_.repoInfo_.toString()+")"),_.interrupt("server_kill")},o)),[3,4];case 3:return f=v.sent(),this.log_("Failed to get token: "+f),a||(this.repoInfo_.nodeAdmin&&z(f),u()),[3,4];case 4:return[2]}})})},t.prototype.interrupt=function(e){W("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){W("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,b.xb)(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){n=t?t.map(function(e){return X(e)}).join("$"):"default";var n,r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new ex(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){W("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onAppCheckRevoked_=function(e,t){W("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())},t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth(),this.tryAppCheck();try{for(var i=(0,T.XA)(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,(0,T.XA)(a.values())),u=s.next();!u.done;u=s.next()){var l=u.value;this.sendListen_(l)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var c=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(c.action,c.pathString,c.data,c.onComplete)}for(var h=0;h<this.outstandingGets_.length;h++)this.outstandingGets_[h]&&this.sendGet_(h)},t.prototype.sendConnectStats_=function(){var e={},t="js";(0,b.Yr)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+E.replace(/\./g,"-")]=1,(0,b.uI)()?e["framework.cordova"]=1:(0,b.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=eS.getInstance().currentlyOnline();return(0,b.xb)(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(eE),eK=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),eG=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new eK(Y,e),r=new eK(Y,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return eK.MIN},e}(),e$=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,T.ZT)(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return l},set:function(e){l=e},enumerable:!1,configurable:!0}),t.prototype.compare=function(e,t){return G(e.name,t.name)},t.prototype.isDefinedOn=function(e){throw(0,b.g5)("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return eK.MIN},t.prototype.maxPost=function(){return new eK(K,l)},t.prototype.makePost=function(e,t){return(0,b.hu)("string"==typeof e,"KeyIndex indexValue must always be a string."),new eK(e,l)},t.prototype.toString=function(){return".key"},t}(eG),eZ=new e$,eX=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!e.isEmpty();)if(o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else if(0===o){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),eJ=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e1.EMPTY_NODE,this.right=null!=o?o:e1.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,o){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return e1.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return e1.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){return Math.pow(2,this.check_())<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e===this.right.check_())return e+(this.isRed_()?0:1);throw Error("Black depths differ")},e.RED=!0,e.BLACK=!1,e}(),e0=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new eJ(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),e1=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,eJ.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,eJ.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty()){if(r)return r.key;return null}for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new eX(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new eX(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new eX(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new eX(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new e0,e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e2(e,t){return G(e.name,t.name)}function e3(e,t){return G(e,t)}var e4=function(e){return"number"==typeof e?"number:"+et(e):"string:"+e},e5=function(e){if(e.isLeafNode()){var t=e.val();(0,b.hu)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,b.r3)(t,".sv"),"Priority must be a string or number.")}else(0,b.hu)(e===h||e.isEmpty(),"priority of unexpected type.");(0,b.hu)(e===h||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},e8=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,(0,b.hu)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),e5(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return c},set:function(e){c=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return eM(t)?this:".priority"===eR(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var r=eR(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:((0,b.hu)(".priority"!==r||1===eD(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(eA(t),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+e4(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":","number"===t?e+=et(this.value_):e+=this.value_,this.lazyHash_=O(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:((0,b.hu)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),o=e.VALUE_TYPE_ORDER.indexOf(r);return((0,b.hu)(i>=0,"Unknown leaf type: "+n),(0,b.hu)(o>=0,"Unknown leaf type: "+r),i!==o)?o-i:"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}(),e6=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,T.ZT)(t,e),t.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?G(e.name,t.name):i},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return eK.MIN},t.prototype.maxPost=function(){return new eK(K,new e8("[PRIORITY-POST]",p))},t.prototype.makePost=function(e,t){return new eK(t,new e8("[PRIORITY-POST]",d(e)))},t.prototype.toString=function(){return".priority"},t}(eG)),e7=Math.log(2),e9=function(){function e(e){this.count=parseInt(Math.log(e+1)/e7,10),this.current_=this.count-1;var t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),te=function(e,t,n,r){e.sort(t);var i=function(t,r){var o,a=r-t;if(0===a)return null;if(1===a)return o=e[t],new eJ(n?n(o):o,o.node,eJ.BLACK,null,null);var s=parseInt(a/2,10)+t,u=i(t,s),l=i(s+1,r);return o=e[s],new eJ(n?n(o):o,o.node,eJ.BLACK,u,l)};return new e1(r||t,function(t){for(var r=null,o=null,a=e.length,s=function(t,r){var o=a-t,s=a;a-=t;var l=i(o+1,s),h=e[o];u(new eJ(n?n(h):h,h.node,r,null,l))},u=function(e){r?r.left=e:o=e,r=e},l=0;l<t.count;++l){var h=t.nextBitIsOne(),c=Math.pow(2,t.count-(l+1));h?s(c,eJ.BLACK):(s(c,eJ.BLACK),s(c,eJ.RED))}return o}(new e9(e.length)))},tt={},tn=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return(0,b.hu)(tt&&e6,"ChildrenNode.ts has not been loaded"),f=f||new e({".priority":tt},{".priority":e6})},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=(0,b.DV)(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof e1?t:null},e.prototype.hasIndex=function(e){return(0,b.r3)(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,n){(0,b.hu)(t!==eZ,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,i=[],o=!1,a=n.getIterator(eK.Wrap),s=a.getNext();s;)o=o||t.isDefinedOn(s.node),i.push(s),s=a.getNext();r=o?te(i,t.getCompare()):tt;var u=t.toString(),l=(0,T.pi)({},this.indexSet_);l[u]=t;var h=(0,T.pi)({},this.indexes_);return h[u]=r,new e(h,l)},e.prototype.addToIndexes=function(t,n){var r=this;return new e((0,b.UI)(this.indexes_,function(e,i){var o=(0,b.DV)(r.indexSet_,i);if((0,b.hu)(o,"Missing index implementation for "+i),e===tt){if(!o.isDefinedOn(t.node))return tt;for(var a=[],s=n.getIterator(eK.Wrap),u=s.getNext();u;)u.name!==t.name&&a.push(u),u=s.getNext();return a.push(t),te(a,o.getCompare())}var l=n.get(t.name),h=e;return l&&(h=h.remove(new eK(t.name,l))),h.insert(t,t.node)}),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e((0,b.UI)(this.indexes_,function(e){if(e===tt)return e;var r=n.get(t.name);return r?e.remove(new eK(t.name,r)):e}),this.indexSet_)},e}(),tr=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&e5(this.priorityNode_),this.children_.isEmpty()&&(0,b.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return _||(_=new e(new e1(e3),null,tn.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||_},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?_:t},e.prototype.getChild=function(e){var t=eR(e);return null===t?this:this.getImmediateChild(t).getChild(eA(e))},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if((0,b.hu)(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r=new eK(t,n),i=void 0,o=void 0;n.isEmpty()?(i=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),o=this.indexMap_.addToIndexes(r,this.children_));var a=i.isEmpty()?_:this.priorityNode_;return new e(i,a,o)},e.prototype.updateChild=function(e,t){var n=eR(e);if(null===n)return t;(0,b.hu)(".priority"!==eR(e)||1===eD(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(eA(e),t);return this.updateImmediateChild(n,r)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(e6,function(a,s){n[a]=s.val(t),r++,o&&e.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):o=!1}),t||!o||!(i<2*r))return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n;var a=[];for(var s in n)a[s]=n[s];return a},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+e4(this.getPriority().val())+":"),this.forEachChild(e6,function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":O(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(!r)return this.children_.getPredecessorKey(e);var i=r.getPredecessorKey(new eK(e,t));return i?i.name:null},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(!t)return this.children_.minKey();var n=t.minKey();return n&&n.name},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new eK(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();var n=t.maxKey();return n&&n.name},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new eK(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal(function(e){return t(e.name,e.node)}):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,function(e){return e});for(var r=this.children_.getIteratorFrom(e.name,eK.Wrap),i=r.peek();null!=i&&0>t.compare(i,e);)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,function(e){return e});for(var r=this.children_.getReverseIteratorFrom(e.name,eK.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ti?-1:0},e.prototype.withIndex=function(t){if(t===eZ||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===eZ||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority())||this.children_.count()!==e.children_.count())return!1;for(var t=this.getIterator(e6),n=e.getIterator(e6),r=t.getNext(),i=n.getNext();r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=t.getNext(),i=n.getNext()}return null===r&&null===i},e.prototype.resolveIndex_=function(e){return e===eZ?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),ti=new(function(e){function t(){return e.call(this,new e1(e3),tr.EMPTY_NODE,tn.Default)||this}return(0,T.ZT)(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return tr.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(tr));function to(e,t){if(void 0===t&&(t=null),null===e)return tr.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),(0,b.hu)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new e8(e,to(t));if(e instanceof Array){var n=tr.EMPTY_NODE;return ee(e,function(t,r){if((0,b.r3)(e,t)&&"."!==t.substring(0,1)){var i=to(r);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(t,i))}}),n.updatePriority(to(t))}var r=[],i=!1;if(ee(e,function(e,t){if("."!==e.substring(0,1)){var n=to(t);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new eK(e,n)))}}),0===r.length)return tr.EMPTY_NODE;var o=te(r,e2,function(e){return e.name},e3);if(!i)return new tr(o,to(t),tn.Default);var a=te(r,e6.getCompare());return new tr(o,to(t),new tn({".priority":a},{".priority":e6}))}Object.defineProperties(eK,{MIN:{value:new eK(Y,tr.EMPTY_NODE)},MAX:{value:new eK(K,ti)}}),e$.__EMPTY_NODE=tr.EMPTY_NODE,e8.__childrenNodeConstructor=tr,h=ti,p=ti,d=to;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ta=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,(0,b.hu)(!eM(t)&&".priority"!==eR(t),"Can't create PathIndex with empty path or .priority key"),n}return(0,T.ZT)(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?G(e.name,t.name):i},t.prototype.makePost=function(e,t){var n=to(e);return new eK(t,tr.EMPTY_NODE.updateChild(this.indexPath_,n))},t.prototype.maxPost=function(){return new eK(K,tr.EMPTY_NODE.updateChild(this.indexPath_,ti))},t.prototype.toString=function(){return eF(this.indexPath_,0).join("/")},t}(eG),ts=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,T.ZT)(t,e),t.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?G(e.name,t.name):n},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return eK.MIN},t.prototype.maxPost=function(){return eK.MAX},t.prototype.makePost=function(e,t){return new eK(t,to(e))},t.prototype.toString=function(){return".value"},t}(eG)),tu="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",tl=(a=0,s=[],function(e){var t,n=e===a;a=e;var r=Array(8);for(t=7;t>=0;t--)r[t]=tu.charAt(e%64),e=Math.floor(e/64);(0,b.hu)(0===e,"Cannot push at time == 0");var i=r.join("");if(n){for(t=11;t>=0&&63===s[t];t--)s[t]=0;s[t]++}else for(t=0;t<12;t++)s[t]=Math.floor(64*Math.random());for(t=0;t<12;t++)i+=tu.charAt(s[t]);return(0,b.hu)(20===i.length,"nextPushId: Length should be 20."),i}),th=function(e){if("2147483647"===e)return"-";var t=er(e);if(null!=t)return""+(t+1);for(var n=Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);if(n.length<786)return n.push("-"),n.join("");for(var i=n.length-1;i>=0&&"z"===n[i];)i--;if(-1===i)return K;var o=n[i],a=tu.charAt(tu.indexOf(o)+1);return n[i]=a,n.slice(0,i+1).join("")},tc=function(e){if("-2147483648"===e)return Y;var t=er(e);if(null!=t)return""+(t-1);for(var n=Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);return"-"===n[n.length-1]?1===n.length?"2147483647":(delete n[n.length-1],n.join("")):(n[n.length-1]=tu.charAt(tu.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function td(e){return{type:"value",snapshotNode:e}}function tp(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function tf(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function t_(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tv=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,r,i,o){(0,b.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(tf(t,a)):(0,b.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(tp(t,n)):o.trackChildChange(t_(t,n,a))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)},e.prototype.updateFullNode=function(e,t,n){return null==n||(e.isLeafNode()||e.forEachChild(e6,function(e,r){t.hasChild(e)||n.trackChildChange(tf(e,r))}),t.isLeafNode()||t.forEachChild(e6,function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(t_(t,r,i))}else n.trackChildChange(tp(t,r))})),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?tr.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),ty=function(){function e(t){this.indexedFilter_=new tv(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return 0>=this.index_.compare(this.getStartPost(),e)&&0>=this.index_.compare(e,this.getEndPost())},e.prototype.updateChild=function(e,t,n,r,i,o){return this.matches(new eK(t,n))||(n=tr.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=tr.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(tr.EMPTY_NODE);var i=this;return t.forEachChild(e6,function(e,t){i.matches(new eK(e,t))||(r=r.updateImmediateChild(e,tr.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(!e.hasStart())return e.getIndex().minPost();var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)},e.getEndPost_=function(e){if(!e.hasEnd())return e.getIndex().maxPost();var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)},e}(),tg=function(){function e(e){this.rangedFilter_=new ty(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,i,o){return(this.rangedFilter_.matches(new eK(t,n))||(n=tr.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=tr.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=tr.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext(),s=void 0;if(s=this.reverse_?0>=this.index_.compare(this.rangedFilter_.getStartPost(),a):0>=this.index_.compare(a,this.rangedFilter_.getEndPost()))r=r.updateImmediateChild(a.name,a.node),o++;else break}}else{r=(r=t.withIndex(this.index_)).updatePriority(tr.EMPTY_NODE);var u=void 0,l=void 0,h=void 0,i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),u=this.rangedFilter_.getEndPost(),l=this.rangedFilter_.getStartPost();var c=this.index_.getCompare();h=function(e,t){return c(t,e)}}else i=r.getIterator(this.index_),u=this.rangedFilter_.getStartPost(),l=this.rangedFilter_.getEndPost(),h=this.index_.getCompare();for(var o=0,d=!1;i.hasNext();){var a=i.getNext();!d&&0>=h(u,a)&&(d=!0);var s=d&&o<this.limit_&&0>=h(a,l);s?o++:r=r.updateImmediateChild(a.name,tr.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){if(this.reverse_){var o,a=this.index_.getCompare();o=function(e,t){return a(t,e)}}else o=this.index_.getCompare();(0,b.hu)(e.numChildren()===this.limit_,"");var s=new eK(t,n),u=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(s);if(e.hasChild(t)){for(var h=e.getImmediateChild(t),c=r.getChildAfterChild(this.index_,u,this.reverse_);null!=c&&(c.name===t||e.hasChild(c.name));)c=r.getChildAfterChild(this.index_,c,this.reverse_);var d=null==c?1:o(c,s);if(l&&!n.isEmpty()&&d>=0)return null!=i&&i.trackChildChange(t_(t,n,h)),e.updateImmediateChild(t,n);null!=i&&i.trackChildChange(tf(t,h));var p=e.updateImmediateChild(t,tr.EMPTY_NODE);return null!=c&&this.rangedFilter_.matches(c)?(null!=i&&i.trackChildChange(tp(c.name,c.node)),p.updateImmediateChild(c.name,c.node)):p}return n.isEmpty()?e:l&&o(u,s)>=0?(null!=i&&(i.trackChildChange(tf(u.name,u.node)),i.trackChildChange(tp(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(u.name,tr.EMPTY_NODE)):e},e}(),tm=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=e6}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.hasStartAfter=function(){return this.startAfterSet_},e.prototype.hasEndBefore=function(){return this.endBeforeSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},e.prototype.getIndexStartValue=function(){return(0,b.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return((0,b.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:Y},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return(0,b.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return((0,b.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:K},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return(0,b.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===e6},e.prototype.copy=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e}();function tC(e,t,n){var r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function tw(e,t,n){var r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function tb(e,t){var n=e.copy();return n.index_=t,n}function tT(e){var t,n={};return e.isDefault()||(e.index_===e6?t="$priority":e.index_===ts?t="$value":e.index_===eZ?t="$key":((0,b.hu)(e.index_ instanceof ta,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=(0,b.Pz)(t),e.startSet_&&(n.startAt=(0,b.Pz)(e.indexStartValue_),e.startNameSet_&&(n.startAt+=","+(0,b.Pz)(e.indexStartName_))),e.endSet_&&(n.endAt=(0,b.Pz)(e.indexEndValue_),e.endNameSet_&&(n.endAt+=","+(0,b.Pz)(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_)),n}function tk(e){var t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;var n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==e6&&(t.i=e.index_.toString()),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tI=function(e){function t(t,n,r,i){var o=e.call(this)||this;return o.repoInfo_=t,o.onDataUpdate_=n,o.authTokenProvider_=r,o.appCheckTokenProvider_=i,o.log_=j("p:rest:"),o.listens_={},o}return(0,T.ZT)(t,e),t.prototype.reportStats=function(e){throw Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:((0,b.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())},t.prototype.listen=function(e,n,r,i){var o=this,a=e._path.toString();this.log_("Listen called for "+a+" "+e._queryIdentifier);var s=t.getListenId_(e,r),u={};this.listens_[s]=u;var l=tT(e._queryParams);this.restRequest_(a+".json",l,function(e,t){var n=t;404===e&&(n=null,e=null),null===e&&o.onDataUpdate_(a,n,!1,r),(0,b.DV)(o.listens_,s)===u&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.get=function(e){var t=this,n=tT(e._queryParams),r=e._path.toString(),i=new b.BH;return this.restRequest_(r+".json",n,function(e,n){var o=n;404===e&&(o=null,e=null),null===e?(t.onDataUpdate_(r,o,!1,null),i.resolve(o)):i.reject(Error(o))}),i.promise},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var r=this;return void 0===t&&(t={}),t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(function(i){var o=(0,T.CR)(i,2),a=o[0],s=o[1];a&&a.accessToken&&(t.auth=a.accessToken),s&&s.token&&(t.ac=s.token);var u=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+(0,b.xO)(t);r.log_("Sending REST request for "+u);var l=new XMLHttpRequest;l.onreadystatechange=function(){if(n&&4===l.readyState){r.log_("REST Response for "+u+" received. status:",l.status,"response:",l.responseText);var e=null;if(l.status>=200&&l.status<300){try{e=(0,b.cI)(l.responseText)}catch(e){z("Failed to parse JSON response for "+u+": "+l.responseText)}n(null,e)}else 401!==l.status&&404!==l.status&&z("Got unsuccessful REST response for "+u+" Status: "+l.status),n(l.status);n=null}},l.open("GET",u,!0),l.send()})},t}(eE),tE=function(){function e(){this.rootNode_=tr.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tP(){return{value:null,children:new Map}}function tS(e,t,n){if(eM(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{var r=eR(t);e.children.has(r)||e.children.set(r,tP()),tS(e.children.get(r),t=eA(t),n)}}function tx(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(function(e,n){t(n,e)})}(e,function(e,r){tx(r,new ex(t.toString()+"/"+e),n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tN=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=(0,T.pi)({},e);return this.last_&&ee(this.last_,function(e,n){t[e]=t[e]-n}),this.last_=e,t},e}(),tR=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new tN(e);var n=1e4+2e4*Math.random();eo(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;ee(t,function(t,i){i>0&&(0,b.r3)(e.statsToReport_,t)&&(n[t]=i,r=!0)}),r&&this.server_.reportStats(n),eo(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},e}();function tD(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function tA(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function tO(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(u=v||(v={}))[u.OVERWRITE=0]="OVERWRITE",u[u.MERGE=1]="MERGE",u[u.ACK_USER_WRITE=2]="ACK_USER_WRITE",u[u.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tF=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=v.ACK_USER_WRITE,this.source=tD()}return e.prototype.operationForChild=function(t){if(!eM(this.path))return(0,b.hu)(eR(this.path)===t,"operationForChild called for unrelated child."),new e(eA(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return(0,b.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new ex(t));return new e(eN(),n,this.revert)},e}(),tq=function(){function e(e,t){this.source=e,this.path=t,this.type=v.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return eM(this.path)?new e(this.source,eN()):new e(this.source,eA(this.path))},e}(),tL=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=v.OVERWRITE}return e.prototype.operationForChild=function(t){return eM(this.path)?new e(this.source,eN(),this.snap.getImmediateChild(t)):new e(this.source,eA(this.path),this.snap)},e}(),tM=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=v.MERGE}return e.prototype.operationForChild=function(t){if(!eM(this.path))return(0,b.hu)(eR(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,eA(this.path),this.children);var n=this.children.subtree(new ex(t));return n.isEmpty()?null:n.value?new tL(this.source,eN(),n.value):new e(this.source,eN(),n)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),tW=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(eM(e))return this.isFullyInitialized()&&!this.filtered_;var t=eR(e);return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),tj=function(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()};function tU(e,t,n,r,i,o){var a=r.filter(function(e){return e.type===n});a.sort(function(t,n){return function(e,t,n){if(null==t.childName||null==n.childName)throw(0,b.g5)("Should only compare child_ events.");var r=new eK(t.childName,t.snapshotNode),i=new eK(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n)}),a.forEach(function(n){var r=("value"===n.type||"child_removed"===n.type||(n.prevName=o.getPredecessorChildName(n.childName,n.snapshotNode,e.index_)),n);i.forEach(function(i){i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))})})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tB(e,t){return{eventCache:e,serverCache:t}}function tz(e,t,n,r){return tB(new tW(t,n,r),e.serverCache)}function tH(e,t,n,r){return tB(e.eventCache,new tW(t,n,r))}function tV(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function tQ(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}var tY=function(){function e(e,t){void 0===t&&(y||(y=new e1($)),t=y),this.value=e,this.children=t}return e.fromObject=function(t){var n=new e(null);return ee(t,function(e,t){n=n.set(new ex(e),t)}),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:eN(),value:this.value};if(eM(e))return null;var n=eR(e),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(eA(e),t);return null!=i?{path:eL(new ex(n),i.path),value:i.value}:null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,function(){return!0})},e.prototype.subtree=function(t){if(eM(t))return this;var n=eR(t),r=this.children.get(n);return null!==r?r.subtree(eA(t)):new e(null)},e.prototype.set=function(t,n){if(eM(t))return new e(n,this.children);var r=eR(t),i=(this.children.get(r)||new e(null)).set(eA(t),n),o=this.children.insert(r,i);return new e(this.value,o)},e.prototype.remove=function(t){if(eM(t))return this.children.isEmpty()?new e(null):new e(null,this.children);var n=eR(t),r=this.children.get(n);if(!r)return this;var i=r.remove(eA(t)),o=void 0;return(o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty())?new e(null):new e(this.value,o)},e.prototype.get=function(e){if(eM(e))return this.value;var t=eR(e),n=this.children.get(t);return n?n.get(eA(e)):null},e.prototype.setTree=function(t,n){if(eM(t))return n;var r=eR(t),i=(this.children.get(r)||new e(null)).setTree(eA(t),n),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new e(this.value,o)},e.prototype.fold=function(e){return this.fold_(eN(),e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(eL(e,r),t)}),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,eN(),t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(eM(e))return null;var i=eR(e),o=this.children.get(i);return o?o.findOnPath_(eA(e),eL(t,i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,eN(),t)},e.prototype.foreachOnPath_=function(t,n,r){if(eM(t))return this;this.value&&r(n,this.value);var i=eR(t),o=this.children.get(i);return o?o.foreachOnPath_(eA(t),eL(n,i),r):new e(null)},e.prototype.foreach=function(e){this.foreach_(eN(),e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal(function(n,r){r.foreach_(eL(e,n),t)}),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal(function(t,n){n.value&&e(t,n.value)})},e}(),tK=function(){function e(e){this.writeTree_=e}return e.empty=function(){return new e(new tY(null))},e}();function tG(e,t,n){if(eM(t))return new tK(new tY(n));var r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,o=r.value,a=eW(i,t);return o=o.updateChild(a,n),new tK(e.writeTree_.set(i,o))}var s=new tY(n);return new tK(e.writeTree_.setTree(t,s))}function t$(e,t,n){var r=e;return ee(n,function(e,n){r=tG(r,eL(t,e),n)}),r}function tZ(e,t){return eM(t)?tK.empty():new tK(e.writeTree_.setTree(t,new tY(null)))}function tX(e,t){return null!=tJ(e,t)}function tJ(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(eW(n.path,t)):null}function t0(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(e6,function(e,n){t.push(new eK(e,n))}):e.writeTree_.children.inorderTraversal(function(e,n){null!=n.value&&t.push(new eK(e,n.value))}),t}function t1(e,t){if(eM(t))return e;var n=tJ(e,t);return new tK(null!=n?new tY(n):e.writeTree_.subtree(t))}function t2(e){return e.writeTree_.isEmpty()}function t3(e,t){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);var i=null;return n.children.inorderTraversal(function(n,o){".priority"===n?((0,b.hu)(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=e(eL(t,n),o,r)}),r.getChild(t).isEmpty()||null===i||(r=r.updateChild(eL(t,".priority"),i)),r}(eN(),e.writeTree_,t)}function t4(e){return e.visible}function t5(e,t,n){for(var r=tK.empty(),i=0;i<e.length;++i){var o=e[i];if(t(o)){var a=o.path,s=void 0;if(o.snap)eB(n,a)?r=tG(r,s=eW(n,a),o.snap):eB(a,n)&&(s=eW(a,n),r=tG(r,eN(),o.snap.getChild(s)));else if(o.children){if(eB(n,a))r=t$(r,s=eW(n,a),o.children);else if(eB(a,n)){if(eM(s=eW(a,n)))r=t$(r,eN(),o.children);else{var u=(0,b.DV)(o.children,eR(s));if(u){var l=u.getChild(eA(s));r=tG(r,eN(),l)}}}}else throw(0,b.g5)("WriteRecord should have .snap or .children")}}return r}function t8(e,t,n,r,i){if(r||i){var o=t1(e.visibleWrites,t);if(!i&&t2(o))return n;if(!i&&null==n&&!tX(o,eN()))return null;var a=t5(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(eB(e.path,t)||eB(t,e.path))},t),s=n||tr.EMPTY_NODE;return t3(a,s)}var u=tJ(e.visibleWrites,t);if(null!=u)return u;var l=t1(e.visibleWrites,t);if(t2(l))return n;if(null==n&&!tX(l,eN()))return null;var s=n||tr.EMPTY_NODE;return t3(l,s)}function t6(e,t,n,r){return t8(e.writeTree,e.treePath,t,n,r)}function t7(e,t){return function(e,t,n){var r=tr.EMPTY_NODE,i=tJ(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(e6,function(e,t){r=r.updateImmediateChild(e,t)}),r;if(!n)return t0(t1(e.visibleWrites,t)).forEach(function(e){r=r.updateImmediateChild(e.name,e.node)}),r;var o=t1(e.visibleWrites,t);return n.forEachChild(e6,function(e,t){var n=t3(t1(o,new ex(e)),t);r=r.updateImmediateChild(e,n)}),t0(o).forEach(function(e){r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function t9(e,t,n,r){return function(e,t,n,r,i){(0,b.hu)(r||i,"Either existingEventSnap or existingServerSnap must exist");var o=eL(t,n);if(tX(e.visibleWrites,o))return null;var a=t1(e.visibleWrites,o);return t2(a)?i.getChild(n):t3(a,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function ne(e,t){var n,r;return n=e.writeTree,r=eL(e.treePath,t),tJ(n.visibleWrites,r)}function nt(e,t,n){var r,i,o;return r=e.writeTree,i=eL(e.treePath,t),null!=(o=tJ(r.visibleWrites,i))?o:n.isCompleteForChild(t)?t3(t1(r.visibleWrites,i),n.getNode().getImmediateChild(t)):null}function nn(e,t){return nr(eL(e.treePath,t),e.writeTree)}function nr(e,t){return{treePath:e,writeTree:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ni=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;(0,b.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,b.hu)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,t_(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,tf(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,tp(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===i)this.changeMap.set(n,t_(n,e.snapshotNode,r.oldSnap));else throw(0,b.g5)("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),no=new(function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}()),na=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new tW(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return nt(this.writes_,e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r,i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:tQ(this.viewCache_),o=function(e,t,n,r,i,o,a){var s,u=t1(e.visibleWrites,t),l=tJ(u,eN());if(null!=l)s=l;else{if(null==n)return[];s=t3(u,n)}if((s=s.withIndex(a)).isEmpty()||s.isLeafNode())return[];for(var h=[],c=a.getCompare(),d=o?s.getReverseIteratorFrom(r,a):s.getIteratorFrom(r,a),p=d.getNext();p&&h.length<1;)0!==c(p,r)&&h.push(p),p=d.getNext();return h}((r=this.writes_).writeTree,r.treePath,i,t,0,n,e);return 0===o.length?null:o[0]},e}();function ns(e,t,n,r,i,o){var a=t.eventCache;if(null!=ne(r,n))return t;var s=void 0,u=void 0;if(eM(n)){if((0,b.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){var l=tQ(t),h=t7(r,l instanceof tr?l:tr.EMPTY_NODE);s=e.filter.updateFullNode(t.eventCache.getNode(),h,o)}else{var c=t6(r,tQ(t));s=e.filter.updateFullNode(t.eventCache.getNode(),c,o)}}else{var d=eR(n);if(".priority"===d){(0,b.hu)(1===eD(n),"Can't have a priority with additional path components");var p=a.getNode(),f=t9(r,n,p,u=t.serverCache.getNode());s=null!=f?e.filter.updatePriority(p,f):a.getNode()}else{var _=eA(n),v=void 0;if(a.isCompleteForChild(d)){u=t.serverCache.getNode();var y=t9(r,n,a.getNode(),u);v=null!=y?a.getNode().getImmediateChild(d).updateChild(_,y):a.getNode().getImmediateChild(d)}else v=nt(r,d,t.serverCache);s=null!=v?e.filter.updateChild(a.getNode(),d,v,_,i,o):a.getNode()}}return tz(t,s,a.isFullyInitialized()||eM(n),e.filter.filtersNodes())}function nu(e,t,n,r,i,o,a,s){var u,l=t.serverCache,h=a?e.filter:e.filter.getIndexedFilter();if(eM(n))u=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){var c=l.getNode().updateChild(n,r);u=h.updateFullNode(l.getNode(),c,null)}else{var d=eR(n);if(!l.isCompleteForPath(n)&&eD(n)>1)return t;var p=eA(n),f=l.getNode().getImmediateChild(d).updateChild(p,r);u=".priority"===d?h.updatePriority(l.getNode(),f):h.updateChild(l.getNode(),d,f,p,no,null)}var _=tH(t,u,l.isFullyInitialized()||eM(n),h.filtersNodes()),v=new na(i,_,o);return ns(e,_,n,i,v,s)}function nl(e,t,n,r,i,o,a){var s,u,l=t.eventCache,h=new na(i,t,o);if(eM(n))u=e.filter.updateFullNode(t.eventCache.getNode(),r,a),s=tz(t,u,!0,e.filter.filtersNodes());else{var c=eR(n);if(".priority"===c)u=e.filter.updatePriority(t.eventCache.getNode(),r),s=tz(t,u,l.isFullyInitialized(),l.isFiltered());else{var d=eA(n),p=l.getNode().getImmediateChild(c),f=void 0;if(eM(d))f=r;else{var _=h.getCompleteChild(c);f=null!=_?".priority"===eO(d)&&_.getChild(eq(d)).isEmpty()?_:_.updateChild(d,r):tr.EMPTY_NODE}s=p.equals(f)?t:tz(t,e.filter.updateChild(l.getNode(),c,f,d,h,a),l.isFullyInitialized(),e.filter.filtersNodes())}}return s}function nh(e,t){return e.eventCache.isCompleteForChild(t)}function nc(e,t,n){return n.foreach(function(e,n){t=t.updateChild(e,n)}),t}function nd(e,t,n,r,i,o,a,s){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;var u,l=t;u=eM(n)?r:new tY(null).setTree(n,r);var h=t.serverCache.getNode();return u.children.inorderTraversal(function(n,r){if(h.hasChild(n)){var u=nc(e,t.serverCache.getNode().getImmediateChild(n),r);l=nu(e,l,new ex(n),u,i,o,a,s)}}),u.children.inorderTraversal(function(n,r){var u=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!h.hasChild(n)&&!u){var c=nc(e,t.serverCache.getNode().getImmediateChild(n),r);l=nu(e,l,new ex(n),c,i,o,a,s)}}),l}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var np=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n=this.query_._queryParams,r=new tv(n.getIndex()),i=n.loadsAllData()?new tv(n.getIndex()):n.hasLimit()?new tg(n):new ty(n);this.processor_={filter:i};var o=t.serverCache,a=t.eventCache,s=r.updateFullNode(tr.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(tr.EMPTY_NODE,a.getNode(),null),l=new tW(s,o.isFullyInitialized(),r.filtersNodes()),h=new tW(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=tB(h,l),this.eventGenerator_=new tj(this.query_)}return Object.defineProperty(e.prototype,"query",{get:function(){return this.query_},enumerable:!1,configurable:!0}),e}();function nf(e){return 0===e.eventRegistrations_.length}function n_(e,t,n){var r=[];if(n){(0,b.hu)(null==t,"A cancel should cancel all event registrations.");var i=e.query._path;e.eventRegistrations_.forEach(function(e){var t=e.createCancelEvent(n,i);t&&r.push(t)})}if(t){for(var o=[],a=0;a<e.eventRegistrations_.length;++a){var s=e.eventRegistrations_[a];if(s.matches(t)){if(t.hasAnyCallback()){o=o.concat(e.eventRegistrations_.slice(a+1));break}}else o.push(s)}e.eventRegistrations_=o}else e.eventRegistrations_=[];return r}function nv(e,t,n,r){t.type===v.MERGE&&null!==t.source.queryId&&((0,b.hu)(tQ(e.viewCache_),"We should always have a full cache before handling merges"),(0,b.hu)(tV(e.viewCache_),"Missing event cache, even though we have a server cache"));var i,o,a=e.viewCache_,s=function(e,t,n,r,i){var o,a,s,u,l,h,c,d=new ni;if(n.type===v.OVERWRITE)n.source.fromUser?h=nl(e,t,n.path,n.snap,r,i,d):((0,b.hu)(n.source.fromServer,"Unknown source."),c=n.source.tagged||t.serverCache.isFiltered()&&!eM(n.path),h=nu(e,t,n.path,n.snap,r,i,c,d));else if(n.type===v.MERGE)n.source.fromUser?(o=n.path,a=n.children,s=t,a.foreach(function(n,a){var u=eL(o,n);nh(t,eR(u))&&(s=nl(e,s,u,a,r,i,d))}),a.foreach(function(n,a){var u=eL(o,n);nh(t,eR(u))||(s=nl(e,s,u,a,r,i,d))}),h=s):((0,b.hu)(n.source.fromServer,"Unknown source."),c=n.source.tagged||t.serverCache.isFiltered(),h=nd(e,t,n.path,n.children,r,i,c,d));else if(n.type===v.ACK_USER_WRITE)h=n.revert?function(e,t,n,r,i,o){if(null!=ne(r,n))return t;var a,s=new na(r,t,i),u=t.eventCache.getNode(),l=void 0;if(eM(n)||".priority"===eR(n)){var h=void 0;if(t.serverCache.isFullyInitialized())h=t6(r,tQ(t));else{var c=t.serverCache.getNode();(0,b.hu)(c instanceof tr,"serverChildren would be complete if leaf node"),h=t7(r,c)}l=e.filter.updateFullNode(u,h,o)}else{var d=eR(n),p=nt(r,d,t.serverCache);null==p&&t.serverCache.isCompleteForChild(d)&&(p=u.getImmediateChild(d)),(l=null!=p?e.filter.updateChild(u,d,p,eA(n),s,o):t.eventCache.getNode().hasChild(d)?e.filter.updateChild(u,d,tr.EMPTY_NODE,eA(n),s,o):u).isEmpty()&&t.serverCache.isFullyInitialized()&&(a=t6(r,tQ(t))).isLeafNode()&&(l=e.filter.updateFullNode(l,a,o))}return a=t.serverCache.isFullyInitialized()||null!=ne(r,eN()),tz(t,l,a,e.filter.filtersNodes())}(e,t,n.path,r,i,d):function(e,t,n,r,i,o,a){if(null!=ne(i,n))return t;var s=t.serverCache.isFiltered(),u=t.serverCache;if(null!=r.value){if(eM(n)&&u.isFullyInitialized()||u.isCompleteForPath(n))return nu(e,t,n,u.getNode().getChild(n),i,o,s,a);if(!eM(n))return t;var l=new tY(null);return u.getNode().forEachChild(eZ,function(e,t){l=l.set(new ex(e),t)}),nd(e,t,n,l,i,o,s,a)}var h=new tY(null);return r.foreach(function(e,t){var r=eL(n,e);u.isCompleteForPath(r)&&(h=h.set(e,u.getNode().getChild(r)))}),nd(e,t,n,h,i,o,s,a)}(e,t,n.path,n.affectedTree,r,i,d);else if(n.type===v.LISTEN_COMPLETE)u=n.path,l=t.serverCache,h=ns(e,tH(t,l.getNode(),l.isFullyInitialized()||eM(u),l.isFiltered()),u,r,no,d);else throw(0,b.g5)("Unknown operation type: "+n.type);var p=d.getChanges();return function(e,t,n){var r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=tV(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!i||r.getNode().equals(o))&&r.getNode().getPriority().equals(o.getPriority())||n.push(td(tV(t)))}}(t,h,p),{viewCache:h,changes:p}}(e.processor_,a,t,n,r);return i=e.processor_,o=s.viewCache,(0,b.hu)(o.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),(0,b.hu)(o.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),(0,b.hu)(s.viewCache.serverCache.isFullyInitialized()||!a.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,ny(e,s.changes,s.viewCache.eventCache.getNode(),null)}function ny(e,t,n,r){var i,o,a,s=r?[r]:e.eventRegistrations_;return i=e.eventGenerator_,o=[],a=[],t.forEach(function(e){if("child_changed"===e.type&&i.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)){var t;a.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}}),tU(i,o,"child_removed",t,s,n),tU(i,o,"child_added",t,s,n),tU(i,o,"child_moved",a,s,n),tU(i,o,"child_changed",t,s,n),tU(i,o,"value",t,s,n),o}var ng=function(){this.views=new Map};function nm(e,t,n,r){var i,o,a=t.source.queryId;if(null!==a){var s=e.views.get(a);return(0,b.hu)(null!=s,"SyncTree gave us an op for an invalid query."),nv(s,t,n,r)}var u=[];try{for(var l=(0,T.XA)(e.views.values()),h=l.next();!h.done;h=l.next()){var s=h.value;u=u.concat(nv(s,t,n,r))}}catch(e){i={error:e}}finally{try{h&&!h.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}return u}function nC(e,t,n,r,i){var o=t._queryIdentifier,a=e.views.get(o);if(!a){var s=t6(n,i?r:null),u=!1;return s?u=!0:(s=r instanceof tr?t7(n,r):tr.EMPTY_NODE,u=!1),new np(t,tB(new tW(s,u,!1),new tW(r,i,!1)))}return a}function nw(e){var t,n,r=[];try{for(var i=(0,T.XA)(e.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;a.query._queryParams.loadsAllData()||r.push(a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function nb(e,t){var n,r,i=null;try{for(var o=(0,T.XA)(e.views.values()),a=o.next();!a.done;a=o.next()){var s=a.value;i=i||function(e,t){var n=tQ(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!eM(t)&&!n.getImmediateChild(eR(t)).isEmpty())?n.getChild(t):null}(s,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i}function nT(e,t){if(t._queryParams.loadsAllData())return nI(e);var n=t._queryIdentifier;return e.views.get(n)}function nk(e){return null!=nI(e)}function nI(e){var t,n;try{for(var r=(0,T.XA)(e.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.query._queryParams.loadsAllData())return o}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return null}var nE=1,nP=function(e){this.listenProvider_=e,this.syncPointTree_=new tY(null),this.pendingWriteTree_={visibleWrites:tK.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map};function nS(e,t,n,r,i){var o,a;return(o=e.pendingWriteTree_,a=i,(0,b.hu)(r>o.lastWriteId,"Stacking an older write on top of newer ones"),void 0===a&&(a=!0),o.allWrites.push({path:t,snap:n,writeId:r,visible:a}),a&&(o.visibleWrites=tG(o.visibleWrites,t,n)),o.lastWriteId=r,i)?nO(e,new tL(tD(),t,n)):[]}function nx(e,t,n){void 0===n&&(n=!1);var r=function(e,t){for(var n=0;n<e.allWrites.length;n++){var r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n=e.allWrites.findIndex(function(e){return e.writeId===t});(0,b.hu)(n>=0,"removeWrite called with nonexistent writeId.");var r=e.allWrites[n];e.allWrites.splice(n,1);for(var i=r.visible,o=!1,a=e.allWrites.length-1;i&&a>=0;){var s=e.allWrites[a];s.visible&&(a>=n&&function(e,t){if(e.snap)return eB(e.path,t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&eB(eL(e.path,n),t))return!0;return!1}(s,r.path)?i=!1:eB(r.path,s.path)&&(o=!0)),a--}return!!i&&(o?(e.visibleWrites=t5(e.allWrites,t4,eN()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):r.snap?e.visibleWrites=tZ(e.visibleWrites,r.path):ee(r.children,function(t){e.visibleWrites=tZ(e.visibleWrites,eL(r.path,t))}),!0)}(e.pendingWriteTree_,t))return[];var i=new tY(null);return null!=r.snap?i=i.set(eN(),!0):ee(r.children,function(e){i=i.set(new ex(e),!0)}),nO(e,new tF(r.path,i,n))}function nN(e,t,n){return nO(e,new tL(tA(),t,n))}function nR(e,t,n,r){var i=t._path,o=e.syncPointTree_.get(i),a=[];if(o&&("default"===t._queryIdentifier||null!=nT(o,t))){var s=function(e,t,n,r){var i,o,a=t._queryIdentifier,s=[],u=[],l=nk(e);if("default"===a)try{for(var h=(0,T.XA)(e.views.entries()),c=h.next();!c.done;c=h.next()){var d=(0,T.CR)(c.value,2),p=d[0],f=d[1];u=u.concat(n_(f,n,r)),nf(f)&&(e.views.delete(p),f.query._queryParams.loadsAllData()||s.push(f.query))}}catch(e){i={error:e}}finally{try{c&&!c.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}else{var f=e.views.get(a);f&&(u=u.concat(n_(f,n,r)),nf(f)&&(e.views.delete(a),f.query._queryParams.loadsAllData()||s.push(f.query)))}return l&&!nk(e)&&s.push(new((0,b.hu)(g,"Reference.ts has not been loaded"),g)(t._repo,t._path)),{removed:s,events:u}}(o,t,n,r);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(i));var u=s.removed;a=s.events;var l=-1!==u.findIndex(function(e){return e._queryParams.loadsAllData()}),h=e.syncPointTree_.findOnPath(i,function(e,t){return nk(t)});if(l&&!h){var c=e.syncPointTree_.subtree(i);if(!c.isEmpty())for(var d=c.fold(function(e,t,n){if(t&&nk(t))return[nI(t)];var r=[];return t&&(r=nw(t)),ee(n,function(e,t){r=r.concat(t)}),r}),p=0;p<d.length;++p){var f=d[p],_=f.query,v=nF(e,f);e.listenProvider_.startListening(nU(_),nq(e,_),v.hashFn,v.onComplete)}}h||!(u.length>0)||r||(l?e.listenProvider_.stopListening(nU(t),null):u.forEach(function(t){var n=e.queryToTagMap.get(nL(t));e.listenProvider_.stopListening(nU(t),n)})),function(e,t){for(var n=0;n<t.length;++n){var r=t[n];if(!r._queryParams.loadsAllData()){var i=nL(r),o=e.queryToTagMap.get(i);e.queryToTagMap.delete(i),e.tagToQueryMap.delete(o)}}}(e,u)}return a}function nD(e,t,n){var r,i,o,a,s,u=t._path,l=null,h=!1;e.syncPointTree_.foreachOnPath(u,function(e,t){var n=eW(e,u);l=l||nb(t,n),h=h||nk(t)});var c=e.syncPointTree_.get(u);c?(h=h||nk(c),l=l||nb(c,eN())):(c=new ng,e.syncPointTree_=e.syncPointTree_.set(u,c)),null!=l?s=!0:(s=!1,l=tr.EMPTY_NODE,e.syncPointTree_.subtree(u).foreachChild(function(e,t){var n=nb(t,eN());n&&(l=l.updateImmediateChild(e,n))}));var d=null!=nT(c,t);if(!d&&!t._queryParams.loadsAllData()){var p=nL(t);(0,b.hu)(!e.queryToTagMap.has(p),"View does not exist, but we have a tag");var f=nE++;e.queryToTagMap.set(p,f),e.tagToQueryMap.set(f,p)}var _=nr(u,e.pendingWriteTree_),v=(i=nC(r=c,t,_,l,s),r.views.has(t._queryIdentifier)||r.views.set(t._queryIdentifier,i),!function(e,t){e.eventRegistrations_.push(t)}(i,n),o=i.viewCache_.eventCache,a=[],o.getNode().isLeafNode()||o.getNode().forEachChild(e6,function(e,t){a.push(tp(e,t))}),o.isFullyInitialized()&&a.push(td(o.getNode())),ny(i,a,o.getNode(),n));if(!d&&!h){var y=nT(c,t);v=v.concat(function(e,t,n){var r=t._path,i=nq(e,t),o=nF(e,n),a=e.listenProvider_.startListening(nU(t),i,o.hashFn,o.onComplete),s=e.syncPointTree_.subtree(r);if(i)(0,b.hu)(!nk(s.value),"If we're adding a query, it shouldn't be shadowed");else for(var u=s.fold(function(e,t,n){if(!eM(e)&&t&&nk(t))return[nI(t).query];var r=[];return t&&(r=r.concat(nw(t).map(function(e){return e.query}))),ee(n,function(e,t){r=r.concat(t)}),r}),l=0;l<u.length;++l){var h=u[l];e.listenProvider_.stopListening(nU(h),nq(e,h))}return a}(e,t,y))}return v}function nA(e,t,n){var r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,function(e,n){var r=nb(n,eW(e,t));if(r)return r});return t8(r,t,i,n,!0)}function nO(e,t){var n;return function e(t,n,r,i){if(eM(t.path))return function e(t,n,r,i){var o=n.get(eN());null==r&&null!=o&&(r=nb(o,eN()));var a=[];return n.children.inorderTraversal(function(n,o){var s=r?r.getImmediateChild(n):null,u=nn(i,n),l=t.operationForChild(n);l&&(a=a.concat(e(l,o,s,u)))}),o&&(a=a.concat(nm(o,t,i,r))),a}(t,n,r,i);var o=n.get(eN());null==r&&null!=o&&(r=nb(o,eN()));var a=[],s=eR(t.path),u=t.operationForChild(s),l=n.children.get(s);if(l&&u){var h=r?r.getImmediateChild(s):null,c=nn(i,s);a=a.concat(e(u,l,h,c))}return o&&(a=a.concat(nm(o,t,i,r))),a}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,nr(eN(),n)))}function nF(e,t){var n=t.query,r=nq(e,n);return{hashFn:function(){return(t.viewCache_.serverCache.getNode()||tr.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?function(e,t,n){var r=nM(e,n);if(!r)return[];var i=nW(r),o=i.path,a=i.queryId,s=eW(o,t);return nj(e,o,new tq(tO(a),s))}(e,n._path,r):(i=n._path,nO(e,new tq(tA(),i)));var i,o,a,s=(o="Unknown Error","too_big"===t?o="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?o="Client doesn't have permission to access the desired data.":"unavailable"===t&&(o="The service is unavailable"),(a=Error(t+" at "+n._path.toString()+": "+o)).code=t.toUpperCase(),a);return nR(e,n,null,s)}}}function nq(e,t){var n=nL(t);return e.queryToTagMap.get(n)}function nL(e){return e._path.toString()+"$"+e._queryIdentifier}function nM(e,t){return e.tagToQueryMap.get(t)}function nW(e){var t=e.indexOf("$");return(0,b.hu)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new ex(e.substr(0,t))}}function nj(e,t,n){var r=e.syncPointTree_.get(t);return(0,b.hu)(r,"Missing sync point for query tag that we're tracking"),nm(r,n,nr(t,e.pendingWriteTree_),null)}function nU(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new((0,b.hu)(m,"Reference.ts has not been loaded"),m)(e._repo,e._path):e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nB=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){return new e(this.node_.getImmediateChild(t))},e.prototype.node=function(){return this.node_},e}(),nz=function(){function e(e,t){this.syncTree_=e,this.path_=t}return e.prototype.getImmediateChild=function(t){var n=eL(this.path_,t);return new e(this.syncTree_,n)},e.prototype.node=function(){return nA(this.syncTree_,this.path_)},e}(),nH=function(e,t,n){return e&&"object"==typeof e?((0,b.hu)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?nV(e[".sv"],t,n):"object"==typeof e[".sv"]?nQ(e[".sv"],t):void(0,b.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},nV=function(e,t,n){if("timestamp"===e)return n.timestamp;(0,b.hu)(!1,"Unexpected server value: "+e)},nQ=function(e,t,n){e.hasOwnProperty("increment")||(0,b.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&(0,b.hu)(!1,"Unexpected increment value: "+r);var i=t.node();if((0,b.hu)(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var o=i.getValue();return"number"!=typeof o?r:o+r},nY=function(e,t,n,r){return nG(t,new nz(n,e),r)},nK=function(e,t,n){return nG(e,new nB(t),n)};function nG(e,t,n){var r,i=nH(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return r=e,i!==e.getPriority().val()&&(r=r.updatePriority(new e8(i))),e.forEachChild(e6,function(e,i){var o=nG(i,t.getImmediateChild(e),n);o!==i&&(r=r.updateImmediateChild(e,o))}),r;var o=nH(e.getValue(),t,n);return o!==e.getValue()||i!==e.getPriority().val()?new e8(o,to(i)):e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var n$=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n={children:{},childCount:0}),this.name=e,this.parent=t,this.node=n};function nZ(e,t){for(var n=t instanceof ex?t:new ex(t),r=e,i=eR(n);null!==i;){var o=(0,b.DV)(r.node.children,i)||{children:{},childCount:0};r=new n$(i,r,o),i=eR(n=eA(n))}return r}function nX(e){return e.node.value}function nJ(e,t){e.node.value=t,function e(t){var n,r,i,o,a;null!==t.parent&&(n=t.parent,r=t.name,o=void 0===nX(i=t)&&!n0(i),a=(0,b.r3)(n.node.children,r),o&&a?(delete n.node.children[r],n.node.childCount--,e(n)):o||a||(n.node.children[r]=i.node,n.node.childCount++,e(n)))}(e)}function n0(e){return e.node.childCount>0}function n1(e,t){ee(e.node.children,function(n,r){t(new n$(n,e,r))})}function n2(e){return new ex(null===e.parent?e.name:n2(e.parent)+"/"+e.name)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var n3=/[\[\].#$\/\u0000-\u001F\u007F]/,n4=/[\[\].#$\u0000-\u001F\u007F]/,n5=function(e){return"string"==typeof e&&0!==e.length&&!n3.test(e)},n8=function(e){return"string"==typeof e&&0!==e.length&&!n4.test(e)},n6=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!V(e)||e&&"object"==typeof e&&(0,b.r3)(e,".sv")},n7=function(e,t,n,r){r&&void 0===t||n9((0,b.gK)(e,"value"),t,n)},n9=function(e,t,n){var r=n instanceof ex?new ez(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+eV(r));if("function"==typeof t)throw Error(e+"contains a function "+eV(r)+" with contents = "+t.toString());if(V(t))throw Error(e+"contains "+t.toString()+" "+eV(r));if("string"==typeof t&&t.length>3495253.3333333335&&(0,b.ug)(t)>10485760)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+eV(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(ee(t,function(t,n){var a;if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!n5(t)))throw Error(e+" contains an invalid key ("+t+") "+eV(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(t),r.byteLength_+=(0,b.ug)(t),eH(r),n9(e,n,r),a=r.parts_.pop(),r.byteLength_-=(0,b.ug)(a),r.parts_.length>0&&(r.byteLength_-=1)}),i&&o)throw Error(e+' contains ".value" child '+eV(r)+" in addition to actual children.")}},re=function(e,t){for(n=0;n<t.length;n++)for(var n,r,i=eF(r=t[n]),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!n5(i[o]))throw Error(e+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(ej);var a=null;for(n=0;n<t.length;n++){if(r=t[n],null!==a&&eB(a,r))throw Error(e+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}},rt=function(e,t,n,r){if(!r||void 0!==t){var i=(0,b.gK)(e,"values");if(!(t&&"object"==typeof t)||Array.isArray(t))throw Error(i+" must be an object containing the children to replace.");var o=[];ee(t,function(e,t){var r=new ex(e);if(n9(i,t,eL(n,r)),".priority"===eO(r)&&!n6(t))throw Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(r)}),re(i,o)}},rn=function(e,t,n){if(!n||void 0!==t){if(V(t))throw Error((0,b.gK)(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!n6(t))throw Error((0,b.gK)(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},rr=function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw Error((0,b.gK)(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},ri=function(e,t,n,r){if((!r||void 0!==n)&&!n5(n))throw Error((0,b.gK)(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},ro=function(e,t,n,r){if((!r||void 0!==n)&&!n8(n))throw Error((0,b.gK)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ra=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ro(e,t,n,r)},rs=function(e,t){if(".info"===eR(t))throw Error(e+" failed = Can't modify data under /.info/")},ru=function(e,t){var n,r=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!n5(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==r.length&&((n=r)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!n8(n)))throw Error((0,b.gK)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},rl=function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw Error((0,b.gK)(e,t)+"must be a boolean.")},rh=function(){this.eventLists_=[],this.recursionDepth_=0};function rc(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r],o=i.getPath();null===n||eU(o,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(i)}n&&e.eventLists_.push(n)}function rd(e,t,n){rc(e,n),rf(e,function(e){return eU(e,t)})}function rp(e,t,n){rc(e,n),rf(e,function(e){return eB(e,t)||eB(t,e)})}function rf(e,t){e.recursionDepth_++;for(var n=!0,r=0;r<e.eventLists_.length;r++){var i=e.eventLists_[r];i&&(t(i.path)?(function(e){for(var t=0;t<e.events.length;t++){var n=e.events[t];if(null!==n){e.events[t]=null;var r=n.getEventRunner();q&&W("event: "+n.toString()),ei(r)}}}(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var r_="repo_interrupt",rv=function(){function e(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new rh,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=tP(),this.transactionQueueTree_=new n$,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e}();function ry(e){var t=e.infoData_.getNode(new ex(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function rg(e){var t;return(t=t={timestamp:ry(e)}).timestamp=t.timestamp||new Date().getTime(),t}function rm(e,t,n,r,i){e.dataUpdateCount++;var o=new ex(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;var a=[];if(i){if(r){var s=(0,b.UI)(n,function(e){return to(e)});a=function(e,t,n,r){var i=nM(e,r);if(!i)return[];var o=nW(i),a=o.path,s=o.queryId,u=eW(a,t),l=tY.fromObject(n);return nj(e,a,new tM(tO(s),u,l))}(e.serverSyncTree_,o,s,i)}else{var u=to(n);a=function(e,t,n,r){var i=nM(e,r);if(null==i)return[];var o=nW(i),a=o.path,s=o.queryId,u=eW(a,t);return nj(e,a,new tL(tO(s),u,n))}(e.serverSyncTree_,o,u,i)}}else if(r){var l,h,c=(0,b.UI)(n,function(e){return to(e)});l=e.serverSyncTree_,h=tY.fromObject(c),a=nO(l,new tM(tA(),o,h))}else{var d=to(n);a=nN(e.serverSyncTree_,o,d)}var p=o;a.length>0&&(p=rR(e,o)),rp(e.eventQueue_,p,a)}function rC(e,t){var n,r,i;rw(e,"connected",t),!1===t&&(rP(e,"onDisconnectEvents"),n=rg(e),r=tP(),tx(e.onDisconnect_,eN(),function(t,i){var o=nY(t,i,e.serverSyncTree_,n);tS(r,t,o)}),i=[],tx(r,eN(),function(t,n){i=i.concat(nN(e.serverSyncTree_,t,n));var r=rF(e,t);rR(e,r)}),e.onDisconnect_=tP(),rp(e.eventQueue_,eN(),i))}function rw(e,t,n){var r=new ex("/.info/"+t),i=to(n);e.infoData_.updateSnapshot(r,i);var o=nN(e.infoSyncTree_,r,i);rp(e.eventQueue_,r,o)}function rb(e){return e.nextWriteId_++}function rT(e,t,n,r,i){rP(e,"set",{path:t.toString(),value:n,priority:r});var o=rg(e),a=to(n,r),s=nK(a,nA(e.serverSyncTree_,t),o),u=rb(e),l=nS(e.serverSyncTree_,t,s,u,!0);rc(e.eventQueue_,l),e.server_.put(t.toString(),a.val(!0),function(n,r){var o="ok"===n;o||z("set at "+t+" failed: "+n);var a=nx(e.serverSyncTree_,u,!o);rp(e.eventQueue_,t,a),rS(e,i,n,r)});var h=rF(e,t);rR(e,h),rp(e.eventQueue_,h,[])}function rk(e,t,n,r){var i=to(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),function(n,o){"ok"===n&&tS(e.onDisconnect_,t,i),rS(e,r,n,o)})}function rI(e,t,n){var r;r=".info"===eR(t._path)?nR(e.infoSyncTree_,t,n):nR(e.serverSyncTree_,t,n),rd(e.eventQueue_,t._path,r)}function rE(e){e.persistentConnection_&&e.persistentConnection_.interrupt(r_)}function rP(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),W.apply(void 0,(0,T.ev)([r],(0,T.CR)(t)))}function rS(e,t,n,r){t&&ei(function(){if("ok"===n)t(null);else{var e=(n||"error").toUpperCase(),i=e;r&&(i+=": "+r);var o=Error(i);o.code=e,t(o)}})}function rx(e,t,n){return nA(e.serverSyncTree_,t,n)||tr.EMPTY_NODE}function rN(e,t){if(void 0===t&&(t=e.transactionQueueTree_),t||rO(e,t),nX(t)){var n=rA(e,t);(0,b.hu)(n.length>0,"Sending zero length transaction queue"),n.every(function(e){return 0===e.status})&&function(e,t,n){for(var r=rx(e,t,n.map(function(e){return e.currentWriteId})),i=r,o=r.hash(),a=0;a<n.length;a++){var s=n[a];(0,b.hu)(0===s.status,"tryToSendTransactionQueue_: items in queue should all be run."),s.status=1,s.retryCount++;var u=eW(t,s.path);i=i.updateChild(u,s.currentOutputSnapshotRaw)}var l=i.val(!0);e.server_.put(t.toString(),l,function(r){rP(e,"transaction put response",{path:t.toString(),status:r});var i=[];if("ok"===r){for(var o=[],a=function(t){n[t].status=2,i=i.concat(nx(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&o.push(function(){return n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)}),n[t].unwatcher()},s=0;s<n.length;s++)a(s);rO(e,nZ(e.transactionQueueTree_,t)),rN(e,e.transactionQueueTree_),rp(e.eventQueue_,t,i);for(var s=0;s<o.length;s++)ei(o[s])}else{if("datastale"===r)for(var s=0;s<n.length;s++)3===n[s].status?n[s].status=4:n[s].status=0;else{z("transaction at "+t.toString()+" failed: "+r);for(var s=0;s<n.length;s++)n[s].status=4,n[s].abortReason=r}rR(e,t)}},o)}(e,n2(t),n)}else n0(t)&&n1(t,function(t){rN(e,t)})}function rR(e,t){var n=rD(e,t),r=n2(n),i=rA(e,n);return function(e,t,n){if(0!==t.length){for(var r=[],i=[],o=t.filter(function(e){return 0===e.status}).map(function(e){return e.currentWriteId}),a=function(a){var s,u=t[a],l=eW(n,u.path),h=!1;if((0,b.hu)(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===u.status)h=!0,s=u.abortReason,i=i.concat(nx(e.serverSyncTree_,u.currentWriteId,!0));else if(0===u.status){if(u.retryCount>=25)h=!0,s="maxretry",i=i.concat(nx(e.serverSyncTree_,u.currentWriteId,!0));else{var c=rx(e,u.path,o);u.currentInputSnapshot=c;var d=t[a].update(c.val());if(void 0!==d){n9("transaction failed: Data returned ",d,u.path);var p=to(d);"object"==typeof d&&null!=d&&(0,b.r3)(d,".priority")||(p=p.updatePriority(c.getPriority()));var f=u.currentWriteId,_=nK(p,c,rg(e));u.currentOutputSnapshotRaw=p,u.currentOutputSnapshotResolved=_,u.currentWriteId=rb(e),o.splice(o.indexOf(f),1),i=(i=i.concat(nS(e.serverSyncTree_,u.path,_,u.currentWriteId,u.applyLocally))).concat(nx(e.serverSyncTree_,f,!0))}else h=!0,s="nodata",i=i.concat(nx(e.serverSyncTree_,u.currentWriteId,!0))}}rp(e.eventQueue_,n,i),i=[],h&&(t[a].status=2,setTimeout(t[a].unwatcher,Math.floor(0)),t[a].onComplete&&("nodata"===s?r.push(function(){return t[a].onComplete(null,!1,t[a].currentInputSnapshot)}):r.push(function(){return t[a].onComplete(Error(s),!1,null)})))},s=0;s<t.length;s++)a(s);rO(e,e.transactionQueueTree_);for(var s=0;s<r.length;s++)ei(r[s]);rN(e,e.transactionQueueTree_)}}(e,i,r),r}function rD(e,t){var n,r=e.transactionQueueTree_;for(n=eR(t);null!==n&&void 0===nX(r);)r=nZ(r,n),n=eR(t=eA(t));return r}function rA(e,t){var n=[];return function e(t,n,r){var i=nX(n);if(i)for(var o=0;o<i.length;o++)r.push(i[o]);n1(n,function(n){e(t,n,r)})}(e,t,n),n.sort(function(e,t){return e.order-t.order}),n}function rO(e,t){var n=nX(t);if(n){for(var r=0,i=0;i<n.length;i++)2!==n[i].status&&(n[r]=n[i],r++);n.length=r,nJ(t,n.length>0?n:void 0)}n1(t,function(t){rO(e,t)})}function rF(e,t){var n=n2(rD(e,t)),r=nZ(e.transactionQueueTree_,t);return!function(e,t,n){for(var r=e.parent;null!==r;){if(t(r))return!0;r=r.parent}}(r,function(t){rq(e,t)}),rq(e,r),!function e(t,n,r,i){r&&!i&&n(t),n1(t,function(t){e(t,n,!0,i)}),r&&i&&n(t)}(r,function(t){rq(e,t)}),n}function rq(e,t){var n=nX(t);if(n){for(var r=[],i=[],o=-1,a=0;a<n.length;a++)3===n[a].status||(1===n[a].status?((0,b.hu)(o===a-1,"All SENT items should be at beginning of queue."),o=a,n[a].status=3,n[a].abortReason="set"):((0,b.hu)(0===n[a].status,"Unexpected transaction status in abort"),n[a].unwatcher(),i=i.concat(nx(e.serverSyncTree_,n[a].currentWriteId,!0)),n[a].onComplete&&r.push(n[a].onComplete.bind(null,Error("set"),!1,null))));-1===o?nJ(t,void 0):n.length=o+1,rp(e.eventQueue_,n2(t),i);for(var a=0;a<r.length;a++)ei(r[a])}}var rL=function(e,t){var n=rM(e),r=n.namespace;"firebase.com"===n.domain&&B(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||B("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||H();var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new ed(n.host,n.secure,r,t,i,"",r!==n.subdomain),path:new ex(n.pathString)}},rM=function(e){var t="",n="",r="",i="",o="",a=!0,s="https",u=443;if("string"==typeof e){var l=e.indexOf("//");l>=0&&(s=e.substring(0,l-1),e=e.substring(l+2));var h=e.indexOf("/");-1===h&&(h=e.length);var c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(h,c)),h<c&&(i=/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(h,c)));var d=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var i=(0,T.XA)(e.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):z("Invalid query segment '"+a+"' in query '"+e+"'")}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,c)));(l=t.indexOf(":"))>=0?(a="https"===s||"wss"===s,u=parseInt(t.substring(l+1),10)):l=t.length;var p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{var f=t.indexOf(".");r=t.substring(0,f).toLowerCase(),n=t.substring(f+1),o=r}"ns"in d&&(o=d.ns)}return{host:t,port:u,domain:n,subdomain:r,secure:a,scheme:s,pathString:i,namespace:o}},rW=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+(0,b.Pz)(this.snapshot.exportVal())},e}(),rj=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),rU=function(){function e(e,t){this.snapshotCallback=e,this.cancelCallback=t}return e.prototype.onValue=function(e,t){this.snapshotCallback.call(null,e,t)},e.prototype.onCancel=function(e){return(0,b.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)},Object.defineProperty(e.prototype,"hasCancelCallback",{get:function(){return!!this.cancelCallback},enumerable:!1,configurable:!0}),e.prototype.matches=function(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context},e}(),rB=function(){function e(e,t){this._repo=e,this._path=t}return e.prototype.cancel=function(){var e=new b.BH;return function(e,t,n){e.server_.onDisconnectCancel(t.toString(),function(r,i){"ok"===r&&function e(t,n){if(eM(n))return t.value=null,t.children.clear(),!0;if(null!==t.value){if(t.value.isLeafNode())return!1;var r=t.value;return t.value=null,r.forEachChild(e6,function(e,n){tS(t,new ex(e),n)}),e(t,n)}if(!(t.children.size>0))return!0;var i=eR(n);return n=eA(n),t.children.has(i)&&e(t.children.get(i),n)&&t.children.delete(i),0===t.children.size}(e.onDisconnect_,t),rS(e,n,r,i)})}(this._repo,this._path,e.wrapCallback(function(){})),e.promise},e.prototype.remove=function(){rs("OnDisconnect.remove",this._path);var e=new b.BH;return rk(this._repo,this._path,null,e.wrapCallback(function(){})),e.promise},e.prototype.set=function(e){rs("OnDisconnect.set",this._path),n7("OnDisconnect.set",e,this._path,!1);var t=new b.BH;return rk(this._repo,this._path,e,t.wrapCallback(function(){})),t.promise},e.prototype.setWithPriority=function(e,t){rs("OnDisconnect.setWithPriority",this._path),n7("OnDisconnect.setWithPriority",e,this._path,!1),rn("OnDisconnect.setWithPriority",t,!1);var n=new b.BH;return function(e,t,n,r,i){var o=to(n,r);e.server_.onDisconnectPut(t.toString(),o.val(!0),function(n,r){"ok"===n&&tS(e.onDisconnect_,t,o),rS(e,i,n,r)})}(this._repo,this._path,e,t,n.wrapCallback(function(){})),n.promise},e.prototype.update=function(e){rs("OnDisconnect.update",this._path),rt("OnDisconnect.update",e,this._path,!1);var t=new b.BH;return function(e,t,n,r){if((0,b.xb)(n)){W("onDisconnect().update() called with empty data.  Don't do anything."),rS(e,r,"ok",void 0);return}e.server_.onDisconnectMerge(t.toString(),n,function(i,o){"ok"===i&&ee(n,function(n,r){var i=to(r);tS(e.onDisconnect_,eL(t,n),i)}),rS(e,r,i,o)})}(this._repo,this._path,e,t.wrapCallback(function(){})),t.promise},e}(),rz=function(){function e(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}return Object.defineProperty(e.prototype,"key",{get:function(){return eM(this._path)?null:eO(this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new rY(this._repo,this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryIdentifier",{get:function(){var e=X(tk(this._queryParams));return"{}"===e?"default":e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryObject",{get:function(){return tk(this._queryParams)},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!((t=(0,b.m9)(t))instanceof e))return!1;var n=this._repo===t._repo,r=eU(this._path,t._path),i=this._queryIdentifier===t._queryIdentifier;return n&&r&&i},e.prototype.toJSON=function(){return this.toString()},e.prototype.toString=function(){return this._repo.toString()+function(e){for(var t="",n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)},e}();function rH(e,t){if(!0===e._orderByCalled)throw Error(t+": You can't combine multiple orderBy calls.")}function rV(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===eZ){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==Y)throw Error(r);if("string"!=typeof t)throw Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==K)throw Error(r);if("string"!=typeof n)throw Error(i)}}else if(e.getIndex()===e6){if(null!=t&&!n6(t)||null!=n&&!n6(n))throw Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,b.hu)(e.getIndex() instanceof ta||e.getIndex()===ts,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function rQ(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var rY=function(e){function t(t,n){return e.call(this,t,n,new tm,!1)||this}return(0,T.ZT)(t,e),Object.defineProperty(t.prototype,"parent",{get:function(){var e=eq(this._path);return null===e?null:new t(this._repo,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e},enumerable:!1,configurable:!0}),t}(rz),rK=function(){function e(e,t,n){this._node=e,this.ref=t,this._index=n}return Object.defineProperty(e.prototype,"priority",{get:function(){return this._node.getPriority().val()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.ref.key},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._node.numChildren()},enumerable:!1,configurable:!0}),e.prototype.child=function(t){var n=new ex(t),r=rZ(this.ref,t);return new e(this._node.getChild(n),r,e6)},e.prototype.exists=function(){return!this._node.isEmpty()},e.prototype.exportVal=function(){return this._node.val(!0)},e.prototype.forEach=function(t){var n=this;return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,function(r,i){return t(new e(i,rZ(n.ref,r),e6))})},e.prototype.hasChild=function(e){var t=new ex(e);return!this._node.getChild(t).isEmpty()},e.prototype.hasChildren=function(){return!this._node.isLeafNode()&&!this._node.isEmpty()},e.prototype.toJSON=function(){return this.exportVal()},e.prototype.val=function(){return this._node.val()},e}();function rG(e,t){return(e=(0,b.m9)(e))._checkNotDeleted("ref"),void 0!==t?rZ(e._root,t):e._root}function r$(e,t){(e=(0,b.m9)(e))._checkNotDeleted("refFromURL");var n=rL(t,e._repo.repoInfo_.nodeAdmin);ru("refFromURL",n);var r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||B("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),rG(e,n.path.toString())}function rZ(e,t){return null===eR((e=(0,b.m9)(e))._path)?ra("child","path",t,!1):ro("child","path",t,!1),new rY(e._repo,eL(e._path,t))}function rX(e,t){rs("set",(e=(0,b.m9)(e))._path),n7("set",t,e._path,!1);var n=new b.BH;return rT(e._repo,e._path,t,null,n.wrapCallback(function(){})),n.promise}var rJ=function(){function e(e){this.callbackContext=e}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t._queryParams.getIndex();return new rW("value",this,new rK(e.snapshotNode,new rY(t._repo,t._path),n))},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,null)}},e.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new rj(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))},e.prototype.hasAnyCallback=function(){return null!==this.callbackContext},e}(),r0=function(){function e(e,t){this.eventType=e,this.callbackContext=t}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t},e.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new rj(this,e,t):null},e.prototype.createEvent=function(e,t){(0,b.hu)(null!=e.childName,"Child events should have a childName.");var n=rZ(new rY(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new rW(e.type,this,new rK(e.snapshotNode,n,r),e.prevName)},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,e.prevName)}},e.prototype.matches=function(t){return t instanceof e&&this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext))},e.prototype.hasAnyCallback=function(){return!!this.callbackContext},e}();function r1(e,t,n,r,i){if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){var o,a,s,u=n,l=function(t,n){u(t,n),rI(e._repo,e,c)};l.userCallback=n.userCallback,l.context=n.context,n=l}var h=new rU(n,s||void 0),c="value"===t?new rJ(h):new r0(t,h);return o=e._repo,a=".info"===eR(e._path)?nD(o.infoSyncTree_,e,c):nD(o.serverSyncTree_,e,c),rd(o.eventQueue_,e._path,a),function(){return rI(e._repo,e,c)}}function r2(e,t,n,r){return r1(e,"value",t,n,r)}function r3(e,t,n,r){return r1(e,"child_added",t,n,r)}function r4(e,t,n,r){return r1(e,"child_changed",t,n,r)}function r5(e,t,n,r){return r1(e,"child_moved",t,n,r)}function r8(e,t,n,r){return r1(e,"child_removed",t,n,r)}function r6(e,t,n){var r=null,i=n?new rU(n):null;"value"===t?r=new rJ(i):t&&(r=new r0(t,i)),rI(e._repo,e,r)}var r7=function(){},r9=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,T.ZT)(t,e),t.prototype._apply=function(e){n7("endAt",this._value,e._path,!0);var t=tw(e._queryParams,this._value,this._key);if(rQ(t),rV(t),e._queryParams.hasEnd())throw Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new rz(e._repo,e._path,t,e._orderByCalled)},t}(r7),ie=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,T.ZT)(t,e),t.prototype._apply=function(e){n7("endBefore",this._value,e._path,!1);var t,n,r,i,o=(t=e._queryParams,n=this._value,r=this._key,t.index_===eZ?("string"==typeof n&&(n=tc(n)),i=tw(t,n,r)):i=tw(t,n,null==r?Y:tc(r)),i.endBeforeSet_=!0,i);if(rQ(o),rV(o),e._queryParams.hasEnd())throw Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new rz(e._repo,e._path,o,e._orderByCalled)},t}(r7),it=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,T.ZT)(t,e),t.prototype._apply=function(e){n7("startAt",this._value,e._path,!0);var t=tC(e._queryParams,this._value,this._key);if(rQ(t),rV(t),e._queryParams.hasStart())throw Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new rz(e._repo,e._path,t,e._orderByCalled)},t}(r7),ir=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,T.ZT)(t,e),t.prototype._apply=function(e){n7("startAfter",this._value,e._path,!1);var t,n,r,i,o=(t=e._queryParams,n=this._value,r=this._key,t.index_===eZ?("string"==typeof n&&(n=th(n)),i=tC(t,n,r)):i=tC(t,n,null==r?K:th(r)),i.startAfterSet_=!0,i);if(rQ(o),rV(o),e._queryParams.hasStart())throw Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new rz(e._repo,e._path,o,e._orderByCalled)},t}(r7),ii=function(e){function t(t){var n=e.call(this)||this;return n._limit=t,n}return(0,T.ZT)(t,e),t.prototype._apply=function(e){var t,n,r;if(e._queryParams.hasLimit())throw Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new rz(e._repo,e._path,(t=e._queryParams,n=this._limit,(r=t.copy()).limitSet_=!0,r.limit_=n,r.viewFrom_="l",r),e._orderByCalled)},t}(r7),io=function(e){function t(t){var n=e.call(this)||this;return n._limit=t,n}return(0,T.ZT)(t,e),t.prototype._apply=function(e){var t,n,r;if(e._queryParams.hasLimit())throw Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new rz(e._repo,e._path,(t=e._queryParams,n=this._limit,(r=t.copy()).limitSet_=!0,r.limit_=n,r.viewFrom_="r",r),e._orderByCalled)},t}(r7),ia=function(e){function t(t){var n=e.call(this)||this;return n._path=t,n}return(0,T.ZT)(t,e),t.prototype._apply=function(e){rH(e,"orderByChild");var t=new ex(this._path);if(eM(t))throw Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");var n=new ta(t),r=tb(e._queryParams,n);return rV(r),new rz(e._repo,e._path,r,!0)},t}(r7),is=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,T.ZT)(t,e),t.prototype._apply=function(e){rH(e,"orderByKey");var t=tb(e._queryParams,eZ);return rV(t),new rz(e._repo,e._path,t,!0)},t}(r7),iu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,T.ZT)(t,e),t.prototype._apply=function(e){rH(e,"orderByPriority");var t=tb(e._queryParams,e6);return rV(t),new rz(e._repo,e._path,t,!0)},t}(r7),il=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,T.ZT)(t,e),t.prototype._apply=function(e){rH(e,"orderByValue");var t=tb(e._queryParams,ts);return rV(t),new rz(e._repo,e._path,t,!0)},t}(r7),ih=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,T.ZT)(t,e),t.prototype._apply=function(e){if(n7("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new r9(this._value,this._key)._apply(new it(this._value,this._key)._apply(e))},t}(r7);function ic(e){for(var t,n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=(0,b.m9)(e);try{for(var a=(0,T.XA)(r),s=a.next();!s.done;s=a.next())o=s.value._apply(o)}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o}(0,b.hu)(!g,"__referenceConstructor has already been defined"),g=rY,(0,b.hu)(!m,"__referenceConstructor has already been defined"),m=rY;var id={},ip=!1;function i_(e,t,n,r,i){var o,a,s,u,l,h=r||e.options.databaseURL;void 0===h&&(e.options.projectId||B("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),W("Using default host for project ",e.options.projectId),h=e.options.projectId+"-default-rtdb.firebaseio.com");var c=rL(h,i),d=c.repoInfo,p=void 0;void 0!==I&&(p=I.env.FIREBASE_DATABASE_EMULATOR_HOST),p?(l=!0,d=(c=rL(h="http://"+p+"?ns="+d.namespace,i)).repoInfo):l=!c.repoInfo.secure;var f=i&&l?new eu(eu.OWNER):new es(e.name,e.options,t);return ru("Invalid Firebase Database URL",c),eM(c.path)||B("Database URL must point to the root of a Firebase Database (not including a child path)."),new iv((o=d,a=new ea(e.name,n),(s=id[e.name])||(s={},id[e.name]=s),(u=s[o.toURLString()])&&B("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),u=new rv(o,ip,f,a),s[o.toURLString()]=u,u),e)}var iv=function(){function e(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}return Object.defineProperty(e.prototype,"_repo",{get:function(){return this._instanceStarted||(function(e,t,n){var r,i,o;if(e.stats_=ey(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new tI(e.repoInfo_,function(t,n,r,i){rm(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(function(){return rC(e,!0)},0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,b.Pz)(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new eY(e.repoInfo_,t,function(t,n,r,i){rm(e,t,n,r,i)},function(t){rC(e,t)},function(t){ee(t,function(t,n){rw(e,t,n)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(function(t){e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(function(t){e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=(r=e.repoInfo_,i=function(){return new tR(e.stats_,e.server_)},ev[o=r.toString()]||(ev[o]=i()),ev[o]),e.infoData_=new tE,e.infoSyncTree_=new nP({startListening:function(t,n,r,i){var o=[],a=e.infoData_.getNode(t._path);return a.isEmpty()||(o=nN(e.infoSyncTree_,t._path,a),setTimeout(function(){i("ok")},0)),o},stopListening:function(){}}),rw(e,"connected",!1),e.serverSyncTree_=new nP({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,function(n,r){var o=i(n,r);rp(e.eventQueue_,t._path,o)}),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_root",{get:function(){return this._rootInternal||(this._rootInternal=new rY(this._repo,eN())),this._rootInternal},enumerable:!1,configurable:!0}),e.prototype._delete=function(){var e,t,n;return this._checkNotDeleted("delete"),e=this._repo,(n=id[t=this.app.name])&&n[e.key]===e||B("Database "+t+"("+e.repoInfo_+") has already been deleted."),rE(e),delete n[e.key],this._repoInternal=null,this._rootInternal=null,Promise.resolve()},e.prototype._checkNotDeleted=function(e){null===this._rootInternal&&B("Cannot call "+e+" on a deleted database.")},e}(),iy={".sv":"timestamp"},ig=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),im=function(){function e(e){this._delegate=e}return e.prototype.cancel=function(e){(0,b.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,b.Wj)("OnDisconnect.cancel","onComplete",e,!0);var t=this._delegate.cancel();return e&&t.then(function(){return e(null)},function(t){return e(t)}),t},e.prototype.remove=function(e){(0,b.Dv)("OnDisconnect.remove",0,1,arguments.length),(0,b.Wj)("OnDisconnect.remove","onComplete",e,!0);var t=this._delegate.remove();return e&&t.then(function(){return e(null)},function(t){return e(t)}),t},e.prototype.set=function(e,t){(0,b.Dv)("OnDisconnect.set",1,2,arguments.length),(0,b.Wj)("OnDisconnect.set","onComplete",t,!0);var n=this._delegate.set(e);return t&&n.then(function(){return t(null)},function(e){return t(e)}),n},e.prototype.setWithPriority=function(e,t,n){(0,b.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,b.Wj)("OnDisconnect.setWithPriority","onComplete",n,!0);var r=this._delegate.setWithPriority(e,t);return n&&r.then(function(){return n(null)},function(e){return n(e)}),r},e.prototype.update=function(e,t){if((0,b.Dv)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,z("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,b.Wj)("OnDisconnect.update","onComplete",t,!0);var i=this._delegate.update(e);return t&&i.then(function(){return t(null)},function(e){return t(e)}),i},e}(),iC=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return(0,b.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),iw=function(){function e(e,t){this._database=e,this._delegate=t}return e.prototype.val=function(){return(0,b.Dv)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()},e.prototype.exportVal=function(){return(0,b.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()},e.prototype.toJSON=function(){return(0,b.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.exists=function(){return(0,b.Dv)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()},e.prototype.child=function(t){return(0,b.Dv)("DataSnapshot.child",0,1,arguments.length),ro("DataSnapshot.child","path",t=String(t),!1),new e(this._database,this._delegate.child(t))},e.prototype.hasChild=function(e){return(0,b.Dv)("DataSnapshot.hasChild",1,1,arguments.length),ro("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)},e.prototype.getPriority=function(){return(0,b.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority},e.prototype.forEach=function(t){var n=this;return(0,b.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,b.Wj)("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(function(r){return t(new e(n._database,r))})},e.prototype.hasChildren=function(){return(0,b.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()},Object.defineProperty(e.prototype,"key",{get:function(){return this._delegate.key},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return(0,b.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size},e.prototype.getRef=function(){return(0,b.Dv)("DataSnapshot.ref",0,0,arguments.length),new iT(this._database,this._delegate.ref)},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),ib=function(){function e(e,t){this.database=e,this._delegate=t}return e.prototype.on=function(t,n,r,i){var o,a=this;(0,b.Dv)("Query.on",2,4,arguments.length),(0,b.Wj)("Query.on","callback",n,!1);var s=e.getCancelAndContextArgs_("Query.on",r,i),u=function(e,t){n.call(s.context,new iw(a.database,e),t)};u.userCallback=n,u.context=s.context;var l=null===(o=s.cancel)||void 0===o?void 0:o.bind(s.context);switch(t){case"value":return r2(this._delegate,u,l),n;case"child_added":return r3(this._delegate,u,l),n;case"child_removed":return r8(this._delegate,u,l),n;case"child_changed":return r4(this._delegate,u,l),n;case"child_moved":return r5(this._delegate,u,l),n;default:throw Error((0,b.gK)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},e.prototype.off=function(e,t,n){if((0,b.Dv)("Query.off",0,3,arguments.length),rr("Query.off",e,!0),(0,b.Wj)("Query.off","callback",t,!0),(0,b.lb)("Query.off","context",n,!0),t){var r=function(){};r.userCallback=t,r.context=n,r6(this._delegate,e,r)}else r6(this._delegate,e)},e.prototype.get=function(){var e,t,n,r,i=this;return(e=this._delegate,(t=(e=(0,b.m9)(e))._repo,n=e,null!=(r=function(e,t){var n,r=t._path,i=null;e.syncPointTree_.foreachOnPath(r,function(e,t){var n=eW(e,r);i=i||nb(t,n)});var o=e.syncPointTree_.get(r);o?i=i||nb(o,eN()):(o=new ng,e.syncPointTree_=e.syncPointTree_.set(r,o));var a=null!=i,s=a?new tW(i,!0,!1):null,u=(n=e.pendingWriteTree_,nr(t._path,n));return tV(nC(o,t,u,a?s.getNode():tr.EMPTY_NODE,a).viewCache_)}(t.serverSyncTree_,n))?Promise.resolve(r):t.server_.get(n).then(function(e){var r=to(e),i=nN(t.serverSyncTree_,n._path,r);return rd(t.eventQueue_,n._path,i),Promise.resolve(r)},function(e){return rP(t,"get for query "+(0,b.Pz)(n)+" failed: "+e),Promise.reject(Error(e))})).then(function(t){return new rK(t,new rY(e._repo,e._path),e._queryParams.getIndex())})).then(function(e){return new iw(i.database,e)})},e.prototype.once=function(t,n,r,i){var o=this;(0,b.Dv)("Query.once",1,4,arguments.length),(0,b.Wj)("Query.once","callback",n,!0);var a=e.getCancelAndContextArgs_("Query.on",r,i),s=new b.BH,u=function(e,t){var r=new iw(o.database,e);n&&n.call(a.context,r,t),s.resolve(r)};u.userCallback=n,u.context=a.context;var l=function(e){a.cancel&&a.cancel.call(a.context,e),s.reject(e)};switch(t){case"value":r2(this._delegate,u,l,{onlyOnce:!0});break;case"child_added":r3(this._delegate,u,l,{onlyOnce:!0});break;case"child_removed":r8(this._delegate,u,l,{onlyOnce:!0});break;case"child_changed":r4(this._delegate,u,l,{onlyOnce:!0});break;case"child_moved":r5(this._delegate,u,l,{onlyOnce:!0});break;default:throw Error((0,b.gK)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise},e.prototype.limitToFirst=function(t){return(0,b.Dv)("Query.limitToFirst",1,1,arguments.length),new e(this.database,ic(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw Error("limitToFirst: First argument must be a positive integer.");return new ii(e)}(t)))},e.prototype.limitToLast=function(t){return(0,b.Dv)("Query.limitToLast",1,1,arguments.length),new e(this.database,ic(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw Error("limitToLast: First argument must be a positive integer.");return new io(e)}(t)))},e.prototype.orderByChild=function(t){return(0,b.Dv)("Query.orderByChild",1,1,arguments.length),new e(this.database,ic(this._delegate,function(e){if("$key"===e)throw Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return ro("orderByChild","path",e,!1),new ia(e)}(t)))},e.prototype.orderByKey=function(){return(0,b.Dv)("Query.orderByKey",0,0,arguments.length),new e(this.database,ic(this._delegate,new is))},e.prototype.orderByPriority=function(){return(0,b.Dv)("Query.orderByPriority",0,0,arguments.length),new e(this.database,ic(this._delegate,new iu))},e.prototype.orderByValue=function(){return(0,b.Dv)("Query.orderByValue",0,0,arguments.length),new e(this.database,ic(this._delegate,new il))},e.prototype.startAt=function(t,n){var r;return void 0===t&&(t=null),(0,b.Dv)("Query.startAt",0,2,arguments.length),new e(this.database,ic(this._delegate,(void 0===(r=t)&&(r=null),ri("startAt","key",n,!0),new it(r,n))))},e.prototype.startAfter=function(t,n){var r;return void 0===t&&(t=null),(0,b.Dv)("Query.startAfter",0,2,arguments.length),new e(this.database,ic(this._delegate,(r=t,ri("startAfter","key",n,!0),new ir(r,n))))},e.prototype.endAt=function(t,n){var r;return void 0===t&&(t=null),(0,b.Dv)("Query.endAt",0,2,arguments.length),new e(this.database,ic(this._delegate,(r=t,ri("endAt","key",n,!0),new r9(r,n))))},e.prototype.endBefore=function(t,n){var r;return void 0===t&&(t=null),(0,b.Dv)("Query.endBefore",0,2,arguments.length),new e(this.database,ic(this._delegate,(r=t,ri("endBefore","key",n,!0),new ie(r,n))))},e.prototype.equalTo=function(t,n){return(0,b.Dv)("Query.equalTo",1,2,arguments.length),new e(this.database,ic(this._delegate,(ri("equalTo","key",n,!0),new ih(t,n))))},e.prototype.toString=function(){return(0,b.Dv)("Query.toString",0,0,arguments.length),this._delegate.toString()},e.prototype.toJSON=function(){return(0,b.Dv)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.isEqual=function(t){if((0,b.Dv)("Query.isEqual",1,1,arguments.length),!(t instanceof e))throw Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");return this._delegate.isEqual(t._delegate)},e.getCancelAndContextArgs_=function(e,t,n){var r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,(0,b.Wj)(e,"cancel",r.cancel,!0),r.context=n,(0,b.lb)(e,"context",r.context,!0);else if(t){if("object"==typeof t&&null!==t)r.context=t;else if("function"==typeof t)r.cancel=t;else throw Error((0,b.gK)(e,"cancelOrContext")+" must either be a cancel callback or a context object.")}return r},Object.defineProperty(e.prototype,"ref",{get:function(){return new iT(this.database,new rY(this._delegate._repo,this._delegate._path))},enumerable:!1,configurable:!0}),e}(),iT=function(e){function t(t,n){var r=e.call(this,t,new rz(n._repo,n._path,new tm,!1))||this;return r.database=t,r._delegate=n,r}return(0,T.ZT)(t,e),t.prototype.getKey=function(){return(0,b.Dv)("Reference.key",0,0,arguments.length),this._delegate.key},t.prototype.child=function(e){return(0,b.Dv)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new t(this.database,rZ(this._delegate,e))},t.prototype.getParent=function(){(0,b.Dv)("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new t(this.database,e):null},t.prototype.getRoot=function(){return(0,b.Dv)("Reference.root",0,0,arguments.length),new t(this.database,this._delegate.root)},t.prototype.set=function(e,t){(0,b.Dv)("Reference.set",1,2,arguments.length),(0,b.Wj)("Reference.set","onComplete",t,!0);var n=rX(this._delegate,e);return t&&n.then(function(){return t(null)},function(e){return t(e)}),n},t.prototype.update=function(e,t){if((0,b.Dv)("Reference.update",1,2,arguments.length),Array.isArray(e)){for(var n,r,i,o={},a=0;a<e.length;++a)o[""+a]=e[a];e=o,z("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}rs("Reference.update",this._delegate._path),(0,b.Wj)("Reference.update","onComplete",t,!0);var s=(n=this._delegate,rt("update",r=e,n._path,!1),i=new b.BH,function(e,t,n,r){rP(e,"update",{path:t.toString(),value:n});var i=!0,o=rg(e),a={};if(ee(n,function(n,r){i=!1,a[n]=nY(eL(t,n),to(r),e.serverSyncTree_,o)}),i)W("update() called with empty data.  Don't do anything."),rS(e,r,"ok",void 0);else{var s,u,l,h=rb(e),c=(u=(s=e.serverSyncTree_).pendingWriteTree_,(0,b.hu)(h>u.lastWriteId,"Stacking an older merge on top of newer ones"),u.allWrites.push({path:t,children:a,writeId:h,visible:!0}),u.visibleWrites=t$(u.visibleWrites,t,a),u.lastWriteId=h,l=tY.fromObject(a),nO(s,new tM(tD(),t,l)));rc(e.eventQueue_,c),e.server_.merge(t.toString(),n,function(n,i){var o="ok"===n;o||z("update at "+t+" failed: "+n);var a=nx(e.serverSyncTree_,h,!o),s=a.length>0?rR(e,t):t;rp(e.eventQueue_,s,a),rS(e,r,n,i)}),ee(n,function(n){var r=rF(e,eL(t,n));rR(e,r)}),rp(e.eventQueue_,t,[])}}(n._repo,n._path,r,i.wrapCallback(function(){})),i.promise);return t&&s.then(function(){return t(null)},function(e){return t(e)}),s},t.prototype.setWithPriority=function(e,t,n){(0,b.Dv)("Reference.setWithPriority",2,3,arguments.length),(0,b.Wj)("Reference.setWithPriority","onComplete",n,!0);var r=function(e,t,n){if(rs("setWithPriority",e._path),n7("setWithPriority",t,e._path,!1),rn("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";var r=new b.BH;return rT(e._repo,e._path,t,n,r.wrapCallback(function(){})),r.promise}(this._delegate,e,t);return n&&r.then(function(){return n(null)},function(e){return n(e)}),r},t.prototype.remove=function(e){(0,b.Dv)("Reference.remove",0,1,arguments.length),(0,b.Wj)("Reference.remove","onComplete",e,!0);var t,n=(rs("remove",(t=this._delegate)._path),rX(t,null));return e&&n.then(function(){return e(null)},function(t){return e(t)}),n},t.prototype.transaction=function(e,t,n){var r=this;(0,b.Dv)("Reference.transaction",1,3,arguments.length),(0,b.Wj)("Reference.transaction","transactionUpdate",e,!1),(0,b.Wj)("Reference.transaction","onComplete",t,!0),rl("Reference.transaction","applyLocally",n,!0);var i=(function(e,t,n){if(rs("Reference.transaction",(e=(0,b.m9)(e))._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";var r,i=null===(r=null==n?void 0:n.applyLocally)||void 0===r||r,o=new b.BH,a=r2(e,function(){});return function(e,t,n,r,i,o){rP(e,"transaction on "+t);var a={path:t,update:n,onComplete:r,status:null,order:A(),applyLocally:o,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=rx(e,t,void 0);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u)a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete&&a.onComplete(null,!1,a.currentInputSnapshot);else{n9("transaction failed: Data returned ",u,a.path),a.status=0;var l=nZ(e.transactionQueueTree_,t),h=nX(l)||[];h.push(a),nJ(l,h);var c=void 0;"object"==typeof u&&null!==u&&(0,b.r3)(u,".priority")?(c=(0,b.DV)(u,".priority"),(0,b.hu)(n6(c),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):c=(nA(e.serverSyncTree_,t)||tr.EMPTY_NODE).getPriority().val();var d=rg(e),p=to(u,c),f=nK(p,s,d);a.currentOutputSnapshotRaw=p,a.currentOutputSnapshotResolved=f,a.currentWriteId=rb(e);var _=nS(e.serverSyncTree_,t,f,a.currentWriteId,a.applyLocally);rp(e.eventQueue_,t,_),rN(e,e.transactionQueueTree_)}}(e._repo,e._path,t,function(t,n,r){var i=null;t?o.reject(t):(i=new rK(r,new rY(e._repo,e._path),e6),o.resolve(new ig(n,i)))},a,i),o.promise})(this._delegate,e,{applyLocally:n}).then(function(e){return new iC(e.committed,new iw(r.database,e.snapshot))});return t&&i.then(function(e){return t(null,e.committed,e.snapshot)},function(e){return t(e,!1,null)}),i},t.prototype.setPriority=function(e,t){(0,b.Dv)("Reference.setPriority",1,2,arguments.length),(0,b.Wj)("Reference.setPriority","onComplete",t,!0);var n,r,i=(n=this._delegate,rs("setPriority",(n=(0,b.m9)(n))._path),rn("setPriority",e,!1),r=new b.BH,rT(n._repo,eL(n._path,".priority"),e,null,r.wrapCallback(function(){})),r.promise);return t&&i.then(function(){return t(null)},function(e){return t(e)}),i},t.prototype.push=function(e,n){var r,i,o,a,s,u=this;(0,b.Dv)("Reference.push",0,2,arguments.length),(0,b.Wj)("Reference.push","onComplete",n,!0);var l=(r=this._delegate,rs("push",(r=(0,b.m9)(r))._path),n7("push",e,r._path,!0),o=tl(ry(r._repo)),a=rZ(r,o),s=rZ(r,o),i=null!=e?rX(s,e).then(function(){return s}):Promise.resolve(s),a.then=i.then.bind(i),a.catch=i.then.bind(i,void 0),a),h=l.then(function(e){return new t(u.database,e)});n&&h.then(function(){return n(null)},function(e){return n(e)});var c=new t(this.database,l);return c.then=h.then.bind(h),c.catch=h.catch.bind(h,void 0),c},t.prototype.onDisconnect=function(){return rs("Reference.onDisconnect",this._delegate._path),new im(new rB(this._delegate._repo,this._delegate._path))},Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),t}(ib),ik=function(){function e(e,t){var n=this;this._delegate=e,this.app=t,this.INTERNAL={delete:function(){return n._delegate._delete()}}}return e.prototype.useEmulator=function(e,t,n){var r,i,o,a,s;void 0===n&&(n={}),r=this._delegate,void 0===(i=n)&&(i={}),(r=(0,b.m9)(r))._checkNotDeleted("useEmulator"),r._instanceStarted&&B("Cannot call useEmulator() after instance has already been initialized."),o=r._repoInternal,a=void 0,o.repoInfo_.nodeAdmin?(i.mockUserToken&&B('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new eu(eu.OWNER)):i.mockUserToken&&(a=new eu((0,b.Sg)(i.mockUserToken,r.app.options.projectId))),s=a,o.repoInfo_=new ed(e+":"+t,!1,o.repoInfo_.namespace,o.repoInfo_.webSocketOnly,o.repoInfo_.nodeAdmin,o.repoInfo_.persistenceKey,o.repoInfo_.includeNamespaceInQueryParams),s&&(o.authTokenProvider_=s)},e.prototype.ref=function(e){if((0,b.Dv)("database.ref",0,1,arguments.length),e instanceof iT){var t=r$(this._delegate,e.toString());return new iT(this,t)}var t=rG(this._delegate,e);return new iT(this,t)},e.prototype.refFromURL=function(e){return(0,b.Dv)("database.refFromURL",1,1,arguments.length),new iT(this,r$(this._delegate,e))},e.prototype.goOffline=function(){var e;return(0,b.Dv)("database.goOffline",0,0,arguments.length),e=this._delegate,void((e=(0,b.m9)(e))._checkNotDeleted("goOffline"),rE(e._repo))},e.prototype.goOnline=function(){var e,t;return(0,b.Dv)("database.goOnline",0,0,arguments.length),e=this._delegate,void((e=(0,b.m9)(e))._checkNotDeleted("goOnline"),(t=e._repo).persistentConnection_&&t.persistentConnection_.resume(r_))},e.ServerValue={TIMESTAMP:iy,increment:function(e){return{".sv":{increment:e}}}},e}(),iI=Object.freeze({__proto__:null,forceLongPolling:function(){eT.forceDisallow(),eC.forceAllow()},forceWebSockets:function(){eC.forceDisallow()},isWebSocketsAvailable:function(){return eT.isAvailable()},setSecurityDebugCallback:function(e,t){e._delegate._repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){!function(e,t){if(void 0===t&&(t=!1),"undefined"!=typeof console){t?(e.statsListener_||(e.statsListener_=new tN(e.stats_)),n=e.statsListener_.get()):n=e.stats_.get();var n,r=Object.keys(n).reduce(function(e,t){return Math.max(t.length,e)},0);ee(n,function(e,t){for(var n=e,i=e.length;i<r+2;i++)n+=" ";console.log(n+t)})}}(e._delegate._repo,t)},statsIncrementCounter:function(e,t){var n;(n=e._delegate._repo).stats_.incrementCounter(t),n.statsReporter_.statsToReport_[t]=!0},dataUpdateCount:function(e){return e._delegate._repo.dataUpdateCount},interceptServerData:function(e,t){e._delegate._repo.interceptServerDataCallback_=t},initStandalone:function(e){var t=e.app,n=e.url,r=e.version,i=e.customAuthImpl,o=e.namespace,a=e.nodeAdmin;E=r;var s=new w.zt("auth-internal",new w.H0("database-standalone"));return s.setComponent(new w.wA("auth-internal",function(){return i},"PRIVATE")),{instance:new ik(i_(t,s,void 0,n,void 0!==a&&a),t),namespace:o}}});eY.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},eY.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var iE=Object.freeze({__proto__:null,DataConnection:eY,RealTimeConnection:eI,hijackHash:function(e){var t=eY.prototype.put;return eY.prototype.put=function(n,r,i,o){void 0!==o&&(o=e()),t.call(this,n,r,i,o)},function(){eY.prototype.put=t}},ConnectionTarget:ed,queryIdentifier:function(e){return e._delegate._queryIdentifier},forceRestClient:function(e){ip=e}}),iP=ik.ServerValue;E=(r=C.Z).SDK_VERSION,i=r.INTERNAL.registerComponent(new w.wA("database",function(e,t){var n=t.instanceIdentifier,r=e.getProvider("app").getImmediate();return new ik(i_(r,e.getProvider("auth-internal"),e.getProvider("app-check-internal"),n),r)},"PUBLIC").setServiceProps({Reference:iT,Query:ib,Database:ik,DataSnapshot:iw,enableLogging:M,INTERNAL:iI,ServerValue:iP,TEST_ACCESS:iE}).setMultipleInstances(!0)),r.registerVersion("@firebase/database","0.10.0"),(0,b.Yr)()&&(e.exports=i)}}]);