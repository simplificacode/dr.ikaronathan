"use strict";(self.webpackChunksmart_tools=self.webpackChunksmart_tools||[]).push([["3173"],{3591:function(t,e,n){n.d(e,{H:function(){return uy},J:function(){return um},L:function(){return uo},M:function(){return ui},O:function(){return I},Q:function(){return uc},U:function(){return ua},V:function(){return su},Y:function(){return uv},Z:function(){return uw},g:function(){return o7},i:function(){return u_},j:function(){return ul},k:function(){return ur},n:function(){return uI},q:function(){return uu},r:function(){return uE},s:function(){return uT},t:function(){return ub},y:function(){return o9}});var r=n(561975),i=n(376236),o=n(675093),s=n(789786),u=n(499845),a=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();a.o=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var c={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},h=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return(0,s.ZT)(e,t),e}(Error),l=new i.Yd("@firebase/firestore");function f(){return l.logLevel}function d(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=i.in.DEBUG){var r=e.map(m);l.debug.apply(l,(0,s.ev)(["Firestore (8.5.0): "+t],r))}}function p(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=i.in.ERROR){var r=e.map(m);l.error.apply(l,(0,s.ev)(["Firestore (8.5.0): "+t],r))}}function y(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=i.in.WARN){var r=e.map(m);l.warn.apply(l,(0,s.ev)(["Firestore (8.5.0): "+t],r))}}function m(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.5.0) INTERNAL ASSERTION FAILED: "+t;throw p(e),Error(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var g=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<40;r++)n[r]=Math.floor(256*Math.random());return n}(0),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function w(t,e){return t<e?-1:t>e?1:0}function b(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var I=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0||e>=1e9)throw new h(c.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800||t>=253402300800)throw new h(c.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?w(this.nanoseconds,t.nanoseconds):w(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),T=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new I(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function E(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function S(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var N=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&v(),void 0===n?n=t.length-e:n>t.length-e&&v(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return -1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,s.ZT)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0;i<t.length;i++){var o=t[i];if(o.indexOf("//")>=0)throw new h(c.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");r.push.apply(r,o.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(N),A=/^[_a-zA-Z][_a-zA-Z0-9]*$/,k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,s.ZT)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return A.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new h(c.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var u=t[i];if("\\"===u){if(i+1===t.length)throw new h(c.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[i+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new h(c.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=a,i+=2}else"`"===u?s=!s:"."!==u||s?r+=u:o(),i++}if(o(),s)throw new h(c.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(N),x=function(){function t(t){this.fields=t,t.sort(k.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return b(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),C=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return w(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();C.EMPTY_BYTE_STRING=new C("");var R=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function O(t){if(t||v(),"string"==typeof t){var e=0,n=R.exec(t);if(n||v(),n[1]){var r=n[1];e=Number(r=(r+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(t).getTime()/1e3),nanos:e}}return{seconds:L(t.seconds),nanos:L(t.nanos)}}function L(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function P(t){return"string"==typeof t?C.fromBase64String(t):C.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function F(t){var e=O(t.mapValue.fields.__local_write_time__.timestampValue);return new I(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V(t){return null==t}function q(t){return 0===t&&1/t==-1/0}function U(t){return"number"==typeof t&&Number.isInteger(t)&&!q(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var G=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(D.fromString(e))},t.fromName=function(e){return new t(D.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===D.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return D.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new D(e.slice()))},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?M(t)?4:10:v()}function j(t,e){var n=B(t);if(n!==B(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return F(t).isEqual(F(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=O(t.timestampValue),r=O(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return P(t.bytesValue).isEqual(P(e.bytesValue));case 7:return t.referenceValue===e.referenceValue;case 8:return L(t.geoPointValue.latitude)===L(e.geoPointValue.latitude)&&L(t.geoPointValue.longitude)===L(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return L(t.integerValue)===L(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=L(t.doubleValue),r=L(e.doubleValue);return n===r?q(n)===q(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return b(t.arrayValue.values||[],e.arrayValue.values||[],j);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(_(n)!==_(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!j(n[i],r[i])))return!1;return!0}(t,e);default:return v()}}function K(t,e){return void 0!==(t.values||[]).find(function(t){return j(t,e)})}function z(t,e){var n,r,i,o,s,u,a,c,h,l=B(t),f=B(e);if(l!==f)return w(l,f);switch(l){case 0:return 0;case 1:return w(t.booleanValue,e.booleanValue);case 2:return(n=L(t.integerValue||t.doubleValue))<(r=L(e.integerValue||e.doubleValue))?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1;case 3:return Q(t.timestampValue,e.timestampValue);case 4:return Q(F(t),F(e));case 5:return w(t.stringValue,e.stringValue);case 6:return i=t.bytesValue,o=e.bytesValue,s=P(i),u=P(o),s.compareTo(u);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=w(n[i],r[i]);if(0!==o)return o}return w(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return a=t.geoPointValue,c=e.geoPointValue,0!==(h=w(L(a.latitude),L(c.latitude)))?h:w(L(a.longitude),L(c.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=z(n[i],r[i]);if(o)return o}return w(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=w(r[s],o[s]);if(0!==u)return u;var a=z(n[r[s]],i[o[s]]);if(0!==a)return a}return w(r.length,o.length)}(t.mapValue,e.mapValue);default:throw v()}}function Q(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return w(t,e);var n=O(t),r=O(e),i=w(n.seconds,r.seconds);return 0!==i?i:w(n.nanos,r.nanos)}function J(t){var e,n,r;return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?"time("+(r=O(t.timestampValue)).seconds+","+r.nanos+")":"stringValue"in t?t.stringValue:"bytesValue"in t?P(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,G.fromName(n).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=J(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+J(t.fields[o])}return e+"}"}(t.mapValue):v()}function W(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function H(t){return!!t&&"integerValue"in t}function Y(t){return!!t&&"arrayValue"in t}function Z(t){return!!t&&"nullValue"in t}function X(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function $(t){return!!t&&"mapValue"in t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tt=function(){function t(t){this.overlayMap=new Map,this.partialValue=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(e){return t.extractNestedValue(this.buildProto(),e)},t.prototype.toProto=function(){return this.field(k.emptyPath())},t.prototype.set=function(t,e){this.setOverlay(t,e)},t.prototype.setAll=function(t){var e=this;t.forEach(function(t,n){t?e.set(n,t):e.delete(n)})},t.prototype.delete=function(t){this.setOverlay(t,null)},t.prototype.isEqual=function(t){return j(this.buildProto(),t.buildProto())},t.prototype.setOverlay=function(t,e){for(var n=this.overlayMap,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map||(o=o&&10===B(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),n=o}n.set(t.lastSegment(),e)},t.prototype.applyOverlay=function(e,n){var r=this,i=!1,o=t.extractNestedValue(this.partialValue,e),s=$(o)?Object.assign({},o.mapValue.fields):{};return n.forEach(function(t,n){if(t instanceof Map){var o=r.applyOverlay(e.child(n),t);null!=o&&(s[n]=o,i=!0)}else null!==t?(s[n]=t,i=!0):s.hasOwnProperty(n)&&(delete s[n],i=!0)}),i?{mapValue:{fields:s}}:null},t.prototype.buildProto=function(){var t=this.applyOverlay(k.emptyPath(),this.overlayMap);return null!=t&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},t.extractNestedValue=function(t,e){if(e.isEmpty())return t;for(var n=t,r=0;r<e.length-1;++r)if(!n.mapValue.fields||!$(n=n.mapValue.fields[e.get(r)]))return null;return(n=(n.mapValue.fields||{})[e.lastSegment()])||null},t.prototype.clone=function(){return new t(this.buildProto())},t}(),te=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,T.min(),tt.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,tt.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,tt.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=tt.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=tt.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),tn=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tr(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new tn(t,e,n,r,i,o,s)}function ti(t){if(null===t.h){var e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:"+t.filters.map(function(t){return t.field.canonicalString()+t.op.toString()+J(t.value)}).join(",")+"|ob:"+t.orderBy.map(function(t){return t.field.canonicalString()+t.dir}).join(","),V(t.limit)||(e+="|l:"+t.limit),t.startAt&&(e+="|lb:"+tv(t.startAt)),t.endAt&&(e+="|ub:"+tv(t.endAt)),t.h=e}return t.h}function to(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i,o,s=0;s<t.orderBy.length;s++)if(n=t.orderBy[s],r=e.orderBy[s],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1;if(t.filters.length!==e.filters.length)return!1;for(var u=0;u<t.filters.length;u++)if(i=t.filters[u],o=e.filters[u],i.op!==o.op||!i.field.isEqual(o.field)||!j(i.value,o.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!tb(t.startAt,e.startAt)&&tb(t.endAt,e.endAt)}function ts(t){return G.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var tu=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return(0,s.ZT)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new ta(t,n,r):"array-contains"===n?new tf(t,r):"in"===n?new td(t,r):"not-in"===n?new tp(t,r):"array-contains-any"===n?new ty(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new tc(t,n):new th(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(z(e,this.value)):null!==e&&B(this.value)===B(e)&&this.m(z(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return v()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),ta=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=G.fromName(r.referenceValue),i}return(0,s.ZT)(e,t),e.prototype.matches=function(t){var e=G.comparator(t.key,this.key);return this.m(e)},e}(tu),tc=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=tl("in",n),r}return(0,s.ZT)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(tu),th=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=tl("not-in",n),r}return(0,s.ZT)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(tu);function tl(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return G.fromName(t.referenceValue)})}var tf=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return(0,s.ZT)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Y(e)&&K(e.arrayValue,this.value)},e}(tu),td=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return(0,s.ZT)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&K(this.value.arrayValue,e)},e}(tu),tp=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return(0,s.ZT)(e,t),e.prototype.matches=function(t){if(K(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!K(this.value.arrayValue,e)},e}(tu),ty=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return(0,s.ZT)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Y(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return K(e.value.arrayValue,t)})},e}(tu),tm=function(t,e){this.position=t,this.before=e};function tv(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return J(t)}).join(",")}var tg=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function tw(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?G.comparator(G.fromName(s.referenceValue),n.key):z(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function tb(t,e){if(null===t)return null===e;if(null===e||t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!j(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tI=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=u,this.p=null,this.T=null,this.startAt,this.endAt};function tT(t){return new tI(t)}function t_(t){return!V(t.limit)&&"F"===t.limitType}function tE(t){return!V(t.limit)&&"L"===t.limitType}function tS(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function tN(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function tD(t){return null!==t.collectionGroup}function tA(t){if(null===t.p){t.p=[];var e=tN(t),n=tS(t);if(null!==e&&null===n)e.isKeyField()||t.p.push(new tg(e)),t.p.push(new tg(k.keyField(),"asc"));else{for(var r=!1,i=0,o=t.explicitOrderBy;i<o.length;i++){var s=o[i];t.p.push(s),s.field.isKeyField()&&(r=!0)}if(!r){var u=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.p.push(new tg(k.keyField(),u))}}}return t.p}function tk(t){if(!t.T){if("F"===t.limitType)t.T=tr(t.path,t.collectionGroup,tA(t),t.filters,t.limit,t.startAt,t.endAt);else{for(var e=[],n=0,r=tA(t);n<r.length;n++){var i=r[n],o="desc"===i.dir?"asc":"desc";e.push(new tg(i.field,o))}var s=t.endAt?new tm(t.endAt.position,!t.endAt.before):null,u=t.startAt?new tm(t.startAt.position,!t.startAt.before):null;t.T=tr(t.path,t.collectionGroup,e,t.filters,t.limit,s,u)}}return t.T}function tx(t,e,n){return new tI(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function tC(t,e){return to(tk(t),tk(e))&&t.limitType===e.limitType}function tR(t){return ti(tk(t))+"|lt:"+t.limitType}function tO(t){var e,n;return"Query(target="+(n=(e=tk(t)).path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=", filters: ["+e.filters.map(function(t){return t.field.canonicalString()+" "+t.op+" "+J(t.value)}).join(", ")+"]"),V(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=", orderBy: ["+e.orderBy.map(function(t){return t.field.canonicalString()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+tv(e.startAt)),e.endAt&&(n+=", endAt: "+tv(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")"}function tL(t,e){var n;return e.isFoundDocument()&&(n=e.key.path,null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):G.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n))&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&!(t.startAt&&!tw(t.startAt,tA(t),e))&&(!t.endAt||!tw(t.endAt,tA(t),e))}function tP(t){return function(e,n){for(var r=!1,i=0,o=tA(t);i<o.length;i++){var s=o[i],u=function(t,e,n){var r,i,o,s=t.field.isKeyField()?G.comparator(e.key,n.key):(r=t.field,i=e.data.field(r),o=n.data.field(r),null!==i&&null!==o?z(i,o):v());switch(t.dir){case"asc":return s;case"desc":return -1*s;default:return v()}}(s,e,n);if(0!==u)return u;r=r||s.field.isKeyField()}return 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tM(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:q(e)?"-0":e}}function tF(t){return{integerValue:""+t}}function tV(t,e){return U(e)?tF(e):tM(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tq=function(){this._=void 0};function tU(t,e){return t instanceof tQ?H(e)||e&&"doubleValue"in e?e:{integerValue:0}:null}var tG=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,s.ZT)(e,t),e}(tq),tB=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,s.ZT)(e,t),e}(tq);function tj(t,e){for(var n=tW(e),r=function(t){n.some(function(e){return j(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var tK=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,s.ZT)(e,t),e}(tq);function tz(t,e){for(var n=tW(e),r=function(t){n=n.filter(function(e){return!j(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var tQ=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return(0,s.ZT)(e,t),e}(tq);function tJ(t){return L(t.integerValue||t.doubleValue)}function tW(t){return Y(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tH=function(t,e){this.field=t,this.transform=e},tY=function(t,e){this.version=t,this.transformResults=e},tZ=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function tX(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var t$=function(){};function t0(t,e,n){t instanceof t4?function(t,e,n){if(tX(t.precondition,e)){var r=t.value.clone(),i=t8(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(t2(e),r).setHasLocalMutations()}}(t,e,n):t instanceof t3?function(t,e,n){if(tX(t.precondition,e)){var r=t8(t.fieldTransforms,n,e),i=e.data;i.setAll(t5(t)),i.setAll(r),e.convertToFoundDocument(t2(e),i).setHasLocalMutations()}}(t,e,n):tX(t.precondition,e)&&e.convertToNoDocument(T.min())}function t1(t,e){var n,r;return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&b(n,r,function(t,e){var n,r;return t.field.isEqual(e.field)&&(n=t.transform,r=e.transform,n instanceof tB&&r instanceof tB||n instanceof tK&&r instanceof tK?b(n.elements,r.elements,j):n instanceof tQ&&r instanceof tQ?j(n.A,r.A):n instanceof tG&&r instanceof tG)})))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function t2(t){return t.isFoundDocument()?t.version:T.min()}var t4=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return(0,s.ZT)(e,t),e}(t$),t3=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return(0,s.ZT)(e,t),e}(t$);function t5(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function t6(t,e,n){var r=new Map;t.length===n.length||v();for(var i=0;i<n.length;i++){var o,s=t[i],u=s.transform,a=e.data.field(s.field);r.set(s.field,(o=n[i],u instanceof tB?tj(u,a):u instanceof tK?tz(u,a):o))}return r}function t8(t,e,n){for(var r=new Map,i=0;i<t.length;i++){var o=t[i],s=o.transform,u=n.data.field(o.field);r.set(o.field,function(t,e,n){var r,i,o;return t instanceof tG?(r={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},e&&(r.fields.__previous_value__=e),{mapValue:r}):t instanceof tB?tj(t,e):t instanceof tK?tz(t,e):(o=tJ(i=tU(t,e))+tJ(t.A),H(i)&&H(t.A)?tF(o):tM(t.R,o))}(s,u,e))}return r}var t9,t7,et=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return(0,s.ZT)(e,t),e}(t$),ee=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return(0,s.ZT)(e,t),e}(t$),en=function(t){this.count=t};function er(t){switch(t){case c.OK:return v();case c.CANCELLED:case c.UNKNOWN:case c.DEADLINE_EXCEEDED:case c.RESOURCE_EXHAUSTED:case c.INTERNAL:case c.UNAVAILABLE:case c.UNAUTHENTICATED:return!1;case c.INVALID_ARGUMENT:case c.NOT_FOUND:case c.ALREADY_EXISTS:case c.PERMISSION_DENIED:case c.FAILED_PRECONDITION:case c.ABORTED:case c.OUT_OF_RANGE:case c.UNIMPLEMENTED:case c.DATA_LOSS:return!0;default:return v()}}function ei(t){if(void 0===t)return p("GRPC error has no .code"),c.UNKNOWN;switch(t){case t9.OK:return c.OK;case t9.CANCELLED:return c.CANCELLED;case t9.UNKNOWN:return c.UNKNOWN;case t9.DEADLINE_EXCEEDED:return c.DEADLINE_EXCEEDED;case t9.RESOURCE_EXHAUSTED:return c.RESOURCE_EXHAUSTED;case t9.INTERNAL:return c.INTERNAL;case t9.UNAVAILABLE:return c.UNAVAILABLE;case t9.UNAUTHENTICATED:return c.UNAUTHENTICATED;case t9.INVALID_ARGUMENT:return c.INVALID_ARGUMENT;case t9.NOT_FOUND:return c.NOT_FOUND;case t9.ALREADY_EXISTS:return c.ALREADY_EXISTS;case t9.PERMISSION_DENIED:return c.PERMISSION_DENIED;case t9.FAILED_PRECONDITION:return c.FAILED_PRECONDITION;case t9.ABORTED:return c.ABORTED;case t9.OUT_OF_RANGE:return c.OUT_OF_RANGE;case t9.UNIMPLEMENTED:return c.UNIMPLEMENTED;case t9.DATA_LOSS:return c.DATA_LOSS;default:return v()}}(t7=t9||(t9={}))[t7.OK=0]="OK",t7[t7.CANCELLED=1]="CANCELLED",t7[t7.UNKNOWN=2]="UNKNOWN",t7[t7.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",t7[t7.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",t7[t7.NOT_FOUND=5]="NOT_FOUND",t7[t7.ALREADY_EXISTS=6]="ALREADY_EXISTS",t7[t7.PERMISSION_DENIED=7]="PERMISSION_DENIED",t7[t7.UNAUTHENTICATED=16]="UNAUTHENTICATED",t7[t7.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",t7[t7.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",t7[t7.ABORTED=10]="ABORTED",t7[t7.OUT_OF_RANGE=11]="OUT_OF_RANGE",t7[t7.UNIMPLEMENTED=12]="UNIMPLEMENTED",t7[t7.INTERNAL=13]="INTERNAL",t7[t7.UNAVAILABLE=14]="UNAVAILABLE",t7[t7.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var eo=function(){function t(t,e){this.comparator=t,this.root=e||eu.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,eu.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,eu.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return -1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new es(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new es(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new es(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new es(this.root,t,this.comparator,!0)},t}(),es=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),eu=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(0>n(e,i.key))i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){return Math.pow(2,this.check())<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw v();var t=this.left.check();if(t!==this.right.check())throw v();return t+(this.isRed()?0:1)},t}();eu.EMPTY=null,eu.RED=!0,eu.BLACK=!1,eu.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw v()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw v()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new eu(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ea=function(){function t(t){this.comparator=t,this.data=new eo(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new ec(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new ec(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t)||this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),ec=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),eh=new eo(G.comparator),el=new eo(G.comparator),ef=new eo(G.comparator),ed=new ea(G.comparator);function ep(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ed,r=0;r<t.length;r++){var i=t[r];n=n.add(i)}return n}var ey=new ea(w),em=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,ev.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(T.min(),r,ey,eh,ep())},t}(),ev=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(C.EMPTY_BYTE_STRING,n,ep(),ep(),ep())},t}(),eg=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ew=function(t,e){this.targetId=t,this.V=e},eb=function(t,e,n,r){void 0===n&&(n=C.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},eI=function(){function t(){this.S=0,this.D=eE(),this.C=C.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.$=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=ep(),e=ep(),n=ep();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:v()}}),new ev(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=eE()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),eT=function(){function t(t){this.W=t,this.G=new Map,this.H=eh,this.J=e_(),this.Y=new ea(w)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.$(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.$(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.$(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.$(t.resumeToken));break;default:v()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(ts(i)){if(0===n){var o=new G(i.path);this.tt(e,o,te.newNoDocument(o,T.min()))}else 1===n||v()}else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&ts(o.target)){var s=new G(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,te.newNoDocument(s,t))}r.O&&(n.set(i,r.M()),r.L())}});var r=ep();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new em(t,n,this.Y,this.H,r);return this.H=eh,this.J=e_(),this.Y=new ea(w),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new eI,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new ea(w),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||d("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new eI),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function e_(){return new eo(G.comparator)}function eE(){return new eo(G.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var eS={asc:"ASCENDING",desc:"DESCENDING"},eN={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},eD=function(t,e){this.databaseId=t,this.I=e};function eA(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ek(t,e){return t.I?e.toBase64():e.toUint8Array()}function ex(t){var e;return t||v(),T.fromTimestamp(new I((e=O(t)).seconds,e.nanos))}function eC(t,e){return new D(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function eR(t){var e=D.fromString(t);return eY(e)||v(),e}function eO(t,e){return eC(t.databaseId,e.path)}function eL(t,e){var n=eR(e);if(n.get(1)!==t.databaseId.projectId)throw new h(c.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new h(c.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new G(eV(n))}function eP(t,e){return eC(t.databaseId,e)}function eM(t){var e=eR(t);return 4===e.length?D.emptyPath():eV(e)}function eF(t){return new D(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function eV(t){return t.length>4&&"documents"===t.get(4)||v(),t.popFirst(5)}function eq(t,e,n){return{name:eO(t,e),fields:n.toProto().mapValue.fields}}function eU(t,e,n){var r=eL(t,e.name),i=ex(e.updateTime),o=new tt({mapValue:{fields:e.fields}}),s=te.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function eG(t,e){var n,r,i,o;if(e instanceof t4)n={update:eq(t,e.key,e.value)};else if(e instanceof et)n={delete:eO(t,e.key)};else if(e instanceof t3)n={update:eq(t,e.key,e.data),updateMask:(i=e.fieldMask,o=[],i.fields.forEach(function(t){return o.push(t.canonicalString())}),{fieldPaths:o})};else{if(!(e instanceof ee))return v();n={verify:eO(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof tG)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof tB)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof tK)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof tQ)return{fieldPath:e.field.canonicalString(),increment:n.A};throw v()}(0,t)})),e.precondition.isNone||(n.currentDocument=void 0!==(r=e.precondition).updateTime?{updateTime:eA(t,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:v()),n}function eB(t,e){var n,r=e.currentDocument?void 0!==(n=e.currentDocument).updateTime?tZ.updateTime(ex(n.updateTime)):void 0!==n.exists?tZ.exists(n.exists):tZ.none():tZ.none(),i=e.updateTransforms?e.updateTransforms.map(function(e){var n;return n=null,"setToServerValue"in e?("REQUEST_TIME"===e.setToServerValue||v(),n=new tG):"appendMissingElements"in e?n=new tB(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new tK(e.removeAllFromArray.values||[]):"increment"in e?n=new tQ(t,e.increment):v(),new tH(k.fromServerFormat(e.fieldPath),n)}):[];if(e.update){e.update.name;var o=eL(t,e.update.name),s=new tt({mapValue:{fields:e.update.fields}});return e.updateMask?new t3(o,s,new x((e.updateMask.fieldPaths||[]).map(function(t){return k.fromServerFormat(t)})),r,i):new t4(o,s,r,i)}return e.delete?new et(eL(t,e.delete),r):e.verify?new ee(eL(t,e.verify),r):v()}function ej(t,e){return{documents:[eP(t,e.path)]}}function eK(t,e){var n,r={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(r.parent=eP(t,i),r.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r.parent=eP(t,i.popLast()),r.structuredQuery.from=[{collectionId:i.lastSegment()}]);var o=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(X(t.value))return{unaryFilter:{field:eW(t.field),op:"IS_NAN"}};if(Z(t.value))return{unaryFilter:{field:eW(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(X(t.value))return{unaryFilter:{field:eW(t.field),op:"IS_NOT_NAN"}};if(Z(t.value))return{unaryFilter:{field:eW(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:eW(t.field),op:eN[t.op],value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);o&&(r.structuredQuery.where=o);var s=function(t){if(0!==t.length)return t.map(function(t){return{field:eW(t.field),direction:eS[t.dir]}})}(e.orderBy);s&&(r.structuredQuery.orderBy=s);var u=(n=e.limit,t.I||V(n)?n:{value:n});return null!==u&&(r.structuredQuery.limit=u),e.startAt&&(r.structuredQuery.startAt=eQ(e.startAt)),e.endAt&&(r.structuredQuery.endAt=eQ(e.endAt)),r}function ez(t){var e,n,r=eM(t.parent),i=t.structuredQuery,o=i.from?i.from.length:0,s=null;if(o>0){1===o||v();var u=i.from[0];u.allDescendants?s=u.collectionId:r=r.child(u.collectionId)}var a=[];i.where&&(a=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=eH(t.unaryFilter.field);return tu.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=eH(t.unaryFilter.field);return tu.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=eH(t.unaryFilter.field);return tu.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=eH(t.unaryFilter.field);return tu.create(i,"!=",{nullValue:"NULL_VALUE"});default:return v()}}(e)]:void 0!==e.fieldFilter?[tu.create(eH(e.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return v()}}(e.fieldFilter.op),e.fieldFilter.value)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(function(e){return t(e)}).reduce(function(t,e){return t.concat(e)}):v():[]}(i.where));var c=[];i.orderBy&&(c=i.orderBy.map(function(t){return new tg(eH(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}));var h=null;i.limit&&(h=V(n="object"==typeof(e=i.limit)?e.value:e)?null:n);var l=null;i.startAt&&(l=eJ(i.startAt));var f=null;return i.endAt&&(f=eJ(i.endAt)),new tI(r,s,c,a,h,"F",l,f)}function eQ(t){return{before:t.before,values:t.position}}function eJ(t){var e=!!t.before;return new tm(t.values||[],e)}function eW(t){return{fieldPath:t.canonicalString()}}function eH(t){return k.fromServerFormat(t.fieldPath)}function eY(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eZ(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e+="\x01\x01"),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}(t.get(n),e);return e+"\x01\x01"}function eX(t){var e=t.length;if(e>=2||v(),2===e)return"\x01"===t.charAt(0)&&"\x01"===t.charAt(1)||v(),D.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&v(),t.charAt(s+1)){case"\x01":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"\x10":i+=t.substring(o,s)+"\0";break;case"\x11":i+=t.substring(o,s+1);break;default:v()}o=s+2}return new D(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var e$=function(t,e){this.seconds=t,this.nanoseconds=e},e0=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};e0.store="owner",e0.key="owner";var e1=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};e1.store="mutationQueues",e1.keyPath="userId";var e2=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};e2.store="mutations",e2.keyPath="batchId",e2.userMutationsIndex="userMutationsIndex",e2.userMutationsKeyPath=["userId","batchId"];var e4=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,eZ(e)]},t.key=function(t,e,n){return[t,eZ(e),n]},t}();e4.store="documentMutations",e4.PLACEHOLDER=new e4;var e3=function(t,e){this.path=t,this.readTime=e},e5=function(t,e){this.path=t,this.version=e},e6=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};e6.store="remoteDocuments",e6.readTimeIndex="readTimeIndex",e6.readTimeIndexPath="readTime",e6.collectionReadTimeIndex="collectionReadTimeIndex",e6.collectionReadTimeIndexPath=["parentPath","readTime"];var e8=function(t){this.byteSize=t};e8.store="remoteDocumentGlobal",e8.key="remoteDocumentGlobalKey";var e9=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};e9.store="targets",e9.keyPath="targetId",e9.queryTargetsIndexName="queryTargetsIndex",e9.queryTargetsKeyPath=["canonicalId","targetId"];var e7=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};e7.store="targetDocuments",e7.keyPath=["targetId","path"],e7.documentTargetsIndex="documentTargetsIndex",e7.documentTargetsKeyPath=["path","targetId"];var nt=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};nt.key="targetGlobalKey",nt.store="targetGlobal";var ne=function(t,e){this.collectionId=t,this.parent=e};ne.store="collectionParents",ne.keyPath=["collectionId","parent"];var nn=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};nn.store="clientMetadata",nn.keyPath="clientId";var nr=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};nr.store="bundles",nr.keyPath="bundleId";var ni=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};ni.store="namedQueries",ni.keyPath="name";var no=(0,s.ev)((0,s.ev)([],(0,s.ev)((0,s.ev)([],(0,s.ev)((0,s.ev)([],(0,s.ev)((0,s.ev)([],[e1.store,e2.store,e4.store,e6.store,e9.store,e0.store,nt.store,e7.store]),[nn.store])),[e8.store])),[ne.store])),[nr.store,ni.store]),ns="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",nu=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),na=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},nc=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&v(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0;i<e.length;i++)r(e[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),nh=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new na,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new nd(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=ng(e.target.error);n.ft.reject(new nd(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(t){throw new nd(n,t)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(d("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){return new ny(this.transaction.objectStore(t))},t}(),nl=function(){function t(e,n,i){this.name=e,this.version=n,this.wt=i,12.2===t._t((0,r.z$)())&&p("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return d("SimpleDb","Removing database:",t),nm(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=(0,r.z$)(),n=t._t(e),i=t.Et(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<n&&n<10||0<i&&i<4.5)},t.gt=function(){var t;return void 0!==u&&"YES"===(null===(t=u.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(e?e[1].split("_").slice(0,2).join("."):"-1")},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i);return Number(e?e[1].split(".").slice(0,2).join("."):"-1")},t.prototype.At=function(t){return(0,s.mG)(this,void 0,void 0,function(){var e,n=this;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(d("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new nd(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new h(c.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new nd(t,n))},i.onupgradeneeded=function(t){d("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.wt.Rt(e,i.transaction,t.oldVersion,n.version).next(function(){d("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return(0,s.mG)(this,void 0,void 0,function(){var i,o,u,a,c;return(0,s.Jh)(this,function(h){switch(h.label){case 0:i="readonly"===e,o=0,u=function(){var e,u,c,h,l;return(0,s.Jh)(this,function(s){switch(s.label){case 0:++o,s.label=1;case 1:return s.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=s.sent(),u=r(e=nh.open(a.db,t,i?"readonly":"readwrite",n)).catch(function(t){return e.abort(t),nc.reject(t)}).toPromise(),c={},u.catch(function(){}),[4,e.dt];case 3:return[2,(c.value=(s.sent(),u),c)];case 4:return l="FirebaseError"!==(h=s.sent()).name&&o<3,d("SimpleDb","Transaction failed with error:",h.message,"Retrying:",l),a.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}})},a=this,h.label=1;case 1:return[5,u()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),nf=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return nm(this.Pt.delete())},t}(),nd=function(t){function e(e,n){var r=this;return(r=t.call(this,c.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return(0,s.ZT)(e,t),e}(h);function np(t){return"IndexedDbTransactionError"===t.name}var ny=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(d("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(d("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),nm(n)},t.prototype.add=function(t){return d("SimpleDb","ADD",this.store.name,t,t),nm(this.store.add(t))},t.prototype.get=function(t){var e=this;return nm(this.store.get(t)).next(function(n){return void 0===n&&(n=null),d("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return d("SimpleDb","DELETE",this.store.name,t),nm(this.store.delete(t))},t.prototype.count=function(){return d("SimpleDb","COUNT",this.store.name),nm(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){d("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.Ot=function(t,e){e?n=t:(n={},e=t);var n,r=this.cursor(n);return this.xt(r,e)},t.prototype.$t=function(t){var e=this.cursor({});return new nc(function(n,r){e.onerror=function(t){r(ng(t.target.error))},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new nc(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new nf(i),s=e(i.primaryKey,i.value,o);if(s instanceof nc){var u=s.catch(function(t){return o.done(),nc.reject(t)});n.push(u)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return nc.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function nm(t){return new nc(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){n(ng(t.target.error))}})}var nv=!1;function ng(t){var e=nl._t((0,r.z$)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var i=new h("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return nv||(nv=!0,setTimeout(function(){throw i},0)),i}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nw=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return(0,s.ZT)(e,t),e}(nu);function nb(t,e){return nl.It(t.Mt,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nI=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&function(t,e,n){var r,i;t instanceof t4?(r=t.value.clone(),i=t6(t.fieldTransforms,e,n.transformResults),r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()):t instanceof t3?function(t,e,n){if(tX(t.precondition,e)){var r=t6(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(t5(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e,n=0,r=this.baseMutations;n<r.length;n++)(e=r[n]).key.isEqual(t.key)&&t0(e,t,this.localWriteTime);for(var i=0,o=this.mutations;i<o.length;i++)(e=o[i]).key.isEqual(t.key)&&t0(e,t,this.localWriteTime)},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key);e.applyToLocalView(r),r.isValidDocument()||r.convertToNoDocument(T.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},ep())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&b(this.mutations,t.mutations,function(t,e){return t1(t,e)})&&b(this.baseMutations,t.baseMutations,function(t,e){return t1(t,e)})},t}(),nT=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){e.mutations.length===r.length||v();for(var i=ef,o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),n_=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=T.min()),void 0===o&&(o=T.min()),void 0===s&&(s=C.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),nE=function(t){this.Lt=t};function nS(t,e){if(e.document)return eU(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=G.fromSegments(e.noDocument.path),r=nx(e.noDocument.readTime),i=te.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=G.fromSegments(e.unknownDocument.path);return r=nx(e.unknownDocument.version),te.newUnknownDocument(o,r)}return v()}function nN(t,e,n){var r=nD(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o,s={name:eO(o=t.Lt,e.key),fields:e.data.toProto().mapValue.fields,updateTime:eA(o,e.version.toTimestamp())},u=e.hasCommittedMutations;return new e6(null,null,s,u,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),c=nk(e.version);return u=e.hasCommittedMutations,new e6(null,new e3(a,c),null,u,r,i)}return e.isUnknownDocument()?new e6(new e5(e.key.path.toArray(),nk(e.version)),null,null,!0,r,i):v()}function nD(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function nA(t){var e=new I(t[0],t[1]);return T.fromTimestamp(e)}function nk(t){var e=t.toTimestamp();return new e$(e.seconds,e.nanoseconds)}function nx(t){var e=new I(t.seconds,t.nanoseconds);return T.fromTimestamp(e)}function nC(t,e){for(var n=(e.baseMutations||[]).map(function(e){return eB(t.Lt,e)}),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map(function(e){return eB(t.Lt,e)}),u=I.fromMillis(e.localWriteTimeMs);return new nI(e.batchId,u,n,s)}function nR(t){var e,n,r=nx(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?nx(t.lastLimboFreeSnapshotVersion):T.min();return void 0!==t.query.documents?(1===(n=t.query).documents.length||v(),e=tk(tT(eM(n.documents[0])))):e=tk(ez(t.query)),new n_(e,t.targetId,0,t.lastListenSequenceNumber,r,i,C.fromBase64String(t.resumeToken))}function nO(t,e){var n,r=nk(e.snapshotVersion),i=nk(e.lastLimboFreeSnapshotVersion);n=ts(e.target)?ej(t.Lt,e.target):eK(t.Lt,e.target);var o=e.resumeToken.toBase64();return new e9(e.targetId,ti(e.target),r,o,e.sequenceNumber,i,n)}function nL(t){var e=ez({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?tx(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nP=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return nM(t).get(e).next(function(t){if(t)return{id:t.bundleId,createTime:nx(t.createTime),version:t.version}})},t.prototype.saveBundleMetadata=function(t,e){return nM(t).put({bundleId:e.id,createTime:nk(ex(e.createTime)),version:e.version})},t.prototype.getNamedQuery=function(t,e){return nF(t).get(e).next(function(t){if(t)return{name:t.name,query:nL(t.bundledQuery),readTime:nx(t.readTime)}})},t.prototype.saveNamedQuery=function(t,e){return nF(t).put({name:e.name,readTime:nk(ex(e.readTime)),bundledQuery:e.bundledQuery})},t}();function nM(t){return nb(t,nr.store)}function nF(t){return nb(t,ni.store)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nV=function(){function t(){this.Bt=new nq}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),nc.resolve()},t.prototype.getCollectionParents=function(t,e){return nc.resolve(this.Bt.getEntries(e))},t}(),nq=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new ea(D.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new ea(D.comparator)).toArray()},t}(),nU=function(){function t(){this.qt=new nq}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:eZ(i)};return nG(t).put(o)}return nc.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[e+"\0",""],!1,!0);return nG(t).Nt(r).next(function(t){for(var r=0;r<t.length;r++){var i=t[r];if(i.collectionId!==e)break;n.push(eX(i.parent))}return n})},t}();function nG(t){return nb(t,ne.store)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nB={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},nj=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nK(t,e,n){var r=t.store(e2.store),i=t.store(e4.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Ot({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){1===u||v()}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=e4.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return nc.waitFor(o).next(function(){return c})}function nz(t){var e;if(!t)return 0;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw v();e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nj.DEFAULT_COLLECTION_PERCENTILE=10,nj.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nj.DEFAULT=new nj(41943040,nj.DEFAULT_COLLECTION_PERCENTILE,nj.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nj.DISABLED=new nj(-1,0,0);var nQ=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return""!==e.uid||v(),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return nW(t).Ot({index:e2.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=nH(t),s=nW(t);return s.add({}).next(function(u){"number"==typeof u||v();for(var a,c,h,l,f=new nI(u,e,n,r),d=(a=i.R,c=i.userId,h=f.baseMutations.map(function(t){return eG(a.Lt,t)}),l=f.mutations.map(function(t){return eG(a.Lt,t)}),new e2(c,f.batchId,f.localWriteTime.toMillis(),h,l)),p=[],y=new ea(function(t,e){return w(t.canonicalString(),e.canonicalString())}),m=0;m<r.length;m++){var g=r[m],b=e4.key(i.userId,g.key.path,u);y=y.add(g.key.path.popLast()),p.push(s.put(d)),p.push(o.put(b,e4.PLACEHOLDER))}return y.forEach(function(e){p.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Qt[u]=f.keys()}),nc.waitFor(p).next(function(){return f})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return nW(t).get(e).next(function(t){return t?(t.userId===n.userId||v(),nC(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?nc.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return nW(t).Ot({index:e2.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(e.batchId>=r||v(),o=nC(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return nW(t).Ot({index:e2.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return nW(t).Nt(e2.userMutationsIndex,n).next(function(t){return t.map(function(t){return nC(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=e4.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return nH(t).Ot({range:i},function(r,i,s){var u=r[0],a=r[1],c=r[2],h=eX(a);if(u===n.userId&&e.path.isEqual(h))return nW(t).get(c).next(function(t){if(!t)throw v();t.userId===n.userId||v(),o.push(nC(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ea(w),i=[];return e.forEach(function(e){var o=e4.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=nH(t).Ot({range:s},function(t,i,o){var s=t[0],u=t[1],a=t[2],c=eX(u);s===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()});i.push(u)}),nc.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=e4.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new ea(w);return nH(t).Ot({range:s},function(t,e,o){var s=t[0],a=t[1],c=t[2],h=eX(a);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(u=u.add(c)):o.done()}).next(function(){return n.Wt(t,u)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(nW(t).get(e).next(function(t){if(null===t)throw v();t.userId===n.userId||v(),r.push(nC(n.R,t))}))}),nc.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return nK(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),nc.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return nc.resolve();var r=IDBKeyRange.lowerBound(e4.prefixForUser(e.userId)),i=[];return nH(t).Ot({range:r},function(t,n,r){if(t[0]===e.userId){var o=eX(t[1]);i.push(o)}else r.done()}).next(function(){0===i.length||v()})})},t.prototype.containsKey=function(t,e){return nJ(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return nY(t).get(this.userId).next(function(t){return t||new e1(e.userId,-1,"")})},t}();function nJ(t,e,n){var r=e4.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return nH(t).Ot({range:o,kt:!0},function(t,n,r){var o=t[0],u=t[1];t[2],o===e&&u===i&&(s=!0),r.done()}).next(function(){return s})}function nW(t){return nb(t,e2.store)}function nH(t){return nb(t,e4.store)}function nY(t){return nb(t,e1.store)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nZ=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),nX=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new nZ(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return T.fromTimestamp(new I(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return n$(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return e.targetCount>0||v(),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return n$(t).Ot(function(s,u){var a=nR(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.removeTargetData(t,a)))}).next(function(){return nc.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return n$(t).Ot(function(t,n){e(nR(n))})},t.prototype.Xt=function(t){return n0(t).get(nt.key).next(function(t){return null!==t||v(),t})},t.prototype.Zt=function(t,e){return n0(t).put(nt.key,e)},t.prototype.te=function(t,e){return n$(t).put(nO(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=ti(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return n$(t).Ot({range:r,index:e9.queryTargetsIndexName},function(t,n,r){var o=nR(n);to(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=n1(t);return e.forEach(function(e){var s=eZ(e.path);i.push(o.put(new e7(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),nc.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=n1(t);return nc.forEach(e,function(e){var o=eZ(e.path);return nc.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=n1(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=n1(t),i=ep();return r.Ot({range:n,kt:!0},function(t,e,n){var r=new G(eX(t[1]));i=i.add(r)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=eZ(e.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return n1(t).Ot({index:e7.documentTargetsIndex,kt:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return n$(t).get(e).next(function(t){return t?nR(t):null})},t}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n$(t){return nb(t,e9.store)}function n0(t){return nb(t,nt.store)}function n1(t){return nb(t,e7.store)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n2(t){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){if(t.code!==c.FAILED_PRECONDITION||t.message!==ns)throw t;return d("LocalStore","Unexpectedly lost primary lease"),[2]})})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n4(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=w(n,i);return 0===s?w(r,o):s}var n3=function(){function t(t){this.ne=t,this.buffer=new ea(n4),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();0>n4(e,n)&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),n5=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;d("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return(0,s.mG)(e,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return np(e=n.sent())?(d("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,n2(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),n6=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return nc.resolve(a.o);var r=new n3(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return -1===this.params.cacheSizeCollectionThreshold?(d("LruGarbageCollector","Garbage collection skipped; disabled"),nc.resolve(nB)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(d("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),nB):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,o,s,u,a,c,h=this,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>h.params.maximumSequenceNumbersToCollect?(d("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),r=h.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),h.nthSequenceNumber(t,r)}).next(function(r){return n=r,u=Date.now(),h.removeTargets(t,n,e)}).next(function(e){return o=e,a=Date.now(),h.removeOrphanedDocuments(t,n)}).next(function(t){return c=Date.now(),f()<=i.in.DEBUG&&d("LruGarbageCollector","LRU Garbage Collection\n	Counted targets in "+(s-l)+"ms\n	Determined least recently used "+r+" in "+(u-s)+"ms\n	Removed "+o+" targets in "+(a-u)+"ms\n	Removed "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-l)+"ms"),nc.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:o,documentsRemoved:t})})},t}(),n8=function(){function t(t,e){this.db=t,this.garbageCollector=new n6(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return n9(t,n)},t.prototype.removeReference=function(t,e,n){return n9(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return n9(t,e)},t.prototype._e=function(t,e){var n;return n=!1,nY(t).$t(function(r){return nJ(t,r,e).next(function(t){return t&&(n=!0),nc.resolve(!t)})}).next(function(){return n})},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,u){if(u<=e){var a=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),n1(t).delete([0,eZ(s.path)])})});i.push(a)}}).next(function(){return nc.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return n9(t,e)},t.prototype.we=function(t,e){var n,r=n1(t),i=a.o;return r.Ot({index:e7.documentTargetsIndex},function(t,r){var o=t[0],s=(t[1],r.path),u=r.sequenceNumber;0===o?(i!==a.o&&e(new G(eX(n)),i),i=u,n=s):i=a.o}).next(function(){i!==a.o&&e(new G(eX(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function n9(t,e){var n;return n1(t).put((n=t.currentSequenceNumber,new e7(0,eZ(e.path),n)))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var n7=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0;r<n.length;r++){var i=n[r],o=i[0],s=i[1];if(this.equalsFn(o,t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){E(this.inner,function(e,n){for(var r=0;r<n.length;r++){var i=n[r];t(i[0],i[1])}})},t.prototype.isEmpty=function(){return S(this.inner)},t}(),rt=function(){function t(){this.changes=new n7(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:T.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:te.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?nc.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),re=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return ri(t).put(ro(e),n)},t.prototype.removeEntry=function(t,e){var n=ri(t),r=ro(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return ri(t).get(ro(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return ri(t).get(ro(e)).next(function(t){return{document:n.ye(e,t),size:nz(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=eh;return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=eh,i=new eo(G.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,nz(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return nc.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return ri(t).Ot({range:r},function(t,e,r){for(var s=G.fromSegments(t);o&&0>G.comparator(o,s);)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=eh,o=e.path.length+1,s={};if(n.isEqual(T.min())){var u=e.path.toArray();s.range=IDBKeyRange.lowerBound(u)}else{var a=e.path.toArray(),c=nD(n);s.range=IDBKeyRange.lowerBound([a,c],!0),s.index=e6.collectionReadTimeIndex}return ri(t).Ot(s,function(t,n,s){if(t.length===o){var u=nS(r.R,n);e.path.isPrefixOf(u.key.path)?tL(e,u)&&(i=i.insert(u.key,u)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new rn(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return rr(t).get(e8.key).next(function(t){return t||v(),t})},t.prototype.me=function(t,e){return rr(t).put(e8.key,e)},t.prototype.ye=function(t,e){if(e){var n=nS(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(T.min()))return n}return te.newInvalidDocument(t)},t}(),rn=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new n7(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return(0,s.ZT)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new ea(function(t,e){return w(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var u=e.Ae.get(o);if(s.document.isValidDocument()){var a=nN(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=nz(a);r+=c-u,n.push(e.Ie.addEntry(t,o,a))}else if(r-=u,e.trackRemovals){var h=nN(e.Ie.R,te.newNoDocument(o,T.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),nc.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(rt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rr(t){return nb(t,e8.store)}function ri(t){return nb(t,e6.store)}function ro(t){return t.path.toArray()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rs=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;n<r&&n>=0&&r<=11||v();var o=new nh("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(e0.store)}(t),t.createObjectStore(e1.store,{keyPath:e1.keyPath}),t.createObjectStore(e2.store,{keyPath:e2.keyPath,autoIncrement:!0}).createIndex(e2.userMutationsIndex,e2.userMutationsKeyPath,{unique:!0}),t.createObjectStore(e4.store),ru(t),function(t){t.createObjectStore(e6.store)}(t));var s=nc.resolve();return n<3&&r>=3&&(0!==n&&(t.deleteObjectStore(e7.store),t.deleteObjectStore(e9.store),t.deleteObjectStore(nt.store),ru(t)),s=s.next(function(){var t,e;return t=o.store(nt.store),e=new nt(0,0,T.min().toTimestamp(),0),t.put(nt.key,e)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return o.store(e2.store).Nt().next(function(e){t.deleteObjectStore(e2.store),t.createObjectStore(e2.store,{keyPath:e2.keyPath,autoIncrement:!0}).createIndex(e2.userMutationsIndex,e2.userMutationsKeyPath,{unique:!0});var n=o.store(e2.store),r=e.map(function(t){return n.put(t)});return nc.waitFor(r)})})),s=s.next(function(){!function(t){t.createObjectStore(nn.store,{keyPath:nn.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(e8.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){var n;t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(n=e.objectStore(e6.store)).createIndex(e6.readTimeIndex,e6.readTimeIndexPath,{unique:!1}),n.createIndex(e6.collectionReadTimeIndex,e6.collectionReadTimeIndexPath,{unique:!1})})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){(function(t){t.createObjectStore(nr.store,{keyPath:nr.keyPath})})(t),function(t){t.createObjectStore(ni.store,{keyPath:ni.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(e6.store).Ot(function(t,n){e+=nz(n)}).next(function(){var n=new e8(e);return t.store(e8.store).put(e8.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(e1.store),r=t.store(e2.store);return n.Nt().next(function(n){return nc.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(e2.userMutationsIndex,i).next(function(r){return nc.forEach(r,function(r){r.userId===n.userId||v();var i=nC(e.R,r);return nK(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(e7.store),n=t.store(e6.store);return t.store(nt.store).get(nt.key).next(function(t){var r=[];return n.Ot(function(n,i){var o=new D(n),s=[0,eZ(o)];r.push(e.get(s).next(function(n){return n?nc.resolve():e.put(new e7(0,eZ(o),t.highestListenSequenceNumber))}))}).next(function(){return nc.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(ne.store,{keyPath:ne.keyPath});var n=e.store(ne.store),r=new nq,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:eZ(i)})}};return e.store(e6.store).Ot({kt:!0},function(t,e){return i(new D(t).popLast())}).next(function(){return e.store(e4.store).Ot({kt:!0},function(t,e){t[0];var n=t[1];return i((t[2],eX(n)).popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(e9.store);return n.Ot(function(t,r){var i=nR(r),o=nO(e.R,i);return n.put(o)})},t}();function ru(t){t.createObjectStore(e7.store,{keyPath:e7.keyPath}).createIndex(e7.documentTargetsIndex,e7.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(e9.store,{keyPath:e9.keyPath}).createIndex(e9.queryTargetsIndexName,e9.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(nt.store)}var ra="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",rc=function(){function t(e,n,r,i,o,s,u,a,l,f){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=u,this.De=l,this.Ce=f,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.Oe=null,this.$e=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new h(c.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new n8(this,i),this.Le=n+"main",this.R=new nE(a),this.Be=new nl(this.Le,11,new rs(this.R)),this.qe=new nX(this.referenceDelegate,this.R),this.Ut=new nU,this.Ue=new re(this.R,this.Ut),this.Qe=new nP,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===f&&p("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new h(c.FAILED_PRECONDITION,ra);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new a(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return(0,s.mG)(e,void 0,void 0,function(){return(0,s.Jh)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return(0,s.mG)(e,void 0,void 0,function(){return(0,s.Jh)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return(0,s.mG)(e,void 0,void 0,function(){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return rl(e).put(new nn(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(np(e))return d("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return d("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return rh(t).get(e0.key).next(function(t){return nc.resolve(e.tn(t))})},t.prototype.en=function(t){return rl(t).delete(this.clientId)},t.prototype.nn=function(){return(0,s.mG)(this,void 0,void 0,function(){var t,e,n,r,i=this;return(0,s.Jh)(this,function(o){switch(o.label){case 0:return!this.isPrimary||this.sn(this.$e,18e5)?[3,2]:(this.$e=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=nb(t,nn.store);return e.Nt().next(function(t){var n=i.rn(t,18e5),r=t.filter(function(t){return -1===n.indexOf(t)});return nc.forEach(r,function(t){return e.delete(t.clientId)}).next(function(){return r})})}).catch(function(){return[]})]);case 1:if(t=o.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)r=n[e],this.Ke.removeItem(this.on(r.clientId));o.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?nc.resolve(!0):rh(t).get(e0.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new h(c.FAILED_PRECONDITION,ra);return!1}}return!(!e.networkEnabled||!e.inForeground)||rl(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&d("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return(0,s.mG)(this,void 0,void 0,function(){var t=this;return(0,s.Jh)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[e0.store,nn.store],function(e){var n=new nw(e,a.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return rl(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return nQ.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r,i=this;return d("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",no,function(o){return r=new nw(o,i.Ne?i.Ne.next():a.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw p("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new h(c.FAILED_PRECONDITION,ns);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return rh(t).get(e0.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new h(c.FAILED_PRECONDITION,ra)})},t.prototype.Ze=function(t){var e=new e0(this.clientId,this.allowTabSynchronization,Date.now());return rh(t).put(e0.key,e)},t.yt=function(){return nl.yt()},t.prototype.Xe=function(t){var e=this,n=rh(t);return n.get(e0.key).next(function(t){return e.tn(t)?(d("IndexedDbPersistence","Releasing primary lease."),n.delete(e0.key)):nc.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(p("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("unload",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("unload",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return d("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return p("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){p("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function rh(t){return nb(t,e0.store)}function rl(t){return nb(t,nn.store)}function rf(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var rd=function(t,e){this.progress=t,this.wn=e},rp=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0;e<n.length;e++)n[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0;r<e.length;r++)e[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return G.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length?this.Tn(t,e.path):tD(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new G(e)).next(function(t){var e=el;return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=el;return this.Ut.getCollectionParents(t,i).next(function(s){return nc.forEach(s,function(s){var u=new tI(s.child(i),null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt);return r.An(t,u,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return i=e,o.Rn(t,i,r).next(function(t){r=t;for(var e=0;e<i.length;e++)for(var n=i[e],o=0,s=n.mutations;o<s.length;o++){var u=s[o],a=u.key,c=r.get(a);null==c&&(c=te.newInvalidDocument(a),r=r.insert(a,c)),t0(u,c,n.localWriteTime),c.isFoundDocument()||(r=r.remove(a))}})}).next(function(){return r.forEach(function(t,n){tL(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=ep(),i=0;i<e.length;i++)for(var o=0,s=e[i].mutations;o<s.length;o++){var u=s[o];u instanceof t3&&null===n.get(u.key)&&(r=r.add(u.key))}var a=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(a=a.insert(t,e))}),a})},t}(),ry=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=ep(),i=ep(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),rm=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var o=this;return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())||n.isEqual(T.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(s){var u=o.Cn(e,s);return(t_(e)||tE(e))&&o.Nn(e.limitType,u,r,n)?o.Dn(t,e):(f()<=i.in.DEBUG&&d("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),tO(e)),o.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return u.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new ea(tP(t));return e.forEach(function(e,r){tL(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return f()<=i.in.DEBUG&&d("QueryEngine","Using full collection scan to execute query:",tO(e)),this.Sn.getDocumentsMatchingQuery(t,e,T.min())},t}(),rv=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new eo(w),this.kn=new n7(function(t){return ti(t)},to),this.On=T.min(),this._n=t.getMutationQueue(n),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new rp(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function rg(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i,o;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return r=(n=t)._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new rp(n.$n,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=ep(),u=0,a=o;u<a.length;u++){var c=a[u];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var d=0;d<e.length;d++){var p=e[d];r.push(p.batchId);for(var y=0,m=p.mutations;y<m.length;y++){var v=m[y];s=s.add(v.key)}}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function rw(t){return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.qe.getLastRemoteSnapshotVersion(e)})}function rb(t,e,n,r,i){var o=ep();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=eh;return n.forEach(function(n,s){var u=t.get(n),a=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(T.min())?(e.removeEntry(n,a),o=o.insert(n,s)):!u.isValidDocument()||s.version.compareTo(u.version)>0||0===s.version.compareTo(u.version)&&u.hasPendingWrites?(e.addEntry(s,a),o=o.insert(n,s)):d("LocalStore","Ignoring outdated watch update for ",n,". Current version:",u.version," Watch version:",s.version)}),o})}function rI(t,e){return t.persistence.runTransaction("Allocate target","readwrite",function(n){var r;return t.qe.getTargetData(n,e).next(function(i){return i?(r=i,nc.resolve(r)):t.qe.allocateTargetId(n).next(function(i){return r=new n_(e,i,0,n.currentSequenceNumber),t.qe.addTargetData(n,r).next(function(){return r})})})}).then(function(n){var r=t.Fn.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Fn=t.Fn.insert(n.targetId,n),t.kn.set(e,n.targetId)),n})}function rT(t,e,n){return(0,s.mG)(this,void 0,void 0,function(){var r,i,o,u;return(0,s.Jh)(this,function(s){switch(s.label){case 0:i=(r=t).Fn.get(e),o=n?"readwrite":"readwrite-primary",s.label=1;case 1:return s.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:s.sent(),s.label=3;case 3:return[3,5];case 4:if(!np(u=s.sent()))throw u;return d("LocalStore","Failed to update sequence numbers for target "+e+": "+u),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function r_(t,e,n){var r=T.min(),i=ep();return t.persistence.runTransaction("Execute query","readonly",function(o){var s,u;return(s=tk(e),void 0!==(u=t.kn.get(s))?nc.resolve(t.Fn.get(u)):t.qe.getTargetData(o,s)).next(function(e){if(e)return r=e.lastLimboFreeSnapshotVersion,t.qe.getMatchingKeysForTargetId(o,e.targetId).next(function(t){i=t})}).next(function(){return t.xn.getDocumentsMatchingQuery(o,e,n?r:T.min(),n?i:ep())}).next(function(t){return{documents:t,Bn:i}})})}function rE(t,e){var n=t.qe,r=t.Fn.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",function(t){return n.lt(t,e).next(function(t){return t?t.target:null})})}function rS(t){return t.persistence.runTransaction("Get new document changes","readonly",function(e){var n,r,i,o,s,u;return n=t.$n,r=t.On,i=eh,o=nD(r),s=ri(e),u=IDBKeyRange.lowerBound(o,!0),s.Ot({index:e6.readTimeIndex,range:u},function(t,e){var r=nS(n.R,e);i=i.insert(r.key,r),o=e.readTime}).next(function(){return{wn:i,readTime:nA(o)}})}).then(function(e){var n=e.wn,r=e.readTime;return t.On=r,n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rN=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return nc.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){return this.Kn.set(e.id,{id:e.id,version:e.version,createTime:ex(e.createTime)}),nc.resolve()},t.prototype.getNamedQuery=function(t,e){return nc.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,{name:e.name,query:nL(e.bundledQuery),readTime:ex(e.readTime)}),nc.resolve()},t}(),rD=function(){function t(){this.Wn=new ea(rA.Gn),this.zn=new ea(rA.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new rA(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new rA(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new G(new D([])),r=new rA(n,t),i=new rA(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new G(new D([])),n=new rA(e,t),r=new rA(e,t+1),i=ep();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new rA(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),rA=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return G.comparator(t.key,e.key)||w(t.ns,e.ns)},t.Hn=function(t,e){return w(t.ns,e.ns)||G.comparator(t.key,e.key)},t}(),rk=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new ea(rA.Gn)}return t.prototype.checkEmpty=function(t){return nc.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new nI(i,e,n,r);this._n.push(o);for(var s=0;s<r.length;s++){var u=r[s];this.rs=this.rs.add(new rA(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return nc.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return nc.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return nc.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return nc.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return nc.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new rA(e,0),i=new rA(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),nc.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ea(w);return e.forEach(function(t){var e=new rA(t,0),i=new rA(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),nc.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;G.isDocumentKey(i)||(i=i.child(""));var o=new rA(new G(i),0),s=new ea(w);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),nc.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;0===this.hs(e.batchId,"removed")||v(),this._n.shift();var r=this.rs;return nc.forEach(e.mutations,function(i){var o=new rA(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new rA(e,0),r=this.rs.firstAfterOrEqual(n);return nc.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,nc.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),rx=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new eo(G.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return nc.resolve(n?n.document.clone():te.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=eh;return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():te.newInvalidDocument(t))}),nc.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=eh,i=new G(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),u=s.key,a=s.value,c=a.document,h=a.readTime;if(!e.path.isPrefixOf(u.path))break;0>=h.compareTo(n)||tL(e,c)&&(r=r.insert(c.key,c.clone()))}return nc.resolve(r)},t.prototype.fs=function(t,e){return nc.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new rC(this)},t.prototype.getSize=function(t){return nc.resolve(this.size)},t}(),rC=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return(0,s.ZT)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),nc.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(rt),rR=function(){function t(t){this.persistence=t,this.ds=new n7(function(t){return ti(t)},to),this.lastRemoteSnapshotVersion=T.min(),this.highestTargetId=0,this.ws=0,this._s=new rD,this.targetCount=0,this.ys=nZ.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),nc.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return nc.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return nc.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),nc.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),nc.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new nZ(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,nc.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),nc.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,nc.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,u.targetId)),i++)}),nc.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return nc.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return nc.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),nc.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),nc.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),nc.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return nc.resolve(n)},t.prototype.containsKey=function(t,e){return nc.resolve(this._s.containsKey(e))},t}(),rO=function(){function t(t,e){var n=this;this.gs={},this.Ne=new a(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new rR(this),this.Ut=new nV,this.Ue=new rx(this.Ut,function(t){return n.referenceDelegate.ps(t)}),this.R=new nE(e),this.Qe=new rN(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new rk(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;d("MemoryPersistence","Starting transaction:",t);var i=new rL(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return nc.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),rL=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return(0,s.ZT)(e,t),e}(nu),rP=function(){function t(t){this.persistence=t,this.As=new rD,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw v()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),nc.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),nc.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),nc.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nc.forEach(this.vs,function(r){var i=G.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return nc.or([function(){return nc.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),rM=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rF(t,e){return"firestore_clients_"+t+"_"+e}function rV(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function rq(t,e){return"firestore_targets_"+t+"_"+e}rM.UNAUTHENTICATED=new rM(null),rM.GOOGLE_CREDENTIALS=new rM("google-credentials-uid"),rM.FIRST_PARTY=new rM("first-party-uid");var rU=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new h(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(p("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),rG=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new h(i.error.code,i.error.message)),o?new t(e,i.state,r):(p("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),rB=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=ey,s=0;i&&s<r.activeTargetIds.length;++s)i=U(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(p("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),rj=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(p("SharedClientState","Failed to parse online state: "+e),null)},t}(),rK=function(){function t(){this.activeTargetIds=ey}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})},t}(),rz=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new eo(w),this.started=!1,this.Os=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.$s=rF(this.persistenceKey,this.Ns),this.Ms="firestore_sequence_number_"+this.persistenceKey,this.ks=this.ks.insert(this.Ns,new rK),this.Ls=RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us="firestore_online_state_"+this.persistenceKey,this.Qs="firestore_bundle_loaded_"+this.persistenceKey,this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return(0,s.mG)(this,void 0,void 0,function(){var t,e,n,r,i,o,u,a,c,h,l,f=this;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=s.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(rF(this.persistenceKey,r)))&&(o=rB.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(u=this.storage.getItem(this.Us))&&(a=this.js(u))&&this.Ws(a),c=0,h=this.Os;c<h.length;c++)l=h[c],this.Fs(l);return this.Os=[],this.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(rq(this.persistenceKey,t));if(n){var r=rG.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(rq(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.$s),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return d("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){d("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){d("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this;if(t.storageArea===this.storage){if(d("SharedClientState","EVENT",t.key,t.newValue),t.key===this.$s)return void p("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return(0,s.mG)(e,void 0,void 0,function(){var e,n,r,i,o,u;return(0,s.Jh)(this,function(s){if(this.started){if(null!==t.key){if(this.Ls.test(t.key)){if(null==t.newValue)return e=this.ti(t.key),[2,this.ei(e,null)];if(n=this.ni(t.key,t.newValue))return[2,this.ei(n.clientId,n)]}else if(this.Bs.test(t.key)){if(null!==t.newValue&&(r=this.si(t.key,t.newValue)))return[2,this.ii(r)]}else if(this.qs.test(t.key)){if(null!==t.newValue&&(i=this.ri(t.key,t.newValue)))return[2,this.oi(i)]}else if(t.key===this.Us){if(null!==t.newValue&&(o=this.js(t.newValue)))return[2,this.Ws(o)]}else if(t.key===this.Ms)(u=function(t){var e=a.o;if(null!=t)try{var n=JSON.parse(t);"number"==typeof n||v(),e=n}catch(t){p("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==a.o&&this.sequenceNumberHandler(u);else if(t.key===this.Qs)return[2,this.syncEngine.ci()]}}else this.Os.push(t);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.$s,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new rU(this.currentUser,t,e,n),i=rV(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=rV(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=rq(this.persistenceKey,t),i=new rG(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return rB.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return rU.Vs(new rM(i),r,e)},t.prototype.ri=function(t,e){var n=Number(this.qs.exec(t)[1]);return rG.Vs(n,e)},t.prototype.js=function(t){return rj.Vs(t)},t.prototype.ii=function(t){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(d("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.syncEngine.hi(s,u).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=ey;return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),rQ=function(){function t(){this.li=new rK,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new rK,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),rJ=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),rW=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){d("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){d("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),rH={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},rY=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),rZ=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n}return(0,s.ZT)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,s){var u=new o.JJ;u.listenOnce(o.tw.COMPLETE,function(){try{switch(u.getLastErrorCode()){case o.jK.NO_ERROR:var e=u.getResponseJson();d("Connection","XHR received:",JSON.stringify(e)),i(e);break;case o.jK.TIMEOUT:d("Connection",'RPC "'+t+'" timed out'),s(new h(c.DEADLINE_EXCEEDED,"Request time out"));break;case o.jK.HTTP_ERROR:var n=u.getStatus();if(d("Connection",'RPC "'+t+'" failed with status:',n,"response text:",u.getResponseText()),n>0){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var a,l=(a=r.status.toLowerCase().replace(/_/g,"-"),Object.values(c).indexOf(a)>=0?a:c.UNKNOWN);s(new h(l,r.message))}else s(new h(c.UNKNOWN,"Server responded with status "+u.getStatus()))}else s(new h(c.UNAVAILABLE,"Connection failed."));break;default:v()}}finally{d("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);u.send(e,"POST",a,n,15)})},e.prototype.$i=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=(0,o.UE)(),s=(0,o.FJ)(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(u.initMessageHeaders,e),(0,r.uI)()||(0,r.b$)()||(0,r.d)()||(0,r.w1)()||(0,r.Mn)()||(0,r.ru)()||(u.httpHeadersOverwriteParam="$httpHeaders");var a=n.join("");d("Connection","Creating WebChannel: "+a,u);var l=i.createWebChannel(a,u),f=!1,p=!1,m=new rY({Ei:function(t){p?d("Connection","Not sending because WebChannel is closed:",t):(f||(d("Connection","Opening WebChannel transport."),l.open(),f=!0),d("Connection","WebChannel sending:",t),l.send(t))},Ti:function(){return l.close()}}),g=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return g(l,o.ii.EventType.OPEN,function(){p||d("Connection","WebChannel transport opened.")}),g(l,o.ii.EventType.CLOSE,function(){p||(p=!0,d("Connection","WebChannel transport closed"),m.Vi())}),g(l,o.ii.EventType.ERROR,function(t){p||(p=!0,y("Connection","WebChannel transport errored:",t),m.Vi(new h(c.UNAVAILABLE,"The operation could not be completed")))}),g(l,o.ii.EventType.MESSAGE,function(t){var e;if(!p){var n=t.data[0];n||v();var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){d("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=t9[t];if(void 0!==e)return ei(e)}(i),s=r.message;void 0===o&&(o=c.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),p=!0,m.Vi(new h(o,s)),l.close()}else d("Connection","WebChannel received:",n),m.Si(n)}}),g(s,o.ju.STAT_EVENT,function(t){t.stat===o.kN.PROXY?d("Connection","Detected buffering proxy"):t.stat===o.kN.NOPROXY&&d("Connection","Detected no buffering proxy")}),setTimeout(function(){m.Pi()},0),m},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);d("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return d("RestConnection","Received: ",t),t},function(e){throw y("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.Oi=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.5.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=rH[t];return this.Di+"/v1/"+e+":"+n},t}());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rX(){return"undefined"!=typeof window?window:null}function r$(){return"undefined"!=typeof document?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r0(t){return new eD(t,!0)}var r1=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&d("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Qi=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),r2=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new r1(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===c.RESOURCE_EXHAUSTED?(p(e.toString()),p("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===c.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new h(c.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return(0,s.mG)(t,void 0,void 0,function(){return(0,s.Jh)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return d("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(d("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),r4=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return(0,s.ZT)(e,t),e.prototype.wr=function(t){return this.Hi.$i("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r,i,o,s="NO_CHANGE"===(r=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:v(),u=e.targetChange.targetIds||[],a=(i=e.targetChange.resumeToken,t.I?(void 0===i||"string"==typeof i||v(),C.fromBase64String(i||"")):(void 0===i||i instanceof Uint8Array||v(),C.fromUint8Array(i||new Uint8Array))),l=(f=e.targetChange.cause)&&new h(void 0===(o=f).code?c.UNKNOWN:ei(o.code),o.message||"");n=new eb(s,u,a,l||null)}else if("documentChange"in e){e.documentChange,(s=e.documentChange).document,s.document.name,s.document.updateTime,u=eL(t,s.document.name),a=ex(s.document.updateTime);var f=new tt({mapValue:{fields:s.document.fields}});n=new eg((l=te.newFoundDocument(u,a,f),s.targetIds||[]),s.removedTargetIds||[],l.key,l)}else if("documentDelete"in e)e.documentDelete,(s=e.documentDelete).document,u=eL(t,s.document),a=s.readTime?ex(s.readTime):T.min(),f=te.newNoDocument(u,a),n=new eg([],l=s.removedTargetIds||[],f.key,f);else if("documentRemove"in e)e.documentRemove,(s=e.documentRemove).document,u=eL(t,s.document),n=new eg([],a=s.removedTargetIds||[],u,null);else{if(!("filter"in e))return v();e.filter;var d=e.filter;d.targetId,u=new en(s=d.count||0),n=new ew(a=d.targetId,u)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return T.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?T.min():e.readTime?ex(e.readTime):T.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e,n,r,i,o={};o.database=eF(this.R),o.addTarget=(e=this.R,(n=ts(r=t.target)?{documents:ej(e,r)}:{query:eK(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=ek(e,t.resumeToken):t.snapshotVersion.compareTo(T.min())>0&&(n.readTime=eA(e,t.snapshotVersion.toTimestamp())),n);var s=(this.R,null==(i=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return v()}}(0,t.purpose))?null:{"goog-listen-tags":i});s&&(o.labels=s),this.cr(o)},e.prototype.yr=function(t){var e={};e.database=eF(this.R),e.removeTarget=t,this.cr(e)},e}(r2),r3=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return(0,s.ZT)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.$i("Write",t)},e.prototype.onMessage=function(t){if(t.streamToken||v(),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e,n,r=(e=t.writeResults,n=t.commitTime,e&&e.length>0?(void 0!==n||v(),e.map(function(t){var e;return(e=t.updateTime?ex(t.updateTime):ex(n)).isEqual(T.min())&&(e=ex(n)),new tY(e,t.transformResults||[])})):[]),i=ex(t.commitTime);return this.listener.Tr(i,r)}return t.writeResults&&0!==t.writeResults.length&&v(),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=eF(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return eG(e.R,t)})};this.cr(n)},e}(r2),r5=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return(0,s.ZT)(e,t),e.prototype.br=function(){if(this.Rr)throw new h(c.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===c.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new h(c.UNKNOWN,t.toString())})},e.prototype.Oi=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Oi(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===c.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new h(c.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),r6=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(p(e),this.Vr=!1):d("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),r8=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return(0,s.mG)(o,void 0,void 0,function(){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return iu(this)?(d("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return(0,s.mG)(this,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return(e=t).$r.add(4),[4,r7(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.$r.delete(4),[4,r9(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new r6(n,r)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r9(t){return(0,s.mG)(this,void 0,void 0,function(){var e,n;return(0,s.Jh)(this,function(r){switch(r.label){case 0:if(!iu(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function r7(t){return(0,s.mG)(this,void 0,void 0,function(){var e,n;return(0,s.Jh)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function it(t,e){t.Or.has(e.targetId)||(t.Or.set(e.targetId,e),is(t)?io(t):iT(t).er()&&ir(t,e))}function ie(t,e){var n=iT(t);t.Or.delete(e),n.er()&&ii(t,e),0===t.Or.size&&(n.er()?n.ir():iu(t)&&t.Br.set("Unknown"))}function ir(t,e){t.qr.U(e.targetId),iT(t).mr(e)}function ii(t,e){t.qr.U(e),iT(t).yr(e)}function io(t){t.qr=new eT({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.Or.get(e)||null}}),iT(t).start(),t.Br.Sr()}function is(t){return iu(t)&&!iT(t).tr()&&t.Or.size>0}function iu(t){return 0===t.$r.size}function ia(t){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){return t.Or.forEach(function(e,n){ir(t,e)}),[2]})})}function ic(t,e){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(n){return t.qr=void 0,is(t)?(t.Br.Nr(e),io(t)):t.Br.set("Unknown"),[2]})})}function ih(t,e,n){return(0,s.mG)(this,void 0,void 0,function(){var r,i,o;return(0,s.Jh)(this,function(u){switch(u.label){case 0:if(t.Br.set("Online"),!(e instanceof eb&&2===e.state&&e.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i,o;return(0,s.Jh)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?(o=i[r],t.Or.has(o)?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]):[3,5];case 2:s.sent(),t.Or.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:case 4:return u.sent(),[3,5];case 3:return r=u.sent(),d("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,il(t,r)];case 5:return[3,13];case 6:if(e instanceof eg?t.qr.X(e):e instanceof ew?t.qr.rt(e):t.qr.et(e),n.isEqual(T.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,rw(t.localStore)];case 8:var a;return i=u.sent(),n.compareTo(i)>=0?[4,((a=t.qr.ut(n)).targetChanges.forEach(function(e,r){if(e.resumeToken.approximateByteSize()>0){var i=t.Or.get(r);i&&t.Or.set(r,i.withResumeToken(e.resumeToken,n))}}),a.targetMismatches.forEach(function(e){var n=t.Or.get(e);n&&(t.Or.set(e,n.withResumeToken(C.EMPTY_BYTE_STRING,n.snapshotVersion)),ii(t,e),ir(t,new n_(n.target,e,1,n.sequenceNumber)))}),t.remoteSyncer.applyRemoteEvent(a))]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return d("RemoteStore","Failed to raise snapshot:",o=u.sent()),[4,il(t,o)];case 12:return u.sent(),[3,13];case 13:return[2]}})})}function il(t,e,n){return(0,s.mG)(this,void 0,void 0,function(){var r=this;return(0,s.Jh)(this,function(i){switch(i.label){case 0:if(!np(e))throw e;return t.$r.add(1),[4,r7(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return rw(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return(0,s.mG)(r,void 0,void 0,function(){return(0,s.Jh)(this,function(e){switch(e.label){case 0:return d("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.$r.delete(1),[4,r9(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function id(t,e){return e().catch(function(n){return il(t,n,e)})}function ip(t){return(0,s.mG)(this,void 0,void 0,function(){var e,n,r,i,o;return(0,s.Jh)(this,function(s){var u,a,c;switch(s.label){case 0:n=i_(e=t),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!(iu(u=e)&&u.kr.length<10))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,(a=e.localStore,c=r,a.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===c&&(c=-1),a._n.getNextMutationBatchAfterBatchId(t,c)}))];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=i_(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,il(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return iy(e)&&im(e),[2]}})})}function iy(t){return iu(t)&&!i_(t).tr()&&t.kr.length>0}function im(t){i_(t).start()}function iv(t){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){return i_(t).Ar(),[2]})})}function ig(t){return(0,s.mG)(this,void 0,void 0,function(){var e,n,r,i;return(0,s.Jh)(this,function(o){for(e=i_(t),n=0,r=t.kr;n<r.length;n++)i=r[n],e.Er(i.mutations);return[2]})})}function iw(t,e,n){return(0,s.mG)(this,void 0,void 0,function(){var r,i;return(0,s.Jh)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=nT.from(r,e,n),[4,id(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,ip(t)];case 2:return o.sent(),[2]}})})}function ib(t,e){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(n){switch(n.label){case 0:return e&&i_(t).pr?[4,function(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return er(r=e.code)&&r!==c.ABORTED?(n=t.kr.shift(),i_(t).sr(),[4,id(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,ip(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return iy(t)&&im(t),[2]}})})}function iI(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return n=t,e?(n.$r.delete(2),[4,r9(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.$r.add(2),[4,r7(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function iT(t){var e,n,r,i=this;return t.Ur||(t.Ur=(e=t.datastore,n=t.asyncQueue,r={Ii:ia.bind(null,t),Ri:ic.bind(null,t),_r:ih.bind(null,t)},e.br(),new r4(n,e.Hi,e.credentials,e.R,r)),t.Mr.push(function(e){return(0,s.mG)(i,void 0,void 0,function(){return(0,s.Jh)(this,function(n){switch(n.label){case 0:return e?(t.Ur.sr(),is(t)?io(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:n.sent(),t.qr=void 0,n.label=3;case 3:return[2]}})})})),t.Ur}function i_(t){var e,n,r,i=this;return t.Qr||(t.Qr=(e=t.datastore,n=t.asyncQueue,r={Ii:iv.bind(null,t),Ri:ib.bind(null,t),Ir:ig.bind(null,t),Tr:iw.bind(null,t)},e.br(),new r3(n,e.Hi,e.credentials,e.R,r)),t.Mr.push(function(e){return(0,s.mG)(i,void 0,void 0,function(){return(0,s.Jh)(this,function(n){switch(n.label){case 0:return e?(t.Qr.sr(),[4,ip(t)]):[3,2];case 1:return n.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:n.sent(),t.kr.length>0&&(d("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),n.label=4;case 4:return[2]}})})})),t.Qr}var iE=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new na,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new h(c.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function iS(t,e){if(p("AsyncQueue",e+": "+t),np(t))return new h(c.UNAVAILABLE,e+": "+t);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var iN=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||G.comparator(e.key,n.key)}:function(t,e){return G.comparator(t.key,e.key)},this.keyedMap=el,this.sortedSet=new eo(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t)||this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),iD=function(){function t(){this.Kr=new eo(G.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):v():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),iA=function(){function t(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=u}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,iN.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&tC(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),ik=function(){this.Wr=void 0,this.listeners=[]},ix=function(){this.queries=new n7(function(t){return tR(t)},tC),this.onlineState="Unknown",this.Gr=new Set};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iC(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i,o,u,a;return(0,s.Jh)(this,function(s){switch(s.label){case 0:if(n=t,r=e.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new ik),!i)return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),u=o,[4,n.onListen(r)];case 2:return u.Wr=s.sent(),[3,4];case 3:return a=iS(s.sent(),"Initialization of query '"+tO(e.query)+"' failed"),[2,void e.onError(a)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&iP(n),[2]}})})}function iR(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i,o,u;return(0,s.Jh)(this,function(s){return n=t,r=e.query,i=!1,(o=n.queries.get(r))&&(u=o.listeners.indexOf(e))>=0&&(o.listeners.splice(u,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function iO(t,e){for(var n=!1,r=0;r<e.length;r++){var i=e[r],o=i.query,s=t.queries.get(o);if(s){for(var u=0,a=s.listeners;u<a.length;u++)a[u].Hr(i)&&(n=!0);s.Wr=i}}n&&iP(t)}function iL(t,e,n){var r=t.queries.get(e);if(r)for(var i=0,o=r.listeners;i<o.length;i++)o[i].onError(n);t.queries.delete(e)}function iP(t){t.Gr.forEach(function(t){t.next()})}var iM=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new iA(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=iA.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),iF=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),iV=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return eL(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?eU(this.R,t.document,!1):te.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},t.prototype.Qn=function(t){return ex(t)},t}(),iq=function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=iU(t)}return t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new iV(this.R),r=0;r<t.length;r++){var i=t[r];if(i.metadata.queries)for(var o=n.qn(i.metadata.name),s=0,u=i.metadata.queries;s<u.length;s++){var a=u[s],c=(e.get(a)||ep()).add(o);e.set(a,c)}}return e},t.prototype.complete=function(){return(0,s.mG)(this,void 0,void 0,function(){var t,e,n,r,i;return(0,s.Jh)(this,function(o){switch(o.label){case 0:return[4,function(t,e,n,r){return(0,s.mG)(this,void 0,void 0,function(){var i,o,u,a,c,h,l,f,d,p;return(0,s.Jh)(this,function(s){switch(s.label){case 0:for(i=t,o=ep(),u=eh,a=ef,c=0,h=n;c<h.length;c++)l=h[c],f=e.qn(l.metadata.name),l.document&&(o=o.add(f)),u=u.insert(f,e.Un(l)),a=a.insert(f,e.Qn(l.metadata.readTime));return d=i.$n.newChangeBuffer({trackRemovals:!0}),[4,rI(i,tk(tT(D.fromString("__bundle__/docs/"+r))))];case 1:return p=s.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return rb(t,d,u,T.min(),a).next(function(e){return d.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,p.targetId).next(function(){return i.qe.addMatchingKeys(t,o,p.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}(this.localStore,new iV(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?(i=r[n],[4,function(t,e,n){return void 0===n&&(n=ep()),(0,s.mG)(this,void 0,void 0,function(){var r,i;return(0,s.Jh)(this,function(o){switch(o.label){case 0:return[4,rI(t,tk(nL(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=t).persistence.runTransaction("Save named query","readwrite",function(t){var o=ex(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(t,e);var s=r.withResumeToken(C.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Qe.saveNamedQuery(t,e)})})]}})})}(this.localStore,i,e.get(i.name))]):[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new rd(Object.assign({},this.progress),t))]}})})},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iU(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var iG=function(t){this.key=t},iB=function(t){this.key=t},ij=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=ep(),this.mutatedKeys=ep(),this.lo=tP(t),this.fo=new iN(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new iD,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,u=!1,a=t_(this.query)&&i.size===this.query.limit?i.last():null,c=tE(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=tL(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(a&&n.lo(l,a)>0||c&&0>n.lo(l,c))&&(u=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(a||c)&&(u=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),t_(this.query)||tE(this.query))for(;s.size>this.query.limit;){var h=t_(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:u,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){var n,i,o;return n=t.type,i=e.type,(o=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return v()}})(n)-o(i)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],u=0===this.ho.size&&this.current?1:0,a=u!==this.ao;return this.ao=u,0!==o.length||a?{snapshot:new iA(this.query,t.fo,i,o,t.mutatedKeys,0===u,a,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new iD,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=ep(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new iB(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new iG(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=ep();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return iA.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),iK=function(t,e,n){this.query=t,this.targetId=e,this.view=n},iz=function(t){this.key=t,this.bo=!1},iQ=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new n7(function(t){return tR(t)},tC),this.Vo=new Map,this.So=new Set,this.Do=new eo(G.comparator),this.Co=new Map,this.No=new rD,this.xo={},this.Fo=new Map,this.ko=nZ.Yt(),this.onlineState="Unknown",this.Oo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Oo},enumerable:!1,configurable:!0}),t}();function iJ(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i,o,u,a;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return(o=(n=oc(t)).Po.get(e))?(r=o.targetId,n.sharedClientState.addLocalQueryTarget(r),i=o.view.Ro(),[3,4]):[3,1];case 1:return[4,rI(n.localStore,tk(e))];case 2:return u=s.sent(),a=n.sharedClientState.addLocalQueryTarget(u.targetId),r=u.targetId,[4,iW(n,e,r,"current"===a)];case 3:i=s.sent(),n.isPrimaryClient&&it(n.remoteStore,u),s.label=4;case 4:return[2,i]}})})}function iW(t,e,n,r){return(0,s.mG)(this,void 0,void 0,function(){var i,o,u,a,c,h;return(0,s.Jh)(this,function(l){switch(l.label){case 0:return t.$o=function(e,n,r){return function(t,e,n,r){return(0,s.mG)(this,void 0,void 0,function(){var i,o,u;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return(i=e.view._o(n)).Nn?[4,r_(t.localStore,e.query,!1).then(function(t){var n=t.documents;return e.view._o(n,i)})]:[3,2];case 1:i=s.sent(),s.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),u=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(i8(t,e.targetId,u.To),u.snapshot)]}})})}(t,e,n,r)},[4,r_(t.localStore,e,!0)];case 1:return u=(o=new ij(e,(i=l.sent()).Bn))._o(i.documents),a=ev.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),c=o.applyChanges(u,t.isPrimaryClient,a),i8(t,n,c.To),h=new iK(e,n,o),[2,(t.Po.set(e,h),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),c.snapshot)]}})})}function iH(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i;return(0,s.Jh)(this,function(o){switch(o.label){case 0:return r=(n=t).Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!tC(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,rT(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),ie(n.remoteStore,r.targetId),i5(n,r.targetId)}).catch(n2)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return i5(n,r.targetId),[4,rT(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function iY(t,e,n){return(0,s.mG)(this,void 0,void 0,function(){var r,i,o;return(0,s.Jh)(this,function(s){var u,a,c,h,l,f,d;switch(s.label){case 0:r=oh(t),s.label=1;case 1:return s.trys.push([1,5,,6]),[4,(u=r.localStore,c=I.now(),h=e.reduce(function(t,e){return t.add(e.key)},ep()),u.persistence.runTransaction("Locally write mutations","readwrite",function(t){return u.Mn.pn(t,h).next(function(n){a=n;for(var r=[],i=0;i<e.length;i++){var o=e[i],s=function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),u=tU(o.transform,s||null);null!=u&&(null==n&&(n=tt.empty()),n.set(o.field,u))}return n||null}(o,a.get(o.key));null!=s&&r.push(new t3(o.key,s,function t(e){var n=[];return E(e.fields||{},function(e,r){var i=new k([e]);if($(r)){var o=t(r.mapValue).fields;if(0===o.length)n.push(i);else for(var s=0;s<o.length;s++){var u=o[s];n.push(i.child(u))}}else n.push(i)}),new x(n)}(s.toProto().mapValue),tZ.exists(!0)))}return u._n.addMutationBatch(t,c,r,e)})}).then(function(t){return t.applyToLocalDocumentSet(a),{batchId:t.batchId,changes:a}}))];case 2:return i=s.sent(),r.sharedClientState.addPendingMutation(i.batchId),l=r,f=i.batchId,(d=l.xo[l.currentUser.toKey()])||(d=new eo(w)),d=d.insert(f,n),l.xo[l.currentUser.toKey()]=d,[4,i7(r,i.changes)];case 3:return s.sent(),[4,ip(r.remoteStore)];case 4:return s.sent(),[3,6];case 5:return o=iS(s.sent(),"Failed to persist write"),n.reject(o),[3,6];case 6:return[2]}})})}function iZ(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r;return(0,s.Jh)(this,function(i){var o,s,u;switch(i.label){case 0:n=t,i.label=1;case 1:return i.trys.push([1,4,,6]),[4,(o=n.localStore,s=e.snapshotVersion,u=o.Fn,o.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var n=o.$n.newChangeBuffer({trackRemovals:!0});u=o.Fn;var r=[];e.targetChanges.forEach(function(e,n){var i=u.get(n);if(i){r.push(o.qe.removeMatchingKeys(t,e.removedDocuments,n).next(function(){return o.qe.addMatchingKeys(t,e.addedDocuments,n)}));var a=e.resumeToken;if(a.approximateByteSize()>0){var c=i.withResumeToken(a,s).withSequenceNumber(t.currentSequenceNumber);u=u.insert(n,c),c.resumeToken.approximateByteSize()>0||v(),(0===i.resumeToken.approximateByteSize()||c.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()>=3e8||e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size>0)&&r.push(o.qe.updateTargetData(t,c))}}});var i=eh;if(e.documentUpdates.forEach(function(n,i){e.resolvedLimboDocuments.has(n)&&r.push(o.persistence.referenceDelegate.updateLimboDocument(t,n))}),r.push(rb(t,n,e.documentUpdates,s,void 0).next(function(t){i=t})),!s.isEqual(T.min())){var a=o.qe.getLastRemoteSnapshotVersion(t).next(function(e){return o.qe.setTargetsMetadata(t,t.currentSequenceNumber,s)});r.push(a)}return nc.waitFor(r).next(function(){return n.apply(t)}).next(function(){return o.Mn.En(t,i)}).next(function(){return i})}).then(function(t){return o.Fn=u,t}))];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1||v(),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?r.bo||v():t.removedDocuments.size>0&&(r.bo||v(),r.bo=!1))}),[4,i7(n,r,e)];case 3:case 5:return i.sent(),[3,6];case 4:return[4,n2(i.sent())];case 6:return[2]}})})}function iX(t,e,n){if(t.isPrimaryClient&&0===n||!t.isPrimaryClient&&1===n){var r,i,o=[];t.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&o.push(r.snapshot)}),(r=t.eventManager).onlineState=e,i=!1,r.queries.forEach(function(t,n){for(var r=0,o=n.listeners;r<o.length;r++)o[r].zr(e)&&(i=!0)}),i&&iP(r),o.length&&t.vo._r(o),t.onlineState=e,t.isPrimaryClient&&t.sharedClientState.setOnlineState(e)}}function i$(t,e,n){return(0,s.mG)(this,void 0,void 0,function(){var r,i,o,u,a,c;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return(r=t).sharedClientState.updateQueryState(e,"rejected",n),(o=(i=r.Co.get(e))&&i.key)?(u=(u=new eo(G.comparator)).insert(o,te.newNoDocument(o,T.min())),a=ep().add(o),c=new em(T.min(),new Map,new ea(w),u,a),[4,iZ(r,c)]):[3,2];case 1:return s.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),i9(r),[3,4];case 2:return[4,rT(r.localStore,e,!1).then(function(){return i5(r,e,n)}).catch(n2)];case 3:s.sent(),s.label=4;case 4:return[2]}})})}function i0(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i;return(0,s.Jh)(this,function(o){var s;switch(o.label){case 0:n=t,r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,(s=n.localStore).persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var n,r,i,o=e.batch.keys(),u=s.$n.newChangeBuffer({trackRemovals:!0});return(r=(n=e.batch).keys(),i=nc.resolve(),r.forEach(function(r){i=i.next(function(){return u.getEntry(t,r)}).next(function(t){var i=e.docVersions.get(r);null!==i||v(),0>t.version.compareTo(i)&&(n.applyToRemoteDocument(t,e),t.isValidDocument()&&u.addEntry(t,e.commitVersion))})}),i.next(function(){return s._n.removeMutationBatch(t,n)})).next(function(){return u.apply(t)}).next(function(){return s._n.performConsistencyCheck(t)}).next(function(){return s.Mn.pn(t,o)})})];case 2:return i=o.sent(),i3(n,r,null),i4(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,i7(n,i)];case 3:case 5:return o.sent(),[3,6];case 4:return[4,n2(o.sent())];case 6:return[2]}})})}function i1(t,e,n){return(0,s.mG)(this,void 0,void 0,function(){var r,i;return(0,s.Jh)(this,function(o){var s;switch(o.label){case 0:r=t,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,(s=r.localStore).persistence.runTransaction("Reject batch","readwrite-primary",function(t){var n;return s._n.lookupMutationBatch(t,e).next(function(e){return null!==e||v(),n=e.keys(),s._n.removeMutationBatch(t,e)}).next(function(){return s._n.performConsistencyCheck(t)}).next(function(){return s.Mn.pn(t,n)})})];case 2:return i=o.sent(),i3(r,e,n),i4(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,i7(r,i)];case 3:case 5:return o.sent(),[3,6];case 4:return[4,n2(o.sent())];case 6:return[2]}})})}function i2(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i,o;return(0,s.Jh)(this,function(s){var u;switch(s.label){case 0:iu((n=t).remoteStore)||d("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,(u=n.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return u._n.getHighestUnacknowledgedBatchId(t)})];case 2:return -1===(r=s.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=iS(s.sent(),"Initialization of waitForPendingWrites() operation failed"),e.reject(o),[3,4];case 4:return[2]}})})}function i4(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function i3(t,e,n){var r=t.xo[t.currentUser.toKey()];if(r){var i=r.get(e);i&&(n?i.reject(n):i.resolve(),r=r.remove(e)),t.xo[t.currentUser.toKey()]=r}}function i5(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||i6(t,e)})}function i6(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(ie(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),i9(t))}function i8(t,e,n){for(var r=0;r<n.length;r++){var i=n[r];i instanceof iG?(t.No.addReference(i.key,e),function(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(d("SyncEngine","New document in limbo: "+n),t.So.add(r),i9(t))}(t,i)):i instanceof iB?(d("SyncEngine","Document no longer in limbo: "+i.key),t.No.removeReference(i.key,e),t.No.containsKey(i.key)||i6(t,i.key)):v()}}function i9(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new G(D.fromString(e)),r=t.ko.next();t.Co.set(r,new iz(n)),t.Do=t.Do.insert(n,r),it(t.remoteStore,new n_(tk(tT(n.path)),r,2,a.o))}}function i7(t,e,n){return(0,s.mG)(this,void 0,void 0,function(){var r,i,o,u;return(0,s.Jh)(this,function(a){switch(a.label){case 0:return i=[],o=[],u=[],(r=t).Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,s){u.push(r.$o(s,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(s.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=ry.Pn(s.targetId,t);o.push(e)}}))}),[4,Promise.all(u)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i,o,u,a,c,h,l;return(0,s.Jh)(this,function(s){switch(s.label){case 0:n=t,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return nc.forEach(e,function(e){return nc.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return nc.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return s.sent(),[3,4];case 3:if(!np(r=s.sent()))throw r;return d("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(u=o[i]).targetId,u.fromCache||(h=(c=n.Fn.get(a)).snapshotVersion,l=c.withLastLimboFreeSnapshotVersion(h),n.Fn=n.Fn.insert(a,l));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function ot(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r;return(0,s.Jh)(this,function(i){var o;switch(i.label){case 0:return(n=t).currentUser.isEqual(e)?[3,3]:(d("SyncEngine","User change. New user:",e.toKey()),[4,rg(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,(o=n).Fo.forEach(function(t){t.forEach(function(t){t.reject(new h(c.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),o.Fo.clear(),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,i7(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function oe(t,e){var n=t.Co.get(e);if(n&&n.bo)return ep().add(n.key);var r=ep(),i=t.Vo.get(e);if(!i)return r;for(var o=0;o<i.length;o++){var s=i[o],u=t.Po.get(s);r=r.unionWith(u.view.wo)}return r}function on(t){return(0,s.mG)(this,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(n){return[2,rS((e=t).localStore).then(function(t){return i7(e,t)})]})})}function or(t,e,n,r){return(0,s.mG)(this,void 0,void 0,function(){var i,o;return(0,s.Jh)(this,function(s){switch(s.label){case 0:var u,a;return[4,(a=(u=(i=t).localStore)._n,u.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return a.jt(t,e).next(function(e){return e?u.Mn.pn(t,e):nc.resolve(null)})}))];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,ip(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(i3(i,e,r||null),i4(i,e),function(t,e){t._n.Gt(e)}(i.localStore,e)):v(),s.label=4;case 4:return[4,i7(i,o)];case 5:return s.sent(),[3,7];case 6:d("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function oi(t,e,n){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i,o,u,a,c,h,l,f,d,p,y,m;return(0,s.Jh)(this,function(v){switch(v.label){case 0:n=t,r=[],i=[],o=0,u=e,v.label=1;case 1:return o<u.length?(a=u[o],c=void 0,(h=n.Vo.get(a))&&0!==h.length?[4,rI(n.localStore,tk(h[0]))]:[3,7]):[3,13];case 2:c=v.sent(),l=0,f=h,v.label=3;case 3:return l<f.length?(d=f[l],p=n.Po.get(d),[4,function(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i;return(0,s.Jh)(this,function(o){switch(o.label){case 0:return[4,r_((n=t).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&i8(n,e.targetId,i.To),i)]}})})}(n,p)]):[3,6];case 4:(y=v.sent()).snapshot&&i.push(y.snapshot),v.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,rE(n.localStore,a)];case 8:return m=v.sent(),[4,rI(n.localStore,m)];case 9:return c=v.sent(),[4,iW(n,oo(m),a,!1)];case 10:v.sent(),v.label=11;case 11:r.push(c),v.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function oo(t){var e,n,r,i;return e=t.path,n=t.collectionGroup,r=t.orderBy,i=t.filters,new tI(e,n,r,i,t.limit,"F",t.startAt,t.endAt)}function os(t){return t.localStore.persistence.fn()}function ou(t,e,n,r){return(0,s.mG)(this,void 0,void 0,function(){var i,o,u;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return(i=t).Oo?(d("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,rS(i.localStore)];case 3:return o=s.sent(),u=em.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,i7(i,o,u)];case 4:return s.sent(),[3,8];case 5:return[4,rT(i.localStore,e,!0)];case 6:return s.sent(),i5(i,e,r),[3,8];case 7:v(),s.label=8;case 8:return[2]}})})}function oa(t,e,n){return(0,s.mG)(this,void 0,void 0,function(){var r,i,o,u,a,c,h,l,f,p;return(0,s.Jh)(this,function(y){switch(y.label){case 0:if(!(r=oc(t)).Oo)return[3,10];i=0,o=e,y.label=1;case 1:return i<o.length?(u=o[i],r.Vo.has(u)?(d("SyncEngine","Adding an already active target "+u),[3,5]):[4,rE(r.localStore,u)]):[3,6];case 2:return a=y.sent(),[4,rI(r.localStore,a)];case 3:return c=y.sent(),[4,iW(r,oo(a),c.targetId,!1)];case 4:y.sent(),it(r.remoteStore,c),y.label=5;case 5:return i++,[3,1];case 6:h=function(t){return(0,s.Jh)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,rT(r.localStore,t,!1).then(function(){ie(r.remoteStore,t),i5(r,t)}).catch(n2)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},l=0,f=n,y.label=7;case 7:return l<f.length?(p=f[l],[5,h(p)]):[3,10];case 8:y.sent(),y.label=9;case 9:return l++,[3,7];case 10:return[2]}})})}function oc(t){return t.remoteStore.remoteSyncer.applyRemoteEvent=iZ.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=oe.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=i$.bind(null,t),t.vo._r=iO.bind(null,t.eventManager),t.vo.Mo=iL.bind(null,t.eventManager),t}function oh(t){return t.remoteStore.remoteSyncer.applySuccessfulWrite=i0.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=i1.bind(null,t),t}function ol(t,e,n){(function(t,e,n){return(0,s.mG)(this,void 0,void 0,function(){var r,i,o,u,a,c;return(0,s.Jh)(this,function(s){var h,l,f,d,p,m;switch(s.label){case 0:return s.trys.push([0,14,,15]),[4,e.getMetadata()];case 1:return r=s.sent(),[4,(h=t.localStore,f=ex((l=r).createTime),h.persistence.runTransaction("hasNewerBundle","readonly",function(t){return h.Qe.getBundleMetadata(t,l.id)}).then(function(t){return!!t&&t.createTime.compareTo(f)>=0}))];case 2:return s.sent()?[4,e.close()]:[3,4];case 3:return[2,(s.sent(),void n._completeWith({taskState:"Success",documentsLoaded:(d=r).totalDocuments,bytesLoaded:d.totalBytes,totalDocuments:d.totalDocuments,totalBytes:d.totalBytes}))];case 4:return n._updateProgress(iU(r)),i=new iq(r,t.localStore,e.R),[4,e.Lo()];case 5:o=s.sent(),s.label=6;case 6:return o?[4,i.oo(o)]:[3,10];case 7:return(u=s.sent())&&n._updateProgress(u),[4,e.Lo()];case 8:o=s.sent(),s.label=9;case 9:return[3,6];case 10:return[4,i.complete()];case 11:return[4,i7(t,(a=s.sent()).wn,void 0)];case 12:return s.sent(),[4,(p=t.localStore,m=r,p.persistence.runTransaction("Save bundle","readwrite",function(t){return p.Qe.saveBundleMetadata(t,m)}))];case 13:return s.sent(),n._completeWith(a.progress),[3,15];case 14:return y("SyncEngine","Loading bundle failed with "+(c=s.sent())),n._failWith(c),[3,15];case 15:return[2]}})})})(t,e,n).then(function(){t.sharedClientState.notifyBundleLoaded()})}var of=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){switch(e.label){case 0:return this.R=r0(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){var e;return e=this.persistence,new rv(e,new rm,t.initialUser,this.R)},t.prototype.qo=function(t){return new rO(rP.bs,this.R)},t.prototype.Bo=function(t){return new rQ},t.prototype.terminate=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),od=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return(0,s.ZT)(e,t),e.prototype.initialize=function(e){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,function(t){return(0,s.mG)(this,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(n){return[2,(e=t).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){var e,n;return e=ri(t),n=T.min(),e.Ot({index:e6.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=nA(e.readTime)),r.done()}).next(function(){return n})}).then(function(t){e.On=t})]})})}(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,oh(this.Ko.syncEngine)];case 4:return n.sent(),[4,ip(this.Ko.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Qo=function(t){var e;return e=this.persistence,new rv(e,new rm,t.initialUser,this.R)},e.prototype.Uo=function(t){return new n5(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=rf(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?nj.withCacheSize(this.cacheSizeBytes):nj.DEFAULT;return new rc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,rX(),r$(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new rQ},e}(of),op=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return(0,s.ZT)(e,t),e.prototype.initialize=function(e){return(0,s.mG)(this,void 0,void 0,function(){var n,r=this;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof rz?(this.sharedClientState.syncEngine={ui:or.bind(null,n),ai:ou.bind(null,n),hi:oa.bind(null,n),fn:os.bind(null,n),ci:on.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return(0,s.mG)(r,void 0,void 0,function(){return(0,s.Jh)(this,function(e){switch(e.label){case 0:return[4,function(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i,o,u,a,c,h;return(0,s.Jh)(this,function(s){var l;switch(s.label){case 0:return oc(n=t),oh(n),!0!==e||!0===n.Oo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,oi(n,r.toArray())]);case 1:return i=s.sent(),n.Oo=!0,[4,iI(n.remoteStore,!0)];case 2:for(s.sent(),o=0,u=i;o<u.length;o++)a=u[o],it(n.remoteStore,a);return[3,7];case 3:return!1!==e||!1===n.Oo?[3,7]:(c=[],h=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then(function(){return i5(n,e),rT(n.localStore,e,!0)}),ie(n.remoteStore,e)}),[4,h]);case 4:return s.sent(),[4,oi(n,c)];case 5:return s.sent(),(l=n).Co.forEach(function(t,e){ie(l.remoteStore,e)}),l.No.ts(),l.Co=new Map,l.Do=new eo(G.comparator),n.Oo=!1,[4,iI(n.remoteStore,!1)];case 6:s.sent(),s.label=7;case 7:return[2]}})})}(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=rX();if(!rz.yt(e))throw new h(c.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=rf(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new rz(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(od),oy=function(){function t(){}return t.prototype.initialize=function(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n=this;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return iX(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=ot.bind(null,this.syncEngine),[4,iI(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new ix},t.prototype.createDatastore=function(t){var e=r0(t.databaseInfo.databaseId),n=new rZ(t.databaseInfo);return new r5(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n=this;return e=this.localStore,new r8(e,this.datastore,t.asyncQueue,function(t){return iX(n.syncEngine,t,0)},rW.yt()?new rW:new rJ)},t.prototype.createSyncEngine=function(t,e){var n,r,i,o,s;return n=this.localStore,r=this.remoteStore,i=this.eventManager,o=this.sharedClientState,s=new iQ(n,r,i,o,t.initialUser,t.maxConcurrentLimboResolutions),e&&(s.Oo=!0),s},t.prototype.terminate=function(){return function(t){return(0,s.mG)(this,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return e=t,d("RemoteStore","RemoteStore shutting down."),e.$r.add(5),[4,r7(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function om(t,e){void 0===e&&(e=10240);var n=0;return{read:function(){return(0,s.mG)(this,void 0,void 0,function(){var r;return(0,s.Jh)(this,function(i){return n<t.byteLength?(r={value:t.slice(n,n+e),done:!1},[2,(n+=e,r)]):[2,{done:!0}]})})},cancel:function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(t){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ov=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),og=function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new na,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}return t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return(0,s.mG)(this,void 0,void 0,function(){var t,e,n;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return[4,this.Jo()];case 1:return null===(t=r.sent())?[2,null]:(isNaN(n=Number(e=this.zo.decode(t)))&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return[2,new iF(JSON.parse(r.sent()),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return 123===t})},t.prototype.Jo=function(){return(0,s.mG)(this,void 0,void 0,function(){var t,e;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return 0>this.Zo()?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return(0,s.mG)(this,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return(0,s.mG)(this,void 0,void 0,function(){var t,e;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})},t}(),ow=function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return(0,s.mG)(this,void 0,void 0,function(){var e,n=this;return(0,s.Jh)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new h(c.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i,o,u,a;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return r=eF((n=t).R)+"/documents",i={documents:e.map(function(t){return eO(n.R,t)})},[4,n.Oi("BatchGetDocuments",r,i)];case 1:return o=s.sent(),u=new Map,o.forEach(function(t){var e,r,i,o,s,a,c=(e=n.R,"found"in t?(t.found||v(),t.found.name,t.found.updateTime,r=eL(e,t.found.name),i=ex(t.found.updateTime),o=new tt({mapValue:{fields:t.found.fields}}),te.newFoundDocument(r,i,o)):"missing"in t?(t.missing||v(),t.readTime||v(),s=eL(e,t.missing),a=ex(t.readTime),te.newNoDocument(s,a)):v());u.set(c.key.toString(),c)}),a=[],[2,(e.forEach(function(t){var e=u.get(t.toString());e||v(),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new et(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return(0,s.mG)(this,void 0,void 0,function(){var t,e=this;return(0,s.Jh)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=G.fromPath(n);e.mutations.push(new ee(r,e.precondition(r)))}),[4,function(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i;return(0,s.Jh)(this,function(o){switch(o.label){case 0:return r=eF((n=t).R)+"/documents",i={writes:e.map(function(t){return eG(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw v();e=T.min()}var e,n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new h(c.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?tZ.updateTime(e):tZ.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(T.min()))throw new h(c.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return tZ.updateTime(e)}return tZ.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}(),ob=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new r1(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return(0,s.mG)(t,void 0,void 0,function(){var t,e,n=this;return(0,s.Jh)(this,function(r){return t=new ow(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!V(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!er(e)}return!1},t}(),oI=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=rM.UNAUTHENTICATED,this.clientId=g.u(),this.credentialListener=function(){},this.receivedInitialUser=new na,this.credentials.setChangeListener(function(t){d("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()})}return t.prototype.getConfiguration=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}})})},t.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then(function(){return e.credentialListener(e.user)})},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new h(c.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new na;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return(0,s.mG)(t,void 0,void 0,function(){var t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:n.sent(),n.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=iS(n.sent(),"Failed to shutdown persistence"),e.reject(t),[3,6];case 6:return[2]}})})}),e.promise},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oT(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i=this;return(0,s.Jh)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),d("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(n){r.isEqual(n)||(r=n,t.asyncQueue.enqueueRetryable(function(){return(0,s.mG)(i,void 0,void 0,function(){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,rg(e.localStore,n)];case 1:return t.sent(),[2]}})})}))}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function o_(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,oE(t)];case 1:return n=i.sent(),d("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(n){return t.asyncQueue.enqueueRetryable(function(){return function(t,e){return(0,s.mG)(this,void 0,void 0,function(){var n,r;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return(n=t).asyncQueue.verifyOperationInProgress(),d("RemoteStore","RemoteStore received new credentials"),r=iu(n),n.$r.add(3),[4,r7(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.$r.delete(3),[4,r9(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,n)})}),t.onlineComponents=e,[2]}})})}function oE(t){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(d("FirestoreClient","Using default OfflineComponentProvider"),[4,oT(t,new of)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function oS(t){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(d("FirestoreClient","Using default OnlineComponentProvider"),[4,o_(t,new oy)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function oN(t){return oE(t).then(function(t){return t.persistence})}function oD(t){return oE(t).then(function(t){return t.localStore})}function oA(t){return oS(t).then(function(t){return t.remoteStore})}function ok(t){return oS(t).then(function(t){return t.syncEngine})}function ox(t){return(0,s.mG)(this,void 0,void 0,function(){var e,n;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return[4,oS(t)];case 1:return[2,((n=(e=r.sent()).eventManager).onListen=iJ.bind(null,e.syncEngine),n.onUnlisten=iH.bind(null,e.syncEngine),n)]}})})}function oC(t,e,n){var r=this;void 0===n&&(n={});var i=new na;return t.asyncQueue.enqueueAndForget(function(){return(0,s.mG)(r,void 0,void 0,function(){var r;return(0,s.Jh)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new ov({next:function(o){e.enqueueAndForget(function(){return iR(t,s)});var u=o.docs.has(n);!u&&o.fromCache?i.reject(new h(c.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&o.fromCache&&r&&"server"===r.source?i.reject(new h(c.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new iM(tT(n.path),o,{includeMetadataChanges:!0,so:!0});return iC(t,s)},[4,ox(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function oR(t,e,n){var r=this;void 0===n&&(n={});var i=new na;return t.asyncQueue.enqueueAndForget(function(){return(0,s.mG)(r,void 0,void 0,function(){var r;return(0,s.Jh)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new iM(n,new ov({next:function(n){e.enqueueAndForget(function(){return iR(t,o)}),n.fromCache&&"server"===r.source?i.reject(new h(c.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),{includeMetadataChanges:!0,so:!0});return iC(t,o)},[4,ox(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var oO=function(t,e,n,r,i,o,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s},oL=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),oP=new Map,oM=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},oF=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(rM.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),oV=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(this.token.user)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),oq=function(){function t(t){var e=this;this.oc=null,this.currentUser=rM.UNAUTHENTICATED,this.receivedInitialUser=!1,this.cc=0,this.changeListener=null,this.forceRefresh=!1,this.oc=function(){e.cc++,e.currentUser=e.uc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.cc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.oc):(this.oc(null),t.get().then(function(t){e.auth=t,e.oc&&e.auth.addAuthTokenListener(e.oc)},function(){}))}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(d("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?("string"==typeof n.accessToken||v(),new oM(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.oc),this.oc=null,this.changeListener=null},t.prototype.uc=function(){var t=this.auth&&this.auth.getUid();return null===t||"string"==typeof t||v(),new rM(t)},t}(),oU=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n,this.type="FirstParty",this.user=rM.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.hc},e=this.ac.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.lc&&(t["X-Goog-Iam-Authorization-Token"]=this.lc),t},enumerable:!1,configurable:!0}),t}(),oG=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n}return t.prototype.getToken=function(){return Promise.resolve(new oU(this.ac,this.hc,this.lc))},t.prototype.setChangeListener=function(t){t(rM.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oB(t,e,n){if(!n)throw new h(c.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function oj(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new h(c.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function oK(t,e,n,r){if(!0===e&&!0===r)throw new h(c.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function oz(t){if(!G.isDocumentKey(t))throw new h(c.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function oQ(t){if(G.isDocumentKey(t))throw new h(c.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function oJ(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":v()}function oW(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new h(c.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=oJ(t);throw new h(c.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function oH(t,e){if(e<=0)throw new h(c.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var oY=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new h(c.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new h(c.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,oK("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),oZ=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new oY({}),this._settingsFrozen=!1,t instanceof oL?(this._databaseId=t,this._credentials=new oF):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new h(c.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new oL(t.options.projectId)}(t),this._credentials=new oq(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new h(c.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new h(c.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new oY(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new oF;switch(t.type){case"gapi":var e=t.client;return"object"==typeof e&&null!==e&&e.auth&&e.auth.getAuthHeaderValueForFirstParty||v(),new oG(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new h(c.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){var t;return(t=oP.get(this))&&(d("ComponentProvider","Removing Datastore"),oP.delete(this),t.terminate()),Promise.resolve()},t}(),oX=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new o0(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),o$=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),o0=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,tT(r))||this)._path=r,i.type="collection",i}return(0,s.ZT)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new oX(this.firestore,null,new G(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(o$);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o1(t,e){for(var n,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(t=(0,r.m9)(t),oB("collection","path",e),t instanceof oZ)return oQ(n=D.fromString.apply(D,(0,s.ev)([e],i))),new o0(t,null,n);if(!(t instanceof oX||t instanceof o0))throw new h(c.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return oQ(n=D.fromString.apply(D,(0,s.ev)([t.path],i)).child(D.fromString(e))),new o0(t.firestore,null,n)}function o2(t,e){for(var n,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(t=(0,r.m9)(t),1==arguments.length&&(e=g.u()),oB("doc","path",e),t instanceof oZ)return oz(n=D.fromString.apply(D,(0,s.ev)([e],i))),new oX(t,null,new G(n));if(!(t instanceof oX||t instanceof o0))throw new h(c.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return oz(n=t._path.child(D.fromString.apply(D,(0,s.ev)([e],i)))),new oX(t.firestore,t instanceof o0?t.converter:null,new G(n))}function o4(t,e){return t=(0,r.m9)(t),e=(0,r.m9)(e),(t instanceof oX||t instanceof o0)&&(e instanceof oX||e instanceof o0)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function o3(t,e){return t=(0,r.m9)(t),e=(0,r.m9)(e),t instanceof o$&&e instanceof o$&&t.firestore===e.firestore&&tC(t._query,e._query)&&t.converter===e.converter/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var o5=function(){function t(){var t=this;this.fc=Promise.resolve(),this.dc=[],this.wc=!1,this._c=[],this.mc=null,this.yc=!1,this.gc=[],this.Zi=new r1(this,"async_queue_retry"),this.Ec=function(){var e=r$();e&&d("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=r$();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ec)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.wc},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Tc(),this.Ic(t)},t.prototype.enterRestrictedMode=function(){if(!this.wc){this.wc=!0;var t=r$();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ec)}},t.prototype.enqueue=function(t){return this.Tc(),this.wc?new Promise(function(t){}):this.Ic(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.dc.push(t),e.Ac()})},t.prototype.Ac=function(){return(0,s.mG)(this,void 0,void 0,function(){var t,e=this;return(0,s.Jh)(this,function(n){switch(n.label){case 0:if(0===this.dc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.dc[0]()];case 2:return n.sent(),this.dc.shift(),this.Zi.reset(),[3,4];case 3:if(!np(t=n.sent()))throw t;return d("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.dc.length>0&&this.Zi.ji(function(){return e.Ac()}),n.label=5;case 5:return[2]}})})},t.prototype.Ic=function(t){var e=this,n=this.fc.then(function(){return e.yc=!0,t().catch(function(t){var n;throw e.mc=t,e.yc=!1,p("INTERNAL UNHANDLED ERROR: ",(n=t.message||"",t.stack&&(n=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),n)),t}).then(function(t){return e.yc=!1,t})});return this.fc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Tc(),this.gc.indexOf(t)>-1&&(e=0);var i=iE.createAndSchedule(this,t,e,n,function(t){return r.Rc(t)});return this._c.push(i),i},t.prototype.Tc=function(){this.mc&&v()},t.prototype.verifyOperationInProgress=function(){},t.prototype.bc=function(){return(0,s.mG)(this,void 0,void 0,function(){var t;return(0,s.Jh)(this,function(e){switch(e.label){case 0:return[4,t=this.fc];case 1:e.sent(),e.label=2;case 2:if(t!==this.fc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.vc=function(t){for(var e=0,n=this._c;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Pc=function(t){var e=this;return this.bc().then(function(){e._c.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e._c;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.bc()})},t.prototype.Vc=function(t){this.gc.push(t)},t.prototype.Rc=function(t){var e=this._c.indexOf(t);this._c.splice(e,1)},t}();function o6(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)}var o8=function(){function t(){this._progressObserver={},this._taskCompletionResolver=new na,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},t}(),o9=-1,o7=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new o5,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return(0,s.ZT)(e,t),e.prototype._terminate=function(){return this._firestoreClient||se(this),this._firestoreClient.terminate()},e}(oZ);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function st(t){return t._firestoreClient||se(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function se(t){var e,n,r=t._freezeSettings(),i=(e=t._databaseId,new oO(e,(null===(n=t._app)||void 0===n?void 0:n.options.appId)||"",t._persistenceKey,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t._firestoreClient=new oI(t._credentials,t._queue,i)}function sn(t,e,n){var r=this,i=new na;return t.asyncQueue.enqueue(function(){return(0,s.mG)(r,void 0,void 0,function(){var r;return(0,s.Jh)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,oT(t,n)];case 1:return o.sent(),[4,o_(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:var s;if(!("FirebaseError"===(s=r=o.sent()).name?s.code===c.FAILED_PRECONDITION||s.code===c.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&s instanceof DOMException)||22===s.code||20===s.code||11===s.code))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function sr(t){if(t._initialized||t._terminated)throw new h(c.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var si=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new h(c.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new k(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),so=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(C.fromBase64String(e))}catch(t){throw new h(c.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},t.fromUint8Array=function(e){return new t(C.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),ss=function(t){this._methodName=t},su=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new h(c.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new h(c.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return w(this._lat,t._lat)||w(this._long,t._long)},t}(),sa=/^__.*__$/,sc=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new t3(t,this.data,this.fieldMask,e,this.fieldTransforms):new t4(t,this.data,e,this.fieldTransforms)},t}(),sh=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new t3(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sl(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw v()}}var sf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dc",{get:function(){return this.settings.Dc},enumerable:!1,configurable:!0}),t.prototype.Cc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Nc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Fc(t),r},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Sc(),r},t.prototype.Oc=function(t){return this.Cc({path:void 0,xc:!0})},t.prototype.$c=function(t){return sR(t,this.settings.methodName,this.settings.Mc||!1,this.path,this.settings.Lc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Sc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Fc(this.path.get(t))},t.prototype.Fc=function(t){if(0===t.length)throw this.$c("Document fields must not be empty");if(sl(this.Dc)&&sa.test(t))throw this.$c('Document fields cannot begin and end with "__"')},t}(),sd=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||r0(t)}return t.prototype.Bc=function(t,e,n,r){return void 0===r&&(r=!1),new sf({Dc:t,methodName:e,Lc:n,path:k.emptyPath(),xc:!1,Mc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function sp(t){var e=t._freezeSettings(),n=r0(t._databaseId);return new sd(t._databaseId,!!e.ignoreUndefinedProperties,n)}function sy(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Bc(o.merge||o.mergeFields?2:0,e,n,i);sA("Data must be an object, but it was:",s,r);var u,a,l=sN(r,s);if(o.merge)u=new x(s.fieldMask),a=s.fieldTransforms;else if(o.mergeFields){for(var f=[],d=0,p=o.mergeFields;d<p.length;d++){var y=sk(e,p[d],n);if(!s.contains(y))throw new h(c.INVALID_ARGUMENT,"Field '"+y+"' is specified in your field mask but missing from your input data.");sO(f,y)||f.push(y)}u=new x(f),a=s.fieldTransforms.filter(function(t){return u.covers(t.field)})}else u=null,a=s.fieldTransforms;return new sc(new tt(l),u,a)}var sm=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,s.ZT)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Dc)throw 1===t.Dc?t.$c(this._methodName+"() can only appear at the top level of your update data"):t.$c(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(ss);function sv(t,e,n){return new sf({Dc:3,Lc:e.settings.Lc,methodName:t._methodName,xc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var sg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,s.ZT)(e,t),e.prototype._toFieldTransform=function(t){return new tH(t.path,new tG)},e.prototype.isEqual=function(t){return t instanceof e},e}(ss),sw=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return(0,s.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=sv(this,t,!0),n=new tB(this.qc.map(function(t){return sS(t,e)}));return new tH(t.path,n)},e.prototype.isEqual=function(t){return this===t},e}(ss),sb=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return(0,s.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=sv(this,t,!0),n=new tK(this.qc.map(function(t){return sS(t,e)}));return new tH(t.path,n)},e.prototype.isEqual=function(t){return this===t},e}(ss),sI=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return(0,s.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=new tQ(t.R,tV(t.R,this.Uc));return new tH(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(ss);function sT(t,e,n,i){var o=t.Bc(1,e,n);sA("Data must be an object, but it was:",o,i);var s=[],u=tt.empty();return E(i,function(t,i){var a=sC(e,t,n);i=(0,r.m9)(i);var c=o.kc(a);if(i instanceof sm)s.push(a);else{var h=sS(i,c);null!=h&&(s.push(a),u.set(a,h))}}),new sh(u,new x(s),o.fieldTransforms)}function s_(t,e,n,i,o,s){var u=t.Bc(1,e,n),a=[sk(e,i,n)],l=[o];if(s.length%2!=0)throw new h(c.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var f=0;f<s.length;f+=2)a.push(sk(e,s[f])),l.push(s[f+1]);for(var d=[],p=tt.empty(),y=a.length-1;y>=0;--y)if(!sO(d,a[y])){var m=a[y],v=l[y];v=(0,r.m9)(v);var g=u.kc(m);if(v instanceof sm)d.push(m);else{var w=sS(v,g);null!=w&&(d.push(m),p.set(m,w))}}return new sh(p,new x(d),u.fieldTransforms)}function sE(t,e,n,r){return void 0===r&&(r=!1),sS(n,t.Bc(r?4:3,e))}function sS(t,e){if(sD(t=(0,r.m9)(t)))return sA("Unsupported field value:",e,t),sN(t,e);if(t instanceof ss)return function(t,e){if(!sl(e.Dc))throw e.$c(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.$c(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xc&&4!==e.Dc)throw e.$c("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0;i<t.length;i++){var o=sS(t[i],e.Oc(r));null==o&&(o={nullValue:"NULL_VALUE"}),n.push(o),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,r.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return tV(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=I.fromDate(t);return{timestampValue:eA(e.R,n)}}if(t instanceof I)return n=new I(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:eA(e.R,n)};if(t instanceof su)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof so)return{bytesValue:ek(e.R,t._byteString)};if(t instanceof oX){n=e.databaseId;var i=t.firestore._databaseId;if(!i.isEqual(n))throw e.$c("Document reference is for database "+i.projectId+"/"+i.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:eC(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.$c("Unsupported field value: "+oJ(t))}(t,e)}function sN(t,e){var n={};return S(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):E(t,function(t,r){var i=sS(r,e.Nc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function sD(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof I||t instanceof su||t instanceof so||t instanceof oX||t instanceof ss)}function sA(t,e,n){if(!sD(n)||!("object"==typeof n&&null!==n&&(Object.getPrototypeOf(n)===Object.prototype||null===Object.getPrototypeOf(n)))){var r=oJ(n);throw"an object"===r?e.$c(t+" a custom object"):e.$c(t+" "+r)}}function sk(t,e,n){if((e=(0,r.m9)(e))instanceof si)return e._internalPath;if("string"==typeof e)return sC(t,e);throw sR("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var sx=RegExp("[~\\*/\\[\\]]");function sC(t,e,n){if(e.search(sx)>=0)throw sR("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(si.bind.apply(si,(0,s.ev)([void 0],e.split(".")))))._internalPath}catch(r){throw sR("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function sR(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new h(c.INVALID_ARGUMENT,(u+=". ")+t+a)}function sO(t,e){return t.some(function(t){return t.isEqual(e)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sL=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new oX(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new sP(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(sM("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),sP=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,s.ZT)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(sL);function sM(t,e){return"string"==typeof e?sC(t,e):e instanceof si?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sF=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),sV=function(t){function e(e,n,r,i,o,s){var u=this;return(u=t.call(this,e,n,r,i,s)||this)._firestore=e,u._firestoreImpl=e,u.metadata=o,u}return(0,s.ZT)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new sq(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.toProto(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(sM("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(sL),sq=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,s.ZT)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(sV),sU=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new sF(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new sq(n._firestore,n._userDataWriter,r.key,r,new sF(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new h(c.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){var r=new sq(t._firestore,t._userDataWriter,e.doc.key,e.doc,new sF(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new sq(t._firestore,t._userDataWriter,e.doc.key,e.doc,new sF(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return v()}}(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function sG(t,e){return t instanceof sV&&e instanceof sV?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof sU&&e instanceof sU&&t._firestore===e._firestore&&o3(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sB(t){if(tE(t)&&0===t.explicitOrderBy.length)throw new h(c.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var sj=function(){};function sK(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r++)t=e[r]._apply(t);return t}var sz=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qc=e,i.Kc=n,i.jc=r,i.type="where",i}return(0,s.ZT)(e,t),e.prototype._apply=function(t){var e,n,r=sp(t.firestore),i=function(t,e,n,r,i,o,s){if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new h(c.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){sX(s,o);for(var u,a=[],l=0;l<s.length;l++){var f=s[l];a.push(sZ(r,t,f))}u={arrayValue:{values:a}}}else u=sZ(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||sX(s,o),u=sE(n,"where",s,"in"===o||"not-in"===o);var d=tu.create(i,o,u);return function(t,e){if(e.g()){var n=tN(t);if(null!==n&&!n.isEqual(e.field))throw new h(c.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=tS(t);null!==r&&s$(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new h(c.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new h(c.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,d),d}(t._query,0,r,t.firestore._databaseId,this.Qc,this.Kc,this.jc);return new o$(t.firestore,t.converter,(n=(e=t._query).filters.concat([i]),new tI(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)))},e}(sj),sQ=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qc=e,r.Wc=n,r.type="orderBy",r}return(0,s.ZT)(e,t),e.prototype._apply=function(t){var e,n,r=function(t,e,n){if(null!==t.startAt)throw new h(c.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new h(c.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new tg(e,n);return function(t,e){if(null===tS(t)){var n=tN(t);null!==n&&s$(t,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Wc);return new o$(t.firestore,t.converter,(n=(e=t._query).explicitOrderBy.concat([r]),new tI(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))},e}(sj),sJ=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Gc=n,i.zc=r,i}return(0,s.ZT)(e,t),e.prototype._apply=function(t){return new o$(t.firestore,t.converter,tx(t._query,this.Gc,this.zc))},e}(sj),sW=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return(0,s.ZT)(e,t),e.prototype._apply=function(t){var e,n=sY(t,this.type,this.Hc,this.Jc);return new o$(t.firestore,t.converter,new tI((e=t._query).path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,n,e.endAt))},e}(sj),sH=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return(0,s.ZT)(e,t),e.prototype._apply=function(t){var e,n=sY(t,this.type,this.Hc,this.Jc);return new o$(t.firestore,t.converter,new tI((e=t._query).path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,n))},e}(sj);function sY(t,e,n,i){if(n[0]=(0,r.m9)(n[0]),n[0]instanceof sL)return function(t,e,n,r,i){if(!r)throw new h(c.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,u=tA(t);s<u.length;s++){var a=u[s];if(a.field.isKeyField())o.push(W(e,r.key));else{var l=r.data.field(a.field);if(M(l))throw new h(c.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===l){var f=a.field.canonicalString();throw new h(c.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+f+"' (used as the orderBy) does not exist.")}o.push(l)}}return new tm(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,i);var o=sp(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new h(c.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var l=i[a];if(s[a].field.isKeyField()){if("string"!=typeof l)throw new h(c.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof l);if(!tD(t)&&-1!==l.indexOf("/"))throw new h(c.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+l+"' contains a slash.");var f=t.path.child(D.fromString(l));if(!G.isDocumentKey(f))throw new h(c.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+f+"' is not because it contains an odd number of segments.");var d=new G(f);u.push(W(e,d))}else{var p=sE(n,r,l);u.push(p)}}return new tm(u,o)}(t._query,t.firestore._databaseId,o,e,n,i)}function sZ(t,e,n){if("string"==typeof(n=(0,r.m9)(n))){if(""===n)throw new h(c.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!tD(e)&&-1!==n.indexOf("/"))throw new h(c.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var i=e.path.child(D.fromString(n));if(!G.isDocumentKey(i))throw new h(c.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+i+"' is not because it has an odd number of segments ("+i.length+").");return W(t,new G(i))}if(n instanceof oX)return W(t,n._key);throw new h(c.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+oJ(n)+".")}function sX(t,e){if(!Array.isArray(t)||0===t.length)throw new h(c.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new h(c.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function s$(t,e,n){if(!n.isEqual(e))throw new h(c.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var s0=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),B(t)){case 0:return null;case 1:return t.booleanValue;case 2:return L(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(P(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw v()}},t.prototype.convertObject=function(t,e){var n=this,r={};return E(t.fields||{},function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new su(L(t.latitude),L(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){var n=e.mapValue.fields.__previous_value__;return M(n)?t(n):n}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(F(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=O(t);return new I(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=D.fromString(t);eY(n)||v();var r=new oL(n.get(1),n.get(3)),i=new G(n.popFirst(5));return r.isEqual(e)||p("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s1(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var s2=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,s.ZT)(e,t),e.prototype.convertBytes=function(t){return new so(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new oX(this.firestore,null,e)},e}(s0),s4=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=sp(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=s3(t,this._firestore),i=s1(r.converter,e,n),o=sy(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,tZ.none())),this},t.prototype.update=function(t,e,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];this._verifyNotCommitted();var s,u=s3(t,this._firestore);return s="string"==typeof(e=(0,r.m9)(e))||e instanceof si?s_(this._dataReader,"WriteBatch.update",u._key,e,n,i):sT(this._dataReader,"WriteBatch.update",u._key,e),this._mutations.push(s.toMutation(u._key,tZ.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=s3(t,this._firestore);return this._mutations=this._mutations.concat(new et(e._key,tZ.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new h(c.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s3(t,e){if((t=(0,r.m9)(t)).firestore!==e)throw new h(c.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var s5=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,s.ZT)(e,t),e.prototype.convertBytes=function(t){return new so(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new oX(this.firestore,null,e)},e}(s0);function s6(t,e,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];t=oW(t,oX);var s=oW(t.firestore,o7),u=sp(s);return s9(s,[("string"==typeof(e=(0,r.m9)(e))||e instanceof si?s_(u,"updateDoc",t._key,e,n,i):sT(u,"updateDoc",t._key,e)).toMutation(t._key,tZ.exists(!0))])}function s8(t){for(var e,n,i,o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];t=(0,r.m9)(t);var a={includeMetadataChanges:!1},c=0;"object"!=typeof o[0]||o6(o[c])||(a=o[c],c++);var h,l,f,d={includeMetadataChanges:a.includeMetadataChanges};if(o6(o[c])){var p=o[c];o[c]=null===(e=p.next)||void 0===e?void 0:e.bind(p),o[c+1]=null===(n=p.error)||void 0===n?void 0:n.bind(p),o[c+2]=null===(i=p.complete)||void 0===i?void 0:i.bind(p)}if(t instanceof oX)l=oW(t.firestore,o7),f=tT(t._key.path),h={next:function(e){o[c]&&o[c](s7(l,t,e))},error:o[c+1],complete:o[c+2]};else{var y=oW(t,o$);l=oW(y.firestore,o7),f=y._query;var m=new s5(l);h={next:function(t){o[c]&&o[c](new sU(l,m,y,t))},error:o[c+1],complete:o[c+2]},sB(t._query)}return function(t,e,n,r){var i=this,o=new ov(r),u=new iM(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return(0,s.mG)(i,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return e=iC,[4,ox(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,s.mG)(i,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return e=iR,[4,ox(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}})})})}}(st(l),f,d,h)}function s9(t,e){return function(t,e){var n=this,r=new na;return t.asyncQueue.enqueueAndForget(function(){return(0,s.mG)(n,void 0,void 0,function(){var n;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return n=iY,[4,ok(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(st(t),e)}function s7(t,e,n){var r=n.docs.get(e._key),i=new s5(t);return new sV(t,i,e._key,r,new sF(n.hasPendingWrites,n.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ut=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return(0,s.ZT)(e,t),e.prototype.get=function(e){var n=this,r=s3(e,this._firestore),i=new s5(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new sV(n._firestore,i,r._key,t._document,new sF(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=sp(t)}return t.prototype.get=function(t){var e=this,n=s3(t,this._firestore),r=new s2(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return v();var i=t[0];if(i.isFoundDocument())return new sL(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new sL(e._firestore,r,n._key,null,n.converter);throw v()})},t.prototype.set=function(t,e,n){var r=s3(t,this._firestore),i=s1(r.converter,e,n),o=sy(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s,u=s3(t,this._firestore);return s="string"==typeof(e=(0,r.m9)(e))||e instanceof si?s_(this._dataReader,"Transaction.update",u._key,e,n,i):sT(this._dataReader,"Transaction.update",u._key,e),this._transaction.update(u._key,s),this},t.prototype.delete=function(t){var e=s3(t,this._firestore);return this._transaction.delete(e._key),this},t}());/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ue(){if("undefined"==typeof Uint8Array)throw new h(c.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function un(){if("undefined"==typeof atob)throw new h(c.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ur=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return un(),new t(so.fromBase64String(e))},t.fromUint8Array=function(e){return ue(),new t(so.fromUint8Array(e))},t.prototype.toBase64=function(){return un(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return ue(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),ui=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){var n,r,i,o,s;return n=t._delegate,r={forceOwnership:e},sr(n=oW(n,o7)),i=st(n),o=n._freezeSettings(),sn(i,s=new oy,new od(s,o.cacheSizeBytes,null==r?void 0:r.forceOwnership))},t.prototype.enableMultiTabIndexedDbPersistence=function(t){var e,n,r,i;return sr(e=oW(e=t._delegate,o7)),n=st(e),r=e._freezeSettings(),sn(n,i=new oy,new op(i,r.cacheSizeBytes))},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new h(c.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new na;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return(0,s.mG)(e,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return(0,s.mG)(this,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return nl.yt()?(e=t+"main",[4,nl.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}})})}(rf(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),uo=function(){function t(t,e,n){var r=this;this._delegate=e,this.Yc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof oL||(this.Xc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,i){void 0===i&&(i={});var o=(t=oW(t,oZ))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&y("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:e+":"+n,ssl:!1})),i.mockUserToken){var s=(0,r.Sg)(i.mockUserToken),u=i.mockUserToken.sub||i.mockUserToken.user_id;if(!u)throw new h(c.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new oV(new oM(s,new rM(u)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return(0,s.mG)(e,void 0,void 0,function(){var e,n;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return[4,oN(t)];case 1:return e=r.sent(),[4,oA(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),n.$r.delete(0),r9(n))]}})})})}(st(oW(this._delegate,o7)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return(0,s.mG)(e,void 0,void 0,function(){var e,n;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return[4,oN(t)];case 1:return e=r.sent(),[4,oA(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return(0,s.mG)(this,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return(e=t).$r.add(0),[4,r7(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(st(oW(this._delegate,o7)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&oK("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Yc.enableMultiTabIndexedDbPersistence(this):this.Yc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Yc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Xc&&(this.Xc._removeServiceInstance("firestore"),this.Xc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new na;return t.asyncQueue.enqueueAndForget(function(){return(0,s.mG)(e,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return e=i2,[4,ok(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(st(oW(this._delegate,o7)))},t.prototype.onSnapshotsInSync=function(t){var e;return function(t,e){var n=this,r=new ov(e);return t.asyncQueue.enqueueAndForget(function(){return(0,s.mG)(n,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return e=function(t,e){t.Gr.add(e),e.next()},[4,ox(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,s.mG)(n,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return e=function(t,e){t.Gr.delete(e)},[4,ox(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(st(oW(this._delegate,o7)),o6(t)?t:{next:t})},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Xc)throw new h(c.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Xc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new ub(this,o1(this._delegate,t))}catch(t){throw uf(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new ul(this,o2(this._delegate,t))}catch(t){throw uf(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new uv(this,function(t,e){if(t=oW(t,oZ),oB("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new h(c.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new o$(t,null,new tI(D.emptyPath(),e))}(this._delegate,t))}catch(t){throw uf(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e,n,r=this;return e=this._delegate,n=function(e){return t(new ua(r,e))},function(t,e){var n=this,r=new na;return t.asyncQueue.enqueueAndForget(function(){return(0,s.mG)(n,void 0,void 0,function(){var n;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return[4,oS(t).then(function(t){return t.datastore})];case 1:return n=i.sent(),new ob(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(st(e),function(t){return n(new ut(e,t))})},t.prototype.batch=function(){var t=this;return st(this._delegate),new uc(new s4(this._delegate,function(e){return s9(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new h(c.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new h(c.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),us=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,s.ZT)(e,t),e.prototype.convertBytes=function(t){return new ur(new so(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return ul.Zc(e,this.firestore,null)},e}(s0);function uu(t){l.setLogLevel(t)}var ua=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new us(t)}return t.prototype.get=function(t){var e=this,n=oW(t,oX);return this._delegate.get(n).then(function(t){return new uy(e._firestore,new sV(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=oW(t,oX);return n?(oj("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var u=oW(t,oX);return 2==arguments.length?this._delegate.update(u,e):(r=this._delegate).update.apply(r,(0,s.ev)([u,e,n],i)),this},t.prototype.delete=function(t){var e=oW(t,oX);return this._delegate.delete(e),this},t}(),uc=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=oW(t,oX);return n?(oj("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var u=oW(t,oX);return 2==arguments.length?this._delegate.update(u,e):(r=this._delegate).update.apply(r,(0,s.ev)([u,e,n],i)),this},t.prototype.delete=function(t){var e=oW(t,oX);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),uh=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new sq(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new um(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.tu=function(e,n){var r=t.eu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new us(e),n),i.set(n,o)),o},t}();uh.eu=new WeakMap;var ul=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new us(t)}return t.nu=function(e,n,r){if(e.length%2!=0)throw new h(c.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new oX(n._delegate,r,new G(e)))},t.Zc=function(e,n,r){return new t(n,new oX(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new ub(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new ub(this.firestore,o1(this._delegate,t))}catch(t){throw uf(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=(0,r.m9)(t))instanceof oX&&o4(this._delegate,t)},t.prototype.set=function(t,e){e=oj("DocumentReference.set",e);try{var n,r,i,o;return n=this._delegate,r=e,n=oW(n,oX),i=oW(n.firestore,o7),o=s1(n.converter,t,r),s9(i,[sy(sp(i),"setDoc",n._key,o,null!==n.converter,r).toMutation(n._key,tZ.none())])}catch(t){throw uf(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1==arguments.length?s6(this._delegate,t):s6.apply(void 0,(0,s.ev)([this._delegate,t,e],n))}catch(t){throw uf(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){var t;return s9(oW((t=this._delegate).firestore,o7),[new et(t._key,tZ.none())])},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=ud(e),i=up(e,function(e){return new uy(t.firestore,new sV(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return s8(this._delegate,r,i)},t.prototype.get=function(t){var e,n,r,i,o,u,a,l,f=this;return("cache"===(null==t?void 0:t.source)?(e=oW(e=this._delegate,oX),r=st(n=oW(e.firestore,o7)),i=new s5(n),(function(t,e){var n=this,r=new na;return t.asyncQueue.enqueueAndForget(function(){return(0,s.mG)(n,void 0,void 0,function(){var n;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return(0,s.mG)(this,void 0,void 0,function(){var r;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,t.persistence.runTransaction("read document","readonly",function(n){return t.Mn.mn(n,e)})];case 1:return(r=i.sent()).isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new h(c.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=iS(i.sent(),"Failed to get document '"+e+" from cache"),n.reject(r),[3,3];case 3:return[2]}})})},[4,oD(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise})(r,e._key).then(function(t){return new sV(n,i,e._key,t,new sF(null!==t&&t.hasLocalMutations,!0),e.converter)})):"server"===(null==t?void 0:t.source)?(o=oW(o=this._delegate,oX),oC(st(u=oW(o.firestore,o7)),o._key,{source:"server"}).then(function(t){return s7(u,o,t)})):(a=oW(a=this._delegate,oX),oC(st(l=oW(a.firestore,o7)),a._key).then(function(t){return s7(l,a,t)}))).then(function(t){return new uy(f.firestore,new sV(f.firestore._delegate,f._userDataWriter,t._key,t._document,t.metadata,f._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(uh.tu(this.firestore,e)):this._delegate.withConverter(null))},t}();function uf(t,e,n){return t.message=t.message.replace(e,n),t}function ud(t){for(var e=0;e<t.length;e++){var n=t[e];if("object"==typeof n&&!o6(n))return n}return{}}function up(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=o6(t[0])?t[0]:o6(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var uy=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new ul(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return sG(this._delegate,t._delegate)},t}(),um=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,s.ZT)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(uy),uv=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new us(t)}return t.prototype.where=function(e,n,r){try{var i;return new t(this.firestore,sK(this._delegate,(i=sM("where",e),new sz(i,n,r))))}catch(t){throw uf(t,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{var r,i,o;return new t(this.firestore,sK(this._delegate,(r=n,void 0===r&&(r="asc"),i=r,o=sM("orderBy",e),new sQ(o,i))))}catch(t){throw uf(t,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,sK(this._delegate,(oH("limit",e),new sJ("limit",e,"F"))))}catch(t){throw uf(t,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,sK(this._delegate,(oH("limitToLast",e),new sJ("limitToLast",e,"L"))))}catch(t){throw uf(t,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,sK(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sW("startAt",t,!0)}).apply(void 0,e)))}catch(t){throw uf(t,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,sK(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sW("startAfter",t,!1)}).apply(void 0,e)))}catch(t){throw uf(t,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,sK(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sH("endBefore",t,!0)}).apply(void 0,e)))}catch(t){throw uf(t,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,sK(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sH("endAt",t,!1)}).apply(void 0,e)))}catch(t){throw uf(t,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return o3(this._delegate,t._delegate)},t.prototype.get=function(t){var e,n,r,i,o,u,a,c,h,l,f,d,p=this;return("cache"===(null==t?void 0:t.source)?(e=oW(e=this._delegate,o$),r=st(n=oW(e.firestore,o7)),i=new s5(n),(function(t,e){var n=this,r=new na;return t.asyncQueue.enqueueAndForget(function(){return(0,s.mG)(n,void 0,void 0,function(){var n;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return(0,s.mG)(this,void 0,void 0,function(){var r,i,o,u;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,r_(t,e,!0)];case 1:return i=(r=new ij(e,(u=s.sent()).Bn))._o(u.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return u=iS(s.sent(),"Failed to execute query '"+e+" against cache"),n.reject(u),[3,3];case 3:return[2]}})})},[4,oD(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise})(r,e._query).then(function(t){return new sU(n,i,e,t)})):"server"===(null==t?void 0:t.source)?(o=oW(o=this._delegate,o$),a=st(u=oW(o.firestore,o7)),c=new s5(u),oR(a,o._query,{source:"server"}).then(function(t){return new sU(u,c,o,t)})):(h=oW(h=this._delegate,o$),f=st(l=oW(h.firestore,o7)),d=new s5(l),sB(h._query),oR(f,h._query).then(function(t){return new sU(l,d,h,t)}))).then(function(t){return new uw(p.firestore,new sU(p.firestore._delegate,p._userDataWriter,p._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=ud(e),i=up(e,function(e){return new uw(t.firestore,new sU(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return s8(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(uh.tu(this.firestore,e)):this._delegate.withConverter(null))},t}(),ug=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new um(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),uw=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new uv(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new um(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new ug(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new um(n._firestore,r))})},t.prototype.isEqual=function(t){return sG(this._delegate,t._delegate)},t}(),ub=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return(0,s.ZT)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new ul(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new ul(this.firestore,void 0===t?o2(this._delegate):o2(this._delegate,t))}catch(t){throw uf(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e,n,r,i,o=this;return(n=oW((e=this._delegate).firestore,o7),r=o2(e),i=s1(e.converter,t),s9(n,[sy(sp(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,tZ.exists(!1))]).then(function(){return r})).then(function(t){return new ul(o.firestore,t)})},e.prototype.isEqual=function(t){return o4(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(uh.tu(this.firestore,t)):this._delegate.withConverter(null))},e}(uv),uI=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(si.bind.apply(si,(0,s.ev)([void 0],t)))}return t.documentId=function(){return new t(k.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=(0,r.m9)(t))instanceof si&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),uT=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new sg("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new sm("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sw("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sb("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=new sI("increment",e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u_(t){var e,n,r;return n=st(e=oW(e=this._delegate,o7)),r=new o8,function(t,e,n,r){var i,o=this,u=(i=r0(e),new og(function(t,e){if(t instanceof Uint8Array)return om(t,void 0);if(t instanceof ArrayBuffer)return om(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?(new TextEncoder).encode(n):n),i));t.asyncQueue.enqueueAndForget(function(){return(0,s.mG)(o,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return e=ol,[4,ok(t)];case 1:return e.apply(void 0,[n.sent(),u,r]),[2]}})})})}(n,e._databaseId,t,r),r}function uE(t){var e,n=this;return(function(t,e){var n=this;return t.asyncQueue.enqueue(function(){return(0,s.mG)(n,void 0,void 0,function(){var n;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return n=function(t,e){return t.persistence.runTransaction("Get named query","readonly",function(n){return t.Qe.getNamedQuery(n,e)})},[4,oD(t)];case 1:return[2,n.apply(void 0,[r.sent(),e])]}})})})})(st(e=oW(e=this._delegate,o7)),t).then(function(t){return t?new o$(e,null,t.query):null}).then(function(t){return t?new uv(n,t):null})}}}]);