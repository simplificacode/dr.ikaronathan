"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[843],{84736:(e,t,i)=>{i.d(t,{EG:()=>p.Z,Ex:()=>c.Z,FN:()=>m.Z,HH:()=>x.H,II:()=>n.Z,J2:()=>a.Z,Lt:()=>o.Z,Q2:()=>h.Z,Vp:()=>u.Z,XQ:()=>v.Z,XZ:()=>s.ZP,ih:()=>f.i,l0:()=>S.Z,tL:()=>_.Z,u:()=>g.Z,u_:()=>l.Z,yC:()=>d.Z,z8:()=>k.z,zx:()=>r.Z});i(32913);var r=i(99891),s=i(76021),l=i(15194),o=i(89270),n=i(55550),a=i(21797),c=i(63522),d=i(48611),u=i(40996),p=i(83335),m=i(23997),g=i(11643),S=i(60679),v=i(78367),_=i(92417),h=i(5455),f=i(64482),k=i(96194),x=i(19537)},28747:(e,t,i)=>{i.d(t,{u:()=>P});var r=i(50959),s=i(10422),l=i(84736),o=i(26800),n=i(68277),a=i(45599),c=i(23479),d=i(25807),u=i(69905),p=i(60251),m=i(8129),g=i(86439),S=i(94435),v=i(16743),_=i(84875),h=i.n(_);const f="tag-ZaY7YS",k="selected-umR1Vs",x="disabled-A37DzB";var C=i(11527);const b=({className:e,value:t,selected:i,disabled:r,onClick:s})=>(0,C.jsx)(l.Vp,{className:h()(e,f,i&&k,r&&x),color:i?"cyan":void 0,onClick:()=>null==s?void 0:s(t),children:t},t),I="block-smxiey",w="title-aqS4Cg",F="content-IyBLdN",y="loading-QuFv_G",N="text-ukrQOj",j=({className:e,title:t,loading:i,loadingText:s,value:o,options:n,onSelect:a})=>{const c=(0,r.useCallback)((e=>o.includes(e)),[o]),d=(0,r.useMemo)((()=>n.filter((e=>!o.includes(e)))),[o,n]);return 0===d.length?null:(0,C.jsxs)("div",{className:h()([I,e]),children:[(0,C.jsx)("p",{className:w,children:t}),(0,C.jsx)("div",{className:F,children:i?(0,C.jsxs)("div",{className:y,children:[(0,C.jsx)("span",{className:N,children:s}),(0,C.jsx)(l.yC,{size:"small"})]}):d.map((e=>(0,C.jsx)(b,{selected:c(e),value:e,onClick:()=>a(e)},e)))})]})},U=(0,c.Pi)((({value:e,onSelect:t})=>{const[i,s]=(0,r.useState)([]),{t:l}=(0,a.$)();return(0,r.useEffect)((()=>{const e=(0,u.cF)(u.Qt.TagEachUser,d.$.userInfo.uid).get();s(e)}),[d.$.userInfo.uid,e]),(0,C.jsx)(j,{title:l("pc_recently_used_web"),value:e,options:i,onSelect:t})})),E=((0,c.Pi)((({title:e,uri:t,value:i,itemType:s,onSelect:l})=>{const[c,d]=(0,r.useState)([]),[u,p]=(0,r.useState)([]),[m,g]=(0,r.useState)(!1),v=(0,r.useRef)({}),{t:_}=(0,a.$)(),h=(0,r.useMemo)((()=>[...u,...c]),[c,u]),f=(0,o.Z)((e=>{const{title:t,uri:i}=e;return t?v.current.cvid&&v.current.uri===i?{cvid:v.current.cvid,title:t}:i?{image_uri:i,title:t}:null:null})),k=(0,r.useCallback)((async()=>{try{g(!0);const i=f({title:e,uri:t});await Promise.all([i&&(0,S.Uz)(i).then((e=>{p(e.cv_tags),v.current.cvid=e.cvid,i.image_uri&&(v.current.uri=i.image_uri)})),!v.current.selfConfigTagsReady&&(0,S.On)({effect_type:s}).then((e=>{d(e.rec_tags),v.current.selfConfigTagsReady=!0}))])}finally{g(!1)}}),[e,t,s]);return(0,n.Z)(k,500,[k]),(0,r.useEffect)((()=>{k()}),[]),(0,C.jsx)(j,{title:_("recommend_signature_web"),loading:m,loadingText:_("loading_web"),value:i,options:h,onSelect:l})})),"tagSelect-KEPqcU"),L="dropItem-bpnHuZ",q="suggestListDropdown-fV0lMc",T=(0,c.Pi)((({recommendConfig:e,value:t=[],itemType:i,disabled:c,disableRecommend:_,disableLatest:h,onChange:f,placeholder:k,max:x=15,temporaryId:I,ignoreAddTagOnBlurSelector:w})=>{const F=(0,r.useRef)(!1),[y,N]=(0,r.useState)(""),[j,T]=(0,r.useState)(""),P=(0,r.useRef)(!1),A=P.current?j:y,[R,Z]=(0,r.useState)([]),[M,z]=(0,r.useState)([]),{t:O}=(0,a.$)(),$=e=>(0,u.cF)(u.Qt.TagEachUser,d.$.userInfo.uid).set("add",[e]),B=(0,o.Z)((e=>{z(y?e:[])}));(0,n.Z)((async()=>{if(!i||!y)return;const e=await(0,S.EO)({query:y,count:10}),t=(null==e?void 0:e.sug_tags)||[];B(t)}),500,[y,i]),(0,r.useEffect)((()=>{y||z([])}),[y]);const D=(0,r.useCallback)((e=>{if(x&&e.length>x)return l.FN.error(O("pc_stickers_release_max_tag_web",{X:x})),void(null==f||f(e.slice(0,x)));null==f||f(e)}),[f]),V=(0,o.Z)((e=>{t.includes(e)||D([...t,e])})),W=(0,r.useMemo)((()=>new p.l),[]),X=(0,o.Z)((async e=>{const i=await W.lock("",(async()=>{if(t.includes(e))return!0;let i=!1;try{const t=await(0,S._K)({words:e,scene:S.Xb.Tag});i=!1===(null==t?void 0:t.is_hit)}catch(r){return(0,m.RF)("[TagSelect] call checkAntiDirt failed",r,{tag:e}),l.FN.error(O("pc_tag_retry_web")),!1}return i?(V(e),!0):((0,m.c6)("[TagSelect] checkAntiDirt not passed",{tag:e}),l.FN.error(O("pc_tag_illegal_fail_web")),!1)}));return null!=i&&i})),G=(0,o.Z)((e=>{if(0===e.length)return;const i=t.filter((t=>!e.includes(t)));D(i)})),J=(0,r.useRef)(null),{saveSelectionIfNeeded:H}=(0,v.u)({getInputElem:()=>{var e;return null===(e=J.current)||void 0===e?void 0:e.inputRef.current}}),Y=e=>{const t=(0,g.aF)(e,30);H(t),N(t)},Q=(0,o.Z)((e=>{Y(""),t.includes(e)?G([e]):(V(e),$(e))})),K=e=>{const t=R.includes(e);Z(t?R.filter((t=>t!==e)):[...R,e])},ee=(0,o.Z)((()=>{G(R),Z([])})),te=(0,o.Z)((()=>J.current&&J.current.inputRef.current&&J.current.tagInputRef.current?{tagInput:J.current,tagInputElem:J.current.tagInputRef.current,inputElem:J.current.inputRef.current}:null)),ie=(0,o.Z)((e=>{const t=te();return!!(t&&e&&e instanceof Element)&&e.closest(".semi-tagInput")===t.tagInputElem})),re=(0,o.Z)((e=>!!(e&&e instanceof Element)&&null!==e.closest(".semi-tag"))),se=(0,o.Z)((e=>{const t=e.target,i=te();if(!i||!ie(t))return;const{tagInput:r,tagInputElem:s,inputElem:l}=i,{selectionStart:o,selectionEnd:n}=l;return R.length>0&&re(t)?(ee(),null==l||l.setSelectionRange(0,0),void r.focus()):void 0})),le=(0,o.Z)((e=>{const t=e.target;te()&&ie(t)&&re(t)&&(ie(e.relatedTarget)&&re(e.relatedTarget)||Z([]))}));(0,r.useEffect)((()=>{const e=e=>{"Delete"===e.code||"Backspace"===e.code?(F.current=!0,se(e)):F.current=!1};return window.addEventListener("keydown",e,!0),window.addEventListener("blur",le,!0),()=>{window.removeEventListener("keydown",e,!0),window.removeEventListener("blur",le,!0)}}),[]);const oe=(0,o.Z)((e=>{e.replace(/ {1,}/g,"")===y.replace(/ {1,}/g,"")&&Y("")})),ne=async e=>{const[t]=e;Promise.resolve().then((()=>Y(y)));const i=t.replace(/ {1,}/g,"");if(0===i.length)return;await X(i)&&($(i),oe(y))},ae=async e=>{if(P.current)return void T(e);const t=e.replace(/ {1,}$/,""),i=t.replace(/ {1,}/g,"");if(Y(t),t===e||!t||F.current)return;await X(i)&&($(i),oe(y))};(0,r.useEffect)((()=>{var e;const t=null===(e=J.current)||void 0===e?void 0:e.inputRef.current;if(!t)return;const i=()=>{P.current=!0,T(t.value)},r=()=>(0,s.unstable_batchedUpdates)((()=>{P.current=!1,T(""),ae(t.value)}));return t.addEventListener("compositionstart",i),t.addEventListener("compositionend",r),()=>{t.removeEventListener("compositionstart",i),t.removeEventListener("compositionend",r)}}),[]);(0,r.useEffect)((()=>{I&&N("")}),[I]);return(0,C.jsxs)("div",{className:E,children:[(0,C.jsx)(l.Lt,{position:"bottomLeft",trigger:"focus",className:q,style:{maxHeight:200,overflow:"scroll"},render:(0,C.jsx)(l.Lt.Menu,{children:M.map((e=>(0,C.jsx)(l.Lt.Item,{className:L,onClick:()=>Q(e),children:e},e)))}),children:(0,C.jsx)(l.EG,{ref:J,inputValue:A,onInputChange:ae,value:t,placeholder:k,renderTagItem:(e,t,i)=>(0,C.jsx)(b,{value:e,selected:R.includes(e),disabled:c,onClick:K},e),onAdd:ne,onBlur:e=>{if(e.relatedTarget&&e.relatedTarget instanceof Element){const t=[`.${q}`,w].filter((e=>e)).join(",");if(null!==e.relatedTarget.closest(t)||re(e.relatedTarget))return}ne([y])},disabled:c})}),!1,!c&&!h&&(0,C.jsx)(U,{value:t,onSelect:Q})]})})),P=(0,l.Q2)(T)},42983:(e,t,i)=>{i.d(t,{Ab:()=>r});let r=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e}({})},69836:(e,t,i)=>{i.d(t,{Bo:()=>_,LU:()=>h,ir:()=>f});var r=i(50959),s=i(84875),l=i.n(s),o=i(45599),n=i(82346),a=i(96426),c=i(85083),d=i(88623),u=i(84997),p=i(40699),m=i(96305),g=i(11527);const S=e=>{const{className:t}=e,{t:i}=(0,o.$)(),{handleMouseEnter:r}=(0,u.S)();return(0,g.jsxs)("div",{className:l()(m.Z.root,t),children:[(0,g.jsx)(n.a,{className:m.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,g.jsx)("div",{className:m.Z.text,onMouseEnter:r,children:i("pc_stickers_release_in_web")})]})},v=e=>{const{className:t,tooltip:i}=e,{t:s}=(0,o.$)(),{handleMouseEnter:n}=(0,u.w)({content:i,className:m.Z.tooltip}),c=(0,r.useRef)(null),{setIsMarqueeLoopRunning:d,reactNode:S}=(0,p.J)({text:s("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>c.current});return(0,g.jsxs)("div",{className:l()(m.Z.root,t,m.Z.error),onMouseEnter:e=>{d(!0),n(e)},onMouseLeave:()=>d(!1),children:[(0,g.jsx)(a.r,{className:m.Z.icon}),(0,g.jsx)("div",{ref:c,className:m.Z.text,children:S})]})},_=e=>{const{className:t,text:i}=e,{handleMouseEnter:r}=(0,u.S)();return(0,g.jsxs)("div",{className:l()(m.Z.root,t,m.Z.checked),children:[(0,g.jsx)(d.r,{className:m.Z.icon}),(0,g.jsx)("div",{className:m.Z.text,onMouseEnter:r,children:i})]})},h=e=>{const{className:t}=e,{t:i}=(0,o.$)(),{handleMouseEnter:r}=(0,u.S)();return(0,g.jsxs)("div",{className:l()(m.Z.root,t),children:[(0,g.jsx)("div",{className:l()(m.Z.icon,m.Z.yellowIcon),children:(0,g.jsx)("div",{className:m.Z.yellowPoint})}),(0,g.jsx)("div",{className:m.Z.text,onMouseEnter:r,children:i("pc_stickers_release_editing_web")}),(0,g.jsx)(c.r,{className:m.Z.icon})]})},f=e=>{const{className:t,loading:i,invalid:r,errorToolip:s,isInfoComplete:l,title:o}=e;return i?(0,g.jsx)(S,{className:t}):r?(0,g.jsx)(v,{className:t,tooltip:s}):l?(0,g.jsx)(_,{className:t,text:o}):(0,g.jsx)(h,{className:t})}},58546:(e,t,i)=>{i.d(t,{r:()=>s});var r=i(59787);class s{constructor(e){this.props=e,(0,r.Z)(this,"fileMap",new Map)}ensureFile(e){let t=this.fileMap.get(e);return t||(t={data:this.props.initData(),events:{}},this.fileMap.set(e,t)),t}getFile(e){return this.fileMap.get(e)}register(e,t,i){this.ensureFile(t).events[e]=i}dispatch(e){var t,i;const r=this.fileMap.get(e.id);r&&(null===(t=(i=r.events)[e.type])||void 0===t||t.call(i,e,r))}removeFile(e){this.fileMap.delete(e)}}},5014:(e,t,i)=>{i.d(t,{BI:()=>_,DefaultImportStickerFileRequest:()=>a,Em:()=>u,GR:()=>g,J:()=>d,N7:()=>o,Q0:()=>n,R8:()=>s,S8:()=>S,Us:()=>v,fD:()=>l,mr:()=>c,qb:()=>m,r$:()=>p});var r=i(73224);let s=function(e){return e.Static="static",e.GIF="gif",e.Sequence="sequence",e}({}),l=function(e){return e.Format="format",e.MinImageSize="minImageSize",e.RecommendFileSize="RecommendFileSize",e.SequenceNumber="SequenceNumber",e}({});const o={fps:16,loop:!0},n={maxCount:49,minCount:2,minImageSize:360,maxImageSize:1080,maxFileSize:20971520},a={accept:".png,.jpg,.jpeg,.gif",multiple:!0,enableImportSequence:!0,thumbnailSize:200,minImageSize:360,maxImageSize:800,maxFileSize:20971520},c={fps:16,loop:!0,gen_size:0,gif_gen_opts:[{bg_color:"#242424",width:200,height:200,padding:0},{bg_color:"",width:0,height:0,padding:0}]},d={accept:".png,.gif",minImageSize:320,maxImageSize:1e3,maxFileSize:20971520},u={accept:".png,.gif",minImageSize:320,maxImageSize:1250,maxFileSize:5242880},p=20,m=80,g=4,S=40,v=52,_={[s.Static]:{[l.Format]:r.I18n.t("pc_stickers_release_format_web"),[l.MinImageSize]:r.I18n.t("pc_stickers_release_size_min_web"),[l.RecommendFileSize]:r.I18n.t("pc_stickers_release_recommend_web")},[s.GIF]:{[l.Format]:r.I18n.t("pc_stickers_release_format_gif_web"),[l.MinImageSize]:r.I18n.t("pc_stickers_release_size_min_web"),[l.RecommendFileSize]:r.I18n.t("pc_stickers_release_recommend_web")},[s.Sequence]:{[l.Format]:r.I18n.t("pc_stickers_release_png_groups_web_web"),[l.MinImageSize]:r.I18n.t("pc_stickers_release_reccomend_size_web"),[l.SequenceNumber]:r.I18n.t("pc_stickers_release_amount_web"),[l.RecommendFileSize]:r.I18n.t("pc_stickers_release_recommend_web")}}},76252:(e,t,i)=>{i.d(t,{B3:()=>g,Nf:()=>S,WQ:()=>_,w3:()=>v});var r=i(23073),s=i(50959),l=i(61022),o=i(42983),n=i(5014),a=i(86439),c=i(97311),d=i(67078),u=i(17941),p=i(21919),m=i(94435);function g(e){return e.coverSrc||e.firstFrameCoverSrc}function S(e){return e.isSequence&&Boolean(e.isSequenceSettingsUpdating||e.firstFrameCoverSrc&&!e.coverSrc&&!e.isUploadFailed)}function v(e){return e.isSequence||"gif"===(0,c.lm)(e.path)}function _(){const e=(0,l.fv)((()=>({stickers:[],scrollAreaRef:(0,s.createRef)(),get hasStickers(){return this.stickers.length>0},selectedId:null,get selectedSticker(){return e.selectedId?e.getSticker(e.selectedId):null},setScrollAreaRef(t){e.scrollAreaRef=t},addStickers(t){e.stickers.push(...t)},getSticker:t=>{var i;return null!==(i=e.stickers.find((e=>e.id===t)))&&void 0!==i?i:null},selectSticker(t){e.selectedId=t,e.selectedSticker&&(e.selectedSticker.hasEverSelected=!0)},updateThumbnailSrc(e,t){e.isSequence?e.firstFrameCoverSrc=t:e.coverSrc=t},updateUploadedData(e,t,i){if(e.uri=t,!e.isSequence)return e.coverUri=t,void(e.largeImageUri=t);if(i){const{gifCover:t,gifLargeImage:r,stickerPackage:s}=i;e.coverUri=t.uri,e.coverSrc=t.blobUrl,e.largeImageUri=r.uri,e.stickerPackage=s,e.isSequenceSettingsUpdating=!1}},updateUnmetRequirements(e,t){e.unmetRequirements=t,e.hasCheckedRequirements=!0},setUploadFailed(e){e.isUploadFailed=!0,e.isSequenceSettingsUpdating=!1},get isAllStickersThumbnailReady(){return e.stickers.length>0&&e.stickers.every((e=>g(e)))},applyForTags:t=>{e.stickers.forEach((e=>{e.formState.tags=t}))},applyAuthSettingsToAll:({isOriginal:t,isBusiness:i,isVip:r})=>{e.stickers.forEach((e=>{e.formState.isOriginal=Boolean(t),e.formState.isBusiness=Boolean(i),e.formState.isVip=Boolean(r)}))},makeInitFormState:e=>({title:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:!1,...n.N7,sequenceSettingsApplyToAll:!1,...e}),updateFormState(e,t){Object.assign(e.formState,t)},makeInitSticker(t){const{title:i,isInfoComplete:r,formState:s,path:l="",isSequence:o=!1,...d}=t,m=function(e,t){const i=(0,c.lm)(e);if(t)return n.R8.Sequence;if("gif"===i)return n.R8.GIF;if(["png","jpg","jpeg"].includes(i))return n.R8.Static;throw new Error(`Unsupported suffix ${i}`)}(l,o),g=function(e,t){const i=e.split(/[\\/]/g).pop(),r=t?i:i.replace(/\.\w+?$/g,"");return(0,a.aF)(r,n.S8)}(l,o),S=(0,u.K)(p.YW.OriginalForSubscription);return{id:"",path:l,get title(){return this.formState.title},fileType:m,width:0,height:0,isSequence:o,firstFrameCoverSrc:"",coverSrc:"",uri:"",coverUri:"",largeImageUri:"",stickerPackage:{uri:"",md5:"",size:0},sequenceSettings:{fps:0,loop:!1,...t.isSequence&&n.N7},hasEverSelected:!1,get isInfoComplete(){return Boolean(this.title&&this.formState.tags.length>0)},unmetRequirements:[],hasCheckedRequirements:!1,isUploadFailed:!1,isSequenceSettingsUpdating:!1,formState:e.makeInitFormState({title:g,isVip:S}),...d}},reimportSticker(t,i){const r=e.stickers.findIndex((e=>e.id===t));-1!==r&&(e.stickers[r]=i)},startToRetryUploadStickers(t){t.forEach((t=>{const i=e.getSticker(t);i&&(i.isUploadFailed=!1)}))},startToUpdateSequenceSettings(e,t){e.forEach((e=>{e.sequenceSettings=t,e.largeImageUri&&(e.largeImageUri="",e.coverUri="",e.stickerPackage={uri:"",md5:"",size:0},e.isSequenceSettingsUpdating=!0)}))},removeSticker(t){e.stickers=e.stickers.filter((e=>e.id!==t.id))},dragInsert(t,i){const r=e.stickers.splice(t,1),s=t>i?i+1:i;e.stickers.splice(s,0,...r)},get isReadyToPublish(){return e.stickers.every((e=>e.hasCheckedRequirements&&0===e.unmetRequirements.length&&e.isInfoComplete))},get uploadStats(){let t=0,i=0,r=0;return e.stickers.forEach((e=>{if(e.isUploadFailed)return void(i+=1);(e.isSequence?e.largeImageUri:e.uri)?t+=1:r+=1})),{pending:r,succeeded:t,failed:i}},collectLogData:()=>e.stickers.map((e=>({...(0,r.Z)(e,["id","isSequence","isInfoComplete","hasEverSelected","isUploadFailed","uri"]),...e.isSequence&&{isSequenceUpdating:e.isSequenceSettingsUpdating,largeImageUri:e.largeImageUri,...e.sequenceSettings}}))),makePublishItemList:(t={})=>e.stickers.map((e=>{var i;const{id:r,isSequence:s,formState:l,stickerPackage:n}=e,{is_vip:a=Boolean(l.isVip),is_business:c=l.isBusiness,is_original:u=l.isOriginal,sourceForSimple:p=m.r0.UserPostPc,sourceForSequence:g=m.r0.UserPostPcSequence,authFileUploadServiceManager:S,onResult:_}=t,h=s?g:p,f=(0,d.pn)({isVip:a,isBusiness:c,authFiles:null!==(i=null==S?void 0:S.getUploadedFiles(r))&&void 0!==i?i:[]});return{id:r,req:{effect_type:o.Ab.Sticker,is_vip:a,...f.root,common_data:{title:l.title,description:l.title,icon:{image_uri:e.coverUri},sdk_version:"1.0.0",source:h,tags:[...l.tags],is_original:u,is_business:c,web_extra:"",...f.commonData,...s&&{file:{file_uri:n.uri,file_md5:n.md5,size:n.size}}},sticker:{large_image:{image_uri:e.largeImageUri},sticker_type:v(e)?m.Ic.Dynamic:m.Ic.Static,no_multi_sticker:!1,package_size:0}},onResult:t=>null==_?void 0:_(e,t)}}))})));return e}},60600:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Wt});var r=i(23479),s=i(45599),l=(i(52915),i(68166)),o=i(12390),n=i(67100),a=i(84875),c=i.n(a),d=i(2237),u=i(69836),p=i(84997);const m="root-W9YKLd",g="selected-MfKVC9",S="cover-Sg1bSx",v="icon-NjGS_M",_="textInfo-zYCck9",h="title-PHGLK_",f="description-W4AGHI",k="statusBar-wU3FIA",x="checkedStatusBar-YMzSep";var C=i(11527);const b=({className:e,selected:t,coverSrc:i,title:r,description:l,isInfoComplete:o,onClick:n})=>{const{t:a}=(0,s.$)(),{handleMouseEnter:b}=(0,p.S)();return(0,C.jsxs)("div",{className:c()(e,m,t&&g),onClick:n,children:[(0,C.jsx)("div",{className:S,children:i?(0,C.jsx)("img",{className:v,src:i}):(0,C.jsx)(d.t,{className:v,iconWidth:28})}),(0,C.jsxs)("div",{className:_,children:[(0,C.jsx)("div",{className:h,onMouseEnter:b,children:r||a("pc_stickers_release_group_name_web")}),(0,C.jsx)("div",{className:f,onMouseEnter:b,children:l||a("pc_stickers_release_details_recommend_web")})]}),o?(0,C.jsx)(u.Bo,{className:x,text:a("pc_stickers_release_finish_fill_web")}):(0,C.jsx)(u.LU,{className:k})]})};var I=i(23073),w=i(50959),F=i(84736),y=i(66589),N=i(61022),j=i(73224),U=i(42983),E=i(25807),L=i(1110),q=i(50666),T=i(97662),P=i(76252),A=i(5014),R=i(97311),Z=i(74575),M=i(1946),z=i(54847),O=i(60251),$=i(3767),B=i(59787),D=i(82665),V=i(50279),W=i(8129),X=i(2555),G=i(94435);function J(e){return Boolean(e.id)}class H{constructor(){(0,B.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const i of(0,D.Z)(e,10)){const e=await Promise.all(i.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:i,onResult:r,onUpdateResult:s}=e,l=JSON.parse(JSON.stringify(e.req));let o=this.itemMap.get(i);if(null!==(t=o)&&void 0!==t&&t.promise&&(0,V.Z)(o.req,l))try{return await o.promise}catch(n){(0,W.c6)("[MaterialPublishService] publish failed, start to retry",{id:i})}return o={promise:null,id:i,req:l,onResult:r,onUpdateResult:s},this.itemMap.set(i,o),o.promise=this.publishImpl(o),o.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),i=async(i,r)=>{try{const o={error:i,errorText:this.getErrorText(i),time:Math.round(performance.now()-t),resourceId:r};var s,l;if(J(e.req))await(null===(s=e.onUpdateResult)||void 0===s?void 0:s.call(e,{req:e.req,...o}));else await(null===(l=e.onResult)||void 0===l?void 0:l.call(e,{req:e.req,...o}))}catch(o){(0,W.RF)("[MaterialPublishService] callOnResult failed",o)}};let r;try{r=await this.postOrUpdate(e)}catch(s){throw e.promise=null,i(s,""),s}return await i(null,r.resource_id),r}async postOrUpdate(e){return J(e.req)?(await(0,G.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,G.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new X.B).timeout(5e3)])}catch(t){(0,W.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const i=performance.now(),r=new X.B,s={count:50,effect_types:t,uid:E.$.userInfo.uid,cursor:0};for(;performance.now()-i<5e3;){const t=await(0,G.Js)(s).catch((()=>null));if(null!=t&&t.effect_item_list){const i=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>i.has(e))))return}await r.timeout(500)}}}var Y=i(49737),Q=i(24399),K=i(79668),ee=i(57609),te=i(2514),ie=i(67078),re=i(539),se=i(17941),le=i(21919),oe=i(46309),ne=i(3718),ae=i(51654),ce=i(18370);const de="ImportSticker";function ue(e){return{title:"",description:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:!1,...A.N7,sequenceSettingsApplyToAll:!1,...e}}const pe=(0,w.createContext)(null),me=()=>(0,w.useContext)(pe),ge=(0,r.Pi)((e=>{const{className:t}=e,i=me(),{collection:r}=i;return(0,C.jsx)(b,{className:t,selected:i.isCollectionCoverCardSelected,coverSrc:r.cover.url,title:r.title,description:r.description,isInfoComplete:r.isInfoComplete,onClick:i.selectCollectionCoverCard})}));var Se=i(503);const ve="root-krHCkJ",_e="disabled-n2Aq_E",he="percent-uW3VlL",fe=(0,r.Pi)((e=>{const{className:t,onClick:i}=e,r=me(),{t:l}=(0,s.$)(),o=(()=>{const{ready:e,pending:t,failed:i}=r.stickersForOnlineImageEditorStats;return e<4?{tooltip:l("pc_sticker_import_least_{X}_web",{X:4}),percent:null}:0===t&&0===i?null:{tooltip:r.retryTimesForOnlineImageEditor>1?l("pc_sticker_failed_retrying_web"):l("pc_sticker_loading_web"),percent:Math.floor(e/(e+t+i)*100)}})(),{handleMouseEnter:n}=(0,p.w)({content:null==o?void 0:o.tooltip,cursor:"not-allowed"});return(0,C.jsxs)("div",{className:c()(t,ve,o&&_e),onClick:e=>{o?e.stopPropagation():i(e)},onMouseEnter:o?n:void 0,children:[(0,C.jsx)("span",{children:l("pc_stickers_release_online_puzzle_web")}),o&&null!==o.percent&&(0,C.jsxs)("span",{className:he,children:[o.percent,"%"]})]})}));var ke;function xe(){return xe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},xe.apply(this,arguments)}const Ce=e=>w.createElement("svg",xe({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),ke||(ke=w.createElement("path",{fill:"#D4A500",d:"M8 14c3.292 0 6-2.71 6-6.003C14 4.703 11.292 2 8 2S2 4.703 2 7.997C2 11.29 4.708 14 8 14Zm0-5.142c-.391 0-.62-.217-.638-.614l-.09-2.493c-.024-.421.277-.704.722-.704.445 0 .752.289.728.71l-.09 2.48c-.018.404-.247.621-.632.621Zm0 2.047c-.445 0-.794-.283-.794-.71 0-.428.349-.717.794-.717.451 0 .788.29.788.717s-.343.71-.788.71Z"})));var be=i(82346);const Ie="root-OOqubc",we="loadingText-blkQ9S",Fe="errorText-b8vNmn",ye="retryText-cBAROb",Ne="warnText-XizvZZ",je=e=>{const{className:t,isUploadFailed:i,onRetry:r,needImport:l,loading:o}=e,n=c()(Ie,t),{t:a}=(0,s.$)();return i?(0,C.jsx)("div",{className:n,children:(0,C.jsx)("span",{className:Fe,children:a("pc_stickers_release_error_x_web",{X:(0,C.jsx)("span",{className:ye,onClick:r,children:a("pc_stickers_release_click_again_web")},"X")})})}):l?(0,C.jsxs)("div",{className:n,children:[(0,C.jsx)(Ce,{height:14,width:14}),(0,C.jsx)("span",{className:Ne,children:a("pc_stickers_release_add_cover_web")})]}):o?(0,C.jsxs)("div",{className:n,children:[(0,C.jsx)(be.a,{size:12,arcColor:"var(--grey-1)"}),(0,C.jsx)("span",{className:we,children:a("pc_stickers_release_in_web")})]}):(0,C.jsx)("div",{className:n})},Ue="root-SiuXcn",Ee="icon-pvz0IF",Le=e=>{const{className:t,src:i}=e,r=c()(Ue,t);return(0,C.jsx)("div",{className:r,children:i?(0,C.jsx)("img",{className:Ee,src:i}):(0,C.jsx)(d.t,{className:Ee,iconWidth:28})})};var qe=i(44704);const Te="root-RGRrw_",Pe="statusBar-g7EX3X",Ae="edit-gNJiPH",Re="editMenuItem-Lwrrxl",Ze=(0,r.Pi)((e=>{const t=me(),{t:i}=(0,s.$)(),{cover:r}=t.collection;return(0,C.jsxs)("div",{className:Te,children:[(0,C.jsx)(Le,{src:r.url}),(0,C.jsx)(F.J2,{position:"bottomRight",trigger:"click",className:qe.i.heycanPopoverWrapperClearStyle,clickToHide:!0,onVisibleChange:e=>{e&&t.retryUploadForOnlineImageEditor()},content:(0,C.jsx)(Se.m,{items:[{key:"openCoverImageEditor",render:({key:e,className:i})=>(0,C.jsx)(fe,{className:i,onClick:t.openCoverImageEditor},e)},{key:"localUploadCover",render:({key:e,className:r})=>(0,C.jsx)("div",{className:c()(r,Re),onClick:t.localUploadCover,children:i("pc_stickers_release_local_web")},e)}]}),children:(0,C.jsx)("div",{className:Ae,children:i("pc_stickers_release_cover_edit_web")})}),(0,C.jsx)(je,{className:Pe,isUploadFailed:r.isUploadFailed,onRetry:t.retryUpload,needImport:r.needImport,loading:!r.url&&!r.needImport})]})}));var Me=i(3253),ze=i(28747),Oe=(i(15443),i(26758)),$e=i(33831);const Be="rules-dY0ScJ",De="item-AGHWKH",Ve="iconDot-j9ob_p",We="iconTick-D79ceF",Xe="content-g4kRtr",Ge=({className:e,rules:t})=>(0,C.jsx)("div",{className:c()([Be,e]),children:t.map(((e,t)=>(0,C.jsxs)("div",{className:De,children:[(void 0===e.status||"normal"===e.status)&&(0,C.jsx)("div",{className:Ve}),"success"===e.status&&(0,C.jsx)($e.Z,{className:We}),(0,C.jsx)("p",{className:Xe,children:e.content})]},t)))});var Je=i(79679);const He="root-E0tpJM",Ye="title-H2crax",Qe="word-BtnjNE",Ke="help-XAH_LZ",et="opt-QOw283",tt="highLight-PASzWv",it="content-SmW56E",rt="imgBox-q1y7Qu",st="img-fx46qr",lt="statusBar-QLDUGu",ot="loadingText-uP8NbU",nt="retryText-RzWB7U",at="example-p5VW7t",ct="contextMenuItem-tm8D3m",dt="editMenuItem-COaeTW",ut="failedImg-rOcYXw",pt=()=>{const{t:e}=(0,s.$)();return(0,C.jsxs)("div",{className:Qe,children:[e("pc_sticker_sample_web"),(0,C.jsx)(F.J2,{content:(0,C.jsx)("div",{className:at,children:(0,C.jsx)(Ge,{rules:[{content:`${e("file_format_web")}PNG/GIF`},{content:e("pc_stickers_prompt_w_{X}_h_{Y}_web",{X:"1000px",Y:"1250px"})},{content:e("file_size_limit_web",{X:5})}]})}),children:(0,C.jsx)(Oe.Z,{size:"small",className:Ke})})]})},mt=(0,r.Pi)((({className:e})=>{const t=me(),{t:i}=(0,s.$)(),r=t.collection.exampleImages[0],{handleContextMenu:l}=(0,Je.D)({content:(0,C.jsx)(Se.m,{items:[{key:"remove",render:({key:e,className:r})=>(0,C.jsx)("div",{className:c()(r,ct),onClick:t.removeExample,children:i("pc_stickers_release_delete_web")},e)}]})}),o=(0,w.useMemo)((()=>{const e=r;return e?null!=e&&e.url?(0,C.jsx)("div",{className:rt,children:(0,C.jsx)("img",{className:st,src:null==e?void 0:e.url,alt:""})}):(0,C.jsx)("div",{className:rt,children:(0,C.jsx)(d.t,{className:ut,iconWidth:17})}):null}),[null==r?void 0:r.isUploadFailed,null==r?void 0:r.url]);return(0,C.jsx)("div",{className:c()(He,e),children:(0,C.jsxs)("div",{className:Ye,children:[(0,C.jsx)(pt,{}),(0,C.jsx)("div",{className:it,onContextMenu:e=>{l(e)},children:(0,C.jsxs)(C.Fragment,{children:[o,null!=r&&r.isUploadFailed?(0,C.jsx)("div",{className:lt,children:i("pc_stickers_release_error_x_web",{X:(0,C.jsx)("span",{className:nt,onClick:t.retryUpload,children:i("pc_stickers_release_click_again_web")},"X")})}):null==r||!r.id||null!=r&&r.url?null:(0,C.jsxs)("div",{className:lt,children:[(0,C.jsx)(be.a,{size:12,arcColor:"var(--grey-1)"}),(0,C.jsx)("span",{className:ot,children:i("pc_stickers_release_in_web")})]})]})}),(0,C.jsx)("div",{className:et,children:(0,C.jsx)(F.J2,{position:"bottomRight",trigger:"click",clickToHide:!0,content:(0,C.jsx)(Se.m,{items:[{key:"openCoverImageEditor",render:({key:e,className:i})=>(0,C.jsx)(fe,{className:i,onClick:t.openExampleImageEditor},e)},{key:"localUploadCover",render:({key:e,className:r})=>(0,C.jsx)("div",{className:c()(r,dt),onClick:t.localUploadExample,children:i("pc_stickers_release_local_web")},e)}]}),children:(0,C.jsx)("span",{className:tt,children:i("pc_sticker_edit_web")})})})]})})}));var gt=i(28442),St=i(63541),vt=i(76199),_t=i(95471),ht=i(45033),ft=i(53803);const kt="root-VsnTC4",xt="label-Bpq1iR",Ct="useAll-TIjXSy",bt="advancedSettingsTitle-eGU9np",It="exampleImageField-Z2iuTF",wt="fpsSettingsField-ADkz4K",Ft="input-dtQ3J2",yt="businessCheckbox-gIDWKx",Nt=(0,r.Pi)((()=>{const{t:e}=(0,s.$)(),t=me(),{importServ:i,collection:r}=t,{stickerListStore:l}=i;(0,w.useLayoutEffect)((()=>t.initCollectionFields()),[]);const{getDisplayLength:o}=(0,ht._)();return(0,C.jsxs)("div",{className:kt,children:[(0,C.jsx)(Ze,{}),(0,C.jsx)(Me.y,{fieldClassName:Ft,label:e("pc_stickers_release_group_name_web"),field:"collection.title",maxLength:A.S8,placeholder:e("pc_stickers_release_xy_name_web",{X:1,Y:o(A.S8)}),rules:[{required:!0,message:""}],onChange:e=>t.updateCollectionFormState({title:e})}),(0,C.jsx)(Me.y,{fieldClassName:Ft,label:e("pc_stickers_release_details_recommend_web"),field:"collection.description",maxLength:A.Us,placeholder:e("pc_stickers_release_xy_details_web",{X:1,Y:o(A.Us)}),onChange:e=>t.updateCollectionFormState({description:e})}),(0,C.jsxs)("div",{className:xt,children:[(0,C.jsx)(ze.u,{fieldClassName:Ft,label:e("pc_stickers_release_tag_set_web"),placeholder:e("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"collection.tags",itemType:U.Ab.Sticker,recommendConfig:{title:r.title,uri:r.cover.uri},rules:[{required:!0,message:""}],onChange:e=>t.updateCollectionFormState({tags:e})}),(0,C.jsx)("span",{className:Ct,onClick:()=>{var e,i;const r=null===(e=t.formApi)||void 0===e?void 0:e.getValues();l.applyForTags((null==r||null===(i=r.collection)||void 0===i?void 0:i.tags)||[])},children:e("pc_stickers_release_apply_all_web")})]}),!1,(0,C.jsx)(St.Z,{children:(0,C.jsxs)("div",{className:ft.Z.authGroup,children:[(0,C.jsx)(St._,{text:e("pc_template_authorize_range_web")}),(0,C.jsxs)("div",{className:ft.Z.right,children:[(0,C.jsx)(vt.l,{noLabel:!0,field:"collection.isVip",sendLogService:t.sendLogServ}),(0,C.jsx)(_t.R,{fieldClassName:yt,noLabel:!0,field:"collection.isBusiness",vipField:"collection.isVip",authorSignService:t.authorSignService,getAuthFileUploadService:()=>t.authFileUploadServiceManager.ensure(t.collection.id),sendLogService:t.sendLogServ})]})]})}),(0,C.jsx)("div",{className:bt,children:e("pc_stickers_release_higher_settings_web")}),(0,C.jsx)(mt,{className:It}),t.field.canFpsSetting&&(0,C.jsx)(gt.ZP,{className:wt,prefix:"collection",onStartEdit:()=>t.sendLogServ.sendStartEditSequenceSettingsLog({}),onSave:t.saveSequenceSettingsForCollection})]})}));var jt=i(74195),Ut=i(82725);const Et="collectionCoverCard-Wqf4av",Lt="stickerList-Opl43w",qt=(0,r.Pi)((e=>{const{className:t}=e,i=me(),{t:r}=(0,s.$)();return(0,Y.pg)(i),(0,o.O)({className:t,layout:i.mainFormLayout,uploadAreaProps:{titleForUploadArea:r("pc_sticker_release_drag_web"),titleForMainForm:r("pc_stickers_release_drag_in_web"),subTitle:r("pc_sticker_release_groups_png_web"),draggingTitle:r("pc_sticker_release_mouse_web"),disabled:i.isImportDisabled,disabledTooltip:r("pc_stickers_release_max_x_web",{X:A.qb}),onClick:i.openStickerFilePicker,onDrop:i.uploadDroppedStickerFiles},importLoadingText:r("pc_sticker_release_loading_web"),setFormApi:i.setFormApi,renderImportArea:e=>(0,C.jsxs)(C.Fragment,{children:[e,(0,C.jsx)(ge,{className:Et}),(0,C.jsx)(n.z,{className:Lt,importStickerFileService:i.importServ,onSelect:i.selectSticker,onReimport:i.reimportSticker})]}),renderFormArea:()=>{if(i.isCollectionCoverCardSelected)return(0,C.jsx)(Nt,{});const{selectedSticker:e}=i.stickerListStore;return e&&(0,C.jsx)(jt.E,{importStickerFileService:i.importServ,sticker:e,initFields:i.initSingleFields,onStartEditSequenceSettings:()=>i.sendLogServ.sendStartEditSequenceSettingsLog({collection_detail:"collection_material"}),onSaveSequenceSettings:i.saveSequenceSettingsForSingle})},scrollAreaRef:i.importServ.stickerListStore.scrollAreaRef,onRetry:Ut.cb})}));var Tt=i(26800),Pt=i(80432);const At=({className:e,leftText:t,isPublishDisabled:i,isPublishing:r,needConfirmModalOnClose:l,onPublish:o,beforeCancel:n,onCancel:a})=>{const{t:d}=(0,s.$)(),u=(0,Tt.Z)((async()=>{if(n&&n(),l){if(await $.Z.warn({mainText:d("pc_sticker_cancel_web"),subText:d("pc_sticker_click_unrecoverable_web"),confirmBtnText:d("pc_stickers_release_confirm_quit_web"),cancelBtnText:d("pc_stickers_release_cancel_web")})!==$.L.Confirm)return}a?a():(0,oe.Nt)()})),p=le.YW.Creator,{showModalWithoutReview:m}=(0,le.ZP)({protocol:p});return(0,C.jsxs)("div",{className:c()(e,Pt.Z.root),children:[(0,C.jsx)("div",{className:Pt.Z.left,onClick:undefined,children:t}),(0,C.jsxs)("div",{className:Pt.Z.right,children:[(0,C.jsx)("span",{className:Pt.Z.remind,onClick:m,children:d("pc_sticker_release_agree_{X}_web",{X:(0,C.jsx)("span",{className:Pt.Z.protocol,children:le.rr[p]},"protocol")})}),(0,C.jsxs)("div",{className:Pt.Z.buttonContainer,children:[(0,C.jsx)(F.zx,{className:Pt.Z.button,type:"primary",theme:"solid",disabled:i,loading:r,onClick:o,children:d("pc_stickers_release_web")}),(0,C.jsx)(F.zx,{className:Pt.Z.button,type:"secondary",theme:"solid",onClick:u,children:d("pc_stickers_release_cancel_web")})]})]})]})};var Rt=i(36775);const Zt=(0,r.Pi)((e=>{const{className:t}=e,i=me(),r=(0,w.useRef)(null),{t:l}=(0,s.$)();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(At,{className:t,leftText:l("pc_sticker_release_X_web",{X:i.importLoadingStore.isImportLoading?0:i.stickerListStore.stickers.length,Y:A.r$,Z:A.qb}),isPublishDisabled:!i.isReadyToPublish,isPublishing:i.isPublishing,needConfirmModalOnClose:i.needConfirmModalOnClose,onPublish:()=>i.uploadAndPublish(r.current)}),(0,C.jsx)(Rt.q,{ref:r,uploadStats:i.uploadStats,onRetryUpload:i.retryUpload,onCancel:i.isAllUploadedWatcher.stop,onShowUploadFail:i.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:i.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var Mt=i(12904),zt=i(65546);const Ot="page-bI3zoQ",$t="content-CkDfjt",Bt="requirement-CWgpLc",Dt="mainForm-GIDO1U",Vt="footer-YVeBwr",Wt=(0,r.Pi)((()=>{const e=function(){const e=(0,P.WQ)(),t=(0,T.WQ)({stickerListStore:e}),i=new Y.YL({itemType:U.Ab.StickerCollection}),r=(0,re.G)({watch:()=>l.isAllUploaded}),s=new O.l,l=(0,N.fv)((()=>({formApi:null,setFormApi:e=>{l.formApi=e},mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return t.isImportLoading?"loading":"uploadArea"===l.mainFormLayoutAfterLoading&&z.appModel.isInitFailed?"error":l.mainFormLayoutAfterLoading},get isImportDisabled(){return e.stickers.length>=A.qb},stickerListStore:e,importLoadingStore:t,importServ:new L.T({api:new q.r,stickerListStore:e,sendLogServ:i,needSaveSequenceGifUrl:!0}),pubServ:new H,sendLogServ:i,authorSignService:new ee.I({signScene:ne.d.BusinessArtist}),authFileUploadServiceManager:new te.r({}),performanceTimingCollector:(0,ce.uY)(),getImportMinMaxCount(){const t=e.stickers.length;return{minCount:1,maxCount:Math.max(0,A.qb-t),maxTotalCount:A.qb}},getHasImportedType(){const{stickers:t}=e;return 0===t.length?"":t.every(P.w3)?"dynamic":"static"},getStaticDynamicMixParams:()=>({needCheckStaticDynamicMix:!0,hasImportedType:l.getHasImportedType()}),openStickerFilePicker:()=>s.lock(de,(async()=>{i.sendUploadActionLog(l),await l.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"openStickerFilePicker"});const e=await l.importServ.openStickerFilePicker({...l.getImportMinMaxCount(),...l.getStaticDynamicMixParams()});l.addNewStickers(e)})),uploadDroppedStickerFiles:()=>s.lock(de,(async()=>{i.sendUploadActionLog(l),await l.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"uploadDroppedStickerFiles"});const e=await l.importServ.uploadDroppedStickerFiles({...l.getImportMinMaxCount(),...l.getStaticDynamicMixParams()});l.addNewStickers(e)})),reimportSticker:t=>s.lock(de,(async()=>{await l.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"reimportSticker"});const i=await l.importServ.reimportSticker(t,l.getStaticDynamicMixParams());if(i){const t=e.getSticker(i);l.selectSticker(t)}})),addNewStickers(i){if(0!==i.length)if(e.addStickers(i),"uploadArea"===l.mainFormLayoutAfterLoading)l.selectCollectionCoverCard(),t.showImportLoading(),l.mainFormLayoutAfterLoading="mainForm",l.startCheckGenerateCollectionCover(),l.collection.formState.isVip=(0,se.K)(le.YW.OriginalForSubscription);else{const t=e.getSticker(i[0].id);l.selectSticker(t)}},collection:{id:(0,M.V)("sticker-collection"),cover:{id:"",url:"",uri:"",needImport:!0,isUploadFailed:!1},exampleImages:[],get title(){return this.formState.title},get description(){return this.formState.description},hasEverSelected:!1,get isInfoComplete(){return Boolean(this.cover.id&&this.title&&this.formState.tags.length>0)},formState:ue({})},isCollectionCoverCardSelected:!0,get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1,canIconBlank:E.$.permissions.includes(E.v.EffectIconBlank),canHighPro:E.$.permissions.includes(E.v.EffectHighPrio),canPackOne:E.$.permissions.includes(E.v.StickerOnePackage),canFpsSetting:e.stickers.some((e=>e.isSequence))}},get permissions(){return E.$.permissions},selectSticker(t){l.isCollectionCoverCardSelected&&(l.isCollectionCoverCardSelected=!1,l.saveCollectionFormState()),l.saveSingleFormState(),e.selectSticker(t.id)},selectCollectionCoverCard(){l.saveSingleFormState(),e.selectSticker(null),l.isCollectionCoverCardSelected=!0,l.collection.hasEverSelected=!0},initCollectionFields(){var e,t;null===(e=l.formApi)||void 0===e||e.reset(),null===(t=l.formApi)||void 0===t||t.setValues({collection:l.collection.formState})},updateCollectionFormState(e){Object.assign(l.collection.formState,e)},saveCollectionFormState(){var e;l.updateCollectionFormState(ue({...null===(e=l.formApi)||void 0===e?void 0:e.getValue("collection")}))},initSingleFields(e){var t,i;null===(t=l.formApi)||void 0===t||t.reset(),null===(i=l.formApi)||void 0===i||i.setValues({single:{...e.formState,...e.sequenceSettings}})},saveSingleFormState(){var t;const{selectedSticker:i}=e;if(!i)return;const r=e.makeInitFormState({...null===(t=l.formApi)||void 0===t?void 0:t.getValue("single"),...i.sequenceSettings,sequenceSettingsApplyToAll:!1});e.updateFormState(i,r)},saveSequenceSettingsForSingle(){var t;const r=e.makeInitFormState({...null===(t=l.formApi)||void 0===t?void 0:t.getValue("single")}),{fps:s,loop:o,sequenceSettingsApplyToAll:n}=r,a={fps:s,loop:o};l.importServ.updateSequenceSettings({newSettings:a,isApplyToAll:n}),i.sendSaveSequenceSettingsLog({collection_detail:"collection_material",sequenceSettings:{fps:s,loop:o,sequenceSettingsApplyToAll:n}})},saveSequenceSettingsForCollection(){var e;const t=ue({...null===(e=l.formApi)||void 0===e?void 0:e.getValue("collection")}),{fps:r,loop:s}=t,o={fps:r,loop:s};l.importServ.updateSequenceSettings({newSettings:o,isApplyToAll:!0}),i.sendSaveSequenceSettingsLog({collection_detail:"collection_all",sequenceSettings:{...t,sequenceSettingsApplyToAll:!0}})},get needConfirmModalOnClose(){return"mainForm"===l.mainFormLayout||e.stickers.length>0},get isReadyToPublish(){const t=e.stickers.length;return Boolean(t>=A.r$&&t<=A.qb&&l.collection.isInfoComplete&&e.isReadyToPublish&&!l.isPublishSucceeded)},get uploadStats(){const t=e.uploadStats;let i=0,r=0,s=0;const{cover:o,exampleImages:n}=l.collection;return[o,...n].forEach((e=>{e.isUploadFailed?s+=1:e.uri?r+=1:i+=1})),{pending:t.pending+i,succeeded:t.succeeded+r,failed:t.failed+s}},collectLogData(){const t=e.collectLogData(),{collection:i,stickersForOnlineImageEditorStats:r,uploadStats:s}=l,{cover:o,exampleImages:n,isInfoComplete:a}=i,c={isInfoComplete:a,stickersCount:t.length,stickersReadyToPublish:e.isReadyToPublish,stickersForOnlineImageEditorStats:r,uploadStats:s,stickers:t,cover:(0,I.Z)(o,["id","uri","needImport","isUploadFailed"]),exampleImages:n.map((e=>(0,I.Z)(e,["id","uri","isUploadFailed"])))};(0,W.c6)("[CollectionStore] collectLogData",c)},get isAllUploaded(){const{pending:e,failed:t}=l.uploadStats;return!e&&!t},isAllUploadedWatcher:r,async uploadAndPublish(e){i.sendPageActionLog({action:"publish"}),l.isAllUploaded||(await l.retryUpload(),null==e||e.show(),await l.isAllUploadedWatcher.start());try{await l.publish()}finally{null==e||e.hide()}},isPublishing:!1,isPublishSucceeded:!1,async publish(){l.isPublishing=!0;try{await l.publishImpl()}catch(e){return F.FN.error(j.I18n.t("pc_sticker_release_failed_retry_web")),(0,y.z)((()=>{l.isPublishing=!1})),void(0,W.RF)("[CollectionStore] publish failed",e)}(0,y.z)((()=>{l.isPublishing=!1,l.isPublishSucceeded=!0})),F.FN.success(j.I18n.t("pc_sticker_release_successful_web")),(0,oe.ZM)({effect_type:U.Ab.StickerCollection}),(0,W.c6)("[CollectionStore] publish success"),setTimeout((()=>(0,oe.Nt)({item_type:U.Ab.StickerCollection})),1e3)},async publishImpl(){l.isCollectionCoverCardSelected?l.saveCollectionFormState():l.saveSingleFormState();const{collection:t}=l,{cover:r,exampleImages:s,formState:o}=t,{title:n,description:a,tags:c,isVip:d,isBusiness:u,isOriginal:p}=o,m=(0,ie.pn)({isVip:d,isBusiness:u,authFiles:l.authFileUploadServiceManager.getUploadedFiles(l.collection.id)}),g={effect_type:U.Ab.StickerCollection,is_vip:d,...m.root,common_data:{title:n,description:a,icon:{image_uri:r.uri},source:G.r0.UserPostPcCollection,tags:[...c],is_business:u,is_original:p,web_extra:JSON.stringify({tab_detail_images:s.map((e=>e.uri))}),...m.commonData}},S=e.makePublishItemList({is_vip:d,is_business:u,is_original:p,sourceForSimple:G.r0.UserPostPcCollection,sourceForSequence:G.r0.UserPostPcSequenceCollection,onResult:(e,t)=>(0,Q.g)({logPrefix:"[CollectionStore] ",sticker:e,publishResult:t,importServ:l.importServ,sendLogServ:l.sendLogServ})});(0,W.c6)("[CollectionStore] stickers publish start",{ids:S.map((e=>e.id))});const v=(await l.pubServ.batchPublish(S)).map((e=>e.resource_id));g.collection_info={resource_id_list:v},(0,W.c6)("[CollectionStore] collection publish start",{resourceIdList:v});const{resource_id:_}=await l.pubServ.publish({id:t.id,req:g,onResult:({req:e,error:r,errorText:s,time:l,resourceId:o})=>{i.sendStickerPublishStatusLog({error:s,time:l,collectionParams:{collection:t,collectionReqItem:e}}),r?(0,W.RF)("[CollectionStore] collection publish failed",r):(0,W.c6)("[CollectionStore] collection publish success",{resourceId:o})}});(0,W.c6)("[CollectionStore] collection publish done",{resourceId:_}),await l.pubServ.pollUntilAllInEffectList({ids:[_],types:[U.Ab.StickerCollection]}),(0,W.c6)("[SingleStore] poll done")},sendUploadProgressModalShowErrorLog(){const{collection:t}=l,r=e.stickers.filter((e=>e.isUploadFailed)).map((e=>({collection_detail:"collection_material",error_report:l.importServ.getFileStats(e.id).uploadError})));t.cover.id&&t.cover.isUploadFailed&&r.push({collection_detail:"collection_cover",error_report:l.importServ.getFileStats(t.cover.id).uploadError}),t.exampleImages.forEach((e=>{e.isUploadFailed&&r.push({collection_detail:"collection_sample",error_report:l.importServ.getFileStats(e.id).uploadError})})),i.sendStickerPublishErrorLog(r)},async retryUpload(){const e=[];[l.collection.cover,...l.collection.exampleImages].forEach((t=>{t.isUploadFailed&&e.push(t.id)})),await this.importServ.retryUpload(e),(0,y.z)((()=>{[l.collection.cover,...l.collection.exampleImages].forEach((t=>{e.includes(t.id)&&(t.isUploadFailed=!1)}))}))},retryTimesForOnlineImageEditor:0,retryUploadForOnlineImageEditor(){const{pending:e,failed:t}=l.getStickersForOnlineImageEditor();0===e.length&&t.length>0&&(l.retryTimesForOnlineImageEditor+=1,l.retryUpload())},getStickersForOnlineImageEditor(){const t=[],i=[],r=[];return e.stickers.forEach((e=>{if(e.unmetRequirements.length>0)return!1;if(e.isSequence){if(e.isUploadFailed)return void r.push(e);if(e.largeImageUri)return void t.push(e)}else if(e.hasCheckedRequirements)return void t.push(e);i.push(e)})),{pending:i,ready:t,failed:r}},get stickersForOnlineImageEditorStats(){const{pending:e,ready:t,failed:i}=l.getStickersForOnlineImageEditor();return{pending:e.length,ready:t.length,failed:i.length}},generateCollectionCoverWatcher:null,startCheckGenerateCollectionCover(){l.collection.cover.needImport=!1,l.generateCollectionCoverWatcher.start()},stopCheckGenerateCollectionCover(){l.generateCollectionCoverWatcher.stop()},generateCollectionCoverIfNeeded(){const{ready:t,failed:i}=l.getStickersForOnlineImageEditor(),r=new Set(i.map((e=>e.id))),s=new Set(t.map((e=>e.id))),o=e.stickers.slice(0,A.GR);return o.length!==A.GR||o.some((e=>e.unmetRequirements.length>0||r.has(e.id)))?(l.collection.cover.needImport=!0,!0):!!o.every((e=>s.has(e.id)))&&(l.generateCollectionCover(o),!0)},async generateCollectionCover(e){const t=await l.importServ.generateCollectionCover({collectionId:l.collection.id,stickers:e});l.collection.cover.id?(0,W.c6)("[CollectionStore] generateCollectionCover ignored",{coverId:l.collection.cover.id}):t?l.replaceCover(t,"online_generated"):((0,y.z)((()=>{l.collection.cover.needImport=!0})),(0,W.RF)("[CollectionStore] generateCollectionCover failed"))},replaceCover(e,t){l.collection.cover.id&&l.importServ.removeFile(l.collection.cover.id),l.stopCheckGenerateCollectionCover(),l.collection.cover={id:e,uri:"",url:"",needImport:!1,isUploadFailed:!1,generatedFrom:t},l.importServ.recordFileUploadStart(e),l.importServ.registerThumbnailEvent(e,(t=>{l.collection.cover.id===e?t.base64?(0,y.z)((()=>{const{cover:e}=l.collection;e.url=(0,R.F2)(t.base64)})):(0,W.RF)(`[CollectionStore] cover thumbnail failed {${e}}`):(0,W.c6)(`[CollectionStore] cover thumbnail ignored {${e}}`,{coverId:l.collection.cover.id})})),l.importServ.registerUploadEvent(e,(t=>{if(l.collection.cover.id!==e)return void(0,W.c6)(`[CollectionStore] cover upload ignored {${e}}`,{coverId:l.collection.cover.id});const{cover:i}=l.collection,{uri:r}=t;(0,y.z)((()=>{if(r)i.uri=r,l.importServ.recordFileUploadEnd(e),(0,W.c6)(`[CollectionStore] cover upload success {${e}}`,{uri:r});else{i.isUploadFailed=!0;const r=t.error||"unknown";l.importServ.recordFileUploadEnd(e,r),(0,W.RF)(`[CollectionStore] cover upload failed {${e}}`,null,{error:r})}})),this.sendLogServ.sendCollectionUploadStatusLog({cover:i,stats:l.importServ.getFileStats(e)})}))},replaceExample(e,t){const i=l.collection.exampleImages[0];null!=i&&i.id&&l.importServ.removeFile(null==i?void 0:i.id),l.collection.exampleImages=[{id:e,uri:"",url:"",isUploadFailed:!1,generatedFrom:t}],l.importServ.recordFileUploadStart(e),l.importServ.registerThumbnailEvent(e,(t=>{const i=l.collection.exampleImages.find((t=>t.id===e));i?t.base64?(0,y.z)((()=>{i.url=(0,R.F2)(t.base64)})):(0,W.RF)(`[CollectionStore] exampleImage thumbnail failed {${e}}`):(0,W.c6)(`[CollectionStore] exampleImage thumbnail ignored {${e}}`)})),l.importServ.registerUploadEvent(e,(t=>{const i=l.collection.exampleImages.find((t=>t.id===e));i?((0,y.z)((()=>{const{uri:r}=t;if(r)i.uri=r,l.importServ.recordFileUploadEnd(e),(0,W.c6)(`[CollectionStore] exampleImage upload success {${e}}`,{uri:r});else{i.isUploadFailed=!0;const r=t.error||"unknown";l.importServ.recordFileUploadEnd(e,r),(0,W.RF)(`[CollectionStore] exampleImage upload failed {${e}}`,null,{error:r})}})),this.sendLogServ.sendCollectionUploadStatusLog({exampleImage:i,stats:l.importServ.getFileStats(e)})):(0,W.c6)(`[CollectionStore] exampleImage upload ignored {${e}}`)}))},async openCoverImageEditor(){i.sendPageActionLog({action:"cover_generate_from_online"}),await l.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"openCoverImageEditor"});const e=l.getStickersForOnlineImageEditor().ready,t=await l.importServ.openStickerOnlineImageEditor({...A.J,collectionId:l.collection.id,type:"CoverImage",stickers:e});t&&l.replaceCover(t,"online_generated")},async localUploadCover(){i.sendPageActionLog({action:"cover_upload_from_local"}),await l.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"localUploadCover"});const e=await l.importServ.localUploadImage({...A.J}),t=await this.checkLocalUploadRequirements({image:e,collection_detail:"collection_cover",requirements:A.J,i18nKey:{minImageSize:"pc_collection_cover_size_{X}x{X}px_web"}});t&&l.replaceCover(t.id,"local_uploaded")},async openExampleImageEditor(){await l.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"openExampleImageEditor"});const e=l.getStickersForOnlineImageEditor().ready,t=await l.importServ.openStickerOnlineImageEditor({...A.Em,collectionId:l.collection.id,type:"ExampleImage",stickers:e});t&&l.replaceExample(t,"online_generated")},removeExample(){const e=l.collection.exampleImages[0];null!=e&&e.id&&l.importServ.removeFile(null==e?void 0:e.id),l.collection.exampleImages=[]},async localUploadExample(){await l.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"localUploadExample"});const e=await l.importServ.localUploadImage({...A.Em}),t=await this.checkLocalUploadRequirements({image:e,collection_detail:"collection_sample",requirements:A.Em,i18nKey:{minImageSize:"pc_sample_smallest_size_{X}x{X}px_web"}});t&&l.replaceExample(t.id,"local_uploaded")},async checkLocalUploadRequirements(e){const{image:t,requirements:r,i18nKey:s,collection_detail:l}=e;if(!t)return null;const{width:o,height:n}=t,{minImageSize:a}=r;return o<a||n<a?($.Z.warn({mainText:j.I18n.t("pc_stickers_release_failed_web"),subText:j.I18n.t(s.minImageSize,{X:a}),confirmBtnText:j.I18n.t("pc_stickers_release_confirm_web")}),i.sendStickerImportErrorLog({collection_detail:l,error_report:`width or height < ${a}`}),(0,W.c6)(`[CollectionStore] ${l} checkLocalUploadRequirements not passed: minImageSize`,{width:o,height:n,minImageSize:a}),null):t},destroy(){l.stopCheckGenerateCollectionCover()}})),{formApi:!1,generateCollectionCoverWatcher:!1});return l.generateCollectionCoverWatcher=(0,Z.e)({watch:()=>l.generateCollectionCoverIfNeeded()}),(0,K.L)({watch:()=>{l.uploadStats,l.isReadyToPublish},collect:l.collectLogData}),(0,ae.u)({watch:()=>l.needConfirmModalOnClose}),(0,w.useEffect)((()=>(window.store=l,l.importServ.uploadConfigService.updateCache(),l.authorSignService.init(),l.performanceTimingCollector.addRenderTiming(ce.Pk),()=>{t.destroy(),l.importServ.destroy()})),[]),l}(),{t}=(0,s.$)(),{selectedSticker:i}=e.importServ.stickerListStore;return(0,Mt.F)({title:t("pc_stickers_release_ing_web"),pid:"sticker-publish-collection"}),(0,zt.d)(),(0,Y.t9)(e.sendLogServ),(0,C.jsxs)(pe.Provider,{value:e,children:[(0,C.jsxs)("div",{className:Ot,children:[(0,C.jsxs)("div",{className:$t,children:[(0,C.jsx)(l.n,{className:Bt,sticker:i}),(0,C.jsx)(qt,{className:Dt})]}),(0,C.jsx)(Zt,{className:Vt})]}),!1]})}))},97311:(e,t,i)=>{i.d(t,{F2:()=>s,J9:()=>r,lm:()=>l});i(96706);const r=async e=>{const t=await fetch(e);return(e=>URL.createObjectURL(e))(await t.blob())},s=(e,t="")=>`data:${t};base64,${e}`;const l=e=>e.toLowerCase().split(".").pop()}}]);