"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[948],{84736:(e,t,i)=>{i.d(t,{EG:()=>m.Z,Ex:()=>c.Z,FN:()=>d.Z,HH:()=>w.H,II:()=>n.Z,J2:()=>l.Z,Lt:()=>o.Z,Q2:()=>h.Z,Vp:()=>p.Z,XQ:()=>S.Z,XZ:()=>s.ZP,ih:()=>v.i,l0:()=>_.Z,tL:()=>f.Z,u:()=>g.Z,u_:()=>a.Z,yC:()=>u.Z,z8:()=>k.z,zx:()=>r.Z});i(32913);var r=i(99891),s=i(76021),a=i(15194),o=i(89270),n=i(55550),l=i(21797),c=i(63522),u=i(48611),p=i(40996),m=i(83335),d=i(23997),g=i(11643),_=i(60679),S=i(78367),f=i(92417),h=i(5455),v=i(64482),k=i(96194),w=i(19537)},79679:(e,t,i)=>{i.d(t,{D:()=>_});var r=i(50959),s=i(44478),a=i(26800),o=i(84875),n=i.n(o),l=i(84736),c=i(45599),u=i(20468),p=i(44704),m=i(86057),d=i(11527);const g=e=>{const{position:t,getPopupContainer:i,onClosePopover:s,popoverProps:o}=e,[c,u]=(0,r.useState)(!0),g=(0,a.Z)((()=>u(!1))),_=(0,r.useRef)(null);return(0,r.useLayoutEffect)((()=>{var e;null===(e=_.current)||void 0===e||e.focus()}),[]),(0,d.jsx)(l.J2,{autoAdjustOverflow:!0,position:"bottomLeft",clickToHide:!0,...o,className:n()(o.className,p.i.heycanPopoverWrapperClearStyle),trigger:"custom",visible:c,onEscKeyDown:g,onClickOutSide:g,getPopupContainer:i,onVisibleChange:e=>{var t;!e&&s(),null===(t=o.onVisibleChange)||void 0===t||t.call(o,e)},children:(0,d.jsx)("div",{className:m.Z.point,tabIndex:-1,ref:_,style:{...t}})})};function _(e){const{zIndex:t=1e3,...i}=e,[o,n]=(0,r.useState)(null),[l,p]=(0,r.useState)(null),{i18n:_}=(0,c.$)(),S=(0,a.Z)((()=>{o&&(o.destroy(),n(null),p(null))})),f=(0,a.Z)((()=>{null==o||o.destroy()})),h=(0,a.Z)((e=>{if(o)return;const i=document.createElement("div");i.className=m.Z.root,i.style.zIndex=`${t}`;i.addEventListener("wheel",(e=>{e.currentTarget===i&&(e.preventDefault(),e.stopPropagation())}),!1),window.addEventListener("resize",S),document.body.appendChild(i);const r=(0,s.createRoot)(i);n({container:i,reactRoot:r,destroy:()=>{i.remove(),Promise.resolve().then((()=>r.unmount())),window.removeEventListener("resize",S)}}),p(e)})),v=(0,a.Z)((e=>{e.preventDefault(),e.stopPropagation(),h({left:e.clientX,top:e.clientY})}));return(0,r.useLayoutEffect)((()=>f),[]),(0,r.useLayoutEffect)((()=>{o&&l&&o.reactRoot.render((0,d.jsx)(u.a,{i18n:_,children:(0,d.jsx)(g,{popoverProps:i,getPopupContainer:()=>o.container,onClosePopover:S,position:l})})),o&&(o.container.style.zIndex=`${t}`)})),{handleContextMenu:v}}},503:(e,t,i)=>{i.d(t,{m:()=>a});var r=i(3731),s=i(11527);function a(e){const{items:t}=e,i=e=>{e.currentTarget===e.target&&e.stopPropagation()};return(0,s.jsx)("div",{className:r.Z.menu,onClick:i,children:(0,s.jsx)("div",{className:r.Z.menuItemContainer,onClick:i,children:t.map((({key:e,render:t},i)=>t({key:e,index:i,className:r.Z.menuItem})))})})}},86349:(e,t,i)=>{i.d(t,{XH:()=>u});var r=i(22310),s=i(73224),a=i(42983),o=i(99305);const{t:n}=s.I18n;let l=function(e){return e.all="all",e.paster="paster",e.wordart="wordart",e.soundEffect="soundEffect",e.textTemplate="textTemplate",e.subtitleTemplate="subtitleTemplate",e.video="video",e.stickerFramePack="sticker_frame_zip",e.emoticons="emoticons",e.formula="formula",e.filter="filter",e.filterCollection="filter_collection",e.stickerCollection="sticker_collection",e}({});let c=function(e){return e[e.all=0]="all",e[e.wordart=1]="wordart",e[e.paster=2]="paster",e[e.soundEffect=3]="soundEffect",e[e.video=4]="video",e[e.Song=5]="Song",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Filter=12]="Filter",e[e.StickerCollection=102]="StickerCollection",e[e.FilterCollection=112]="FilterCollection",e[e.emoticons=105]="emoticons",e[e.stickerFramePack=1e3]="stickerFramePack",e[e.formula=50]="formula",e}({});a.Ab.TextTemplate,n("text_template"),a.Ab.Sticker,n("sticker"),a.Ab.WordArt,n("flower_character"),a.Ab.Filter,n("filter"),a.Ab.Sticker,n("pc_template_authorize_sticker_web"),a.Ab.WordArt,n("pc_template_authorize_effect_web"),a.Ab.Font,n("pc_template_authorize_font_web");const u={[c.paster]:n("original_stickers_web"),[c.TextTemplate]:n("pc_text_template_origial_material_web"),[c.SubtitleTemplate]:n("pc_subtitle_original"),[c.wordart]:n("original_cursive"),[c.soundEffect]:n("pc_material_release_original_material"),[c.Filter]:n("pc_material_release_original_material"),[c.video]:n("pc_material_release_original_material")};c.all,l.all,c.paster,l.paster,c.wordart,l.wordart,c.soundEffect,l.soundEffect,c.video,l.video,c.emoticons,l.emoticons,c.formula,l.formula,c.Filter,l.filter,c.FilterCollection,l.filterCollection,c.TextTemplate,l.textTemplate,c.SubtitleTemplate,l.subtitleTemplate,c.StickerCollection,l.stickerCollection,l.wordart,c.wordart,l.paster,c.paster,l.soundEffect,c.soundEffect,l.video,c.video,l.emoticons,c.emoticons,l.formula,c.formula,l.filter,c.Filter,l.filterCollection,c.FilterCollection,l.textTemplate,c.TextTemplate,c.SubtitleTemplate,l.subtitleTemplate,l.stickerCollection,c.StickerCollection,l.all,l.paster,l.wordart,l.soundEffect,l.video,l.emoticons,l.formula,c.paster,c.StickerCollection,c.wordart,c.soundEffect,c.video,c.stickerFramePack,c.emoticons,c.formula,c.Image,c.Special,c.FaceSpecial,c.TextTemplate,c.SubtitleTemplate,c.Filter,c.FilterCollection,c.paster,c.wordart,c.soundEffect,c.video,c.emoticons,c.TextTemplate,c.SubtitleTemplate;let p=function(e){return e[e.default=0]="default",e[e.latest=1]="latest",e[e.hotest=2]="hotest",e}({});p.default,p.latest,p.hotest,c.all,c.paster,c.video,c.soundEffect,c.wordart;o.Ms.Offline,o.Ms.Online,o.Ms.HomepageOnline,o.Ms.HomepageOnline,o.KM.Passed,o.KM.Passed,o.Ms.Reviewing,o.Ms.SelfView,o.Ms.HomepageOnline,o.Ms.SelfView,o.KM.WaitReview,o.KM.RiskReviewing,o.KM.QualityReviewing,o.KM.CopyrightReviewing,o.Ms.HomepageOnline,o.KM.WaitReview,o.KM.RiskReviewing,o.KM.QualityReviewing,o.KM.CopyrightReviewing,o.KM.WaitReview,o.KM.RiskReviewing,o.KM.QualityReviewing,o.KM.CopyrightReviewing,o.Ms.HomepageOnline,o.Ms.SelfView,o.Ms.Banned,o.Ms.HomepageOnline,o.KM.Unknown,o.KM.RiskReviewFailed,o.KM.QualityReviewFailed,o.KM.CopyrightReviewFailed,o.Ms.SelfView,o.KM.Unknown,o.KM.RiskReviewFailed,o.KM.QualityReviewFailed,o.KM.CopyrightReviewFailed,o.KM.Passed,o.KM.Unknown,o.KM.RiskReviewFailed,o.KM.QualityReviewFailed,o.KM.CopyrightReviewFailed,o.Ms.HomepageOnline,o.KM.QualityReviewFailed,o.KM.CopyrightReviewFailed,o.Ms.SelfView,o.KM.QualityReviewFailed,o.KM.CopyrightReviewFailed,o.KM.Passed;let m=function(e){return e[e.Douyin=0]="Douyin",e[e.Heycon=1]="Heycon",e[e.VideoCut=2]="VideoCut",e[e.WebVideoCut=3]="WebVideoCut",e[e.Ulike=4]="Ulike",e[e.Effect=5]="Effect",e}({});m.Douyin,m.Heycon,m.VideoCut,m.WebVideoCut,m.Ulike,m.Effect,m.Douyin,m.Heycon,m.VideoCut,m.WebVideoCut,m.Ulike,m.Effect,m.Douyin,m.Heycon,m.VideoCut,m.WebVideoCut,m.Ulike,m.Effect,(0,r.Z)((()=>({zh:n("pc_text_tamplate_language_cn_web"),en:n("pc_text_tamplate_language_en_web"),ja:n("pc_text_tamplate_language_jp_web"),ko:n("pc_text_tamplate_language_kr_web")})))},69836:(e,t,i)=>{i.d(t,{ir:()=>v});var r=i(50959),s=i(84875),a=i.n(s),o=i(45599),n=i(82346),l=i(96426),c=i(85083),u=i(88623),p=i(84997),m=i(40699),d=i(96305),g=i(11527);const _=e=>{const{className:t}=e,{t:i}=(0,o.$)(),{handleMouseEnter:r}=(0,p.S)();return(0,g.jsxs)("div",{className:a()(d.Z.root,t),children:[(0,g.jsx)(n.a,{className:d.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,g.jsx)("div",{className:d.Z.text,onMouseEnter:r,children:i("pc_stickers_release_in_web")})]})},S=e=>{const{className:t,tooltip:i}=e,{t:s}=(0,o.$)(),{handleMouseEnter:n}=(0,p.w)({content:i,className:d.Z.tooltip}),c=(0,r.useRef)(null),{setIsMarqueeLoopRunning:u,reactNode:_}=(0,m.J)({text:s("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>c.current});return(0,g.jsxs)("div",{className:a()(d.Z.root,t,d.Z.error),onMouseEnter:e=>{u(!0),n(e)},onMouseLeave:()=>u(!1),children:[(0,g.jsx)(l.r,{className:d.Z.icon}),(0,g.jsx)("div",{ref:c,className:d.Z.text,children:_})]})},f=e=>{const{className:t,text:i}=e,{handleMouseEnter:r}=(0,p.S)();return(0,g.jsxs)("div",{className:a()(d.Z.root,t,d.Z.checked),children:[(0,g.jsx)(u.r,{className:d.Z.icon}),(0,g.jsx)("div",{className:d.Z.text,onMouseEnter:r,children:i})]})},h=e=>{const{className:t}=e,{t:i}=(0,o.$)(),{handleMouseEnter:r}=(0,p.S)();return(0,g.jsxs)("div",{className:a()(d.Z.root,t),children:[(0,g.jsx)("div",{className:a()(d.Z.icon,d.Z.yellowIcon),children:(0,g.jsx)("div",{className:d.Z.yellowPoint})}),(0,g.jsx)("div",{className:d.Z.text,onMouseEnter:r,children:i("pc_stickers_release_editing_web")}),(0,g.jsx)(c.r,{className:d.Z.icon})]})},v=e=>{const{className:t,loading:i,invalid:r,errorToolip:s,isInfoComplete:a,title:o}=e;return i?(0,g.jsx)(_,{className:t}):r?(0,g.jsx)(S,{className:t,tooltip:s}):a?(0,g.jsx)(f,{className:t,text:o}):(0,g.jsx)(h,{className:t})}},67078:(e,t,i)=>{i.d(t,{$X:()=>a,pn:()=>s});var r=i(94435);function s({isVip:e,isBusiness:t,authFiles:i}){var s;const a=null!==(s=null==i?void 0:i.map((({uri:e})=>({uri:e}))))&&void 0!==s?s:[];return{root:{is_vip:!1,copyright:{copyright_info:[{scene:r.$x.Vip,auth_status:e?r.U9.Authorized:r.U9.Unauthorized,third_party_agreements:[]},{scene:r.$x.Business,auth_status:t?r.U9.Authorized:r.U9.Unauthorized,third_party_agreements:t?a:[]}]}},commonData:{is_business:!1,is_original:Boolean(e||t)}}}function a(e,t){return Boolean(null==e?void 0:e.copyright_info.some((e=>e.scene===t&&e.auth_status===r.U9.Authorized)))}},9679:(e,t,i)=>{i.d(t,{$v:()=>u,Ad:()=>m,DV:()=>l,Sj:()=>c,_4:()=>d,ce:()=>p,iL:()=>o,j2:()=>n});var r=i(17095);function s(e){return void 0===e?e:String(Math.round(e/1024))}function a(e){const{material_category:t,material_type:i,collection_detail:r}=e;return{material_category:t,material_type:i,...r&&"collection"===i&&{collection_detail:r}}}function o(e){const{action:t,extra:i={}}=e;(0,r.g)({eventName:"personal_page_material_publish_page_action",params:{action:t,...a(e),...i}})}function n(e){const{error_report:t,upload_status:i,time:o,isCompressed:n,sizeBeforeCompress:l,sizeAfterCompress:c,resolutionBeforeCompress:u,resolutionAfterCompress:p,extra:m={}}=e;(0,r.g)({eventName:"personal_page_material_upload_status",params:{...a(e),error_report:t,upload_status:i,time:o,is_compressed:n?1:0,...n&&{material_size_before_compress:s(l),material_size_after_compress:s(c),material_resolution_before_compress:u,material_resolution_after_compress:p},...m}})}function l(e){const{error_report:t}=e;(0,r.g)({eventName:"personal_page_material_import_error_report",params:{...a(e),error_report:t}})}function c(e){if(0===e.length)return;const t=function(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,i])=>{const r=i||"";t[e]=t[e]?`${t[e]},${r}`:r}))})),t}(e),i=new Set(t.material_type.split(","));1===i.size&&(t.material_type=i.values().next().value),(0,r.g)({eventName:"personal_page_material_publish_error_report",params:t})}function u(e){const{status:t,material_type:i,material_category:a,title:o,description:n,isOriginal:l,tags:c,material_format:u,material_size:p,resolution:m,error_type:d,cover_type:g,time:_,extra:S={},authorize_range:f,isVipAuthorized:h,isBusinessAuthorized:v}=e;return(0,r.g)({eventName:"personal_page_material_publish_status",params:{status:t,material_type:i,material_category:a,material_title:o,material_introduction:n,is_original:l?"1":"0",hashtag:c.join(","),material_format:u,material_size:s(p),resolution:m,authorize_range:f,..."fail"===t&&{error_type:d},cover_type:g,time:_,is_subscription_authorized:h?1:0,is_commercial_authorized:v?1:0,...S}})}function p(e){const{action:t,material_category:i,material_type:s,entry_from:a}=e;return(0,r.g)({eventName:"ugc_material_subscription_original_statment",params:{action:t,material_category:i,material_type:s,entry_from:a}})}function m(e){const{action:t,material_category:i,material_type:s,entry_from:a,hasCopyrightAuthorization:o}=e;return(0,r.g)({eventName:"ugc_material_commercial_original_statment",params:{action:t,material_category:i,material_type:s,entry_from:a,..."boolean"==typeof o&&{has_copyright_authorization:o?"1":"0"}}})}function d(e){const{action:t,page_type:i,material_category:s,material_type:a,button_name:o}=e;return(0,r.g)({eventName:"ugc_material_creator_sign_agreement",params:{action:t,page_type:i,material_category:s,material_type:a,...o&&{button_name:o}}})}},5014:(e,t,i)=>{i.d(t,{BI:()=>p,DefaultImportStickerFileRequest:()=>l,N7:()=>o,Q0:()=>n,R8:()=>s,S8:()=>u,fD:()=>a,mr:()=>c});var r=i(73224);let s=function(e){return e.Static="static",e.GIF="gif",e.Sequence="sequence",e}({}),a=function(e){return e.Format="format",e.MinImageSize="minImageSize",e.RecommendFileSize="RecommendFileSize",e.SequenceNumber="SequenceNumber",e}({});const o={fps:16,loop:!0},n={maxCount:49,minCount:2,minImageSize:360,maxImageSize:1080,maxFileSize:20971520},l={accept:".png,.jpg,.jpeg,.gif",multiple:!0,enableImportSequence:!0,thumbnailSize:200,minImageSize:360,maxImageSize:800,maxFileSize:20971520},c={fps:16,loop:!0,gen_size:0,gif_gen_opts:[{bg_color:"#242424",width:200,height:200,padding:0},{bg_color:"",width:0,height:0,padding:0}]},u=40,p={[s.Static]:{[a.Format]:r.I18n.t("pc_stickers_release_format_web"),[a.MinImageSize]:r.I18n.t("pc_stickers_release_size_min_web"),[a.RecommendFileSize]:r.I18n.t("pc_stickers_release_recommend_web")},[s.GIF]:{[a.Format]:r.I18n.t("pc_stickers_release_format_gif_web"),[a.MinImageSize]:r.I18n.t("pc_stickers_release_size_min_web"),[a.RecommendFileSize]:r.I18n.t("pc_stickers_release_recommend_web")},[s.Sequence]:{[a.Format]:r.I18n.t("pc_stickers_release_png_groups_web_web"),[a.MinImageSize]:r.I18n.t("pc_stickers_release_reccomend_size_web"),[a.SequenceNumber]:r.I18n.t("pc_stickers_release_amount_web"),[a.RecommendFileSize]:r.I18n.t("pc_stickers_release_recommend_web")}}},76252:(e,t,i)=>{i.d(t,{B3:()=>g,Nf:()=>_,WQ:()=>f,w3:()=>S});var r=i(23073),s=i(50959),a=i(61022),o=i(42983),n=i(5014),l=i(86439),c=i(97311),u=i(67078),p=i(17941),m=i(21919),d=i(94435);function g(e){return e.coverSrc||e.firstFrameCoverSrc}function _(e){return e.isSequence&&Boolean(e.isSequenceSettingsUpdating||e.firstFrameCoverSrc&&!e.coverSrc&&!e.isUploadFailed)}function S(e){return e.isSequence||"gif"===(0,c.lm)(e.path)}function f(){const e=(0,a.fv)((()=>({stickers:[],scrollAreaRef:(0,s.createRef)(),get hasStickers(){return this.stickers.length>0},selectedId:null,get selectedSticker(){return e.selectedId?e.getSticker(e.selectedId):null},setScrollAreaRef(t){e.scrollAreaRef=t},addStickers(t){e.stickers.push(...t)},getSticker:t=>{var i;return null!==(i=e.stickers.find((e=>e.id===t)))&&void 0!==i?i:null},selectSticker(t){e.selectedId=t,e.selectedSticker&&(e.selectedSticker.hasEverSelected=!0)},updateThumbnailSrc(e,t){e.isSequence?e.firstFrameCoverSrc=t:e.coverSrc=t},updateUploadedData(e,t,i){if(e.uri=t,!e.isSequence)return e.coverUri=t,void(e.largeImageUri=t);if(i){const{gifCover:t,gifLargeImage:r,stickerPackage:s}=i;e.coverUri=t.uri,e.coverSrc=t.blobUrl,e.largeImageUri=r.uri,e.stickerPackage=s,e.isSequenceSettingsUpdating=!1}},updateUnmetRequirements(e,t){e.unmetRequirements=t,e.hasCheckedRequirements=!0},setUploadFailed(e){e.isUploadFailed=!0,e.isSequenceSettingsUpdating=!1},get isAllStickersThumbnailReady(){return e.stickers.length>0&&e.stickers.every((e=>g(e)))},applyForTags:t=>{e.stickers.forEach((e=>{e.formState.tags=t}))},applyAuthSettingsToAll:({isOriginal:t,isBusiness:i,isVip:r})=>{e.stickers.forEach((e=>{e.formState.isOriginal=Boolean(t),e.formState.isBusiness=Boolean(i),e.formState.isVip=Boolean(r)}))},makeInitFormState:e=>({title:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:!1,...n.N7,sequenceSettingsApplyToAll:!1,...e}),updateFormState(e,t){Object.assign(e.formState,t)},makeInitSticker(t){const{title:i,isInfoComplete:r,formState:s,path:a="",isSequence:o=!1,...u}=t,d=function(e,t){const i=(0,c.lm)(e);if(t)return n.R8.Sequence;if("gif"===i)return n.R8.GIF;if(["png","jpg","jpeg"].includes(i))return n.R8.Static;throw new Error(`Unsupported suffix ${i}`)}(a,o),g=function(e,t){const i=e.split(/[\\/]/g).pop(),r=t?i:i.replace(/\.\w+?$/g,"");return(0,l.aF)(r,n.S8)}(a,o),_=(0,p.K)(m.YW.OriginalForSubscription);return{id:"",path:a,get title(){return this.formState.title},fileType:d,width:0,height:0,isSequence:o,firstFrameCoverSrc:"",coverSrc:"",uri:"",coverUri:"",largeImageUri:"",stickerPackage:{uri:"",md5:"",size:0},sequenceSettings:{fps:0,loop:!1,...t.isSequence&&n.N7},hasEverSelected:!1,get isInfoComplete(){return Boolean(this.title&&this.formState.tags.length>0)},unmetRequirements:[],hasCheckedRequirements:!1,isUploadFailed:!1,isSequenceSettingsUpdating:!1,formState:e.makeInitFormState({title:g,isVip:_}),...u}},reimportSticker(t,i){const r=e.stickers.findIndex((e=>e.id===t));-1!==r&&(e.stickers[r]=i)},startToRetryUploadStickers(t){t.forEach((t=>{const i=e.getSticker(t);i&&(i.isUploadFailed=!1)}))},startToUpdateSequenceSettings(e,t){e.forEach((e=>{e.sequenceSettings=t,e.largeImageUri&&(e.largeImageUri="",e.coverUri="",e.stickerPackage={uri:"",md5:"",size:0},e.isSequenceSettingsUpdating=!0)}))},removeSticker(t){e.stickers=e.stickers.filter((e=>e.id!==t.id))},dragInsert(t,i){const r=e.stickers.splice(t,1),s=t>i?i+1:i;e.stickers.splice(s,0,...r)},get isReadyToPublish(){return e.stickers.every((e=>e.hasCheckedRequirements&&0===e.unmetRequirements.length&&e.isInfoComplete))},get uploadStats(){let t=0,i=0,r=0;return e.stickers.forEach((e=>{if(e.isUploadFailed)return void(i+=1);(e.isSequence?e.largeImageUri:e.uri)?t+=1:r+=1})),{pending:r,succeeded:t,failed:i}},collectLogData:()=>e.stickers.map((e=>({...(0,r.Z)(e,["id","isSequence","isInfoComplete","hasEverSelected","isUploadFailed","uri"]),...e.isSequence&&{isSequenceUpdating:e.isSequenceSettingsUpdating,largeImageUri:e.largeImageUri,...e.sequenceSettings}}))),makePublishItemList:(t={})=>e.stickers.map((e=>{var i;const{id:r,isSequence:s,formState:a,stickerPackage:n}=e,{is_vip:l=Boolean(a.isVip),is_business:c=a.isBusiness,is_original:p=a.isOriginal,sourceForSimple:m=d.r0.UserPostPc,sourceForSequence:g=d.r0.UserPostPcSequence,authFileUploadServiceManager:_,onResult:f}=t,h=s?g:m,v=(0,u.pn)({isVip:l,isBusiness:c,authFiles:null!==(i=null==_?void 0:_.getUploadedFiles(r))&&void 0!==i?i:[]});return{id:r,req:{effect_type:o.Ab.Sticker,is_vip:l,...v.root,common_data:{title:a.title,description:a.title,icon:{image_uri:e.coverUri},sdk_version:"1.0.0",source:h,tags:[...a.tags],is_original:p,is_business:c,web_extra:"",...v.commonData,...s&&{file:{file_uri:n.uri,file_md5:n.md5,size:n.size}}},sticker:{large_image:{image_uri:e.largeImageUri},sticker_type:S(e)?d.Ic.Dynamic:d.Ic.Static,no_multi_sticker:!1,package_size:0}},onResult:t=>null==f?void 0:f(e,t)}}))})));return e}},11610:(e,t,i)=>{i.r(t),i.d(t,{default:()=>se});var r=i(23479),s=i(45599),a=(i(52915),i(68166)),o=i(50959),n=i(38803),l=i(36775),c=i(66589),u=i(61022),p=i(84736),m=i(73224),d=i(42983),g=i(25807),_=i(76252),S=i(97662),f=i(50666),h=i(1110),v=i(54847),k=i(60251),w=i(59787),b=i(82665),y=i(50279),F=i(8129),C=i(2555),I=i(94435);function x(e){return Boolean(e.id)}class M{constructor(){(0,w.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const i of(0,b.Z)(e,10)){const e=await Promise.all(i.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:i,onResult:r,onUpdateResult:s}=e,a=JSON.parse(JSON.stringify(e.req));let o=this.itemMap.get(i);if(null!==(t=o)&&void 0!==t&&t.promise&&(0,y.Z)(o.req,a))try{return await o.promise}catch(n){(0,F.c6)("[MaterialPublishService] publish failed, start to retry",{id:i})}return o={promise:null,id:i,req:a,onResult:r,onUpdateResult:s},this.itemMap.set(i,o),o.promise=this.publishImpl(o),o.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),i=async(i,r)=>{try{const o={error:i,errorText:this.getErrorText(i),time:Math.round(performance.now()-t),resourceId:r};var s,a;if(x(e.req))await(null===(s=e.onUpdateResult)||void 0===s?void 0:s.call(e,{req:e.req,...o}));else await(null===(a=e.onResult)||void 0===a?void 0:a.call(e,{req:e.req,...o}))}catch(o){(0,F.RF)("[MaterialPublishService] callOnResult failed",o)}};let r;try{r=await this.postOrUpdate(e)}catch(s){throw e.promise=null,i(s,""),s}return await i(null,r.resource_id),r}async postOrUpdate(e){return x(e.req)?(await(0,I.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,I.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new C.B).timeout(5e3)])}catch(t){(0,F.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const i=performance.now(),r=new C.B,s={count:50,effect_types:t,uid:g.$.userInfo.uid,cursor:0};for(;performance.now()-i<5e3;){const t=await(0,I.Js)(s).catch((()=>null));if(null!=t&&t.effect_item_list){const i=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>i.has(e))))return}await r.timeout(500)}}}var R=i(49737),U=i(24399),P=i(79668),A=i(57609),L=i(2514),q=i(539),T=i(46309),N=i(3718);var E=i(18370);const z="ImportSticker";function Z(){const e=(0,_.WQ)(),t=(0,S.WQ)({stickerListStore:e}),i=new R.YL({itemType:d.Ab.Sticker}),r=(0,q.G)({watch:()=>a.isAllUploaded}),s=(0,o.useMemo)((()=>new k.l),[]),a=(0,u.fv)((()=>({formApi:null,setFormApi:e=>{a.formApi=e},mainFormLayoutAfterLoading:"uploadArea",get mainFormLayout(){return t.isImportLoading?"loading":"uploadArea"===a.mainFormLayoutAfterLoading&&v.appModel.isInitFailed?"error":a.mainFormLayoutAfterLoading},get maxStickerCount(){return g.$.permissions.includes(g.v.EffectBatchMore)?50:20},get isImportDisabled(){return e.stickers.length>=a.maxStickerCount},stickerListStore:e,importLoadingStore:t,importServ:new h.T({api:new f.r,stickerListStore:e,sendLogServ:i,needSaveSequenceGifUrl:!1}),pubServ:new M,sendLogServ:i,authorSignService:new A.I({signScene:N.d.BusinessArtist}),authFileUploadServiceManager:new L.r({}),performanceTimingCollector:(0,E.uY)(),get field(){return{canOriginal:!0,canBusiness:!1,canVip:!1,canIconBlank:g.$.permissions.includes(g.v.EffectIconBlank),canHighPro:g.$.permissions.includes(g.v.EffectHighPrio),canPackOne:g.$.permissions.includes(g.v.StickerOnePackage)}},get permissions(){return g.$.permissions},getImportMinMaxCount(){const t=e.stickers.length;return{minCount:1,maxCount:Math.max(0,a.maxStickerCount-t),maxTotalCount:a.maxStickerCount}},openStickerFilePicker:()=>s.lock(z,(async()=>{i.sendUploadActionLog(a),await a.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[SingleStore]",when:"openStickerFilePicker"});const e=await a.importServ.openStickerFilePicker(a.getImportMinMaxCount());a.addNewStickers(e)})),uploadDroppedStickerFiles:()=>s.lock(z,(async()=>{i.sendUploadActionLog(a),await a.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[SingleStore]",when:"uploadDroppedStickerFiles"});const e=await a.importServ.uploadDroppedStickerFiles(a.getImportMinMaxCount());a.addNewStickers(e)})),reimportSticker:t=>s.lock(z,(async()=>{await a.importServ.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[SingleStore]",when:"reimportSticker"});const i=await a.importServ.reimportSticker(t,{});if(i){const t=e.getSticker(i);a.selectSticker(t)}})),addNewStickers(i){0!==i.length&&(e.addStickers(i),e.selectSticker(i[0].id),"uploadArea"===a.mainFormLayoutAfterLoading&&(t.showImportLoading(),a.mainFormLayoutAfterLoading="mainForm"))},selectSticker(t){a.saveFormState(),e.selectSticker(t.id)},initFields(e){var t,i;null===(t=a.formApi)||void 0===t||t.reset(),null===(i=a.formApi)||void 0===i||i.setValues({single:{...e.formState,...e.sequenceSettings}})},saveFormState(){var t;const{selectedSticker:i}=e;if(!i)return;const r=e.makeInitFormState({...null===(t=a.formApi)||void 0===t?void 0:t.getValue("single"),...i.sequenceSettings,sequenceSettingsApplyToAll:!1});e.updateFormState(i,r)},saveSequenceSettings(){var t;const{fps:r,loop:s,sequenceSettingsApplyToAll:o}=e.makeInitFormState({...null===(t=a.formApi)||void 0===t?void 0:t.getValue("single")}),n={fps:r,loop:s};a.importServ.updateSequenceSettings({newSettings:n,isApplyToAll:o}),i.sendSaveSequenceSettingsLog({collection_detail:"collection_material",sequenceSettings:{fps:r,loop:s,sequenceSettingsApplyToAll:o}})},get needConfirmModalOnClose(){return e.stickers.length>0},get isAllUploaded(){const{pending:e,failed:t}=a.stickerListStore.uploadStats;return!e&&!t},isAllUploadedWatcher:r,async uploadAndPublish(e){i.sendPageActionLog({action:"publish"}),a.isAllUploaded||(await a.retryUpload(),null==e||e.show(),await a.isAllUploadedWatcher.start());try{await a.publish()}finally{null==e||e.hide()}},get isReadyToPublish(){return e.stickers.length>0&&e.isReadyToPublish&&!a.isPublishSucceeded},collectLogData(){const t=e.collectLogData(),{isReadyToPublish:i,uploadStats:r}=e,s={stickers:t,stickersCount:t.length,stickersReadyToPublish:i,uploadStats:r};(0,F.c6)("[SingleStore] collectLogData",s)},isPublishing:!1,isPublishSucceeded:!1,async publish(){a.isPublishing=!0;try{await a.publishImpl()}catch(e){return(0,F.RF)("[SingleStore] publish failed",e),p.FN.error(m.I18n.t("pc_sticker_release_failed_retry_web")),void(0,c.z)((()=>{a.isPublishing=!1}))}(0,c.z)((()=>{a.isPublishing=!1,a.isPublishSucceeded=!0})),p.FN.success(m.I18n.t("pc_sticker_release_successful_web")),(0,T.ZM)({effect_type:d.Ab.Sticker}),setTimeout((()=>(0,T.Nt)({item_type:d.Ab.Sticker})),1e3)},async publishImpl(){a.saveFormState();const t=e.makePublishItemList({authFileUploadServiceManager:a.authFileUploadServiceManager,onResult:(e,t)=>(0,U.g)({logPrefix:"[SingleStore] ",sticker:e,publishResult:t,importServ:a.importServ,sendLogServ:a.sendLogServ})});(0,F.c6)("[SingleStore] stickers publish start",{ids:t.map((e=>e.id))});const i=(await a.pubServ.batchPublish(t)).map((e=>e.resource_id));(0,F.c6)("[SingleStore] stickers publish done",{resourceIdList:i}),await a.pubServ.pollUntilAllInEffectList({ids:i.slice(-10),types:[d.Ab.Sticker]}),(0,F.c6)("[SingleStore] poll done")},sendUploadProgressModalShowErrorLog(){const e=a.stickerListStore.stickers.filter((e=>e.isUploadFailed)).map((e=>({error_report:a.importServ.getFileStats(e.id).uploadError})));i.sendStickerPublishErrorLog(e)},retryUpload(){return this.importServ.retryUpload([])}})),{formApi:!1});return(0,P.L)({watch:()=>{a.stickerListStore.uploadStats,a.isReadyToPublish},collect:a.collectLogData}),function(e){const t=(0,u.fv)((()=>({get watchResult(){return e.watch()}})));(0,o.useEffect)((()=>{const e=(0,c.EH)((()=>{const e=t.watchResult;(0,T.c0)({isNeed:e})}));return()=>{e()}}),[])}({watch:()=>a.needConfirmModalOnClose}),(0,o.useEffect)((()=>(window.store=a,a.importServ.uploadConfigService.updateCache(),a.authorSignService.init(),a.performanceTimingCollector.addRenderTiming(E.Pk),()=>{t.destroy(),a.importServ.destroy()})),[]),a}const j=(0,o.createContext)(null),K=()=>(0,o.useContext)(j);var O=i(11527);const V=(0,r.Pi)((e=>{const{className:t}=e,i=K(),{t:r}=(0,s.$)(),a=(0,o.useRef)(null);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(n.P,{className:t,leftText:r("pc_sticker_import_zero_to_hundred_web",{X:i.importLoadingStore.isImportLoading?0:i.stickerListStore.stickers.length,Y:i.maxStickerCount}),isPublishDisabled:!i.isReadyToPublish,isPublishing:i.isPublishing,needConfirmModalOnClose:i.needConfirmModalOnClose,onPublish:()=>i.uploadAndPublish(a.current)}),(0,O.jsx)(l.q,{ref:a,uploadStats:i.stickerListStore.uploadStats,onRetryUpload:i.retryUpload,onCancel:i.isAllUploadedWatcher.stop,onShowUploadFail:i.sendUploadProgressModalShowErrorLog,onPromptConfirmToCancel:i.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var B=i(23073),D=i(12390),$=i(67100),H=i(74195),W=i(82725);const Q="stickerList-Tcr1X1",J=(0,r.Pi)((e=>{const{className:t}=e,i=K(),{t:r}=(0,s.$)();return(0,R.pg)(i),(0,D.O)({className:t,layout:i.mainFormLayout,uploadAreaProps:{titleForUploadArea:r("pc_sticker_release_drag_web"),titleForMainForm:r("pc_stickers_release_drag_in_web"),subTitle:r("pc_sticker_release_groups_png_web"),draggingTitle:r("pc_sticker_release_mouse_web"),disabled:i.isImportDisabled,disabledTooltip:r("pc_stickers_release_max_x_web",{X:i.maxStickerCount}),onClick:i.openStickerFilePicker,onDrop:i.uploadDroppedStickerFiles},setFormApi:i.setFormApi,renderImportArea:e=>(0,O.jsxs)(O.Fragment,{children:[e,(0,O.jsx)($.z,{className:Q,importStickerFileService:i.importServ,onSelect:i.selectSticker,onReimport:i.reimportSticker})]}),renderFormArea:()=>{const{selectedSticker:e}=i.stickerListStore;return e&&(0,O.jsx)(H.E,{importStickerFileService:i.importServ,sticker:e,initFields:i.initFields,controlField:i.field,onStartEditSequenceSettings:()=>i.sendLogServ.sendStartEditSequenceSettingsLog({}),authProps:(0,B.Z)(i,"authorSignService","authFileUploadServiceManager","sendLogServ"),onSaveSequenceSettings:i.saveSequenceSettings})},scrollAreaRef:i.importServ.stickerListStore.scrollAreaRef,onRetry:W.cb})}));var X=i(12904),G=i(65546);const Y="page-BXIsLv",ee="content-z8aW2X",te="requirement-FGjxIs",ie="mainForm-qv90fk",re="footer-JhzMqS",se=(0,r.Pi)((()=>{const e=Z(),{t}=(0,s.$)(),{selectedSticker:i}=e.importServ.stickerListStore;return(0,X.F)({title:t("pc_stickers_release_ing_web"),pid:"sticker-publish-single"}),(0,G.d)(),(0,R.t9)(e.sendLogServ),(0,O.jsxs)(j.Provider,{value:e,children:[(0,O.jsxs)("div",{className:Y,children:[(0,O.jsxs)("div",{className:ee,children:[(0,O.jsx)(a.n,{className:te,sticker:i}),(0,O.jsx)(J,{className:ie})]}),(0,O.jsx)(V,{className:re})]}),!1]})}))},97311:(e,t,i)=>{i.d(t,{F2:()=>s,J9:()=>r,lm:()=>a});i(96706);const r=async e=>{const t=await fetch(e);return(e=>URL.createObjectURL(e))(await t.blob())},s=(e,t="")=>`data:${t};base64,${e}`;const a=e=>e.toLowerCase().split(".").pop()},86057:(e,t,i)=>{i.d(t,{Z:()=>r});const r={root:"root-qThJ3Y",point:"point-ytHHVg"}},3731:(e,t,i)=>{i.d(t,{Z:()=>r});const r={menu:"menu-v4m02G",menuItemContainer:"menuItemContainer-K5Eent",menuItem:"menuItem-eU7buP"}}}]);