"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[232],{79668:(e,t,i)=>{i.d(t,{L:()=>l});var s=i(93302),r=i(50959),n=i(66589);const o=5e3;function l({watch:e,collect:t}){const i=(0,r.useMemo)((()=>(0,s.Z)((async()=>{await Promise.resolve(),t()}),o)),[]);(0,r.useEffect)((()=>{const t=(0,n.EH)((()=>{e(),i()}));return()=>{t(),i.cancel()}}),[])}},28442:(e,t,i)=>{i.d(t,{ZP:()=>w});var s=i(50959),r=i(84875),n=i.n(r),o=i(84736),l=i(40625),c=i(4343),a=i(73224),d=i(45599),u=i(84997),p=i(44704);const h="root-ZzVTGw",m="title-JCdnyN",g="titleText-Fuw67p",S="opt-YF2iRW",f="optButton-El1KQ1",k="optPrimaryButton-w8QZPM",v="content-fjkxJu",_="fpsField-n8dui5",y="loopFieldRatioGroup-NJIp0Y",C="edit-w0eg3S",x="globalSettings-fCcYV0";var q=i(11527);const I=[{value:!0,label:a.I18n.t("pc_stickers_release_cycle_start_web")},{value:!1,label:a.I18n.t("pc_stickers_release_one_start_web")}],w=e=>{const{className:t,prefix:i,onStartEdit:r,onSave:a,showGlobalSetting:w}=e,b=(0,o.XQ)(),F=(0,o.tL)(i).value,j=(0,s.useMemo)((()=>{const{fps:e=0,loop:t=!1,sequenceSettingsApplyToAll:i=!1}=F||{};return{fps:e,loop:t,sequenceSettingsApplyToAll:i}}),[null==F?void 0:F.fps,null==F?void 0:F.loop,null==F?void 0:F.sequenceSettingsApplyToAll]),[U,L]=(0,s.useState)(!1),[R,T]=(0,s.useState)(!1),P=(0,s.useRef)(j),{t:E}=(0,d.$)(),A=(0,s.useMemo)((()=>(()=>{const e=[];for(let t=1;t<=49;t++)e.push({label:`${t} FPS`,value:t});return e})()),[]),N=(0,s.useMemo)((()=>U?E("pc_stickers_release_animation_set_web"):`${E("pc_stickers_release_sfps_web",{X:j.fps,Y:j.loop?E("pc_stickers_release_cycle_start_web"):E("pc_stickers_release_one_start_web")})}`),[j,U]),{handleMouseOver:B}=(0,u.S)({checkIsTarget:e=>null!==e.closest(".semi-form-field-label-text, .semi-radio-addon, .semi-checkbox-addon")});return(0,q.jsxs)("div",{className:n()(t,h,{[C]:U}),children:[(0,q.jsxs)("div",{className:m,children:[(0,q.jsx)("div",{className:g,children:N}),(0,q.jsx)("div",{className:S,children:U?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)("span",{className:f,onClick:()=>{b.setValues({[i]:{...F,...P.current}}),L(!1)},children:E("pc_stickers_release_cancel_web")}),(0,q.jsx)("span",{className:k,onClick:()=>{L(!1),a()},children:E("pc_stickers_release_saved_web")})]}):(0,q.jsx)("span",{className:k,onClick:()=>{P.current=j,L(!0),r()},children:E("pc_sticker_edit_web")})})]}),(0,q.jsxs)("div",{className:v,onMouseOver:B,children:[(0,q.jsx)(o.ih,{labelPosition:"left",field:`${i}.fps`,label:E("pc_stickers_release_fps_web"),size:"small",fieldClassName:_,optionList:A,arrowIcon:R?(0,q.jsx)(l.Z,{}):(0,q.jsx)(c.Z,{}),onDropdownVisibleChange:T}),(0,q.jsx)(o.HH,{fieldClassName:n()(y,p.i.heycanFormFieldEllipsis),className:p.i.heycanRatioGroupEllipsis,direction:"vertical",labelPosition:"left",field:`${i}.loop`,label:E("pc_stickers_release_cycle_set_web"),options:I}),(0,q.jsx)("div",{className:x,hidden:!w,children:(0,q.jsx)(o.z8,{labelPosition:"left",field:`${i}.sequenceSettingsApplyToAll`,fieldClassName:p.i.heycanFormFieldEllipsis,className:p.i.heycanCheckboxEllipsis,label:E("pc_stickers_release_settings_web_web"),children:E("pc_stickers_release_apply_all_frames_web")})})]})]})}},68166:(e,t,i)=>{i.d(t,{n:()=>a});var s=i(50959),r=i(45599),n=i(23479),o=i(5014),l=i(9608),c=i(11527);const a=(0,n.Pi)((({className:e,sticker:t})=>{var i,n;const{t:a}=(0,r.$)(),d=e=>Object.entries(o.BI[e]).map((([e,t])=>({key:e,title:t}))),u=(0,s.useMemo)((()=>[{key:o.R8.Static,title:a("pc_stickers_release_png_web"),link:{text:a("pc_stickers_release_template_web"),src:"https://sf16-sg.tiktokcdn.com/obj/eden-sg/lm_shpylaht_cs/ljhwZthlaukjlkulzlp/pc-heycan/downloads/1682576253/sticker%20template.psd"},instructions:d(o.R8.Static)},{key:o.R8.GIF,title:a("pc_stickers_release_gif_details_web"),link:{text:a("pc_stickers_release_template_web"),src:"https://sf16-sg.tiktokcdn.com/obj/eden-sg/lm_shpylaht_cs/ljhwZthlaukjlkulzlp/pc-heycan/downloads/1682576253/sticker%20template.psd"},instructions:d(o.R8.GIF)},{key:o.R8.Sequence,title:a("pc_stickers_release_frame_web_web"),link:{text:a("pc_stickers_release_template_web"),src:"https://sf16-sg.tiktokcdn.com/obj/eden-sg/lm_shpylaht_cs/ljhwZthlaukjlkulzlp/pc-heycan/downloads/1682576253/sticker%20template.psd"},instructions:d(o.R8.Sequence)}]),[]);return(0,c.jsx)(l.v,{className:e,groups:u,initGroup:o.R8.Static,activeGroup:null!==(i=null==t?void 0:t.fileType)&&void 0!==i?i:o.R8.Static,resetExpandedGroupKey:null!==(n=null==t?void 0:t.id)&&void 0!==n?n:null,getStatus:(e,i)=>{var s;return i.key!==(null==t?void 0:t.fileType)?"init":null!=t&&null!==(s=t.unmetRequirements)&&void 0!==s&&s.includes(e.key)?"error":"success"}})}))},74195:(e,t,i)=>{i.d(t,{E:()=>F});var s=i(50959),r=i(23479),n=i(45599),o=i(84736),l=i(42983),c=i(3253),a=i(36983),d=i(28747),u=(i(15443),i(28442)),p=i(63541),h=i(76199),m=i(95471),g=i(76252),S=i(5014),f=i(45033),k=i(53803);const v="root-U7gnG8",_="label-ySJjwQ",y="useAll-fBQS09",C="cover-_hZQ9Q",x="input-cVWAZF",q="advancedSettingsTitle-4hrFUR",I="fpsSettingsField-JVMreK",w="businessCheckbox-C680pV";var b=i(11527);const F=(0,r.Pi)((e=>{const{t}=(0,n.$)(),i=(0,o.XQ)(),{importStickerFileService:r,sticker:F,initFields:j,controlField:U,authProps:L,onStartEditSequenceSettings:R,onSaveSequenceSettings:T}=e,{stickerListStore:P}=r;(0,s.useLayoutEffect)((()=>{j(F)}),[F]);const{getDisplayLength:E}=(0,f._)();return(0,b.jsxs)("div",{className:v,children:[(0,b.jsx)(a.Y,{className:C,src:(0,g.B3)(F),isSelected:!1,isInvalid:F.unmetRequirements.length>0,isUpdating:(0,g.Nf)(F),size:128}),(0,b.jsx)(c.y,{fieldClassName:x,label:t("pc_stickers_release_set_title_web"),field:"single.title",maxLength:S.S8,placeholder:t("pc_stickers_release_xy_name_web",{X:1,Y:E(S.S8)}),rules:[{required:!0,message:""}],onChange:e=>P.updateFormState(F,{title:e})}),(0,b.jsxs)("div",{className:_,children:[(0,b.jsx)(d.u,{fieldClassName:x,label:t("pc_stickers_release_tag_set_web"),placeholder:t("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"single.tags",itemType:l.Ab.Sticker,recommendConfig:{title:F.title,uri:F.largeImageUri},rules:[{required:!0,message:""}],onChange:e=>P.updateFormState(F,{tags:e})}),(0,b.jsx)("span",{className:y,onClick:()=>{var e;null==P||P.applyForTags((null===(e=i.getValue("single"))||void 0===e?void 0:e.tags)||[])},children:t("pc_stickers_release_apply_all_web")})]}),!1,L&&(0,b.jsx)(p.Z,{onClickUseAll:()=>{const e=i.getValue("single");null==P||P.applyAuthSettingsToAll({isOriginal:e.isOriginal,isBusiness:e.isBusiness,isVip:e.isVip})},children:(0,b.jsxs)("div",{className:k.Z.authGroup,children:[(0,b.jsx)(p._,{text:t("pc_template_authorize_range_web")}),(0,b.jsxs)("div",{className:k.Z.right,children:[(0,b.jsx)(h.l,{noLabel:!0,field:"single.isVip",sendLogService:L.sendLogServ}),(0,b.jsx)(m.R,{fieldClassName:w,noLabel:!0,field:"single.isBusiness",vipField:"single.isVip",authorSignService:L.authorSignService,getAuthFileUploadService:()=>L.authFileUploadServiceManager.ensure(F.id),sendLogService:L.sendLogServ})]})]})}),F.isSequence&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:q,children:t("pc_stickers_release_higher_settings_web")}),(0,b.jsx)(u.ZP,{className:I,prefix:"single",showGlobalSetting:!0,onStartEdit:R,onSave:T})]})]})}))},67100:(e,t,i)=>{i.d(t,{M:()=>T,z:()=>P});var s=i(50959),r=i(23479),n=i(84875),o=i.n(n),l=i(26699),c=i(4690),a=i(45599),d=i(36983),u=i(69836),p=i(503),h=i(5014),m=i(76252),g=i(79679);const S="root-xS65kc",f="statusBar-_dfb1Q",k="contextMenuItem-gUXpM3";var v=i(11527);const _=(0,r.Pi)((e=>{const{className:t,sticker:i,isSelected:s,onClick:r,onReimport:n,onRemove:l}=e,{t:c}=(0,a.$)(),_=(0,m.B3)(i),y=i.unmetRequirements.length>0,{handleContextMenu:C}=(0,g.D)({content:(0,v.jsx)(p.m,{items:[{key:"reimport",render:({key:e,className:t})=>y&&(0,v.jsx)("div",{className:o()(t,k),onClick:()=>n(i),children:c("pc_stickers_release_again_web")},e)},{key:"remove",render:({key:e,className:t})=>(0,v.jsx)("div",{className:o()(t,k),onClick:()=>l(i),children:c("pc_stickers_release_delete_web")},e)}]})});return(0,v.jsxs)("div",{className:o()(t,S),onClick:()=>{r(i)},children:[(0,v.jsx)(d.Y,{src:_,isSelected:s,isInvalid:y,isUpdating:(0,m.Nf)(i),size:80,onContextMenu:e=>{C(e),r(i)}}),(0,v.jsx)(u.ir,{className:f,loading:!_,invalid:y,errorToolip:y&&i.unmetRequirements.map((e=>{const t=h.BI[i.fileType][e];return t?(0,v.jsx)("div",{children:t},e):null})),isInfoComplete:i.isInfoComplete,title:i.title})]})}));var y=i(93302),C=i(98205),x=i(28516);const q={cursor:"move"},I=(e,t,i)=>i>e&&i<t,w=({children:e,index:t,id:i,className:r,onMoveCard:n,onHoverCard:o,onCardClick:l,startPoint:c,scrollAreaRef:a,stickerListRect:d,onStickerListRect:u})=>{const p=(0,s.useRef)(null),[{handlerId:h},m]=(0,C.L)({accept:"sticker",collect:e=>({handlerId:e.getHandlerId()})}),g=()=>(new Date).getTime()-c.current.clickTime[0]>T,[{isDragging:S},f]=(0,x.c)({type:"sticker",item:()=>({id:i,index:t}),collect:e=>({isDragging:e.isDragging(),monitor:e}),canDrag:()=>g()});m(f(p));const k=e=>{var i,s;if(!a.current||!p.current)return;if(!g())return;const r=a.current.getBoundingClientRect(),{top:n,bottom:l}=r;if(I(n,n+20,e.clientY)&&a.current.scrollTop>0)return a.current.scrollTop-=2,void o(t,-1);if(I(l-20,l,e.clientY)&&a.current.scrollTop+a.current.clientHeight<a.current.scrollHeight)return a.current.scrollTop+=2,void o(t,-1);const{hoverIndex:u,direction:h}=((e,t)=>{const i=e.findIndex((e=>I(e.left,e.right,t.x)&&I(e.top,e.bottom,t.y)));if(i<0)return{hoverIndex:-1,direction:0};const s=(e[i].right+e[i].left)/2;return{hoverIndex:i,direction:t.x<s?-1:0}})(d,{x:e.clientX+((null===(i=c.current.centerOffset)||void 0===i?void 0:i.x)||0),y:e.clientY+((null===(s=c.current.centerOffset)||void 0===s?void 0:s.y)||0)});o(t,u,h)},_=(0,y.Z)((e=>k(e)),20);return(0,s.useEffect)((()=>{if(p.current){const e=p.current.getBoundingClientRect();null==u||u(t,e)}}),[p.current,u,t]),(0,v.jsx)("div",{draggable:!0,ref:p,className:r,style:{...q,opacity:S?0:1},"data-handler-id":h,onDrag:_,onDragStart:e=>{var i;if(!a.current||!p.current)return;l(t);const s=(null===(i=a.current)||void 0===i?void 0:i.scrollTop)||0,r=p.current.getBoundingClientRect();c.current={x:(null==e?void 0:e.clientX)||-1,y:(null==e?void 0:e.clientY)||-1,start:!0,scrollTop:s,centerOffset:{x:(r.left+r.right)/2-e.clientX,y:(r.top+r.bottom)/2-e.clientY},index:t,clickTime:c.current.clickTime}},onDragEnd:()=>{g()&&n()},children:e})},b="root-bIVz24",F="container-bqVOeD",j="stickerCardDragWrapper-ohlIdQ",U="stickerCard-OqZDu8",L="hover-right-NUTXt8",R="hover-left-mko1D3",T=1e3,P=(0,r.Pi)((e=>{const[t,i]=(0,s.useState)(-1),[r,n]=(0,s.useState)(-1),a=(0,s.useRef)({x:-1,y:-1,start:!1,scrollTop:0,index:-1,clickTime:[-3e3,0]}),d=(0,s.useRef)([]),{className:u,importStickerFileService:p,onSelect:h,onReimport:m}=e,{stickerListStore:g}=p,S=(0,s.useCallback)((e=>{(()=>{const e=Date.now()-a.current.clickTime[0]>T;a.current.clickTime=e?[a.current.clickTime[1],Date.now()]:[a.current.clickTime[0],Date.now()]})(),g.selectedId!==e.id&&h(e)}),[h,a.current]),f=()=>{-1!==t&&(g.dragInsert(a.current.index,t+r),i(-1),a.current={x:-1,y:-1,start:!1,scrollTop:0,index:-1,clickTime:a.current.clickTime})},k=(e,t,s=0)=>{a.current.start&&(i(t),n(s))},y=(e,t)=>{d.current[e]=t};return(0,v.jsx)("div",{className:o()(u,b),children:(0,v.jsx)("div",{className:F,children:(0,v.jsx)(l.W,{backend:c.PD,children:g.stickers.map(((e,i)=>(0,v.jsx)(w,{id:e.id,className:j,index:i,scrollAreaRef:g.scrollAreaRef,startPoint:a,stickerListRect:d.current,onStickerListRect:y,onMoveCard:f,onHoverCard:k,onCardClick:e=>{S(g.stickers[e])},children:(0,v.jsx)(_,{className:o()(U,{[L]:t===i&&0===r,[R]:t===i&&-1===r}),sticker:e,isSelected:g.selectedId===e.id,onClick:S,onReimport:m,onRemove:p.removeSticker})},e.id)))})})})}))},52915:(e,t,i)=>{var s=i(50959),r=i(23479),n=i(84736),o=i(11527);(0,r.Pi)((e=>{const[t,i]=(0,s.useState)(!1);(0,s.useEffect)((()=>{window.showStickerDebugWindow=()=>{var e,t;i(!0),null===(e=window.getSelection())||void 0===e||e.removeAllRanges(),null===(t=window.vconsole)||void 0===t||t.showSwitch()}}),[]);const r=(0,s.useRef)(null),l=window.store;return t?(0,o.jsxs)("div",{style:{position:"fixed",top:10,left:0,bottom:10,width:250,zIndex:2,backgroundColor:"white",padding:8,display:"flex",flexDirection:"column",overflow:"auto",color:"black"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,o.jsx)("div",{children:"\u5bfc\u5165\u7684\u8d34\u7eb8\u72b6\u6001"}),(0,o.jsxs)("div",{style:{display:"flex"},children:[(0,o.jsx)("div",{style:{cursor:"pointer",marginInlineEnd:8},onClick:()=>{var e,t;const i=(null===(e=r.current)||void 0===e?void 0:e.innerText)||"",s=document.createElement("textarea");s.value=i,document.body.append(s),s.select(),document.execCommand("copy"),s.blur(),n.FN.info("\u590d\u5236\u6210\u529f"),null===(t=s.parentNode)||void 0===t||t.removeChild(s)},children:"\u590d\u5236"}),(0,o.jsx)("div",{style:{cursor:"pointer"},onClick:()=>i(!1),children:"\u5173\u95ed"})]})]}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"50px 1fr",rowGap:10,columnGap:8,marginTop:10},ref:r,children:[(0,o.jsx)("div",{children:"\u4e0a\u4f20 stats"}),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{children:["pending:"," ",(l.uploadStats||l.stickerListStore.uploadStats).pending]}),(0,o.jsxs)("div",{children:["succeeded:"," ",(l.uploadStats||l.stickerListStore.uploadStats).succeeded]}),(0,o.jsxs)("div",{children:["failed:"," ",(l.uploadStats||l.stickerListStore.uploadStats).failed]})]}),l.stickersForOnlineImageEditorStats&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:"\u5728\u7ebf\u8bbe\u8ba1 stats"}),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{children:["pending: ",l.stickersForOnlineImageEditorStats.pending]}),(0,o.jsxs)("div",{children:["ready: ",l.stickersForOnlineImageEditorStats.ready]}),(0,o.jsxs)("div",{children:["failed: ",l.stickersForOnlineImageEditorStats.failed]})]})]}),l.collection&&[l.collection.cover,...l.collection.exampleImages].map(((e,t)=>{const{id:i}=e,s=0===t;return[(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsx)("div",{children:t}),(0,o.jsx)("div",{children:s?"\u5c01\u9762\u56fe":"\u793a\u4f8b\u56fe"})]},`collection-${t}-1`),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["id: ",i]}),(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["uri: ",e.uri||"\u4e0a\u4f20\u4e2d..."]}),(0,o.jsxs)("div",{children:["\u7f29\u7565\u56fe: ",e.url?"OK":"\u2757\ufe0f\u65e0"]}),(0,o.jsxs)("div",{children:["isUploadFailed:"," ",e.isUploadFailed?"\u2757\ufe0ftrue - \u4e0a\u4f20\u5931\u8d25":"false"]}),s&&(0,o.jsxs)("div",{children:["needImport:"," ",e.needImport?"\u2757\ufe0ftrue - \u672a\u751f\u6210":"false"+(e.id?"":" - \u2757\ufe0f\u7b49\u5f85\u751f\u6210\u4e2d")]})]},`collection-${t}-2`)]})),l.stickerListStore.stickers.map(((e,t)=>{const{id:i,isSequence:s}=e;return[(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsx)("div",{children:t}),(0,o.jsx)("div",{children:s?"\u5e8f\u5217\u5e27":"\u666e\u901a\u8d34\u7eb8"})]},`${i}-1`),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["id: ",i]}),(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["uri:"," ",e.uri||(e.isUploadFailed?"":"\u4e0a\u4f20\u4e2d...")]}),(0,o.jsxs)("div",{children:["\u7f29\u7565\u56fe:"," ",e.coverSrc||e.firstFrameCoverSrc?"OK"+(e.coverSrc?"":" - \u7b2c\u4e00\u5e27"):"\u2757\ufe0f\u65e0"]}),(0,o.jsxs)("div",{children:["isUploadFailed:"," ",e.isUploadFailed?"true - "+(e.uri?"\u274c\u5e8f\u5217\u5e27 gif \u56fe\u5408\u6210\u5931\u8d25":"\u274c\u4e0a\u4f20\u5931\u8d25"):"false"]}),(0,o.jsxs)("div",{style:{whiteSpace:"nowrap"},children:["unmetRequirements:"," ",e.unmetRequirements.length>0&&"\u274c",e.unmetRequirements.join(", ")||"\u65e0"]}),s&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{children:["largeImgUri:"," ",e.largeImageUri?"OK":"\u2757\ufe0f\u65e0"+(e.isUploadFailed?"":e.uri?" - \u5e8f\u5217\u5e27 gif \u56fe\u5408\u6210\u4e2d...":" - zip \u5305\u4e0a\u4f20\u4e2d...")]}),(0,o.jsxs)("div",{children:["\u5e8f\u5217\u5e27\u91cd\u65b0\u5408\u6210\u4e2d:"," ",e.isSequenceSettingsUpdating?"true":"false"]}),(0,o.jsxs)("div",{children:["\u5e8f\u5217\u5e27\u8bbe\u7f6e: ",e.sequenceSettings.fps,"fps/",e.sequenceSettings.loop?"\u5faa\u73af\u64ad\u653e":"\u5355\u6b21\u64ad\u653e"]})]})]},`${i}-2`)]}))]})]}):null}))},97662:(e,t,i)=>{i.d(t,{WQ:()=>c});var s=i(50959),r=i(66589),n=i(61022),o=i(2555);const l=1e4;function c(e){const{stickerListStore:t}=e,i=(0,n.fv)((()=>({isImportLoading:!1,hideImportLoadingTimer:new o.B,notifyImportLoadingFinish:null,showImportLoading:async()=>{i.isImportLoading=!0,await Promise.race([new Promise((e=>i.notifyImportLoadingFinish=e)),i.hideImportLoadingTimer.timeout(l)]),(0,r.z)((()=>{i.isImportLoading=!1}))},finishImportLoadingFinishIfNeeded:()=>{i.isImportLoading&&i.notifyImportLoadingFinish&&(i.notifyImportLoadingFinish(),i.notifyImportLoadingFinish=null)},destroy:()=>{i.hideImportLoadingTimer.cancel()}})));return(0,s.useEffect)((()=>{const e=(0,r.EH)((()=>{t.isAllStickersThumbnailReady&&i.finishImportLoadingFinishIfNeeded()}));return()=>{e()}}),[]),i}},1110:(e,t,i)=>{i.d(t,{T:()=>v});var s=i(59787),r=i(22310),n=i(82665),o=i(94435),l=i(5014),c=i(97311),a=i(53486),d=i(8129),u=i(2555);function p(){let e;return{promise:new Promise((t=>{e=t})),resolve:e}}class h{constructor(){(0,s.Z)(this,"schedulePromiseCtrl",p()),(0,s.Z)(this,"timer",null),(0,s.Z)(this,"finishPromiseCtrl",p())}schedule(e){var t,i;null===(t=(i=this.schedulePromiseCtrl).resolve)||void 0===t||t.call(i),this.schedulePromiseCtrl.resolve=null,e&&!this.timer&&(this.timer=new u.B,this.timer.timeout(e).then((()=>this.finish())))}scheduled(){return this.schedulePromiseCtrl.promise}finish(){var e,t,i;null===(e=(t=this.finishPromiseCtrl).resolve)||void 0===e||e.call(t),this.finishPromiseCtrl.resolve=null,null===(i=this.timer)||void 0===i||i.cancel()}finished(){return this.finishPromiseCtrl.promise}destroy(){var e;this.schedulePromiseCtrl.resolve=null,this.finishPromiseCtrl.resolve=null,null===(e=this.timer)||void 0===e||e.cancel()}}class m{constructor(e){(0,s.Z)(this,"queue",[]),(0,s.Z)(this,"runningSet",new Set),(0,s.Z)(this,"isStopped",!1),(0,s.Z)(this,"config",void 0),this.config={concurrency:1,timeout:0,...e},this.flushRunningSet()}async add(e){const t=this.createTask();await t.scheduled();try{return await e()}finally{t.finish()}}createTask(){const e=new h;return this.queue.push(e),this.flushRunningSet(),e}async flushRunningSet(){if(!this.isStopped)for(;this.runningSet.size<this.config.concurrency&&this.queue.length;){const e=this.queue.shift();this.runningSet.add(e),e.schedule(this.config.timeout),e.finished().then((()=>{this.runningSet.delete(e),this.flushRunningSet()}))}}destroy(){this.isStopped=!0,this.runningSet.forEach((e=>e.destroy())),this.runningSet.clear(),this.queue.splice(0,this.queue.length)}}var g=i(62262),S=i(58546),f=i(39486),k=i(66564);class v{constructor(e){this.props=e,(0,s.Z)(this,"unregisterStickerFileProcessResultEvent",void 0),(0,s.Z)(this,"fileEventDispatcher",new S.r({initData:()=>({stats:{isCompressed:!1,resolutionBeforeCompress:"",resolutionAfterCompress:"",sizeBeforeCompress:0,sizeAfterCompress:0,uploadStartAt:0,uploadTime:0,uploadError:""}})})),(0,s.Z)(this,"uploadConfigService",new f.w),(0,s.Z)(this,"checkIsSequenceToGifLocallyEnabled",(0,r.Z)((async()=>{const e=await(0,k.G)("sequence_to_gif_locally",["enabled"]);return(0,d.c6)("[ImportStickerFileService] getSettings sequence_to_gif_locally",{result:e}),"true"===e.enabled}))),(0,s.Z)(this,"removeSticker",(e=>{this.cleanupStickerInfo(e),this.stickerListStore.removeSticker(e)})),(0,s.Z)(this,"sequenceInfoMap",new Map),(0,s.Z)(this,"genSequenceStickerQueue",new m({concurrency:1})),(0,s.Z)(this,"genSequenceStickerLocallyQueue",new m({concurrency:4})),this.unregisterStickerFileProcessResultEvent=this.props.api.registerStickerFileProcessResultEvent((e=>this.fileEventDispatcher.dispatch(e))),this.checkIsSequenceToGifLocallyEnabled()}get stickerListStore(){return this.props.stickerListStore}get sendLogServ(){return this.props.sendLogServ}async getUploadConfigs(e){const{imageUploadConfig:t,objectUploadConfig:i}=await this.uploadConfigService.getUploadConfigs(e);return{imageUploadConfig:t,objectUploadConfig:i}}async getOpenStickerFilePickerRequest(e){return{...await this.getUploadConfigs("OpenStickerFilePicker"),...l.DefaultImportStickerFileRequest,sequence:{...l.Q0},needCheckStaticDynamicMix:!1,hasImportedType:"",...e}}async openStickerFilePicker(e){const t=await this.getOpenStickerFilePickerRequest(e),i=await this.props.api.openStickerFilePicker(t),s=this.ensureMaxImageCount(t,i);return this.initStickers(s)}async uploadDroppedStickerFiles(e){const t=await this.getOpenStickerFilePickerRequest(e),i=await this.props.api.uploadDroppedStickerFiles(t),s=this.ensureMaxImageCount(t,i);return this.initStickers(s)}ensureMaxImageCount(e,t){const{maxCount:i}=e,{images:s,...r}=t;return s.length>i&&(0,d.RF)("[ImportStickerFileService] jsb resp images.length > maxCount",null,{imagesCount:s.length,maxCount:i}),{...r,images:s.slice(0,i)}}getFileStats(e){return this.fileEventDispatcher.ensureFile(e).data.stats}registerThumbnailEvent(e,t){this.fileEventDispatcher.register("Thumbnail",e,t)}registerUploadEvent(e,t){this.fileEventDispatcher.register("Upload",e,((e,i)=>{const{uri:s,error:r,isCompressed:n,resolutionBeforeCompress:o,resolutionAfterCompress:l,sizeBeforeCompress:c,sizeAfterCompress:a}=e;i.data.stats={...i.data.stats,isCompressed:n,resolutionBeforeCompress:o,resolutionAfterCompress:l,sizeBeforeCompress:c,sizeAfterCompress:a,uploadError:s?"":r},t(e)}))}initStickers(e){const{isSequenceImport:t,images:i}=e,s=[];for(const r of i){const{id:e,path:i,width:n,height:o}=r;s.push(this.stickerListStore.makeInitSticker({id:e,path:i,width:n,height:o,isSequence:t})),this.recordFileUploadStart(e),this.registerThumbnailEvent(e,(async t=>{const i=this.stickerListStore.getSticker(e);if(!i)return void(0,d.RF)(`[ImportStickerFileService] sticker thumbnail ignored {${e}}`);if(!t.base64)return void(0,d.RF)(`[ImportStickerFileService] sticker thumbnail failed {${e}}`);const s=(0,c.F2)(t.base64),r=await(0,c.J9)(s).catch((()=>s));this.stickerListStore.updateThumbnailSrc(i,r),this.checkRequirements(i)})),this.registerUploadEvent(e,(t=>{const i=this.stickerListStore.getSticker(e);if(!i)return void(0,d.RF)(`[ImportStickerFileService] sticker upload ignored {${e}}`);const{uri:s}=t;if(!s){const s=t.error||"unknown";return this.handleStickerUploadEnd(i,s),void(0,d.RF)(`[ImportStickerFileService] sticker upload failed {${e}}`,null,{error:s,isSequence:i.isSequence})}this.stickerListStore.updateUploadedData(i,s),i.isSequence?this.generateSequenceSticker(i):this.handleStickerUploadEnd(i),(0,d.c6)(`[ImportStickerFileService] sticker upload success {${e}}`,{uri:s,isSequence:i.isSequence})}))}return s}recordFileUploadStart(e){const{stats:t}=this.fileEventDispatcher.ensureFile(e).data;t.uploadStartAt=performance.now(),t.uploadTime=0,t.uploadError=""}recordFileUploadEnd(e,t){var i;const s=null===(i=this.fileEventDispatcher.getFile(e))||void 0===i?void 0:i.data;if(!s||0!==s.stats.uploadTime)return;const{stats:r}=s;r.uploadTime=Math.round(performance.now()-r.uploadStartAt),"string"==typeof t&&(r.uploadError=t)}handleStickerUploadEnd(e,t){"string"==typeof t&&this.stickerListStore.setUploadFailed(e),this.recordFileUploadEnd(e.id,t),this.sendLogServ.sendStickerUploadStatusLog({sticker:e,stats:this.getFileStats(e.id)})}revokeBlobUrlIfNeeded(e){null!=e&&e.startsWith("blob:")&&URL.revokeObjectURL(e)}cleanupStickerInfo(e){const{id:t}=e;this.revokeBlobUrlIfNeeded(e.firstFrameCoverSrc),this.revokeBlobUrlIfNeeded(e.coverSrc),this.sequenceInfoMap.forEach(((e,i)=>{if(e.id!==t)return;this.sequenceInfoMap.delete(i);const s=e.cache.getSync();this.revokeBlobUrlIfNeeded(null==s?void 0:s.gifCover.blobUrl)})),this.removeFile(t)}removeFile(e){this.fileEventDispatcher.removeFile(e)}getSequenceInfoKey(e){const{id:t,sequenceSettings:{fps:i,loop:s}}=e;return`${t}-${i}-${s}`}getStickerWithSameSequenceSettings(e,t){const i=this.stickerListStore.getSticker(e),s=null==i?void 0:i.sequenceSettings;return s&&s.fps===t.fps&&s.loop===t.loop?i:null}async generateSequenceSticker(e){const{id:t,sequenceSettings:{fps:i,loop:s}}=e,r=this.getSequenceInfoKey(e),n=this.sequenceInfoMap.get(r);if(n)try{const i=await n.cache.get();return(0,d.c6)(`[ImportStickerFileService] get sequenceInfo cache success {${t}}`,{key:r}),this.updateSequenceStickerInfo(e,i)}catch(p){(0,d.RF)(`[ImportStickerFileService] update sequenceInfo cache failed {${t}}`,p,{key:r});const e=this.getStickerWithSameSequenceSettings(t,{fps:i,loop:s});return void(e&&this.handleStickerUploadEnd(e,"update sequenceInfo cache failed"))}let o=null,l=null;try{const t=await this.generateSequenceStickerImpl(e);t&&({sequenceStickerInfo:o,resp:l}=t)}catch(p){(0,d.RF)(`[ImportStickerFileService] genSequenceSticker failed {${t}}`,p,{key:r,resp:l});const e=this.getStickerWithSameSequenceSettings(t,{fps:i,loop:s});return void(e&&this.handleStickerUploadEnd(e,"genSequenceSticker failed"))}if(!o)return void(0,d.c6)(`[ImportStickerFileService] generateSequenceSticker canceled {${t}}`,{key:r});const c=this.getStickerWithSameSequenceSettings(t,{fps:i,loop:s});if(!c)return;const a=this.initSequenceInfoCache(o);this.sequenceInfoMap.set(r,{id:t,cache:a});const u=!c.isSequenceSettingsUpdating;await this.updateSequenceStickerInfo(c,o),u&&this.handleStickerUploadEnd(c),(0,d.c6)(`[ImportStickerFileService] genSequenceSticker success {${t}}`,{key:r,isFirstTime:u,resp:l})}async generateSequenceStickerImpl(e){const{id:t,uri:i,sequenceSettings:{fps:s,loop:r}}=e;if(await this.checkIsSequenceToGifLocallyEnabled()){const{imageUploadConfig:e}=await this.getUploadConfigs("GenerateSequenceSticker"),{gif_gen_opts:n,...a}=l.mr,[d,u]=await this.genSequenceStickerLocallyQueue.add((()=>Promise.all([(0,o.PU)({...a,file_uri:i,fps:s,loop:r}),this.props.api.sequenceToGif({id:t,...a,fps:s,loop:r,gifs:n.map(((e,t)=>({bgColor:e.bg_color,width:e.width,height:e.height,needBase64:0===t}))),imageUploadConfig:e})])));if(u.isCanceled)return null;if(u.error)throw new g.w(`sequenceToGif error - ${u.error||"unknown"}`,{});const{file_uri:p,file_md5:h,file_size:m}=d,[S,f]=u.gifs,k=(0,c.F2)(S.base64),v=await(0,c.J9)(k);return{sequenceStickerInfo:{gifCover:{uri:S.uri,url:k,blobUrl:v},gifLargeImage:{uri:f.uri,url:"",blobUrl:""},stickerPackage:{uri:p,md5:h,size:m}},resp:d}}const n=await this.genSequenceStickerQueue.add((()=>(0,o.PU)({...l.mr,file_uri:i,fps:s,loop:r}))),a=await(0,c.J9)(n.gif_infos[0].url),{gif_infos:d,file_uri:u,file_md5:p,file_size:h}=n,[m,S]=d;return{sequenceStickerInfo:{gifCover:{...m,blobUrl:a},gifLargeImage:{...S,blobUrl:""},stickerPackage:{uri:u,md5:p,size:h}},resp:n}}async updateSequenceStickerInfo(e,t){const{id:i,uri:s,sequenceSettings:{fps:r,loop:n}}=e,{gifCover:o,gifLargeImage:l}=t;this.props.needSaveSequenceGifUrl&&!await this.checkIsSequenceToGifLocallyEnabled()&&await this.props.api.saveSequenceGifUrl({id:i,url:l.url,coverUrl:o.url,fps:r,loop:n}),this.stickerListStore.updateUploadedData(e,s,t)}initSequenceInfoCache(e){const t=()=>{const e=Date.now();return{expireTime:e+72e5,refreshTime:e,silentRefreshTime:e+6e5}},i=new a.C({initCacheData:{data:e,...t()},refresh:async()=>{var s;if(await this.checkIsSequenceToGifLocallyEnabled())return{data:{...e},...t()};const{gifCoverUrl:r,gifLargeImageUrl:n}=await this.refreshStickerSequenceUrls(e),o=null!==(s=i.getSync())&&void 0!==s?s:e;return{data:{...o,gifCover:{...o.gifCover,url:r},gifLargeImage:{...o.gifLargeImage,url:n}},...t()}}});return i}async refreshStickerSequenceUrls(e){const{gifCover:t,gifLargeImage:i}=e,{uri_to_url:s}=await(0,o.nz)({uri_infos:[{uri:t.uri,width:0,height:0,format:"image"},{uri:i.uri,width:0,height:0,format:"image"}]}),r=[],n=null==s?void 0:s[t.uri];n||r.push(`cover-${t.uri}`);const l=null==s?void 0:s[i.uri];if(l||r.push(`largeImage-${i.uri}`),!n||!l)throw new Error(`Failed to get url for ${r.join(", ")}`);return{gifCoverUrl:n,gifLargeImageUrl:l}}async checkRequirements(e){if(e.isSequence)return void this.stickerListStore.updateUnmetRequirements(e,[]);const t=[],{minImageSize:i}=l.DefaultImportStickerFileRequest;(e.width<i||e.height<i)&&t.push(l.fD.MinImageSize),this.stickerListStore.updateUnmetRequirements(e,t)}async reimportSticker(e,t){const i=await this.getOpenStickerFilePickerRequest({minCount:1,maxCount:1,maxTotalCount:1,...t}),s=await this.props.api.openStickerFilePicker({...i,multiple:!1}),r=this.initStickers(s);if(0===r.length)return null;const[n]=r;return this.cleanupStickerInfo(e),this.stickerListStore.reimportSticker(e.id,n),n.id}async retryUpload(e){return this.retryUploadStickersIfNeeded(this.stickerListStore.stickers,e)}async retryUploadStickersIfNeeded(e,t){const i=[],s=[];return e.forEach((e=>{!e.isUploadFailed||e.unmetRequirements.length>0||(e.isSequence&&e.uri?s.push(e):i.push(e))})),this.retryGenerateSequence(s),this.retryUploadFile(i,t)}async retryUploadFile(e,t){const i=e.map((e=>e.id)),s=[...i,...t];if(!s.length)return;let r;try{r=await this.getOpenStickerFilePickerRequest({minCount:1,maxCount:s.length,maxTotalCount:s.length})}catch(n){throw(0,d.RF)("[ImportStickerFileService] retryUploadFile get request failed",n,{retryUploadIds:s}),n}this.props.stickerListStore.startToRetryUploadStickers(i),s.forEach((e=>this.recordFileUploadStart(e))),this.props.api.openStickerFilePicker({...r,retryUploadIds:s}),(0,d.c6)("[ImportStickerFileService] retryUploadFile start",{retryUploadIds:s})}retryGenerateSequence(e){const t=e.map((e=>e.id));t.length&&(this.stickerListStore.startToRetryUploadStickers(t),t.forEach((e=>this.recordFileUploadStart(e))),this.batchGenerateSequenceSticker(e),(0,d.c6)("[ImportStickerFileService] retryGenerateSequence start",{stickerIds:t}))}updateSequenceSettings(e){const{newSettings:t,isApplyToAll:i}=e;let s=[];if(i)s=this.stickerListStore.stickers.filter((e=>e.isSequence));else{if(!this.stickerListStore.selectedSticker)return;s=[this.stickerListStore.selectedSticker]}const r=s.filter((e=>e.isUploadFailed||e.sequenceSettings.fps!==t.fps||e.sequenceSettings.loop!==t.loop));if(0===r.length)return;this.stickerListStore.startToUpdateSequenceSettings(r,t);const n=r.filter((e=>!e.isUploadFailed&&e.uri)),o=r.filter((e=>e.isUploadFailed));this.batchGenerateSequenceSticker(n),this.retryUploadStickersIfNeeded(o,[])}async batchGenerateSequenceSticker(e){for(const i of(0,n.Z)(e,10))try{await Promise.all(i.map((e=>this.generateSequenceSticker(e))))}catch(t){(0,d.RF)("[ImportStickerFileService] batchGenerateSequenceSticker failed",t,{stickers:i.map((e=>e.id))})}}async generateCollectionCover(e){const{collectionId:t}=e,i=await this.getUploadConfigs("generateCollectionCover"),s=e.stickers.map((e=>({id:e.id,...e.sequenceSettings})));(0,d.c6)("[ImportStickerFileService] generateCollectionCover start",{collectionId:t,stickers:s});const{id:r}=await this.props.api.generateStickerCollectionCoverImage({...i,collectionId:t,stickers:s});return r}async openStickerOnlineImageEditor(e){const{stickers:t,...i}=e,s=await this.getUploadConfigs("openStickerOnlineImageEditor"),{id:r}=await this.props.api.openStickerOnlineImageEditor({...i,...s,stickers:t.map((e=>({id:e.id,...e.sequenceSettings})))});return r}async localUploadImage(e){const t=await this.getOpenStickerFilePickerRequest({...e,minCount:1,maxCount:1,maxTotalCount:1}),{images:i}=await this.props.api.openStickerFilePicker({...t,multiple:!1,enableImportSequence:!1});return 0===i.length?null:i[0]}destroy(){this.unregisterStickerFileProcessResultEvent(),this.genSequenceStickerQueue.destroy(),this.genSequenceStickerLocallyQueue.destroy()}}},50666:(e,t,i)=>{i.d(t,{r:()=>l});var s=i(23073),r=i(93639),n=i(98052);var o=i(8129);class l{getJSBRequest(e){const t=e.accept.split(",").map((e=>e.trim().replace(/^\./g,""))).join("-");return{...e,accept:t}}async openStickerFilePicker(e){var t;const i=this.getJSBRequest(e);(0,o.c6)("[JSB] openStickerFilePicker req --\x3e",{...(0,r.Z)(i,["objectUploadConfig","imageUploadConfig","sequence"])});const s=await(e=>n.Jn.call("openStickerFilePicker",e))(i);return(0,o.c6)("[JSB] openStickerFilePicker resp <--",{isSequenceImport:null==s?void 0:s.isSequenceImport,imagesCount:null==s||null===(t=s.images)||void 0===t?void 0:t.length}),s}async uploadDroppedStickerFiles(e){var t;const i=this.getJSBRequest(e);(0,o.c6)("[JSB] uploadDroppedStickerFiles req --\x3e",{...(0,r.Z)(i,["objectUploadConfig","imageUploadConfig","sequence"])});const s=await(e=>n.Jn.call("uploadDroppedStickerFiles",e))(i);return(0,o.c6)("[JSB] uploadDroppedStickerFiles resp <--",{isSequenceImport:null==s?void 0:s.isSequenceImport,imagesCount:null==s||null===(t=s.images)||void 0===t?void 0:t.length}),s}registerStickerFileProcessResultEvent(e){return(e=>{const t=t=>{t.data&&e(t.data)};return n.Jn.on("StickerFileProcessResult",t),()=>n.Jn.off("StickerFileProcessResult",t)})((t=>{(0,o.c6)(`[JSB] StickerFileProcessResult ${null==t?void 0:t.type} {${null==t?void 0:t.id}}`,{...(0,s.Z)(t,["result","uri","error"])}),e(t)}))}async saveSequenceGifUrl(e){try{return(0,o.c6)(`[JSB] saveSequenceGifUrl {${e.id}}`),await(e=>n.Jn.call("saveSequenceGifUrl",e))(e)}catch{return}}async generateStickerCollectionCoverImage(e){(0,o.c6)("[JSB] generateStickerCollectionCoverImage req --\x3e",{...(0,r.Z)(e,["objectUploadConfig","imageUploadConfig"])});const t=await(e=>n.Jn.call("generateStickerCollectionCoverImage",e))(e);return(0,o.c6)("[JSB] generateStickerCollectionCoverImage resp <--",t),t}async openStickerOnlineImageEditor(e){(0,o.c6)("[JSB] openStickerOnlineImageEditor req --\x3e",{...(0,r.Z)(e,["objectUploadConfig","imageUploadConfig"])});const t=await(e=>n.Jn.call("openStickerOnlineImageEditor",e))(e);return(0,o.c6)("[JSB] openStickerOnlineImageEditor resp <--",t),t}async sequenceToGif(e){var t;(0,o.c6)("[JSB] sequenceToGif req --\x3e",{...(0,r.Z)(e,["imageUploadConfig"])});const i=await(e=>(0,n.mu)("sequenceToGif",{...e,timeout_ms:6e5}))(e);return(0,o.c6)("[JSB] sequenceToGif resp <--",{gifs:null===(t=i.gifs)||void 0===t?void 0:t.map((e=>{var t;return{uri:e.uri,base64Length:null===(t=e.base64)||void 0===t?void 0:t.length}})),isCanceled:i.isCanceled,error:i.error}),i}}},49737:(e,t,i)=>{i.d(t,{YL:()=>u,pg:()=>h,t9:()=>p});var s=i(59787),r=i(50959),n=i(76252),o=i(9679),l=i(42983),c=i(97311),a=i(67078),d=i(94435);class u{constructor(e){(0,s.Z)(this,"materialTypeParams",{material_category:"",material_type:""}),(0,s.Z)(this,"isCollection",!1),this.isCollection=e.itemType===l.Ab.StickerCollection,this.materialTypeParams={material_category:"sticker",material_type:this.isCollection?"collection":"single"}}sendPageActionLog(e){(0,o.iL)({...this.materialTypeParams,...e,...this.isCollection&&{collection_detail:e.collection_detail||"collection_all"}})}sendUploadActionLog(e){const{mainFormLayout:t}=e,i="mainForm"===t?"upload_more":"sticker_upload";this.sendPageActionLog({action:i})}sendStartEditSequenceSettingsLog(e){const{collection_detail:t}=e;this.sendPageActionLog({action:"animation_edit",collection_detail:t})}sendSaveSequenceSettingsLog(e){const{collection_detail:t,sequenceSettings:i}=e;this.sendPageActionLog({action:"animation_edit_save",collection_detail:t,extra:{...i&&{animation_cycle_detail:i.loop?"repeat":"once",animation_fps_detail:String(i.fps),animation_is_applied_to_all:i.sequenceSettingsApplyToAll?"1":"0"}}})}sendStickerUploadStatusLog(e){const{sticker:t,stats:i}=e,{isSequence:s,isUploadFailed:r}=t,n=s&&r&&t.uri&&"sequencial_material_failed",l=!r&&t.largeImageUri&&"success",{isCompressed:c,resolutionBeforeCompress:a,resolutionAfterCompress:d,sizeBeforeCompress:u,sizeAfterCompress:p,uploadTime:h,uploadError:m}=i;(0,o.j2)({...this.materialTypeParams,...this.isCollection&&{collection_detail:"collection_material"},error_report:m,upload_status:n||l||"fail",time:h,isCompressed:c,resolutionBeforeCompress:a,resolutionAfterCompress:d,sizeBeforeCompress:u,sizeAfterCompress:p,extra:{...void 0!==s&&{is_sequential:s?1:0}}})}sendCollectionUploadStatusLog(e){const{cover:t,exampleImage:i,stats:s}=e,{isUploadFailed:r}=t||i,{isCompressed:n,resolutionBeforeCompress:l,resolutionAfterCompress:c,sizeBeforeCompress:a,sizeAfterCompress:d,uploadTime:u,uploadError:p}=s;(0,o.j2)({...this.materialTypeParams,collection_detail:t?"collection_cover":"collection_sample",error_report:p,upload_status:r?"fail":"success",time:u,isCompressed:n,resolutionBeforeCompress:l,resolutionAfterCompress:c,sizeBeforeCompress:a,sizeAfterCompress:d})}sendStickerImportErrorLog(e){return(0,o.DV)({...this.materialTypeParams,...e})}sendStickerPublishErrorLog(e){return(0,o.Sj)(e.map((e=>({...this.materialTypeParams,...e}))))}sendStickerPublishStatusLog(e){const{stickerParams:t,collectionParams:i,error:s,time:r}=e,l=s?"fail":"success",u=[];if((null!=t&&t.stickerReqItem.common_data.is_business||null!=i&&i.collectionReqItem.common_data.is_business)&&u.push("business"),(null!=t&&t.stickerReqItem.is_vip||null!=i&&i.collectionReqItem.is_vip)&&u.push("subscribe"),t){const{sticker:e,stickerReqItem:i,stats:p}=t,{common_data:h,copyright:m}=i,{isSequence:g,sequenceSettings:S,path:f}=e;return(0,o.$v)({status:l,material_category:this.materialTypeParams.material_category,material_type:"single",title:h.title,isOriginal:h.is_original||!1,tags:h.tags||[],material_format:g?"zip":(0,c.lm)(f),material_size:p.sizeAfterCompress,resolution:p.resolutionAfterCompress,error_type:s,time:r,authorize_range:u.join(","),isVipAuthorized:(0,a.$X)(i.copyright,d.$x.Vip),isBusinessAuthorized:(0,a.$X)(i.copyright,d.$x.Business),extra:{sticker_type:(0,n.w3)(e)?"gif":"png",sticker_animation:g?"1":"0",...g&&{animation_cycle_detail:S.loop?"repeat":"once",animation_fps_detail:String(S.fps)}}})}{const{collection:e,collectionReqItem:t}=i,{common_data:n}=t;return(0,o.$v)({status:l,...this.materialTypeParams,title:n.title,description:n.description||"",isOriginal:n.is_original||!1,tags:n.tags||[],error_type:s,cover_type:e.cover.generatedFrom,time:r,authorize_range:u.join(","),isVipAuthorized:(0,a.$X)(t.copyright,d.$x.Vip),isBusinessAuthorized:(0,a.$X)(t.copyright,d.$x.Business),extra:{sticker_animation:"0"}})}}sendClickSubscriptionCheckboxLog(e){this.sendPageActionLog({action:e?"check_box_subscription":"cancel_check_box_subscription"})}sendSubscriptionStatementLog(e){(0,o.ce)({...this.materialTypeParams,...e})}sendClickCommercialCheckboxLog(e){this.sendPageActionLog({action:e?"check_box_commercial":"cancel_check_box_commercial"})}sendCommercialStatementLog(e){(0,o.Ad)({...this.materialTypeParams,...e})}sendAuthorSignLog(e){(0,o._4)({...this.materialTypeParams,...e})}}function p(e){(0,r.useEffect)((()=>{e.sendPageActionLog({action:"upload_page_show"})}),[])}function h(e){const{mainFormLayout:t,sendLogServ:i}=e;(0,r.useEffect)((()=>{"mainForm"===t&&i.sendPageActionLog({action:"detail_page_show"})}),[t])}},24399:(e,t,i)=>{i.d(t,{g:()=>r});var s=i(8129);function r(e){const{logPrefix:t,sticker:i,publishResult:r,sendLogServ:n,importServ:o}=e,{req:l,error:c,errorText:a,time:d,resourceId:u}=r;n.sendStickerPublishStatusLog({error:a,time:d,stickerParams:{sticker:i,stickerReqItem:l,stats:o.getFileStats(i.id)}});const{id:p}=i;c?(0,s.RF)(`${t} sticker publish failed`,c,{id:p}):(0,s.c6)(`${t} sticker publish success`,{id:p,resourceId:u})}},74235:(e,t,i)=>{i.d(t,{xB:()=>s});function s(e){const{len:t,i18n:i}=e,[s]=(i.language||"").split("-");return"zh"===s?Math.floor(t/2):t}}}]);