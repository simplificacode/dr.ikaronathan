"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[639],{28747:(e,t,n)=>{n.d(t,{u:()=>R});var l=n(50959),r=n(10422),i=n(84736),s=n(26800),c=n(68277),a=n(45599),o=n(23479),u=n(25807),d=n(69905),p=n(60251),m=n(8129),f=n(86439),g=n(94435),v=n(16743),_=n(84875),h=n.n(_);const b="tag-ZaY7YS",x="selected-umR1Vs",w="disabled-A37DzB";var C=n(11527);const T=({className:e,value:t,selected:n,disabled:l,onClick:r})=>(0,C.jsx)(i.Vp,{className:h()(e,b,n&&x,l&&w),color:n?"cyan":void 0,onClick:()=>null==r?void 0:r(t),children:t},t),k="block-smxiey",E="title-aqS4Cg",S="content-IyBLdN",y="loading-QuFv_G",Z="text-ukrQOj",j=({className:e,title:t,loading:n,loadingText:r,value:s,options:c,onSelect:a})=>{const o=(0,l.useCallback)((e=>s.includes(e)),[s]),u=(0,l.useMemo)((()=>c.filter((e=>!s.includes(e)))),[s,c]);return 0===u.length?null:(0,C.jsxs)("div",{className:h()([k,e]),children:[(0,C.jsx)("p",{className:E,children:t}),(0,C.jsx)("div",{className:S,children:n?(0,C.jsxs)("div",{className:y,children:[(0,C.jsx)("span",{className:Z,children:r}),(0,C.jsx)(i.yC,{size:"small"})]}):u.map((e=>(0,C.jsx)(T,{selected:o(e),value:e,onClick:()=>a(e)},e)))})]})},N=(0,o.Pi)((({value:e,onSelect:t})=>{const[n,r]=(0,l.useState)([]),{t:i}=(0,a.$)();return(0,l.useEffect)((()=>{const e=(0,d.cF)(d.Qt.TagEachUser,u.$.userInfo.uid).get();r(e)}),[u.$.userInfo.uid,e]),(0,C.jsx)(j,{title:i("pc_recently_used_web"),value:e,options:n,onSelect:t})})),F=((0,o.Pi)((({title:e,uri:t,value:n,itemType:r,onSelect:i})=>{const[o,u]=(0,l.useState)([]),[d,p]=(0,l.useState)([]),[m,f]=(0,l.useState)(!1),v=(0,l.useRef)({}),{t:_}=(0,a.$)(),h=(0,l.useMemo)((()=>[...d,...o]),[o,d]),b=(0,s.Z)((e=>{const{title:t,uri:n}=e;return t?v.current.cvid&&v.current.uri===n?{cvid:v.current.cvid,title:t}:n?{image_uri:n,title:t}:null:null})),x=(0,l.useCallback)((async()=>{try{f(!0);const n=b({title:e,uri:t});await Promise.all([n&&(0,g.Uz)(n).then((e=>{p(e.cv_tags),v.current.cvid=e.cvid,n.image_uri&&(v.current.uri=n.image_uri)})),!v.current.selfConfigTagsReady&&(0,g.On)({effect_type:r}).then((e=>{u(e.rec_tags),v.current.selfConfigTagsReady=!0}))])}finally{f(!1)}}),[e,t,r]);return(0,c.Z)(x,500,[x]),(0,l.useEffect)((()=>{x()}),[]),(0,C.jsx)(j,{title:_("recommend_signature_web"),loading:m,loadingText:_("loading_web"),value:n,options:h,onSelect:i})})),"tagSelect-KEPqcU"),I="dropItem-bpnHuZ",L="suggestListDropdown-fV0lMc",M=(0,o.Pi)((({recommendConfig:e,value:t=[],itemType:n,disabled:o,disableRecommend:_,disableLatest:h,onChange:b,placeholder:x,max:w=15,temporaryId:k,ignoreAddTagOnBlurSelector:E})=>{const S=(0,l.useRef)(!1),[y,Z]=(0,l.useState)(""),[j,M]=(0,l.useState)(""),R=(0,l.useRef)(!1),A=R.current?j:y,[P,$]=(0,l.useState)([]),[V,B]=(0,l.useState)([]),{t:D}=(0,a.$)(),W=e=>(0,d.cF)(d.Qt.TagEachUser,u.$.userInfo.uid).set("add",[e]),q=(0,s.Z)((e=>{B(y?e:[])}));(0,c.Z)((async()=>{if(!n||!y)return;const e=await(0,g.EO)({query:y,count:10}),t=(null==e?void 0:e.sug_tags)||[];q(t)}),500,[y,n]),(0,l.useEffect)((()=>{y||B([])}),[y]);const z=(0,l.useCallback)((e=>{if(w&&e.length>w)return i.FN.error(D("pc_stickers_release_max_tag_web",{X:w})),void(null==b||b(e.slice(0,w)));null==b||b(e)}),[b]),O=(0,s.Z)((e=>{t.includes(e)||z([...t,e])})),Q=(0,l.useMemo)((()=>new p.l),[]),U=(0,s.Z)((async e=>{const n=await Q.lock("",(async()=>{if(t.includes(e))return!0;let n=!1;try{const t=await(0,g._K)({words:e,scene:g.Xb.Tag});n=!1===(null==t?void 0:t.is_hit)}catch(l){return(0,m.RF)("[TagSelect] call checkAntiDirt failed",l,{tag:e}),i.FN.error(D("pc_tag_retry_web")),!1}return n?(O(e),!0):((0,m.c6)("[TagSelect] checkAntiDirt not passed",{tag:e}),i.FN.error(D("pc_tag_illegal_fail_web")),!1)}));return null!=n&&n})),X=(0,s.Z)((e=>{if(0===e.length)return;const n=t.filter((t=>!e.includes(t)));z(n)})),Y=(0,l.useRef)(null),{saveSelectionIfNeeded:G}=(0,v.u)({getInputElem:()=>{var e;return null===(e=Y.current)||void 0===e?void 0:e.inputRef.current}}),H=e=>{const t=(0,f.aF)(e,30);G(t),Z(t)},K=(0,s.Z)((e=>{H(""),t.includes(e)?X([e]):(O(e),W(e))})),J=e=>{const t=P.includes(e);$(t?P.filter((t=>t!==e)):[...P,e])},ee=(0,s.Z)((()=>{X(P),$([])})),te=(0,s.Z)((()=>Y.current&&Y.current.inputRef.current&&Y.current.tagInputRef.current?{tagInput:Y.current,tagInputElem:Y.current.tagInputRef.current,inputElem:Y.current.inputRef.current}:null)),ne=(0,s.Z)((e=>{const t=te();return!!(t&&e&&e instanceof Element)&&e.closest(".semi-tagInput")===t.tagInputElem})),le=(0,s.Z)((e=>!!(e&&e instanceof Element)&&null!==e.closest(".semi-tag"))),re=(0,s.Z)((e=>{const t=e.target,n=te();if(!n||!ne(t))return;const{tagInput:l,tagInputElem:r,inputElem:i}=n,{selectionStart:s,selectionEnd:c}=i;return P.length>0&&le(t)?(ee(),null==i||i.setSelectionRange(0,0),void l.focus()):void 0})),ie=(0,s.Z)((e=>{const t=e.target;te()&&ne(t)&&le(t)&&(ne(e.relatedTarget)&&le(e.relatedTarget)||$([]))}));(0,l.useEffect)((()=>{const e=e=>{"Delete"===e.code||"Backspace"===e.code?(S.current=!0,re(e)):S.current=!1};return window.addEventListener("keydown",e,!0),window.addEventListener("blur",ie,!0),()=>{window.removeEventListener("keydown",e,!0),window.removeEventListener("blur",ie,!0)}}),[]);const se=(0,s.Z)((e=>{e.replace(/ {1,}/g,"")===y.replace(/ {1,}/g,"")&&H("")})),ce=async e=>{const[t]=e;Promise.resolve().then((()=>H(y)));const n=t.replace(/ {1,}/g,"");if(0===n.length)return;await U(n)&&(W(n),se(y))},ae=async e=>{if(R.current)return void M(e);const t=e.replace(/ {1,}$/,""),n=t.replace(/ {1,}/g,"");if(H(t),t===e||!t||S.current)return;await U(n)&&(W(n),se(y))};(0,l.useEffect)((()=>{var e;const t=null===(e=Y.current)||void 0===e?void 0:e.inputRef.current;if(!t)return;const n=()=>{R.current=!0,M(t.value)},l=()=>(0,r.unstable_batchedUpdates)((()=>{R.current=!1,M(""),ae(t.value)}));return t.addEventListener("compositionstart",n),t.addEventListener("compositionend",l),()=>{t.removeEventListener("compositionstart",n),t.removeEventListener("compositionend",l)}}),[]);(0,l.useEffect)((()=>{k&&Z("")}),[k]);return(0,C.jsxs)("div",{className:F,children:[(0,C.jsx)(i.Lt,{position:"bottomLeft",trigger:"focus",className:L,style:{maxHeight:200,overflow:"scroll"},render:(0,C.jsx)(i.Lt.Menu,{children:V.map((e=>(0,C.jsx)(i.Lt.Item,{className:I,onClick:()=>K(e),children:e},e)))}),children:(0,C.jsx)(i.EG,{ref:Y,inputValue:A,onInputChange:ae,value:t,placeholder:x,renderTagItem:(e,t,n)=>(0,C.jsx)(T,{value:e,selected:P.includes(e),disabled:o,onClick:J},e),onAdd:ce,onBlur:e=>{if(e.relatedTarget&&e.relatedTarget instanceof Element){const t=[`.${L}`,E].filter((e=>e)).join(",");if(null!==e.relatedTarget.closest(t)||le(e.relatedTarget))return}ce([y])},disabled:o})}),!1,!o&&!h&&(0,C.jsx)(N,{value:t,onSelect:K})]})})),R=(0,i.Q2)(M)},42983:(e,t,n)=>{n.d(t,{Ab:()=>l});let l=function(e){return e[e.WordArt=1]="WordArt",e[e.Sticker=2]="Sticker",e[e.AudioEffect=3]="AudioEffect",e[e.Video=4]="Video",e[e.Music=5]="Music",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.Font=10]="Font",e[e.Timbre=11]="Timbre",e[e.Filter=12]="Filter",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Formula=50]="Formula",e[e.WordArtCollection=101]="WordArtCollection",e[e.StickerCollection=102]="StickerCollection",e[e.AudioEffectCollection=103]="AudioEffectCollection",e[e.VideoCollection=104]="VideoCollection",e[e.Emoticons=105]="Emoticons",e[e.TextTemplateCollection=106]="TextTemplateCollection",e[e.FilterCollection=112]="FilterCollection",e[e.MultiLanguageTextTemplate=207]="MultiLanguageTextTemplate",e}({})},38803:(e,t,n)=>{n.d(t,{P:()=>m});var l=n(84875),r=n.n(l),i=n(84736),s=n(26800),c=n(45599),a=n(46309),o=n(3767),u=n(21919),d=n(80432),p=n(11527);const m=({className:e,leftText:t,isPublishDisabled:n,isPublishing:l,needConfirmModalOnClose:m,onPublish:f,beforeCancel:g,onCancel:v})=>{const{t:_}=(0,c.$)(),h=(0,s.Z)((async()=>{if(g&&g(),m){if(await o.Z.warn({mainText:_("pc_sticker_cancel_web"),subText:_("pc_sticker_click_unrecoverable_web"),confirmBtnText:_("pc_stickers_release_confirm_quit_web"),cancelBtnText:_("pc_stickers_release_cancel_web")})!==o.L.Confirm)return}v?v():(0,a.Nt)()})),b=u.YW.Creator,{showModalWithoutReview:x}=(0,u.ZP)({protocol:b});return(0,p.jsxs)("div",{className:r()(e,d.Z.root),children:[(0,p.jsx)("div",{className:d.Z.left,onClick:undefined,children:t}),(0,p.jsxs)("div",{className:d.Z.right,children:[(0,p.jsx)("span",{className:d.Z.remind,onClick:x,children:_("pc_sticker_release_agree_{X}_web",{X:(0,p.jsx)("span",{className:d.Z.protocol,children:u.rr[b]},"protocol")})}),(0,p.jsxs)("div",{className:d.Z.buttonContainer,children:[(0,p.jsx)(i.zx,{className:d.Z.button,type:"primary",theme:"solid",disabled:n,loading:l,onClick:f,children:_("pc_stickers_release_web")}),(0,p.jsx)(i.zx,{className:d.Z.button,type:"secondary",theme:"solid",onClick:h,children:_("pc_stickers_release_cancel_web")})]})]})]})}},58546:(e,t,n)=>{n.d(t,{r:()=>r});var l=n(59787);class r{constructor(e){this.props=e,(0,l.Z)(this,"fileMap",new Map)}ensureFile(e){let t=this.fileMap.get(e);return t||(t={data:this.props.initData(),events:{}},this.fileMap.set(e,t)),t}getFile(e){return this.fileMap.get(e)}register(e,t,n){this.ensureFile(t).events[e]=n}dispatch(e){var t,n;const l=this.fileMap.get(e.id);l&&(null===(t=(n=l.events)[e.type])||void 0===t||t.call(n,e,l))}removeFile(e){this.fileMap.delete(e)}}},17095:(e,t,n)=>{n.d(t,{g:()=>r});var l=n(46309);function r(e){(0,l.qx)(e)}}}]);