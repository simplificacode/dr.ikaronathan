"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[460],{76706:(e,t,i)=>{i.d(t,{Jr:()=>r,OP:()=>l,Yg:()=>n,cF:()=>o,x3:()=>a});var s=i(55425);const a=()=>(0,s.v_)("/lv/v1/ad_maker/user/get_enable_list",{}),r=e=>(0,s.v_)("/lv/v1/ad_maker/contract/country_code_list",e),n=()=>(0,s.v_)("/lv/v1/ad_maker/contract/dt_list",{}),o=async()=>{const{email:e}=await(0,s.v_)("/lv/v1/ad_maker/contract/get_binding_email",{});return e},l=e=>(0,s.v_)("/lv/v1/ad_maker/contract/create_common",e,{timeout:6e4})},99305:(e,t,i)=>{i.d(t,{KM:()=>a,Ms:()=>s});let s=function(e){return e[e.Deleted=22]="Deleted",e[e.Offline=23]="Offline",e[e.Banned=25]="Banned",e[e.Online=102]="Online",e[e.Reviewing=141]="Reviewing",e[e.SelfView=144]="SelfView",e[e.HomepageOnline=103]="HomepageOnline",e}({}),a=function(e){return e[e.Unknown=0]="Unknown",e[e.WaitReview=1]="WaitReview",e[e.RiskReviewing=2]="RiskReviewing",e[e.QualityReviewing=3]="QualityReviewing",e[e.RiskReviewFailed=4]="RiskReviewFailed",e[e.QualityReviewFailed=5]="QualityReviewFailed",e[e.CopyrightReviewing=6]="CopyrightReviewing",e[e.CopyrightReviewFailed=7]="CopyrightReviewFailed",e[e.Passed=100]="Passed",e}({})},6858:(e,t,i)=>{i.d(t,{R:()=>xe});var s=i(84875),a=i.n(s),r=i(84736),n=i(45599),o=i(73622),l=i(73768),c=i(33556),d=i(50959),u=i(20468);const p="modal-S_b8i3",m="content-oiSfAy",h="title-N9LwzD",f="description-Hachtj",g="buttonContainer-k71Pqw",v="button-TW07qH";var _=i(11527);const w=e=>{const{title:t,description:i,primaryButtonProps:s,secondaryButtonProps:a}=e;return(0,_.jsxs)("div",{className:m,children:[(0,_.jsx)("div",{className:h,children:t}),(0,_.jsx)("div",{className:f,children:i}),(0,_.jsxs)("div",{className:g,children:[s&&(0,_.jsx)(r.zx,{className:v,type:"primary",theme:"solid",...s}),a&&(0,_.jsx)(r.zx,{className:v,type:"secondary",theme:"solid",...a})]})]})};var y=i(66589),b=i(23479),x=i(52918),F=i(4343),k=i(41750),T=i(26800),S=i(86439),C=i(16743);const N="input-gRb1O6",I=(0,r.Q2)((e=>{const{className:t,maxLength:i,onChange:s,onCompositionStart:n,onCompositionEnd:o}=e,[l,c]=(0,d.useState)(""),u=(0,d.useRef)(!1),p=(0,T.Z)((e=>void 0===i?e:(0,S.aF)(e,i))),m=(0,T.Z)((e=>{u.current=!0,c(e.currentTarget.value),null==n||n(e)})),h=(0,d.useRef)(null),{saveSelectionIfNeeded:f}=(0,C.u)({getInputElem:()=>h.current}),g=(0,T.Z)(((e,t)=>{f(e),null==s||s(e,t)})),v=(0,T.Z)((e=>{const t=p(e.currentTarget.value);u.current=!1,c(""),g(t,null),null==o||o(e)})),w=(0,T.Z)(((e,t)=>{if(u.current)return void c(e);if(void 0===i)return void g(e,t);const s=p(e);g(s,t)}));return(0,_.jsx)(r.II,{autoComplete:"off",...e,ref:h,className:a()(t,N),value:u.current?l:e.value,maxLength:void 0,onChange:w,onCompositionStart:m,onCompositionEnd:v})}));var j=i(54847),L=i(8129),M=i(76706),Z=i(97475);const A="modal-j03Zu2",E="content-RVu02C",O="form-LCc7yN",R="idFieldTextarea-QYFmBa",z="description-uzXbJF",D="regionFieldSelect-g4Dn88",P="idFieldRow-N48L3C",U="regionField-qLH6NJ",$="idFieldLabel-KHst6y",B="emailField-GN3qXQ",V="idTypeField-YlcpiJ",q="idField-YtQw4I",W="idTypeFieldSelect-xwFQHv",J="submitButton-LEfESg";var H=i(68212);const Q=(0,b.Pi)((e=>{const{authorSignService:t,onSubmitStart:i,onSubmitted:s,onClose:o}=e,{t:l}=(0,n.$)(),c=(0,x.fv)((()=>({formApi:null,setFormApi:e=>c.formApi=e,regionList:[],idTypeListMap:{},idTypeList:[],async fetchRegionAndIDTypeList(){let e=null;try{e=await t.fetchRegionData()}catch(n){return r.FN.error(l("pc_template_authorize_error_web")),void(0,L.RF)("[FormModalContent] fetchRegionData failed",n)}const{country_code_list:i,doc_type_info:s,region:a}=e;(0,y.z)((()=>{var e;c.idTypeListMap=s,c.regionList=Object.entries(i).map((([e,t])=>({label:t,value:e}))).sort(((e,t)=>e.label.localeCompare(t.label)));const t=c.regionList.some((({value:e})=>e===a))?a:"";null===(e=c.formApi)||void 0===e||e.setValue("region",t),c.updateIdFieldsByRegion(t)}))},updateIdFieldsByRegion(e){var t,i,s,a,r,n,o,l,d;const u=null!==(t=c.idTypeListMap[e])&&void 0!==t?t:[],p=j.appModel.appInfo.language.split("-")[0].toLowerCase(),m=(null!==(i=null!==(s=u[p])&&void 0!==s?s:u.en)&&void 0!==i?i:[]).map((({code:e,name:t})=>({label:t,value:e})));(null!==(a=null!==(r=c.idTypeListMap.GLOBAL[p])&&void 0!==r?r:c.idTypeListMap.GLOBAL.en)&&void 0!==a?a:[]).forEach((({code:e,name:t})=>{m.some((t=>t.value===e))||m.push({label:t,value:e})})),m.sort(((e,t)=>e.label.localeCompare(t.label))),(0,y.z)((()=>{c.idTypeList=m})),null===(n=c.formApi)||void 0===n||n.setValue("id",""),null===(o=c.formApi)||void 0===o||o.setValue("idType",null!==(l=null===(d=c.idTypeList[0])||void 0===d?void 0:d.code)&&void 0!==l?l:"")},async fetchBindingEmail(){const e=await(0,M.cF)().catch((()=>""));c.formApi&&e&&!c.formApi.getTouched("email")&&c.formApi.setValue("email",e)},isSubmitting:!1,isSubmitable:!1,calcIsSubmitable(e){const{values:t,errors:i}=e;return!!(t&&t.name&&t.region&&t.idType&&t.id&&t.email)&&(!i||!i.email)},handleFormChange:e=>{c.isSubmitable=c.calcIsSubmitable(e)},submitContract:async()=>{var e;const a=await(null===(e=c.formApi)||void 0===e?void 0:e.validate().catch((()=>null)));if(a){c.isSubmitting=!0;try{i();const{contract_id:e}=await t.createContract({identity_nationality:a.region,identity_id_type:a.idType,identity_id:a.id,identity_email:a.email,identity_name:a.name});(0,L.c6)("[FormModalContent] createContract success",{contract_id:e})}catch(n){return r.FN.error(l("pc_template_authorize_error_web")),void(0,L.RF)("[FormModalContent] createContract failed",n)}finally{c.isSubmitting=!1}s(),o()}}})));return(0,d.useEffect)((()=>{c.formApi&&(c.formApi.setValues({name:"",region:"",idType:"",id:"",email:""}),c.fetchRegionAndIDTypeList(),c.fetchBindingEmail(),window.formStore=c)}),[c.formApi]),(0,_.jsxs)("div",{className:E,children:[(0,_.jsxs)("div",{className:H.Z.root,children:[(0,_.jsx)("div",{className:H.Z.title,children:l("pc_template_authorize_info_web")}),(0,_.jsx)("div",{className:H.Z.right,children:(0,_.jsx)(k.r,{className:H.Z.closeIcon,onClick:o})})]}),(0,_.jsxs)(r.l0,{className:O,getFormApi:c.setFormApi,onChange:c.handleFormChange,children:[(0,_.jsx)("div",{className:z,children:l("pc_template_authorize_info_contract_web")}),(0,_.jsx)(I,{label:l("pc_template_authorize_name_web"),field:"name",placeholder:l("pc_template_authorize_enter_web"),rules:[{required:!0,message:""}]}),(0,_.jsx)(r.ih,{field:"region",label:l("pc_template_authorize_region_web"),size:"small",fieldClassName:U,className:D,optionList:c.regionList,placeholder:l("pc_template_authorize_select_web"),arrowIcon:(0,_.jsx)(F.Z,{}),rules:[{required:!0,message:""}],onChange:e=>c.updateIdFieldsByRegion(e)}),(0,_.jsx)("div",{className:a()($,"semi-form-field"),children:(0,_.jsx)(r.l0.Label,{required:!0,children:l("pc_template_authorize_certificate_num_web")})}),(0,_.jsxs)("div",{className:P,children:[(0,_.jsx)(r.ih,{field:"idType",noLabel:!0,size:"small",fieldClassName:V,className:W,optionList:c.idTypeList,placeholder:l("pc_template_authorize_select_web"),arrowIcon:(0,_.jsx)(F.Z,{}),onChange:()=>{var e;return null===(e=c.formApi)||void 0===e?void 0:e.setValue("id","")},rules:[{required:!0,message:""}]}),(0,_.jsx)(I,{noLabel:!0,field:"id",fieldClassName:q,className:a()(R,Z.i.heycanInputThemeGrey),placeholder:l("pc_template_authorize_enter_n_web"),rules:[{required:!0,message:""}]})]}),(0,_.jsx)(I,{fieldClassName:B,label:l("pc_template_authorize_email_web"),field:"email",placeholder:l("pc_template_enter_email_web"),trigger:"blur",rules:[{required:!0,message:""},{type:"email",message:l("pc_template_authorize_email_error_web")}],onChange:()=>{var e;return null===(e=c.formApi)||void 0===e?void 0:e.setError("email",null)}}),(0,_.jsx)(r.zx,{className:J,type:"primary",theme:"solid",loading:c.isSubmitting,disabled:!c.isSubmitable,onClick:c.submitContract,children:l("pc_template_submit_web")})]})]})}));var K=i(3718);const X=e=>{const{authorSignService:t,sendLogService:i}=e,{t:s}=(0,n.$)(),{openInfoModal:a}=(()=>{const{i18n:e}=(0,n.$)(),t=(0,d.useRef)(null);return(0,d.useEffect)((()=>()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.call(t)}),[]),{openInfoModal:i=>{var s;const{primaryButtonProps:a,secondaryButtonProps:n,...o}=i,l=r.u_.info({width:"auto",height:"auto",header:null,footer:null,centered:!0,maskClosable:!1,closable:!1,className:p,icon:null,content:(0,_.jsx)(u.a,{i18n:e,children:(0,_.jsx)(w,{...o,primaryButtonProps:a&&{...a,onClick:e=>{var t;null===(t=a.onClick)||void 0===t||t.call(a,e),l.destroy()}},secondaryButtonProps:n&&{...n,onClick:e=>{var t;null===(t=n.onClick)||void 0===t||t.call(n,e),l.destroy()}}})})});return null===(s=t.current)||void 0===s||s.call(t),t.current=()=>{t.current=null,l.destroy()},l}}})(),{openFormModal:o}=(()=>{const{i18n:e}=(0,n.$)(),t=(0,d.useRef)(null);return(0,d.useEffect)((()=>()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.call(t)}),[]),{openFormModal:i=>{var s;const a=r.u_.info({width:"auto",height:"auto",header:null,footer:null,centered:!0,maskClosable:!1,closable:!1,className:A,icon:null,closeOnEsc:!1,content:(0,_.jsx)(u.a,{i18n:e,children:(0,_.jsx)(Q,{...i,onClose:()=>a.destroy()})})});return null===(s=t.current)||void 0===s||s.call(t),t.current=()=>{t.current=null,a.destroy()},a}}})(),l=()=>{o({authorSignService:t,onSubmitStart:()=>i.sendAuthorSignLog({action:"confirm",page_type:"information",button_name:"submit"}),onSubmitted:c}),i.sendAuthorSignLog({action:"show",page_type:"information"})},c=()=>{a({title:s("pc_template_authorize_submitted_web"),description:s("pc_template_authorize_email_sign_web"),primaryButtonProps:{children:s("pc_template_authorize_ok_web")}}),i.sendAuthorSignLog({action:"show",page_type:"submitted"})};return{openModal:()=>{const{signCode:e}=t;switch(e){case K.Z.Unsigned:return a({title:s("pc_template_authorize_sign_web"),description:s("pc_template_authorize_business_copyright_web"),primaryButtonProps:{children:s("pc_template_authorize_sign_n_web"),onClick:()=>{i.sendAuthorSignLog({action:"confirm",page_type:"sign_agreement",button_name:"sign"}),l()}},secondaryButtonProps:{children:s("pc_template_authorize_cancel_web")}}),void i.sendAuthorSignLog({action:"show",page_type:"sign_agreement"});case K.Z.Signing:return a({title:s("pc_template_authorize_sign_web"),description:s("pc_template_authorize_email_sign_check_web"),primaryButtonProps:{children:s("pc_template_authorize_i_know_web")}}),void i.sendAuthorSignLog({action:"show",page_type:"signed"});default:return}}}};var Y,G=i(15843);function ee(){return ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},ee.apply(this,arguments)}const te=e=>d.createElement("svg",ee({xmlns:"http://www.w3.org/2000/svg",width:21,height:20,fill:"none",viewBox:"0 0 21 20"},e),Y||(Y=d.createElement("path",{stroke:"#FAFAFA",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.7,d:"M6.5 10h8M10.5 14V6"})));var ie;function se(){return se=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},se.apply(this,arguments)}const ae=e=>d.createElement("svg",se({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),ie||(ie=d.createElement("path",{stroke:"#E5E5E5",strokeWidth:1.188,d:"M4.986 4.672h6.066v7.135H4.986V4.671ZM8.02 3.188v1.481M3.47 4.671h9.099"})));var re;function ne(){return ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},ne.apply(this,arguments)}const oe=e=>d.createElement("svg",ne({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),re||(re=d.createElement("path",{stroke:"#999",strokeWidth:1.2,d:"M5.485 6.734 4.228 7.991A2.667 2.667 0 1 0 8 11.762l1.258-1.256M10.514 9.25l1.257-1.257A2.667 2.667 0 0 0 8 4.222L6.742 5.479M9.886 6.102 6.743 9.244"}))),le="root-l9tBJC",ce="button-d7ObAP",de="addIcon-az6RxQ",ue="fileList-xgrNuo",pe="fileInfo-FSzbb0",me="hoverIcon-aRWO5l",he="mainIcon-fYnws9",fe="fileIconArea-yRTZz9",ge="fileName-RVW4y3",ve=(0,b.Pi)((e=>{const{service:t}=e,{t:i}=(0,n.$)(),s=(0,d.useRef)(null);return(0,_.jsxs)("div",{className:le,children:[(0,_.jsx)(r.zx,{className:ce,type:"secondary",theme:"solid",icon:(0,_.jsx)(te,{className:de}),onClick:()=>{var e;return null===(e=s.current)||void 0===e?void 0:e.click()},children:i("pc_template_authorize_upload_web")}),(0,_.jsx)("input",{ref:s,type:"file",hidden:!0,onChange:e=>{const s=Array.from(e.target.files||[]).filter((e=>{const t=e.name.split(".").pop().toLowerCase();return["png","jpg","jpeg","webp"].includes(t)}));s.length>0?t.addFiles(s):r.FN.error(i("the_uploaded_file_format_please_try_another_file")),e.target.value=""}}),t.fileList.length>0&&(0,_.jsx)("div",{className:ue,children:t.fileList.map((e=>(0,_.jsxs)("div",{className:pe,children:[(0,_.jsxs)("div",{className:fe,onClick:()=>t.deleteFile(e.id),children:[(0,_.jsx)(ae,{className:me}),e.uri&&(0,_.jsx)(oe,{className:he}),!e.uri&&(0,_.jsx)(r.Ex,{className:he,percent:Math.ceil(100*e.progress),type:"circle",size:"small",stroke:"rgba(246, 247, 254, 0.7)",orbitStroke:"rgba(255, 255, 255, 0.2)",strokeLinecap:"round",strokeWidth:2,width:10})]}),(0,_.jsx)("div",{className:ge,children:e.file.name})]},e.id)))})]})}));var _e=i(17941);const we="root-OIPT3k",ye="disabled-MDJgVh",be="help-eVD2Tx",xe=(0,r.Q2)((e=>{const{t}=(0,n.$)(),i=(0,r.XQ)(),{value:s,onChange:d,authorSignService:u,sendLogService:p,getAuthFileUploadService:m,disabledTooltip:h,vipField:f,...g}=e,{className:v,disabled:w}=g,y=c.YW.OriginalForCommercial,{showModal:b,showModalWithoutReview:x}=(0,c.ZP)({handleBtnText:t("pc_template_authorize_confirm_web"),closeIcon:!0,protocol:y,needReview:!0,onOk:()=>{var e;(0,_e.F)(y),null==d||d(!0),f&&(null===(e=i.setValue)||void 0===e||e.call(i,f,!0)),p.sendCommercialStatementLog({action:"confirm",entry_from:"checkbox",hasCopyrightAuthorization:m().fileList.length>0}),p.sendClickCommercialCheckboxLog(!0)},renderConfirmExtra:()=>(0,_.jsx)(ve,{service:m()}),getCanConfirmExtra:()=>m().isAllUploaded}),{openModal:F}=X({authorSignService:u,sendLogService:p}),{handleMouseEnter:k}=(0,G.w)({cursor:"not-allowed",content:h}),{handleMouseOver:T}=(0,G.S)({checkIsTarget:e=>null!==e.closest(".semi-checkbox-addon")}),S=a()(g.className,Z.i.heycanCheckboxEllipsis);return(0,_.jsxs)("div",{className:a()(we,w&&ye,v),onMouseEnter:w&&h?k:void 0,onMouseOver:w&&h?void 0:T,children:[(0,_.jsx)(r.XZ,{...g,className:S,checked:s,onChange:async e=>{if(Boolean(e.target.checked)){if(u.isRefreshing)return;let e=!1;try{await l.c.show((async()=>{e=await u.checkAuthorHasSigned()}))}catch(i){return r.FN.error(t("pc_template_authorize_error_web")),void(0,L.RF)("[AuthBusinessCheckbox] checkAuthorHasSigned failed",i)}e?(b(),p.sendCommercialStatementLog({action:"show",entry_from:"checkbox"})):F()}else p.sendClickCommercialCheckboxLog(!1),null==d||d(!1)},children:t("pc_template_authorize_business_web")}),(0,_.jsx)(o.r,{className:be,onClick:w?void 0:()=>{x(),p.sendCommercialStatementLog({action:"show",entry_from:"question_mark"})}})]})}))},63541:(e,t,i)=>{i.d(t,{_:()=>h,Z:()=>f});var s=i(50959),a=i(84875),r=i.n(a),n=i(45599),o=i(15843),l=i(53803);const c="root-Hmk_Iv",d="fieldLabel-OCVTxU",u="useAll-oywefT",p="box-eWwoEb";var m=i(11527);const h=(0,s.memo)((e=>{const{text:t,className:i}=e,{handleMouseEnter:s}=(0,o.S)({content:({target:e})=>e.textContent});return(0,m.jsx)("div",{className:r()(l.Z.label,i),onMouseEnter:s,children:t})})),f=e=>{const{t}=(0,n.$)(),{className:i,boxClassName:s,title:a,children:o,onClickUseAll:l,hiddenFieldLabel:h=!1}=e;return(0,m.jsxs)("div",{className:r()(c,i),children:[!h&&(0,m.jsxs)("div",{className:d,children:[(0,m.jsx)("div",{children:null!=a?a:t("pc_template_authorize_settings_web")}),l&&(0,m.jsx)("span",{className:u,onClick:l,children:t("pc_material_release_apply_all")})]}),(0,m.jsx)("div",{className:r()(p,s),children:o})]})}},76199:(e,t,i)=>{i.d(t,{l:()=>g});var s=i(84875),a=i.n(s),r=i(84736),n=i(45599),o=i(73622),l=i(33556),c=i(15843),d=i(17941),u=i(97475);const p="root-ff5Go9",m="disabled-gDaIdV",h="help-zq6k5a";var f=i(11527);const g=(0,r.Q2)((e=>{const{t}=(0,n.$)(),{value:i,onChange:s,sendLogService:g,disabledTooltip:v,..._}=e,{className:w,disabled:y}=_,b=l.YW.OriginalForSubscription,{showModal:x,showModalWithoutReview:F}=(0,l.ZP)({handleBtnText:t("pc_template_authorize_confirm_web"),closeIcon:!0,protocol:b,needReview:!0,onOk:()=>{(0,d.F)(b),null==s||s(!0),g.sendSubscriptionStatementLog({action:"confirm",entry_from:"checkbox"}),g.sendClickSubscriptionCheckboxLog(!0)}}),{handleMouseEnter:k}=(0,c.w)({cursor:"not-allowed",content:v}),{handleMouseOver:T}=(0,c.S)({checkIsTarget:e=>null!==e.closest(".semi-checkbox-addon")}),S=a()(_.className,u.i.heycanCheckboxEllipsis);return(0,f.jsxs)("div",{className:a()(p,y&&m,w),onMouseEnter:y&&v?k:void 0,onMouseOver:y&&v?void 0:T,children:[(0,f.jsx)(r.XZ,{..._,className:S,checked:i,onChange:e=>{const t=Boolean(e.target.checked);if(t&&!(0,d.K)(b))return x(),void g.sendSubscriptionStatementLog({action:"show",entry_from:"checkbox"});g.sendClickSubscriptionCheckboxLog(t),null==s||s(t)},children:t("pc_template_authorize_pro_web")}),(0,f.jsx)(o.r,{className:h,onClick:()=>{F(),g.sendSubscriptionStatementLog({action:"show",entry_from:"question_mark"})}})]})}))},69836:(e,t,i)=>{i.d(t,{ir:()=>w});var s=i(50959),a=i(84875),r=i.n(a),n=i(45599),o=i(87842),l=i(96426),c=i(85083),d=i(88623),u=i(15843),p=i(40699),m=i(96305),h=i(11527);const f=e=>{const{className:t}=e,{t:i}=(0,n.$)(),{handleMouseEnter:s}=(0,u.S)();return(0,h.jsxs)("div",{className:r()(m.Z.root,t),children:[(0,h.jsx)(o.a,{className:m.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,h.jsx)("div",{className:m.Z.text,onMouseEnter:s,children:i("pc_stickers_release_in_web")})]})},g=e=>{const{className:t,tooltip:i}=e,{t:a}=(0,n.$)(),{handleMouseEnter:o}=(0,u.w)({content:i,className:m.Z.tooltip}),c=(0,s.useRef)(null),{setIsMarqueeLoopRunning:d,reactNode:f}=(0,p.J)({text:a("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>c.current});return(0,h.jsxs)("div",{className:r()(m.Z.root,t,m.Z.error),onMouseEnter:e=>{d(!0),o(e)},onMouseLeave:()=>d(!1),children:[(0,h.jsx)(l.r,{className:m.Z.icon}),(0,h.jsx)("div",{ref:c,className:m.Z.text,children:f})]})},v=e=>{const{className:t,text:i}=e,{handleMouseEnter:s}=(0,u.S)();return(0,h.jsxs)("div",{className:r()(m.Z.root,t,m.Z.checked),children:[(0,h.jsx)(d.r,{className:m.Z.icon}),(0,h.jsx)("div",{className:m.Z.text,onMouseEnter:s,children:i})]})},_=e=>{const{className:t}=e,{t:i}=(0,n.$)(),{handleMouseEnter:s}=(0,u.S)();return(0,h.jsxs)("div",{className:r()(m.Z.root,t),children:[(0,h.jsx)("div",{className:r()(m.Z.icon,m.Z.yellowIcon),children:(0,h.jsx)("div",{className:m.Z.yellowPoint})}),(0,h.jsx)("div",{className:m.Z.text,onMouseEnter:s,children:i("pc_stickers_release_editing_web")}),(0,h.jsx)(c.r,{className:m.Z.icon})]})},w=e=>{const{className:t,loading:i,invalid:s,errorToolip:a,isInfoComplete:r,title:n}=e;return i?(0,h.jsx)(f,{className:t}):s?(0,h.jsx)(g,{className:t,tooltip:a}):r?(0,h.jsx)(v,{className:t,text:n}):(0,h.jsx)(_,{className:t})}},37991:(e,t,i)=>{i.d(t,{v:()=>T});var s=i(50959),a=i(23479),r=i(52918),n=i(84875),o=i.n(n),l=i(84736),c=i(45599),d=i(20468),u=i(66589),p=i(83714),m=i(86156),h=i(8129),f=i(26800),g=i(73023);let v;const _=new WeakMap;function w(e){let t=_.get(e);return t||(t=new Set,_.set(e,t)),t}const y="46px",b="2px",x={macos:"macos",windows:"windows",heycanRatioGroupEllipsis:"heycan-ratio-group-ellipsis",heycanCheckboxEllipsis:"heycan-checkbox-ellipsis",heycanFormFieldEllipsis:"heycan-form-field-ellipsis",heycanPopoverWrapperClearStyle:"heycan-popover-wrapper-clear-style",heycanTextareaThemeGrey:"heycan-textarea-theme-grey",heycanInputThemeGrey:"heycan-input-theme-grey",frameWidth:"46px",sliderWidth:"2px",modal:"modal-iFkPHk",root:"root-Zq2UXx",title:"title-RjRwF3",content:"content-pMppxf",loading:"loading-J12Xi0",footer:"footer-otMNTQ",buttonContainer:"buttonContainer-aC2XIN",button:"button-ekKG5u",previewImg:"previewImg-tCoExU",invisible:"invisible-Kg_ArH",frameViewer:"frameViewer-cEhK3e",frameList:"frameList-YrZVfi",frame:"frame-XEvw9I",slider:"slider-RraD19",isSliding:"isSliding-I3_Tp0"};var F=i(11527);const k=(0,a.Pi)((e=>{const{fetchData:t,onOK:i,onClose:a}=e,n=(0,r.fv)((()=>({dataFrameList:[],dataFrameIndex:0,setDataFrameIndex(e){n.dataFrameIndex=Math.max(0,Math.min(e,n.dataFrameList.length-1))},fetchOp:new m.q({fetchFirstPage:async()=>{const{list:e,index:i}=await t();return()=>{n.dataFrameList=e,n.dataFrameIndex=i,n.initSliderIfNeeded()}},slardarErrorLog:(e,t,i)=>(0,h.RF)(`[FramePicker] ${e} failed`,t,i)}),frameListWidth:0,halfSliderWidth:Number.parseInt(b,10)/2,frameWidth:Number.parseInt(y,10),get frameList(){const{dataFrameList:e,frameListWidth:t}=n;if(!e.length||!t)return[];const i=Math.ceil(t/n.frameWidth);return Array(i).fill(0).map(((t,s)=>{if(0===s)return e[0];if(s===i-1)return e[e.length-1];{const t=Math.floor(e.length*(s+.5)/i);return e[t]}}))},setWidth(e){n.frameListWidth=e,n.initSliderIfNeeded()},sliderCenterOffset:0,initSliderIfNeeded(){const{dataFrameList:e,frameListWidth:t}=n;e.length&&t&&(n.dataFrameIndex===n.dataFrameList.length-1?n.setSliderCenterOffset(t):n.setSliderCenterOffset(t*n.dataFrameIndex/n.dataFrameList.length))},setSliderCenterOffset(e){const t=n.halfSliderWidth,i=n.frameListWidth-n.halfSliderWidth;n.sliderCenterOffset=Math.max(t,Math.min(i,e))},handleOK(){i(n.dataFrameIndex)}}))),{handleRef:d}=function(e){const t=(0,f.Z)(((t,i)=>e.onResize(t,i))),i=(0,s.useMemo)((()=>({element:null,observer:(v||(v=new g.Z((e=>{let t=null;if(e.forEach((e=>{const i=w(e.target),s=e.target.getBoundingClientRect();i.forEach((e=>{try{e.props.onResize(s,e)}catch(i){null===t&&(t=i)}}))})),null!==t)throw t}))),v),props:{onResize:t},rect:null,unobserve:null})),[]),a=(0,f.Z)((e=>{var t;null===(t=i.unobserve)||void 0===t||t.call(i),e&&(i.observer.observe(e),i.element=e,i.rect=null,w(e).add(i),i.unobserve=()=>{i.unobserve=null,i.element=null,i.rect=null,i.observer.unobserve(e),w(e).delete(i)})}));return(0,s.useLayoutEffect)((()=>{if(i.element){const e=i.element.getBoundingClientRect();i.rect=null,t(e,i)}}),[]),(0,s.useEffect)((()=>()=>{var e;null===(e=i.unobserve)||void 0===e||e.call(i)}),[]),{resizeData:i,handleRef:a}}({onResize:(e,t)=>{t.element&&n.setWidth(t.element.clientWidth)}}),_=(0,s.useRef)(null),k=(0,s.useRef)({isSliding:!1,destroy:null}),T=e=>{var t,i;if(null===(t=(i=k.current).destroy)||void 0===t||t.call(i),!_.current)return;const s=_.current.getBoundingClientRect().left,a=(0,u.aD)((e=>{k.current.isSliding||(document.body.classList.add(x.isSliding),k.current.isSliding=!0),e.preventDefault(),n.setSliderCenterOffset(e.clientX-s);const t=Math.floor(n.dataFrameList.length*n.sliderCenterOffset/n.frameListWidth);n.setDataFrameIndex(t)})),r=()=>{var e,t;null===(e=(t=k.current).destroy)||void 0===e||e.call(t)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",r),a(e.nativeEvent),k.current.destroy=()=>{k.current.destroy=null,document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",r),k.current.isSliding=!1,document.body.classList.remove(x.isSliding)},document.activeElement instanceof HTMLElement&&document.activeElement.blur()};(0,s.useEffect)((()=>{n.fetchOp.initFetchFirstPage(null)}),[]);const{isPending:S}=n.fetchOp.fetchStatus,C=n.frameList.length>0,{t:N}=(0,c.$)();return(0,F.jsxs)("div",{className:x.root,children:[(0,F.jsx)("div",{className:x.title,children:N("pc_stickers_release_cover_edit_web")}),S?(0,F.jsx)("div",{className:x.loading,children:(0,F.jsx)(p.Y,{status:"loading",children:N("loading_web")})}):(0,F.jsxs)("div",{className:x.content,children:[(0,F.jsx)("img",{className:o()(x.previewImg,!C&&x.invisible),src:C?n.dataFrameList[n.dataFrameIndex]:""}),(0,F.jsxs)("div",{ref:_,className:x.frameViewer,onMouseDown:T,children:[(0,F.jsx)("div",{ref:d,className:x.frameList,children:n.frameList.map(((e,t)=>(0,F.jsx)("img",{src:e,className:x.frame},t)))}),C&&(0,F.jsx)("div",{className:x.slider,style:{left:n.sliderCenterOffset}})]})]}),(0,F.jsx)("div",{className:x.footer,children:(0,F.jsxs)("div",{className:x.buttonContainer,children:[(0,F.jsx)(l.zx,{className:x.button,type:"primary",theme:"solid",disabled:!C,onClick:n.handleOK,children:N("pc_text_template_complete_web")}),(0,F.jsx)(l.zx,{className:x.button,type:"secondary",theme:"solid",onClick:a,children:N("pc_text_template_cancel_n_web")})]})})]})}));function T(){const{i18n:e}=(0,c.$)(),t=(0,s.useRef)(null);return(0,s.useEffect)((()=>()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.call(t)}),[]),{openFramePicker:i=>{var s;const a=l.u_.info({width:"auto",height:"auto",header:null,footer:null,centered:!0,maskClosable:!1,closable:!1,className:x.modal,icon:null,closeOnEsc:!1,content:(0,F.jsx)(d.a,{i18n:e,children:(0,F.jsx)(k,{...i,onOK:e=>{var s;i.onOK(e),null===(s=t.current)||void 0===s||s.call(t)},onClose:()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.call(t)}})})});return null===(s=t.current)||void 0===s||s.call(t),t.current=()=>{t.current=null,a.destroy()},a}}}},15443:(e,t,i)=>{var s=i(50959),a=i(84736),r=i(26758),n=i(45599),o=i(84875),l=i.n(o),c=i(86349),d=i(25807),u=i(69905),p=i(33556);const m="originFlag-Lhtbs4",h="row-yLNK03",f="help-yUKWDh";var g=i(11527);const v=e=>{const{value:t,onChange:i,...o}=e,[v,_]=(0,s.useState)([]),{t:w}=(0,n.$)(),{itemType:y,className:b,checkboxCls:x}=e,{get:F,set:k}=(0,u.ZP)(u.Qt.UseHasAgree,d.$.userInfo.uid),{showModal:T}=(0,p.ZP)({handleBtnText:w("pc_i_see_web"),needReview:!1,protocol:p.YW.Origin,onOk:()=>{if(!d.$.userInfo.uid)return;k("add",[p.YW.Origin]);const e=F();_(e)}});return(0,s.useEffect)((()=>{if(d.$.userInfo.uid){const e=F();_(e)}}),[d.$.userInfo.uid]),(0,g.jsx)("div",{className:l()([m,b]),children:(0,g.jsxs)("div",{className:h,children:[(0,g.jsx)(a.XZ,{...o,checked:t,className:x,onChange:e=>{e.target.checked&&(v.includes(p.YW.Origin)||T()),null==i||i(e.target.checked)},children:c.XH[y]}),(0,g.jsx)(r.Z,{size:"small",className:f,onClick:T})]})})};(0,a.Q2)(v)},89563:(e,t,i)=>{i.d(t,{M:()=>p});var s=i(23479),a=i(84875),r=i.n(a),n=i(36983),o=i(69836),l=i(33372);const c="root-ITIgwH",d="statusBar-PBKTou";var u=i(11527);const p=(0,s.Pi)((e=>{const{className:t,flowerText:i,isSelected:s,onClick:a}=e;return(0,u.jsxs)("div",{className:r()(c,t),onClick:()=>{a(i)},children:[(0,u.jsx)(n.Y,{src:(0,l.Pc)(i).cover.src,isInvalid:!1,isSelected:s,size:80,onContextMenu:e=>{e.preventDefault(),a(i)}}),(0,u.jsx)(o.ir,{className:d,loading:!1,invalid:!1,errorToolip:"",isInfoComplete:(0,l.QX)(i),title:i.title})]})}))},88370:(e,t,i)=>{i.d(t,{p:()=>w});var s=i(50959),a=i(66589),r=i(23479),n=i(45599),o=i(84736),l=i(36983),c=i(91285),d=i(28747),u=i(42983),p=i(45033),m=i(33372),h=i(56130);const f="root-ti0rBz",g="cover-FWyxQo",v="titleField-gXEG6N";var _=i(11527);const w=(0,r.Pi)((e=>{const{flowerText:t,initFlowerTextForm:i,applyTagsToAll:r,maxTitleLength:w}=e,{t:y}=(0,n.$)();(0,s.useLayoutEffect)((()=>{i(t)}),[]);const{getDisplayLength:b}=(0,p._)(),x=(0,m.Pc)(t);return(0,_.jsxs)("div",{className:f,children:[(0,_.jsx)(l.Y,{className:g,src:x.cover.src,isInvalid:!1,isSelected:!1,size:128}),(0,_.jsx)(c.l,{fieldClassName:v,label:y("pc_text_template_name_n_web"),field:"flowerText.title",maxLength:w,allowEnter:!1,placeholder:y("pc_stickers_release_xy_name_web",{X:1,Y:b(w)}),rules:[{required:!0,message:""}],onChange:(0,a.aD)((e=>t.title=e))}),(0,_.jsx)(d.u,{label:(0,_.jsxs)("div",{className:h.Z.labelHeader,children:[(0,_.jsx)(o.l0.Label,{required:!0,children:y("pc_text_template_tag_settings_web")}),(0,_.jsx)("div",{className:h.Z.applyToAll,tabIndex:-1,onClick:()=>r([...t.tags]),children:y("pc_text_template_apply_all_effect_web")})]}),placeholder:y("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"flowerText.tags",itemType:u.Ab.WordArt,recommendConfig:{title:t.title,uri:x.cover.uri},ignoreAddTagOnBlurSelector:`.${h.Z.applyToAll}`,onChange:(0,a.aD)((e=>t.tags=e))})]})}))},21130:(e,t,i)=>{i.d(t,{D5:()=>d});var s=i(59787),a=(i(50959),i(42983)),r=i(97311),n=i(9679),o=i(94435),l=i(67078);const c={[a.Ab.Sticker]:"sticker",[a.Ab.Filter]:"filter",[a.Ab.FilterCollection]:"filter",[a.Ab.AudioEffect]:"audio",[a.Ab.Video]:"video",[a.Ab.TextTemplate]:"text_template",[a.Ab.SubtitleTemplate]:"caption_template",[a.Ab.WordArt]:"flower"};class d{constructor({itemType:e}){(0,s.Z)(this,"materialTypeParams",{material_category:"",material_type:""}),(0,s.Z)(this,"isCollection",!1),this.isCollection=e>100,this.materialTypeParams={material_category:c[e]||"",material_type:e>100?"collection":"single"}}sendPageActionLog(e){(0,n.iL)({...this.materialTypeParams,...e,...this.isCollection&&{collection_detail:e.collection_detail||"collection_all"}})}sendMaterialUploadStatusLog(e){(0,n.j2)({...this.materialTypeParams,...e})}sendMaterialImportErrorLog(e){return(0,n.DV)({...this.materialTypeParams,...e})}sendMaterialPublishErrorLog(e){return(0,n.Sj)(e.map((e=>({...this.materialTypeParams,...e}))))}sendMaterialPublishStatusLog(e,t){var i;const{status:s,error_type:a,cover_type:c,resolution:d,time:u,path:p}=e,{common_data:m,is_vip:h}=e.publishParams,f=[];return m.is_business&&f.push("business"),h&&f.push("subscribe"),(0,n.$v)({...this.materialTypeParams,status:s,title:m.title,isOriginal:Boolean(m.is_original),tags:m.tags||[],material_format:(0,r.lm)(p),material_size:null===(i=m.file)||void 0===i?void 0:i.size,description:m.description,resolution:d,error_type:a,time:u,cover_type:c,authorize_range:f.join(","),isVipAuthorized:(0,l.$X)(e.publishParams.copyright,o.$x.Vip),isBusinessAuthorized:(0,l.$X)(e.publishParams.copyright,o.$x.Business),...t})}sendClickSubscriptionCheckboxLog(e){this.sendPageActionLog({action:e?"check_box_subscription":"cancel_check_box_subscription"})}sendSubscriptionStatementLog(e){(0,n.ce)({...this.materialTypeParams,...e})}sendClickCommercialCheckboxLog(e){this.sendPageActionLog({action:e?"check_box_commercial":"cancel_check_box_commercial"})}sendCommercialStatementLog(e){(0,n.Ad)({...this.materialTypeParams,...e})}sendAuthorSignLog(e){(0,n._4)({...this.materialTypeParams,...e})}}},35686:(e,t,i)=>{i.d(t,{T:()=>r});var s=i(59787),a=i(66589);class r{get materials(){return this.ids.map((e=>this.data.get(e)))}get selected(){var e;return this.ids.includes(this.selectedId)&&null!==(e=this.data.get(this.selectedId))&&void 0!==e?e:null}get length(){return this.ids.length}select(e){this.selectedId=e&&this.ids.includes(e.id)?e.id:""}constructor(e){this.options=e,(0,s.Z)(this,"ids",[]),(0,s.Z)(this,"data",new Map),(0,s.Z)(this,"selectedId",""),(0,s.Z)(this,"op",null),(0,a.ky)(this),this.options.createOp&&(this.op=this.options.createOp(this))}get(e){return this.ids.includes(e)&&this.data.get(e)||null}add(...e){for(const t of e)this.ids.includes(t.id)||(this.ids.push(t.id),this.data.set(t.id,t))}replaceByMap(e,t){const i=this.ids;if(e.forEach((e=>{var i;const s=null!==(i=this.data.get(e.id))&&void 0!==i?i:null;this.data.set(e.id,t(e,s))})),this.ids=e.map((e=>e.id)),this.ids.includes(this.selectedId)||(this.selectedId=""),!this.options.keepDataOnDelete){const e=new Set(this.ids);i.filter((t=>!e.has(t))).forEach((e=>this.deleteData(e)))}}delete(e){const t=this.ids.findIndex((t=>t===e.id));-1!==t&&(this.ids.splice(t,1),e.id===this.selectedId&&(this.selectedId=""),this.options.keepDataOnDelete||this.deleteData(e.id))}deleteData(e){var t,i;const s=this.data.get(e);this.data.delete(e),s&&(null===(t=(i=this.options).onDeleteData)||void 0===t||t.call(i,s))}updateAll(e){this.materials.forEach((t=>e(t)))}}},31086:(e,t,i)=>{i.d(t,{Z:()=>p,f:()=>d});var s=i(59787),a=i(82665),r=i(6471),n=i(25807),o=i(8129),l=i(2555),c=i(94435);const d=10;function u(e){return Boolean(e.id)}class p{constructor(){(0,s.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const i of(0,a.Z)(e,d)){const e=await Promise.all(i.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:i,onResult:s,onUpdateResult:a}=e,n=JSON.parse(JSON.stringify(e.req));let l=this.itemMap.get(i);if(null!==(t=l)&&void 0!==t&&t.promise&&(0,r.Z)(l.req,n))try{return await l.promise}catch(c){(0,o.c6)("[MaterialPublishService] publish failed, start to retry",{id:i})}return l={promise:null,id:i,req:n,onResult:s,onUpdateResult:a},this.itemMap.set(i,l),l.promise=this.publishImpl(l),l.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),i=async(i,s)=>{try{const n={error:i,errorText:this.getErrorText(i),time:Math.round(performance.now()-t),resourceId:s};var a,r;if(u(e.req))await(null===(a=e.onUpdateResult)||void 0===a?void 0:a.call(e,{req:e.req,...n}));else await(null===(r=e.onResult)||void 0===r?void 0:r.call(e,{req:e.req,...n}))}catch(n){(0,o.RF)("[MaterialPublishService] callOnResult failed",n)}};let s;try{s=await this.postOrUpdate(e)}catch(a){throw e.promise=null,i(a,""),a}return await i(null,s.resource_id),s}async postOrUpdate(e){return u(e.req)?(await(0,c.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,c.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new l.B).timeout(5e3)])}catch(t){(0,o.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const i=performance.now(),s=new l.B,a={count:50,effect_types:t,uid:n.$.userInfo.uid,cursor:0};for(;performance.now()-i<5e3;){const t=await(0,c.Js)(a).catch((()=>null));if(null!=t&&t.effect_item_list){const i=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>i.has(e))))return}await s.timeout(500)}}}},79668:(e,t,i)=>{i.d(t,{L:()=>o});var s=i(93302),a=i(50959),r=i(66589);const n=5e3;function o({watch:e,collect:t}){const i=(0,a.useMemo)((()=>(0,s.Z)((async()=>{await Promise.resolve(),t()}),n)),[]);(0,a.useEffect)((()=>{const t=(0,r.EH)((()=>{e(),i()}));return()=>{t(),i.cancel()}}),[])}},21423:(e,t,i)=>{i.d(t,{N0:()=>N,r:()=>C,B4:()=>k,Dz:()=>T,wt:()=>S});var s=i(59787),a=i(6471),r=i(66589),n=i(8129),o=i(58546),l=i(62262),c=i(29755),d=i(97311),u=i(94435);class p{constructor(){(0,s.Z)(this,"uploadConfigService",null),(0,s.Z)(this,"fileEventDispatcher",null),(0,s.Z)(this,"map",new Map)}init(e){const{uploadConfigService:t,fileEventDispatcher:i}=e;this.uploadConfigService=t,this.fileEventDispatcher=i}async initUpload(e){return this.map.set(e.id,e),this.upload(e.id)}async retryUpload(e){return this.upload(e)}async upload(e){const t={type:"Upload",result:"Error",id:e,uri:"",size:0,md5:"",error:""},{uploadConfigService:i,fileEventDispatcher:s}=this;if(!i||!s){const t=new l.w("not inited",{id:e});throw(0,n.RF)("[SimpleFileUploader] init upload failed",t),t}const a=this.map.get(e);if(!a){const i=new l.w("data not set",{id:e});throw(0,n.RF)("[SimpleFileUploader] init upload failed",i),t.error=i.message,s.dispatch(t),i}const{type:r,file:o}=a,p=async()=>{const{imageUploadConfig:e,videoUploadConfig:t,objectUploadConfig:s}=await i.getUploadConfigs("SimpleFileUploader");let a;return a=r===u.AJ.Image?e:r===u.AJ.Video?t:s,{current_time:a.currentTime,expired_time:a.expiredTime,access_key_id:a.accessKey,secret_access_key:a.secretKey,session_token:a.sessionToken,upload_domain:a.hostDomain,space_name:a.serviceId||a.nameSpace,space_type:a.serviceId?2:1,region:a.region||""}};try{const i=await(0,c.ws)({file:o,getUploadToken:p});t.result="Success",t.uri=i.uploadResult.Uri,t.size=i.fileSize,t.md5=a.withMD5?await(0,d.C3)(o):"",s.dispatch(t),this.map.delete(e)}catch(h){var m;throw(0,n.RF)("[SimpleFileUploader] upload failed",h),t.result="Error",t.uri="",t.size=0,t.error=null!=h&&h.message?`${h.message}, code=${null===(m=h.context)||void 0===m?void 0:m.code}`:JSON.stringify(h||{}),s.dispatch(t),h}}}var m=i(84677),h=i(82188),f=i(2555);function g(e){const{base64List:t}=(0,h.eK)(e);return t}function v(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}function _(e){const t=v(e);let i=0;for(let s=0;s<e.length;s++){const a=e[s];i+=(a-t)*(a-t)}return Math.sqrt(i/e.length)}const w=async e=>{const t=await e.arrayBuffer();return(0,h.eK)(t).base64List},y=e=>new Promise(((t,i)=>{const s=new Image;s.src=e,s.setAttribute("crossOrigin","Anonymous"),s.onload=()=>{const e=document.createElement("canvas"),i=e.getContext("2d");e.width=s.width,e.height=s.height,null==i||i.drawImage(s,0,0,e.width,e.height);const a=async function(e){const t=e.width,i=e.height,s=Array(i*t).fill(0),a=Array(i*t).fill(0);let r=0,n=performance.now();for(let u=0;u<i;u++){for(let i=0;i<t;i++){const t=4*(i+u*i),n=e.data[t],o=e.data[t+1],l=e.data[t+2];s[r]=Math.abs(n-o),a[r]=Math.abs((n+o)/2-l),r+=1}performance.now()-n>16&&(await(0,f.N)(),n=performance.now())}await(0,f.N)();const o=v(s),l=_(s),c=v(a),d=_(a);return Math.sqrt(l*l+d*d)+.3*Math.sqrt(o*o+c*c)}(null==i?void 0:i.getImageData(0,0,e.width,e.height));t(a)}})),b=async e=>{var t;let i=[];if("string"==typeof e&&(i=await async function(e){const{base64List:t}=await(0,h.Jx)(e);return t}(e)),e instanceof ArrayBuffer&&(i=await g(e)),e instanceof File&&(i=await w(e)),null===(t=i)||void 0===t||!t.length)throw new Error("\u9519\u8befgif\u6587\u4ef6");const s=[];let a=0,r=0;for(let n=0;n<i.length;n++){const e=i[n],t=await y(e);s.push(t),t>a&&(a=t,r=n)}return{max:a,maxIndex:r,frameList:i,frame:i[r]}};var x=i(1946),F=i(33372);function k(e){return{id:"",src:"",uri:"",isUploadFailed:!1,file:new File([],""),...e}}function T(e){return{id:"",uri:"",isUploadFailed:!1,file:new File([],""),md5:"",size:0,...e}}function S(e){return{id:"",src:"",uri:"",isUploadFailed:!1,file:new File([],""),index:0,duration:3,list:[],...e}}function C(e,...t){for(const i of t)i.id||null==e.uninited||(e.uninited+=1),i.isUploadFailed?e.failed+=1:i.uri?e.succeeded+=1:e.pending+=1}class N{constructor(e){this.props=e,(0,s.Z)(this,"fileEventDispatcher",new o.r({initData:()=>null})),(0,s.Z)(this,"fileUploader",new p),(0,s.Z)(this,"prevDepResourceIdMap",{}),(0,s.Z)(this,"templateZipCacheMap",new Map),(0,r.ky)(this),this.fileUploader.init({fileEventDispatcher:this.fileEventDispatcher,uploadConfigService:this.props.uploadConfigService})}async initUploadCover(e){const t=e.getCover();if(!t||t.id)return;if((0,m.L)(t,{...e.getInitValues(),uri:"",isUploadFailed:!1}),!t.file.size&&!t.file.name){const e=new l.w("file is empty",{id:t.id});throw(0,n.RF)("[TemplateFileOperator] initUploadCover failed",e),e}const{id:i}=t;this.fileUploader.initUpload({id:i,type:u.AJ.Image,file:t.file}),this.fileEventDispatcher.register("Upload",t.id,(0,r.aD)((t=>{const s=e.getCover();var a;if(!s||s.id!==i)return void(0,n.c6)(`[TemplateFileOperator] cover upload ignored {${i}}`,{coverId:null!==(a=null==s?void 0:s.id)&&void 0!==a?a:"null"});const{uri:r}=t;if(r)s.uri=r,(0,n.c6)(`[TemplateFileOperator] cover upload success {${i}}`,{uri:r});else{s.isUploadFailed=!0;const e=t.error||"unknown";(0,n.RF)(`[TemplateFileOperator] cover upload failed {${i}}`,null,{error:e})}})))}async initUploadFile(e){const{typeName:t}=e,i=e.getFile();if(!i||i.id)return;if((0,m.L)(i,{...e.getInitValues(),uri:"",isUploadFailed:!1,md5:"",size:0}),!i.file.size&&!i.file.name){const e=new l.w("file is empty",{id:i.id,type:t});throw(0,n.RF)("[TemplateFileOperator] initUploadFile failed",e),e}const{id:s}=i;this.fileUploader.initUpload({id:s,type:u.AJ.Object,file:i.file,withMD5:!0}),this.fileEventDispatcher.register("Upload",s,(0,r.aD)((i=>{const a=e.getFile();var r;if(!a||a.id!==s)return void(0,n.c6)(`[TemplateFileOperator] ${t} upload ignored {${s}}`,{fileId:null!==(r=null==a?void 0:a.id)&&void 0!==r?r:"null"});const{uri:o,size:l,md5:c}=i;if(o)a.uri=o,a.size=l,a.md5=c,(0,n.c6)(`[TemplateFileOperator] ${t} upload success {${s}}`,{uri:o});else{a.isUploadFailed=!0;const e=i.error||"unknown";(0,n.RF)(`[TemplateFileOperator] ${t} upload failed {${s}}`,null,{error:e})}})))}retryUpload(...e){for(const t of e)t.id&&t.isUploadFailed&&(t.isUploadFailed=!1,this.fileUploader.retryUpload(t.id))}async getStaticFrame(e,t){if(null==t){const{maxIndex:t,frameList:i}=await b(e);return{index:t,frameList:i}}return{index:t,frameList:await w(e)}}async initStaticFrame(e){var t;const{id:i,templateZipData:s,staticFrame:a}=e,{coverFile:r}=s.template;(0,n.c6)(`[TemplateFileOperator] getGifColorFrame start {${i}}`);const{index:o,frameList:l}=await this.getStaticFrame(r,null===(t=e.getInitIndex)||void 0===t?void 0:t.call(e));(0,n.c6)(`[TemplateFileOperator] getGifColorFrame done {${i}}`),(0,m.L)(a,{id:"",uri:"",isUploadFailed:!1,src:l[o],index:o,list:l})}updateStaticFrame(e,t){const{list:i}=e;0!==i.length&&(0,m.L)(e,{id:"",uri:"",isUploadFailed:!1,src:i[t],index:t})}saveTemplateZipCache(e,t,i){i.id&&!i.isUploadFailed&&i.uri&&this.templateZipCacheMap.set(`${t}-${e}`,{...i}),(0,m.L)(i,{...T({}),extraJson:{}})}async initUploadTemplateZip(e){const{zipFile:t,templateZipData:i,staticFrame:s,depResourceIdMap:r,checkIsCanceled:o}=e,l=`${e.lang}-${e.id}`,c=this.templateZipCacheMap.get(l),d=(0,a.Z)(r,this.prevDepResourceIdMap);d&&(this.prevDepResourceIdMap=r);const u=s.index/s.list.length*s.duration;if(c&&u===c.previewTime&&d)return(0,m.L)(t,c),void(0,n.c6)(`[TemplateFileOperator] zip reuse cache success {${l}}`,{uri:c.uri});const p=(0,F.ii)(e.lang,i,r),{file:h,extraJson:f}=await i.createNewZipFile({previewTime:u,depResourceIdMap:p});(0,n.c6)(`[SingleStore] createNewZipFile success {${l}}`,{depResourceIdMap:p}),o()||this.initUploadFile({getFile:()=>t,typeName:"zip",getInitValues:()=>({id:(0,x.V)("template-zip"),file:h,previewTime:u,extraJson:f})})}}},86324:(e,t,i)=>{i.d(t,{v:()=>f});var s=i(59787),a=i(34210),r=i.n(a),n=i(46309),o=i(42983);async function l(e,t={}){const i=new(r());return(await i.loadAsync(e,t)).files}var c=i(8129),d=i(74235);async function u(e,t){try{const i=await e.async("blob"),s=await i.text();return(0,d.ZP)(s,t)}catch(i){throw(0,c.RF)("[TextTmp] file error",i,e),i}}i(94435);var p=i(62262);const m="content.json",h="extra.json";o.Ab.Font,o.Ab.Font,o.Ab.WordArt,o.Ab.Sticker;class f{constructor(e){this.options=e,(0,s.Z)(this,"timing",{}),(0,s.Z)(this,"sdkVersion",""),(0,s.Z)(this,"rootFiles",{}),(0,s.Z)(this,"_template",null),(0,s.Z)(this,"flowerTexts",[]),(0,s.Z)(this,"stickers",[])}get template(){if(!this._template)throw new p.w("template not inited",{id:this.options.id});return this._template}async init(){this.timing.startTime=performance.now();const{id:e,fetchZipBase64:t}=this.options;(0,c.c6)(`[TemplateZipData] init start {${e}}`);let i="";try{[i,this.sdkVersion]=await Promise.all([t(e),(0,n.mI)().then((e=>e.sdk))])}catch(r){throw(0,c.RF)(`[TemplateZipData] fetch from native failed {${e}}`,r),r}this.timing.fetchZipBase64EndTime=performance.now(),(0,c.c6)("[TemplateZipData] fetchZipBase64 done"),this.rootFiles=await l(i,{base64:!0}),this.timing.decompressRootEndTime=performance.now(),(0,c.c6)("[TemplateZipData] decompress root done",{files:Object.keys(this.rootFiles)});const s=[this.initFlowerTexts()],a=this.rootFiles["template_sticker.zip"];if(a){const e=await a.async("blob"),t=await l(e);(0,c.c6)("[TemplateZipData] decompress template_sticker.zip done",{files:Object.keys(t)});const i=t["caption_animation.json"],[r,n,o]=await Promise.all([u(t[h],{}),u(t[m],{root:{duration:3,preview_time:0},children:[]}),i&&u(i,{caption_animation:[]})]);r.depend_resource_list&&(r.depend_resource_list=r.depend_resource_list.filter((e=>e.resource_id))),this._template={files:t,extraJson:r,contentJson:n,captionAnimationJson:o,coverFile:new File([],""),notBusinessEffectTypes:[]},this.timing.decompressTemplateZipEndTime=performance.now(),(0,c.c6)("[TemplateZipData] decompress template.zip done",{files:Object.keys(t),extraJson:r,contentJson:n}),s.push(this.initTemplateFiles(this.template),this.initNonBusinessInfo(this.template),this.initStickers(this.template))}await Promise.all(s),this.timing.endTime=performance.now(),(0,c.c6)(`[TemplateZipData] all done {${e}}`)}async initTemplateFiles(e){const t=await this.rootFiles["preview_gif.gif"].async("blob");e.coverFile=new File([t],"text.gif",{type:"image/gif"}),this.timing.initTemplateFilesEndTime=performance.now(),(0,c.c6)("[TemplateZipData] initTemplateFiles done")}async initNonBusinessInfo(e){}async initFlowerTexts(){const e=this.rootFiles["flower_text.json"];if(!e)return;const{text_template:t=[],local:i=[]}=await u(e,{});if((0,c.c6)("[TemplateZipData] flower_text.json",{text_template:t,local:i}),!t.length&&!i.length)return;const s=await Promise.all(t.map((async e=>{const t=e.local_id,i=this.rootFiles[`${t}.zip`];if(!i)return null;const s=await i.async("blob"),a=new File([s],"flower.zip",{type:"application/zip"}),r=await l(s);(0,c.c6)(`[TemplateZipData] decompress flower.zip done {${t}}`,{id:t,files:Object.keys(r)});const n=await r["cover_icon.png"].async("blob"),o=new File([n],"flower.png",{type:"image/png"}),{version:d="1.0.0"}=await u(r["config.json"],{});return{id:t,isDepMaterial:!0,file:a,coverFile:o,sdkVersion:d,groupId:e.group_id||""}})));this.flowerTexts=s.filter((e=>null!==e)),this.timing.initFlowerTextsEndTime=performance.now(),(0,c.c6)("[TemplateZipData] initFlowerTexts done",{flowers:this.flowerTexts.map((e=>e.id))})}async initStickers(e){const t=this.rootFiles["local_sticker.json"];if(!t)return;const{text_template:i=[],local:s=[]}=await u(t,{});(0,c.c6)("[TemplateZipData] local_sticker.json",{text_template:i,local:s});const a=await Promise.all(i.map((async t=>{var i;const s=t.local_id,a="true"===t.is_sequence,r=t.type,n=null===(i=e.contentJson.children)||void 0===i?void 0:i.find((e=>e.name===t.local_id)),o="sticker"===(null==n?void 0:n.type)&&n.sticker_path||"",l=e.files[o];if(!l)return null;const c=await l.async("blob");return{id:s,isDepMaterial:!0,file:new File([c],l.name,{type:`image/${r}`}),isSequence:a}})));this.stickers=a.filter((e=>null!==e)),this.timing.initStickersEndTime=performance.now(),(0,c.c6)("[TemplateZipData] initStickers done",{stickers:this.stickers.map((e=>e.id))})}async createNewZipFile(e){var t;const{previewTime:i,depResourceIdMap:s}=e,{files:a,contentJson:n,extraJson:o}=this.template,l={...n,root:{...n.root,preview_time:i},children:n.children.map((e=>{var t;if("text"===e.type&&null!==(t=e.text_params)&&void 0!==t&&t.richText){let t=e.text_params.richText;return Object.entries(s).forEach((([e,i])=>{const s=new RegExp(e,"g");t=t.replace(s,i)})),{...e,text_params:{...e.text_params,richText:t}}}return"sticker"===e.type&&!e.sticker_resource_id&&s[e.name]&&e.sticker_path?{...e,sticker_path:"",sticker_design_type:0,sticker_resource_id:s[e.name]}:e}))},c={...o,depend_resource_list:null===(t=o.depend_resource_list)||void 0===t?void 0:t.map((e=>{const t=s[e.resource_id];return t?{...e,resource_id:t,source:1}:e}))},d=new(r());d.file(m,JSON.stringify(l)),d.file(h,JSON.stringify(c)),d.files={...a,...d.files};const u=await d.generateAsync({type:"blob"});return{file:new File([u],"text_template.zip",{type:"application/zip"}),contentJson:l,extraJson:c}}}},33372:(e,t,i)=>{i.d(t,{Id:()=>_,Kl:()=>w,Pc:()=>f,QX:()=>h,Rd:()=>y,Sv:()=>m,Wl:()=>b,er:()=>v,ii:()=>x,wu:()=>g});var s=i(91550),a=i(66589),r=i(21423),n=i(97311),o=i(1946),l=i(8129),c=i(45735),d=i(9679),u=i(94435),p=i(67078);function m(e){const t=e.subFlowerTexts.map(((e,t)=>function(e,t){const{lang:i,data:s}=e,{id:a,coverFile:o,file:l}=s;return{id:a,lang:i,resourceId:"",cover:(0,r.B4)({src:t.needSrc?(0,n.y8)(o):"",file:o}),file:(0,r.Dz)({file:l})}}(e,{needSrc:0===t}))),{isDepMaterial:i,sdkVersion:s}=e.subFlowerTexts[0].data;return(0,a.LO)({id:t[0].id,groupId:e.groupId,isDepMaterial:i,sdkVersion:s,title:"",tags:[],subFlowerTexts:t})}function h(e){return Boolean(e.title&&e.tags.length)}function f(e){return e.subFlowerTexts[0]}function g(e){const{id:t,isDepMaterial:i,isSequence:s,file:a}=e;return{id:t,resourceId:"",isDepMaterial:i,title:"",tags:[],isSequence:s,cover:(0,r.B4)({file:a})}}function v(e,t){for(const i of t.flowerTexts)for(const t of i.subFlowerTexts)e.initUploadCover({getCover:()=>t.cover,getInitValues:()=>({id:(0,o.V)("flower-text-cover")})}),e.initUploadFile({getFile:()=>t.file,typeName:"zip",getInitValues:()=>({id:(0,o.V)("flower-text-zip")})});for(const i of t.stickers)e.initUploadCover({getCover:()=>i.cover,getInitValues:()=>({id:(0,o.V)("sticker-cover")})})}function _(e,t){for(const i of t.flowerTexts)for(const t of i.subFlowerTexts)e.retryUpload(t.cover,t.file);for(const i of t.stickers)e.retryUpload(i.cover)}function w(e,t){return e.map((e=>e.subFlowerTexts.map((i=>{const{lang:r}=i,n=i.id;return{id:n,req:(0,c.h$)({...(0,s.Z)(e,["tags","sdkVersion"]),...(0,s.Z)(i,["cover","file"]),...t,title:e.title,baseSource:u.r0.UserPostPcInTextTemplate}),onResult:(0,a.aD)((({resourceId:e,error:t,req:s,time:a,errorText:o})=>{var c;(0,d.$v)({status:t?"fail":"success",material_category:"flower",material_type:"single",title:s.common_data.title,isOriginal:Boolean(s.common_data.is_original),tags:null!==(c=s.common_data.tags)&&void 0!==c?c:[],time:a,isVipAuthorized:(0,p.$X)(s.copyright,u.$x.Vip),isBusinessAuthorized:(0,p.$X)(s.copyright,u.$x.Business),error_type:o}),t?(0,l.RF)(`[DepMaterial] dep publish failed {${n}}`,t,{lang:r}):(i.resourceId=e,(0,l.c6)(`[DepMaterial] dep publish success {${n}}`,{resourceId:e,lang:r}))}))}})))).flat()}function y(e,t){const{getTitle:i,...r}=t;return e.map(((e,t)=>{const{id:n}=e,o=i(e,t),d=e.isSequence?u.r0.UserPostPcInTextTemplateSequence:u.r0.UserPostPcInTextTemplate;return{id:n,req:(0,c.td)({...(0,s.Z)(e,["tags","isSequence","cover"]),...r,title:o,baseSource:d}),onResult:(0,a.aD)((({resourceId:t,error:i})=>{i?(0,l.RF)(`[DepMaterial] dep publish failed {${n}}`,i):(e.id===n&&(e.resourceId=t),(0,l.c6)(`[DepMaterial] dep publish success {${n}}`,{resourceId:t,latestId:e.id}))}))}})).flat()}function b(e){const t={};for(const i of e.flowerTexts)for(const e of i.subFlowerTexts)t[`${e.lang}-${e.id}`]=e.resourceId;for(const i of e.stickers)t[i.id]=i.resourceId;return t}function x(e,t,i){const s={};for(const a of t.flowerTexts){const t=`${e}-${a.id}`;a.isDepMaterial&&i[t]&&(s[a.id]=i[t])}for(const a of t.stickers)a.isDepMaterial&&i[a.id]&&(s[a.id]=i[a.id]);return s}},45735:(e,t,i)=>{i.d(t,{Ob:()=>l,h$:()=>n,td:()=>o,xo:()=>c});var s=i(42983),a=i(67078),r=i(94435);function n(e){const{title:t,isHighPriority:i,isVip:r,isBusiness:n,isOriginal:o,tags:l,sdkVersion:c,baseSource:d,cover:u,file:p}=e,m=i?`${d}_without_review`:d,h=(0,a.pn)({isVip:r,isBusiness:n});return{effect_type:s.Ab.WordArt,is_vip:r,...h.root,common_data:{title:t,description:t,icon:{image_uri:u.uri},file:{file_md5:p.md5,file_uri:p.uri,size:p.size},sdk_version:c,source:m,tags:l,is_original:o,is_business:n,...h.commonData}}}function o(e){const{title:t,isHighPriority:i,isVip:n,isBusiness:o,isOriginal:l,tags:c,baseSource:d,cover:u}=e,p=i?`${d}_without_review`:d,m=(0,a.pn)({isVip:n,isBusiness:o}),h=u.file.name.split(".").pop();return{effect_type:s.Ab.Sticker,is_vip:n,...m.root,common_data:{title:t,description:t,icon:{image_uri:u.uri},sdk_version:"1.0.0",source:p,tags:c,is_original:l,is_business:o,...m.commonData},sticker:{large_image:{image_uri:u.uri},sticker_type:"gif"===h?r.Ic.Dynamic:r.Ic.Static}}}function l(e){var t,i;const{effectType:r,title:n,tags:o,isHighPriority:l,isVip:c,isBusiness:d,isOriginal:u,templateZipData:p,cover:m,staticFrame:h,file:f,lang:g,extraJson:v,authFiles:_,baseSource:w}=e,{sdkVersion:y}=p,b=(0,a.pn)({isVip:c,isBusiness:d,authFiles:_}),x=l?`${w}_without_review`:w,F=r===s.Ab.SubtitleTemplate?"subtitle_template":"text_template";return{effect_type:r,is_vip:c,...b.root,common_data:{title:n,description:n,icon:{image_uri:m.uri,static_uri:h.uri},file:{file_md5:f.md5,file_uri:f.uri,size:f.size},sdk_version:y,source:x,tags:o,is_original:u,is_business:d,...b.commonData,...g&&{item_language:g}},[F]:{depend_resource_list:null!==(t=v.depend_resource_list)&&void 0!==t?t:[],script_template_version:null!==(i=v.script_template_version)&&void 0!==i?i:"",...v.texts&&{texts:v.texts}}}}function c(e){const{id:t,title:i,tags:s,isVip:r,isBusiness:n,isOriginal:o,cover:l,staticFrame:c,file:d,authFiles:u,onlineData:p}=e,m=(0,a.sR)({isOriginal:o,isVip:r,isBusiness:n,authFiles:u,onlineData:p});return{id:t,title:i,description:i,icon:{image_uri:l.uri,static_uri:c.uri},file:{file_md5:d.md5,file_uri:d.uri,size:d.size},tags:s,...m}}},17941:(e,t,i)=>{i.d(t,{F:()=>n,K:()=>r});var s=i(25807),a=i(69905);function r(e){const t=s.$.userInfo.uid;return!!t&&(0,a.cF)(a.Qt.UseHasAgree,t).get().includes(e)}function n(e){const t=s.$.userInfo.uid;t&&(0,a.cF)(a.Qt.UseHasAgree,t).set("add",[e])}},69905:(e,t,i)=>{i.d(t,{Qt:()=>a,ZP:()=>o,cF:()=>n});var s=i(50959);let a=function(e){return e.TagEachUser="TagEachUser",e.UseHasAgree="useHasAgree",e}({});const r={TagEachUser:20};function n(e,t,i=r[e]){return{get:()=>JSON.parse(localStorage.getItem(e)||"{}")[t]||[],set:(s,a)=>{const r=JSON.parse(localStorage.getItem(e)||"{}"),n=r[t]||[];let o=[];"add"===s?(Array.isArray(a)?n.unshift(...a):n.unshift(a),o=Array.isArray(a)?Array.from(new Set(n.slice(0,i))):a):"remove"===s?o=n.filter((e=>Array.isArray(a)?a.includes(e):e!==a)):"change"===s&&(o=a),r[t]=o;const l=JSON.stringify(r);localStorage.setItem(e,l)}}}const o=(e,t,i)=>(0,s.useMemo)((()=>n(e,t,i)),[e,t,i])},84677:(e,t,i)=>{i.d(t,{L:()=>a});var s=i(66589);function a(e,...t){return(0,s.z)((()=>Object.assign(e,...t)))}},73622:(e,t,i)=>{i.d(t,{r:()=>n});var s,a=i(50959);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},r.apply(this,arguments)}const n=e=>a.createElement("svg",r({xmlns:"http://www.w3.org/2000/svg",width:10,height:10,fill:"none",viewBox:"0 0 10 10"},e),s||(s=a.createElement("path",{fill:"currentColor",d:"M5.005 10c2.735 0 5-2.265 5-5S7.735 0 5 0 0 2.265 0 5s2.27 5 5.005 5Zm0-.888A4.096 4.096 0 0 1 .898 5 4.092 4.092 0 0 1 5 .888 4.108 4.108 0 0 1 9.118 5a4.097 4.097 0 0 1-4.113 4.112Zm-.108-3.116c.253 0 .413-.15.418-.346v-.062c.005-.263.17-.433.5-.655.475-.31.805-.599.805-1.171 0-.816-.727-1.26-1.568-1.26-.836 0-1.394.393-1.538.842a.83.83 0 0 0-.041.247c0 .227.175.351.36.351.28 0 .331-.144.486-.325.16-.258.382-.413.696-.413.429 0 .702.243.702.599 0 .32-.206.48-.63.774-.345.242-.603.5-.603.965v.057c0 .268.15.397.413.397Zm-.01 1.47a.527.527 0 0 0 .541-.516c0-.294-.242-.516-.542-.516a.53.53 0 0 0-.541.516c0 .29.253.516.541.516Z"})))},53803:(e,t,i)=>{i.d(t,{Z:()=>s});const s={group:"group-m_Apv3",authGroup:"authGroup-Yuaspf",label:"label-EV9bRs",right:"right-pmBY1Y"}},56130:(e,t,i)=>{i.d(t,{Z:()=>s});const s={labelHeader:"labelHeader-YVMW2T",applyToAll:"applyToAll-TCdMm4"}}}]);