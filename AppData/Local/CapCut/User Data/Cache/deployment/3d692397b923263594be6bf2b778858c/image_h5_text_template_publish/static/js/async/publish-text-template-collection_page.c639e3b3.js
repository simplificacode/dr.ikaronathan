/*! For license information please see publish-text-template-collection_page.c639e3b3.js.LICENSE.txt */
(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[243],{60153:(e,t,l)=>{"use strict";l.d(t,{GO:()=>g,ID:()=>u,UW:()=>c,Xh:()=>d,np:()=>_,ql:()=>p,vY:()=>m});var i=l(54029),o=l(19780),s=l(94195),n=l(50959),a=l(32890),r=l(50840);function c(e,t){e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),!t&&e.nativeEvent&&"function"==typeof e.nativeEvent.stopImmediatePropagation&&e.nativeEvent.stopImmediatePropagation()}function d(e,t){return(0,s.Z)(e,(e=>{if("function"==typeof t)return t(e);if("function"==typeof e||n.isValidElement(e))return e;if("[object Error]"===Object.prototype.toString.call(e))return e;if(Array.isArray(e)&&0===e.length){const t=Object.keys(e);if(t.length){const s=[];t.forEach((t=>{(0,o.Z)(s,t,e[t])}));try{(0,a.Z)("production"!==(0,i.Z)(process,"env.NODE_ENV"),"[Semi] You may use an out-of-bounds array. In some cases, your program may not behave as expected.\n                    The maximum length of an array is 4294967295.\n                    Please check whether the array subscript in your data exceeds the maximum value of the JS array subscript")}catch(l){}return s}}else;}))}const p=(e,t)=>{let{match:l,unmatch:i,callInInit:o=!0}=t;if("undefined"!=typeof window){const s=window.matchMedia(e);function n(e){e.matches?l&&l(e):i&&i(e)}return o&&n(s),Object.prototype.hasOwnProperty.call(s,"addEventListener")?(s.addEventListener("change",n),()=>s.removeEventListener("change",n)):(s.addListener(n),()=>s.removeListener(n))}return()=>{}},u=e=>n.isValidElement(e)&&"Icon"===(0,i.Z)(e.type,"elementType");function m(){return document?document.activeElement:null}function g(e){if(!(0,r.Z)(e))return[];const t=["input:not([disabled]):not([tabindex='-1'])","textarea:not([disabled]):not([tabindex='-1'])","button:not([disabled]):not([tabindex='-1'])","a[href]:not([tabindex='-1'])","select:not([disabled]):not([tabindex='-1'])","area[href]:not([tabindex='-1'])","iframe:not([tabindex='-1'])","object:not([tabindex='-1'])","*[tabindex]:not([tabindex='-1'])","*[contenteditable]:not([tabindex='-1'])"].join(",");return Array.from(e.querySelectorAll(t))}function _(){return globalThis&&"[object Window]"===Object.prototype.toString.call(globalThis)?window.innerWidth-document.documentElement.clientWidth:0}},84736:(e,t,l)=>{"use strict";l.d(t,{EG:()=>u.Z,Ex:()=>c.Z,FN:()=>m.Z,J2:()=>r.Z,Kx:()=>a.Z,Lt:()=>n.Z,Q2:()=>h.Z,Vp:()=>p.Z,XZ:()=>o.ZP,l0:()=>_.Z,u:()=>g.Z,u_:()=>s.Z,yC:()=>d.Z,zx:()=>i.Z});l(32913);var i=l(99891),o=l(76021),s=l(15194),n=l(89270),a=l(88161),r=l(21797),c=l(63522),d=l(48611),p=l(40996),u=l(83335),m=l(23997),g=l(11643),_=l(60679),h=l(5455)},76706:(e,t,l)=>{"use strict";l.d(t,{Jr:()=>s,OP:()=>a,Yg:()=>n,x3:()=>o});var i=l(55425);const o=()=>(0,i.v_)("/lv/v1/ad_maker/user/get_enable_list",{}),s=e=>(0,i.v_)("/lv/v1/ad_maker/contract/country_code_list",e),n=()=>(0,i.v_)("/lv/v1/ad_maker/contract/dt_list",{}),a=e=>(0,i.v_)("/lv/v1/ad_maker/contract/create_common",e,{timeout:6e4})},27752:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>ht});var i=l(23479),o=l(45599),s=l(50959),n=l(9608),a=l(91550),r=l(66589),c=l(52918),d=l(84736),p=l(42983),u=l(54847),m=l(60251),g=l(59787),_=l(82665),h=l(6471),v=l(25807),x=l(8129),f=l(2555),b=l(94435);function C(e){return Boolean(e.id)}class y{constructor(){(0,g.Z)(this,"itemMap",new Map)}getPublishInfo(e){return this.itemMap.get(e)}async batchPublish(e){const t=[];for(const l of(0,_.Z)(e,10)){const e=await Promise.all(l.map((e=>this.publish(e))));t.push(...e)}return t}async publish(e){var t;const{id:l,onResult:i,onUpdateResult:o}=e,s=JSON.parse(JSON.stringify(e.req));let n=this.itemMap.get(l);if(null!==(t=n)&&void 0!==t&&t.promise&&(0,h.Z)(n.req,s))try{return await n.promise}catch(a){(0,x.c6)("[MaterialPublishService] publish failed, start to retry",{id:l})}return n={promise:null,id:l,req:s,onResult:i,onUpdateResult:o},this.itemMap.set(l,n),n.promise=this.publishImpl(n),n.promise}getErrorText(e){return e?e.message||JSON.stringify(e):""}async publishImpl(e){const t=performance.now(),l=async(l,i)=>{try{const n={error:l,errorText:this.getErrorText(l),time:Math.round(performance.now()-t),resourceId:i};var o,s;if(C(e.req))await(null===(o=e.onUpdateResult)||void 0===o?void 0:o.call(e,{req:e.req,...n}));else await(null===(s=e.onResult)||void 0===s?void 0:s.call(e,{req:e.req,...n}))}catch(n){(0,x.RF)("[MaterialPublishService] callOnResult failed",n)}};let i;try{i=await this.postOrUpdate(e)}catch(o){throw e.promise=null,l(o,""),o}return await l(null,i.resource_id),i}async postOrUpdate(e){return C(e.req)?(await(0,b.Y$)(e.req),{resource_id:e.req.id,source:1}):(0,b.TT)(e.req)}async pollUntilAllInEffectList(e){try{await Promise.race([this.pollUntilAllInEffectListImpl(e),(new f.B).timeout(5e3)])}catch(t){(0,x.RF)("[MaterialPublishService] pollUntilAllInEffectList failed",t)}}async pollUntilAllInEffectListImpl({ids:e,types:t}){const l=performance.now(),i=new f.B,o={count:50,effect_types:t,uid:v.$.userInfo.uid,cursor:0};for(;performance.now()-l<5e3;){const t=await(0,b.Js)(o).catch((()=>null));if(null!=t&&t.effect_item_list){const l=new Set(t.effect_item_list.map((e=>e.common_attr.id)));if(e.every((e=>l.has(e))))return}await i.timeout(500)}}}var w=l(57609),T=l(2514),S=l(539),j=l(46309),N=l(3718),I=l(50366);var P=l(98052);const k="CollectionActionLockKey";var E=l(82725),F=l(86156);l(96706);const Z=async e=>{const t=await fetch(e);return(e=>URL.createObjectURL(e))(await t.blob())};var U=l(1946),A=l(58546);function M(e){return Boolean(e.title&&e.tags.length&&e.cover.id)}var O=l(17095);var L=l(18370);function R(){const e=(0,S.G)({watch:()=>i.isAllUploaded}),t=new m.l,{t:l}=(0,o.$)(),i=(0,c.fv)((()=>({formApi:null,setFormApi:e=>{i.formApi=e},performanceTimingCollector:(0,L.uY)(),initOp:new F.q({fetchFirstPage:async()=>{u.appModel.isInited||await(0,E.cb)({throwOnError:!0}),i.performanceTimingCollector.addTiming("initFullAppInfoDone"),(0,x.c6)("[CollectionStore] getTextTemplateCollectionInitialData req --\x3e");const e=await(0,P.mu)("getTextTemplateCollectionInitialData",{});return(0,x.c6)("[CollectionStore] getTextTemplateCollectionInitialData resp <--",{singles:e.singles}),()=>{i.handleNewSingles(e.singles),i.selectCollectionCard(),i.performanceTimingCollector.addSetStateTiming(L.Pk)}},slardarErrorLog:(e,t)=>{i.performanceTimingCollector.addSetStateTiming(L.Pk,{scene:"initFailed"}),(0,x.RF)(`[CollectionStore] ${e} failed`,t)}}),get mainFormLayout(){const{fetchStatus:e}=i.initOp;return e.isFailed?"error":e.hasFetched?"mainForm":"loading"},get needConfirmModalOnClose(){return!0},pubServ:new y,authorSignService:new w.I({signScene:N.d.BusinessArtist}),authFileUploadServiceManager:new T.r({}),uploadConfigService:new I.w,isAllUploadedWatcher:e,textTemplateIds:[],textTemplateMap:new Map,get textTemplates(){return i.textTemplateIds.map((e=>i.textTemplateMap.get(e)))},selectedTextTemplateId:"",get selectedTextTemplate(){var e;return i.textTemplateIds.includes(i.selectedTextTemplateId)&&null!==(e=i.textTemplateMap.get(i.selectedTextTemplateId))&&void 0!==e?e:null},isCollectionCardSelected:!1,collection:{id:(0,U.V)("text-template-collection"),title:"",description:"",tags:[],cover:{id:"",uri:"",src:"",isUploadFailed:!1}},async init(){i.initOp.initFetchFirstPage(null)},async retryInit(){i.initOp.retryFetchFirstPage()},openOnlineTextTemplatePicker(){t.lock(k,(async()=>{const e=[...i.textTemplateIds];(0,x.c6)("[CollectionStore] openOnlineTextTemplatePicker req --\x3e",{singles:e});const t=await(l={singles:e},P.Jn.call("openOnlineTextTemplatePicker",l));var l;(0,x.c6)("[CollectionStore] openOnlineTextTemplatePicker resp <--",{singles:t.singles}),0!==t.singles.length&&i.handleNewSingles(t.singles)}))},async handleNewSingles(e){if(!e)return;const t=[];if(e.forEach((e=>{const{id:l,source:o,title:s,cover:n,isVip:a}=e;i.textTemplateMap.has(e.id)||(t.push(l),i.textTemplateMap.set(l,{id:l,source:o,title:s,coverSrc:"",tags:[],isOriginal:!1,isVip:a,isBusiness:!1}),i.updateWithBlobUrl(l,n))})),i.textTemplateIds=e.map((e=>e.id)),0===t.length)return void(0,x.c6)("[CollectionStore] handleNewSingles no addedIds");(0,x.c6)("[CollectionStore] handleNewSingles mgetItem start",{ids:t});const l=await(0,b.yF)({items:t.map((e=>({id:e,source:i.textTemplateMap.get(e).source,effect_type:p.Ab.TextTemplate}))),pack_optional:{need_tag:!0,need_parent_tag:!1}});(0,x.c6)("[CollectionStore] handleNewSingles mgetItem success",{ids:l.effect_item_list.map((e=>e.common_attr.id))}),(0,r.z)((()=>{l.effect_item_list.forEach((e=>{var t;const{id:l,business_info:o,is_business:s,is_original:n,tag_list:a}=e.common_attr,r=i.textTemplateMap.get(l);if(!r)return;const c=[...new Set((a||[]).map((e=>e.name)))];r.tags=c,r.isOriginal=n,r.isVip=Boolean(null===(t=o.json)||void 0===t?void 0:t.is_vip),r.isBusiness=s,i.selectedTextTemplateId===l&&i.updateSingleForm({tags:[...c]})}))})),(0,x.c6)("[CollectionStore] handleNewSingles updated with online data")},async updateWithBlobUrl(e,t){try{const l=await Z(t),o=i.textTemplateMap.get(e);if(!o)return;(0,r.z)((()=>{o.coverSrc=l}))}catch(l){(0,x.RF)("[CollectionStore] updateWithBlobUrl error",l,{id:e,src:t})}},selectTextTemplateCard(e){i.saveCurrentForm(),i.isCollectionCardSelected=!1,i.selectedTextTemplateId=e.id},selectCollectionCard(){i.saveCurrentForm(),i.isCollectionCardSelected=!0,i.selectedTextTemplateId=""},initSingleForm(e){i.updateSingleForm({title:e.title,tags:[...e.tags]})},updateSingleForm(e){var t;null===(t=i.formApi)||void 0===t||t.setValues({single:{...i.formApi.getValue("single"),...e}})},initCollectionForm(){var e;const{collection:t}=i;null===(e=i.formApi)||void 0===e||e.setValues({collection:{title:t.title,description:t.description,tags:t.tags}})},updateCollection(e){Object.assign(i.collection,e)},saveCurrentForm(){if(i.isCollectionCardSelected){var e;const t=null===(e=i.formApi)||void 0===e?void 0:e.getValue("collection");if(!t)return;i.collection.title=t.title,i.collection.description=t.description,i.collection.tags=t.tags}},fileEventDispatcher:new A.r({initData:()=>null}),openCoverImageEditor(){t.lock(k,(async()=>{await i.uploadConfigService.refreshUploadConfigsIfNeeded({logPrefix:"[CollectionStore]",when:"openCoverImageEditor"});const{imageUploadConfig:e,objectUploadConfig:t}=await i.uploadConfigService.getUploadConfigs("openCoverImageEditor"),l={collectionId:i.collection.id,type:"CoverImage",singles:i.textTemplateIds,thumbnailSize:200,minImageSize:320,maxImageSize:1e3,maxFileSize:20971520,imageUploadConfig:e,objectUploadConfig:t};(0,x.c6)("[CollectionStore] openTextTemplateImageEditor req --\x3e",{...(0,a.Z)(l,"singles")});const{id:o}=await(e=>P.Jn.call("openTextTemplateImageEditor",e))(l);(0,x.c6)("[CollectionStore] openTextTemplateImageEditor resp <--",{id:o}),o&&i.replaceCover(o)}))},replaceCover(e){i.collection.cover.id&&i.fileEventDispatcher.removeFile(i.collection.cover.id),i.collection.cover={id:e,uri:"",src:"",isUploadFailed:!1},i.fileEventDispatcher.register("Thumbnail",e,(t=>{i.collection.cover.id===e?t.base64?(0,r.z)((()=>{const{cover:e}=i.collection;e.src=((e,t="")=>`data:${t};base64,${e}`)(t.base64)})):(0,x.RF)(`[CollectionStore] cover thumbnail failed {${e}}`):(0,x.c6)(`[CollectionStore] cover thumbnail ignored {${e}}`,{coverId:i.collection.cover.id})})),i.fileEventDispatcher.register("Upload",e,(t=>{if(i.collection.cover.id!==e)return void(0,x.c6)(`[CollectionStore] cover upload ignored {${e}}`,{coverId:i.collection.cover.id});const{cover:l}=i.collection,{uri:o}=t;(0,r.z)((()=>{if(o)l.uri=o,(0,x.c6)(`[CollectionStore] cover upload success {${e}}`,{uri:o});else{l.isUploadFailed=!0;const i=t.error||"unknown";(0,x.RF)(`[CollectionStore] cover upload failed {${e}}`,null,{error:i})}}))}))},async retryUpload(){const e=[],{collection:t}=i;var l;(t.cover.isUploadFailed&&e.push(t.cover.id),e.length)&&((0,x.c6)("[CollectionStore] retryUploadTextTemplateFiles req --\x3e",{ids:e}),await(l={ids:e},P.Jn.call("retryUploadTextTemplateFiles",l)),(0,x.c6)("[CollectionStore] retryUploadTextTemplateFiles resp <--",{}),(0,r.z)((()=>{e.includes(t.cover.id)&&(t.cover.isUploadFailed=!1)})))},get uploadStats(){let e=0,t=0,l=0;const{cover:o}=i.collection;return o.isUploadFailed?l+=1:o.uri?t+=1:e+=1,{pending:e,succeeded:t,failed:l}},get isAllUploaded(){const{pending:e,failed:t}=i.uploadStats;return!e&&!t},get isReadyToPublish(){const e=i.textTemplates.length;return Boolean(e>=3&&e<=20&&M(i.collection)&&!i.isPublishSucceeded)},async uploadAndPublish(e){i.sendMaterialToolClickPublishLog(),i.isAllUploaded||(await i.retryUpload(),null==e||e.show(),await i.isAllUploadedWatcher.start());try{await i.publish()}finally{null==e||e.hide()}},isPublishing:!1,isPublishSucceeded:!1,async publish(){i.isPublishing=!0;try{await i.publishImpl()}catch(e){return d.FN.error(l("pc_sticker_release_failed_retry_web")),(0,r.z)((()=>{i.isPublishing=!1})),void(0,x.RF)("[CollectionStore] publish failed",e)}(0,r.z)((()=>{i.isPublishing=!1,i.isPublishSucceeded=!0})),(0,x.c6)("[CollectionStore] publish success"),setTimeout((()=>(0,j.gk)({showHomePage:!0})),1e3)},async publishImpl(){i.saveCurrentForm();const{collection:e,textTemplates:t,textTemplateIds:l}=i,{cover:o,title:s,description:n,tags:a}=e,r={effect_type:p.Ab.TextTemplateCollection,is_vip:!1,common_data:{title:s,description:n,icon:{image_uri:o.uri},source:b.r0.UserPostPcCollection,tags:[...a],is_business:!1,is_original:!1},collection_info:{resource_id_list:l}};(0,x.c6)("[CollectionStore] collection publish start",{resourceIdList:l});const{resource_id:c}=await i.pubServ.publish({id:e.id,req:r,onResult:({error:e,resourceId:t})=>{!function(e){const{multiLang:t,...l}=e,i=e=>({zh:"cn",en:"en",ja:"jp",ko:"kr"}[e]||""),o=e=>{var l;return null!==(l=null==t?void 0:t.map(e).join(","))&&void 0!==l?l:""};(0,O.g)({eventName:"material_tool_publish_status",params:{...l,...t&&{language_setting:o((({isMultiLang:e})=>e?"multi":"single")),language_type:o((({langs:e})=>i(e[0]))),language_total_type:o((({langs:e})=>e.map(i).join(";")))}}})}({text_template_cnt:l.length,material_type:"collection",status:e?"fail":"success",success_cnt:1}),e?(0,x.RF)("[CollectionStore] collection publish failed",e):(0,x.c6)("[CollectionStore] collection publish success",{resourceId:t})}});(0,x.c6)("[CollectionStore] collection publish done",{resourceId:c}),await i.pubServ.pollUntilAllInEffectList({ids:[c],types:[p.Ab.TextTemplateCollection]}),(0,x.c6)("[CollectionStore] poll done")},sendMaterialToolClickPublishLog(){const{textTemplateIds:e}=i;!function(e){const{caption_template_cnt:t,captionAnimationIds:l=[],text_template_cnt:i,material_type:o,text_special_effect_cnt:s}=e;(0,O.g)({eventName:"material_tool_click_publish_confirm",params:{caption_template_cnt:t,caption_animation_id:l.join(","),text_template_cnt:i,material_type:o,text_special_effect_cnt:s}})}({text_template_cnt:e.length,material_type:"collection"})}})));return function(e){const t=(0,c.fv)((()=>({get watchResult(){return e.watch()}})));(0,s.useEffect)((()=>{const e=(0,r.EH)((()=>{const e=t.watchResult;(0,j.c0)({isNeed:e})}));return()=>{e()}}),[])}({watch:()=>i.needConfirmModalOnClose}),(0,s.useEffect)((()=>{window.store=i,i.init(),i.uploadConfigService.uploadConfigsCache.update();const e=(0,j.KS)("TextTemplateFileProcessResult",(e=>{(0,x.c6)(`[JSB] TextTemplateFileProcessResult ${null==e?void 0:e.type} {${null==e?void 0:e.id}}`,{...(0,a.Z)(e,["result","uri","error"])}),i.fileEventDispatcher.dispatch(e)}));return()=>{e()}}),[]),i}const $=(0,s.createContext)(null),q=()=>(0,s.useContext)($);var z=l(11527);const D=(0,i.Pi)((e=>{const{className:t}=e,{t:l}=(0,o.$)(),i=(0,s.useMemo)((()=>[{key:"collection",title:l("pc_text_template_collection_desc_web"),instructions:[{key:"",title:l("pc_text_template_release_combination_web")}]},{key:"single",title:l("pc_text_template_desc_web"),instructions:[{key:"",title:l("pc_text_template_release_effect_web")}]}]),[]),{isCollectionCardSelected:a,selectedTextTemplateId:r}=q(),c=(0,s.useMemo)((()=>()=>"init"),[]);return(0,z.jsx)(n.v,{className:t,groups:i,initGroup:"collection",activeGroup:a?"collection":"single",resetExpandedGroupKey:a?"collection":`single-${r}`,getStatus:c})}));var B=l(26800),J=l(12390),V=l(72328),W=l(84875),Y=l.n(W),X=l(2237),G=l(87842),H=l(96426),K=l(85083),Q=l(88623),ee=l(15843),te=l(40699),le=l(96305);const ie=e=>{const{className:t}=e,{t:l}=(0,o.$)(),{handleMouseEnter:i}=(0,ee.S)();return(0,z.jsxs)("div",{className:Y()(le.Z.root,t),children:[(0,z.jsx)(G.a,{className:le.Z.icon,size:12,arcColor:"var(--grey-1)"}),(0,z.jsx)("div",{className:le.Z.text,onMouseEnter:i,children:l("pc_stickers_release_in_web")})]})},oe=e=>{const{className:t,tooltip:l}=e,{t:i}=(0,o.$)(),{handleMouseEnter:n}=(0,ee.w)({content:l,className:le.Z.tooltip}),a=(0,s.useRef)(null),{setIsMarqueeLoopRunning:r,reactNode:c}=(0,te.J)({text:i("pc_stickers_release_invalid_web"),gap:16,getEllipsisDOM:()=>a.current});return(0,z.jsxs)("div",{className:Y()(le.Z.root,t,le.Z.error),onMouseEnter:e=>{r(!0),n(e)},onMouseLeave:()=>r(!1),children:[(0,z.jsx)(H.r,{className:le.Z.icon}),(0,z.jsx)("div",{ref:a,className:le.Z.text,children:c})]})},se=e=>{const{className:t,text:l}=e,{handleMouseEnter:i}=(0,ee.S)();return(0,z.jsxs)("div",{className:Y()(le.Z.root,t,le.Z.checked),children:[(0,z.jsx)(Q.r,{className:le.Z.icon}),(0,z.jsx)("div",{className:le.Z.text,onMouseEnter:i,children:l})]})},ne=e=>{const{className:t}=e,{t:l}=(0,o.$)(),{handleMouseEnter:i}=(0,ee.S)();return(0,z.jsxs)("div",{className:Y()(le.Z.root,t),children:[(0,z.jsx)("div",{className:Y()(le.Z.icon,le.Z.yellowIcon),children:(0,z.jsx)("div",{className:le.Z.yellowPoint})}),(0,z.jsx)("div",{className:le.Z.text,onMouseEnter:i,children:l("pc_stickers_release_editing_web")}),(0,z.jsx)(K.r,{className:le.Z.icon})]})},ae=e=>{const{className:t,loading:l,invalid:i,errorToolip:o,isInfoComplete:s,title:n}=e;return l?(0,z.jsx)(ie,{className:t}):i?(0,z.jsx)(oe,{className:t,tooltip:o}):s?(0,z.jsx)(se,{className:t,text:n}):(0,z.jsx)(ne,{className:t})},re="root-W9YKLd",ce="selected-MfKVC9",de="cover-Sg1bSx",pe="icon-NjGS_M",ue="textInfo-zYCck9",me="title-PHGLK_",ge="description-W4AGHI",_e="statusBar-wU3FIA",he="checkedStatusBar-YMzSep",ve=({className:e,selected:t,coverSrc:l,title:i,description:s,isInfoComplete:n,onClick:a})=>{const{t:r}=(0,o.$)(),{handleMouseEnter:c}=(0,ee.S)();return(0,z.jsxs)("div",{className:Y()(e,re,t&&ce),onClick:a,children:[(0,z.jsx)("div",{className:de,children:l?(0,z.jsx)("img",{className:pe,src:l}):(0,z.jsx)(X.t,{className:pe,iconWidth:28})}),(0,z.jsxs)("div",{className:ue,children:[(0,z.jsx)("div",{className:me,onMouseEnter:c,children:i||r("pc_stickers_release_group_name_web")}),(0,z.jsx)("div",{className:ge,onMouseEnter:c,children:s||r("pc_stickers_release_details_recommend_web")})]}),n?(0,z.jsx)(se,{className:he,text:r("pc_stickers_release_finish_fill_web")}):(0,z.jsx)(ne,{className:_e})]})},xe=(0,i.Pi)((e=>{const{className:t}=e,l=q(),{collection:i}=l;return(0,z.jsx)(ve,{className:t,selected:l.isCollectionCardSelected,coverSrc:i.cover.src,title:i.title,description:i.description,isInfoComplete:M(i),onClick:l.selectCollectionCard})}));var fe=l(36983);const be="menu-v4m02G",Ce="menuItemContainer-K5Eent",ye="menuItem-eU7buP";function we(e){const{items:t}=e,l=e=>{e.currentTarget===e.target&&e.stopPropagation()};return(0,z.jsx)("div",{className:be,onClick:l,children:(0,z.jsx)("div",{className:Ce,onClick:l,children:t.map((({key:e,render:t},l)=>t({key:e,index:l,className:ye})))})})}var Te=l(44478),Se=l(20468),je=l(97475);const Ne="root-qThJ3Y",Ie="point-ytHHVg",Pe=e=>{const{position:t,getPopupContainer:l,onClosePopover:i,popoverProps:o}=e,[n,a]=(0,s.useState)(!0),r=(0,B.Z)((()=>a(!1))),c=(0,s.useRef)(null);return(0,s.useLayoutEffect)((()=>{var e;null===(e=c.current)||void 0===e||e.focus()}),[]),(0,z.jsx)(d.J2,{autoAdjustOverflow:!0,position:"bottomLeft",clickToHide:!0,...o,className:Y()(o.className,je.i.heycanPopoverWrapperClearStyle),trigger:"custom",visible:n,onEscKeyDown:r,onClickOutSide:r,getPopupContainer:l,onVisibleChange:e=>{var t;!e&&i(),null===(t=o.onVisibleChange)||void 0===t||t.call(o,e)},children:(0,z.jsx)("div",{className:Ie,tabIndex:-1,ref:c,style:{...t}})})};function ke(e){const{zIndex:t=1e3,...l}=e,[i,n]=(0,s.useState)(null),[a,r]=(0,s.useState)(null),{i18n:c}=(0,o.$)(),d=(0,B.Z)((()=>{i&&(i.destroy(),n(null),r(null))})),p=(0,B.Z)((()=>{null==i||i.destroy()})),u=(0,B.Z)((e=>{if(i)return;const l=document.createElement("div");l.className=Ne,l.style.zIndex=`${t}`;l.addEventListener("wheel",(e=>{e.currentTarget===l&&(e.preventDefault(),e.stopPropagation())}),!1),window.addEventListener("resize",d),document.body.appendChild(l);const o=(0,Te.createRoot)(l);n({container:l,reactRoot:o,destroy:()=>{l.remove(),Promise.resolve().then((()=>o.unmount())),window.removeEventListener("resize",d)}}),r(e)})),m=(0,B.Z)((e=>{e.preventDefault(),e.stopPropagation(),u({left:e.clientX,top:e.clientY})}));return(0,s.useLayoutEffect)((()=>p),[]),(0,s.useLayoutEffect)((()=>{i&&a&&i.reactRoot.render((0,z.jsx)(Se.a,{i18n:c,children:(0,z.jsx)(Pe,{popoverProps:l,getPopupContainer:()=>i.container,onClosePopover:d,position:a})})),i&&(i.container.style.zIndex=`${t}`)})),{handleContextMenu:m}}const Ee="root-NGa4yU",Fe="statusBar-z9k5q0",Ze="contextMenuItem-MQ4rUL",Ue=(0,i.Pi)((e=>{const{className:t,textTemplate:l,isSelected:i,onClick:s,onDelete:n}=e,{t:a}=(0,o.$)(),{handleContextMenu:r}=ke({content:(0,z.jsx)(we,{items:[{key:"remove",render:({key:e,className:t})=>(0,z.jsx)("div",{className:Y()(t,Ze),onClick:()=>n(l),children:a("pc_stickers_release_delete_web")},e)}]})});return(0,z.jsxs)("div",{className:Y()(Ee,t),onClick:()=>{s(l)},children:[(0,z.jsx)(fe.Y,{src:l.coverSrc,isInvalid:!1,isSelected:i,size:80,onContextMenu:e=>{e.preventDefault(),s(l)}}),(0,z.jsx)(ae,{className:Fe,loading:!1,invalid:!1,errorToolip:"",isInfoComplete:!0,title:l.title})]})}));var Ae=l(73008);const Me=(0,i.Pi)((e=>{const{className:t}=e,l=q();return(0,z.jsx)("div",{className:Y()(Ae.Z.root,t),children:(0,z.jsx)("div",{className:Ae.Z.container,children:l.textTemplates.map(((e,t)=>(0,z.jsx)(Ue,{className:Ae.Z.card,textTemplate:e,isSelected:l.selectedTextTemplateId===e.id,onClick:l.selectTextTemplateCard,onDelete:()=>{}},e.id)))})})})),Oe="root-SiuXcn",Le="icon-pvz0IF",Re=e=>{const{className:t,src:l}=e,i=Y()(Oe,t);return(0,z.jsx)("div",{className:i,children:l?(0,z.jsx)("img",{className:Le,src:l}):(0,z.jsx)(X.t,{className:Le,iconWidth:28})})};var $e;function qe(){return qe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i])}return e},qe.apply(this,arguments)}const ze=e=>s.createElement("svg",qe({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),$e||($e=s.createElement("path",{fill:"#D4A500",d:"M8 14c3.292 0 6-2.71 6-6.003C14 4.703 11.292 2 8 2S2 4.703 2 7.997C2 11.29 4.708 14 8 14Zm0-5.142c-.391 0-.62-.217-.638-.614l-.09-2.493c-.024-.421.277-.704.722-.704.445 0 .752.289.728.71l-.09 2.48c-.018.404-.247.621-.632.621Zm0 2.047c-.445 0-.794-.283-.794-.71 0-.428.349-.717.794-.717.451 0 .788.29.788.717s-.343.71-.788.71Z"}))),De="root-OOqubc",Be="loadingText-blkQ9S",Je="errorText-b8vNmn",Ve="retryText-cBAROb",We="warnText-XizvZZ",Ye=e=>{const{className:t,isUploadFailed:l,onRetry:i,needImport:s,loading:n}=e,a=Y()(De,t),{t:r}=(0,o.$)();return l?(0,z.jsx)("div",{className:a,children:(0,z.jsx)("span",{className:Je,children:r("pc_stickers_release_error_x_web",{X:(0,z.jsx)("span",{className:Ve,onClick:i,children:r("pc_stickers_release_click_again_web")},"X")})})}):s?(0,z.jsxs)("div",{className:a,children:[(0,z.jsx)(ze,{height:14,width:14}),(0,z.jsx)("span",{className:We,children:r("pc_stickers_release_add_cover_web")})]}):n?(0,z.jsxs)("div",{className:a,children:[(0,z.jsx)(G.a,{size:12,arcColor:"var(--grey-1)"}),(0,z.jsx)("span",{className:Be,children:r("pc_stickers_release_in_web")})]}):(0,z.jsx)("div",{className:a})},Xe="root-RGRrw_",Ge="statusBar-g7EX3X",He="edit-gNJiPH",Ke=(0,i.Pi)((e=>{const{t}=(0,o.$)(),l=q(),{cover:i}=l.collection;return(0,z.jsxs)("div",{className:Xe,children:[(0,z.jsx)(Re,{src:i.src}),(0,z.jsx)("div",{className:He,onClick:l.openCoverImageEditor,children:t("pc_stickers_release_cover_edit_web")}),(0,z.jsx)(Ye,{className:Ge,isUploadFailed:i.isUploadFailed,onRetry:l.retryUpload,needImport:!i.id,loading:Boolean(i.id&&!i.src)})]})}));var Qe=l(91285),et=l(28747),tt=l(45033);const lt="root-rKCzio",it="titleField-DfDWNz",ot=(0,i.Pi)((()=>{const{t:e}=(0,o.$)(),t=q(),{collection:l}=t;(0,s.useLayoutEffect)((()=>t.initCollectionForm()),[]);const{getDisplayLength:i}=(0,tt._)();return(0,z.jsxs)("div",{className:lt,children:[(0,z.jsx)(Ke,{}),(0,z.jsx)(Qe.l,{fieldClassName:it,label:e("pc_text_template_name_n_web"),field:"collection.title",maxLength:40,allowEnter:!1,placeholder:e("pc_stickers_release_xy_name_web",{X:1,Y:i(40)}),rules:[{required:!0,message:""}],onChange:e=>t.updateCollection({title:e})}),(0,z.jsx)(Qe.l,{label:e("pc_stickers_release_details_recommend_web"),field:"collection.description",maxLength:52,allowEnter:!1,placeholder:e("pc_stickers_release_xy_details_web",{X:1,Y:i(52)}),onChange:e=>t.updateCollection({description:e})}),(0,z.jsx)(et.u,{label:e("pc_text_template_tag_settings_web"),placeholder:e("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"collection.tags",itemType:p.Ab.TextTemplate,recommendConfig:{title:l.title,uri:l.cover.uri},rules:[{required:!0,message:""}],onChange:e=>t.updateCollection({tags:e})})]})})),st="root-l6malL",nt="cover-NC1s_6",at="titleField-GmjT0V",rt=(0,i.Pi)((e=>{const{t}=(0,o.$)(),l=q(),i=l.selectedTextTemplate;(0,s.useLayoutEffect)((()=>{i&&l.initSingleForm(i)}),[i]);const{getDisplayLength:n}=(0,tt._)();return i?(0,z.jsxs)("div",{className:st,children:[(0,z.jsx)(fe.Y,{className:nt,src:i.coverSrc,isInvalid:!1,isSelected:!1,size:128}),(0,z.jsx)(Qe.l,{fieldClassName:at,label:t("pc_stickers_release_set_title_web"),disabled:!0,field:"single.title",maxLength:40,allowEnter:!1,placeholder:t("pc_stickers_release_xy_name_web",{X:1,Y:n(40)}),rules:[{required:!0,message:""}]}),(0,z.jsx)(et.u,{label:t("pc_stickers_release_tag_set_web"),placeholder:t("please_enter_the_label_enter_key_to_confirm_the_input_web"),disabled:!0,field:"single.tags",max:15,itemType:p.Ab.TextTemplate,rules:[{required:!0,message:""}]})]}):null})),ct=(0,i.Pi)((e=>{const{className:t}=e,l=q(),{t:i}=(0,o.$)(),n=(0,B.Z)((()=>{})),a=(0,s.useRef)(null);return(0,J.O)({className:t,layout:l.mainFormLayout,uploadAreaProps:{titleForUploadArea:"",titleForMainForm:i("pc_text_template_add_click_web"),draggingDisabled:!0,disabled:!1,onClick:l.openOnlineTextTemplatePicker,onDrop:n},setFormApi:l.setFormApi,renderImportArea:e=>(0,z.jsxs)(z.Fragment,{children:[e,(0,z.jsx)(V.S,{title:i("pc_text_template_collection_web")}),(0,z.jsx)(xe,{}),(0,z.jsx)(V.S,{title:i("pc_text_template_n_collection_web",{X:l.textTemplateIds.length})}),(0,z.jsx)(Me,{})]}),renderFormArea:()=>l.isCollectionCardSelected?(0,z.jsx)(ot,{}):l.selectedTextTemplate?(0,z.jsx)(rt,{}):null,scrollAreaRef:a,onRetry:l.retryInit})}));var dt=l(74502),pt=l(36775);const ut=(0,i.Pi)((e=>{const{className:t}=e,l=q(),{t:i}=(0,o.$)(),n=(0,s.useRef)(null);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(dt.P,{className:t,leftText:i("pc_text_template_import_web",{X:l.textTemplateIds.length,Y:3,Z:20}),isPublishDisabled:!l.isReadyToPublish,isPublishing:l.isPublishing,needConfirmModalOnClose:l.needConfirmModalOnClose,onPublish:()=>l.uploadAndPublish(n.current),onCancel:()=>(0,j.gk)({showHomePage:!0})}),(0,z.jsx)(pt.q,{ref:n,uploadStats:l.uploadStats,onRetryUpload:l.retryUpload,onCancel:l.isAllUploadedWatcher.stop,onShowUploadFail:()=>{},onPromptConfirmToCancel:l.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var mt=l(12904),gt=l(65546),_t=l(89100);const ht=(0,i.Pi)((e=>{const t=R(),{t:l}=(0,o.$)();return(0,mt.F)({title:l("pc_text_template_collection_release_web"),pid:"publish-text-template-collection"}),(0,gt.d)(),(0,z.jsx)($.Provider,{value:t,children:(0,z.jsxs)("div",{className:_t.Z.page,children:[(0,z.jsxs)("div",{className:_t.Z.content,children:[(0,z.jsx)(D,{className:_t.Z.instruction}),(0,z.jsx)(ct,{className:_t.Z.mainForm})]}),(0,z.jsx)(ut,{className:_t.Z.footer})]})})}))},69905:(e,t,l)=>{"use strict";l.d(t,{Qt:()=>i,cF:()=>s});l(50959);let i=function(e){return e.TagEachUser="TagEachUser",e.UseHasAgree="useHasAgree",e}({});const o={TagEachUser:20};function s(e,t,l=o[e]){return{get:()=>JSON.parse(localStorage.getItem(e)||"{}")[t]||[],set:(i,o)=>{const s=JSON.parse(localStorage.getItem(e)||"{}"),n=s[t]||[];let a=[];"add"===i?(Array.isArray(o)?n.unshift(...o):n.unshift(o),a=Array.isArray(o)?Array.from(new Set(n.slice(0,l))):o):"remove"===i?a=n.filter((e=>Array.isArray(o)?o.includes(e):e!==o)):"change"===i&&(a=o),s[t]=a;const r=JSON.stringify(s);localStorage.setItem(e,r)}}}},84875:(e,t)=>{var l;!function(){"use strict";var i={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var l=arguments[t];if(l){var s=typeof l;if("string"===s||"number"===s)e.push(l);else if(Array.isArray(l)){if(l.length){var n=o.apply(null,l);n&&e.push(n)}}else if("object"===s){if(l.toString!==Object.prototype.toString&&!l.toString.toString().includes("[native code]")){e.push(l.toString());continue}for(var a in l)i.call(l,a)&&l[a]&&e.push(a)}}}return e.join(" ")}e.exports?(o.default=o,e.exports=o):void 0===(l=function(){return o}.apply(t,[]))||(e.exports=l)}()}}]);