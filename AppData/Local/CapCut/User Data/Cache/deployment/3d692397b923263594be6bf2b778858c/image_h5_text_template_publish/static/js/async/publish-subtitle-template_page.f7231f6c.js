"use strict";(self.webpackChunkartist_op_web=self.webpackChunkartist_op_web||[]).push([[294],{86349:(e,t,i)=>{i.d(t,{XH:()=>p});var a=i(22310),l=i(73224),s=i(42983),r=i(99305);const{t:o}=l.I18n;let n=function(e){return e.all="all",e.paster="paster",e.wordart="wordart",e.soundEffect="soundEffect",e.textTemplate="textTemplate",e.subtitleTemplate="subtitleTemplate",e.video="video",e.stickerFramePack="sticker_frame_zip",e.emoticons="emoticons",e.formula="formula",e.filter="filter",e.filterCollection="filter_collection",e.stickerCollection="sticker_collection",e}({});let c=function(e){return e[e.all=0]="all",e[e.wordart=1]="wordart",e[e.paster=2]="paster",e[e.soundEffect=3]="soundEffect",e[e.video=4]="video",e[e.Song=5]="Song",e[e.TextTemplate=6]="TextTemplate",e[e.Special=7]="Special",e[e.FaceSpecial=8]="FaceSpecial",e[e.Image=9]="Image",e[e.SubtitleTemplate=48]="SubtitleTemplate",e[e.Filter=12]="Filter",e[e.StickerCollection=102]="StickerCollection",e[e.FilterCollection=112]="FilterCollection",e[e.emoticons=105]="emoticons",e[e.stickerFramePack=1e3]="stickerFramePack",e[e.formula=50]="formula",e}({});s.Ab.TextTemplate,o("text_template"),s.Ab.Sticker,o("sticker"),s.Ab.WordArt,o("flower_character"),s.Ab.Filter,o("filter"),s.Ab.Sticker,o("pc_template_authorize_sticker_web"),s.Ab.WordArt,o("pc_template_authorize_effect_web"),s.Ab.Font,o("pc_template_authorize_font_web");const p={[c.paster]:o("original_stickers_web"),[c.TextTemplate]:o("pc_text_template_origial_material_web"),[c.SubtitleTemplate]:o("pc_subtitle_original"),[c.wordart]:o("original_cursive"),[c.soundEffect]:o("pc_material_release_original_material"),[c.Filter]:o("pc_material_release_original_material"),[c.video]:o("pc_material_release_original_material")};c.all,n.all,c.paster,n.paster,c.wordart,n.wordart,c.soundEffect,n.soundEffect,c.video,n.video,c.emoticons,n.emoticons,c.formula,n.formula,c.Filter,n.filter,c.FilterCollection,n.filterCollection,c.TextTemplate,n.textTemplate,c.SubtitleTemplate,n.subtitleTemplate,c.StickerCollection,n.stickerCollection,n.wordart,c.wordart,n.paster,c.paster,n.soundEffect,c.soundEffect,n.video,c.video,n.emoticons,c.emoticons,n.formula,c.formula,n.filter,c.Filter,n.filterCollection,c.FilterCollection,n.textTemplate,c.TextTemplate,c.SubtitleTemplate,n.subtitleTemplate,n.stickerCollection,c.StickerCollection,n.all,n.paster,n.wordart,n.soundEffect,n.video,n.emoticons,n.formula,c.paster,c.StickerCollection,c.wordart,c.soundEffect,c.video,c.stickerFramePack,c.emoticons,c.formula,c.Image,c.Special,c.FaceSpecial,c.TextTemplate,c.SubtitleTemplate,c.Filter,c.FilterCollection,c.paster,c.wordart,c.soundEffect,c.video,c.emoticons,c.TextTemplate,c.SubtitleTemplate;let u=function(e){return e[e.default=0]="default",e[e.latest=1]="latest",e[e.hotest=2]="hotest",e}({});u.default,u.latest,u.hotest,c.all,c.paster,c.video,c.soundEffect,c.wordart;r.Ms.Offline,r.Ms.Online,r.Ms.HomepageOnline,r.Ms.HomepageOnline,r.KM.Passed,r.KM.Passed,r.Ms.Reviewing,r.Ms.SelfView,r.Ms.HomepageOnline,r.Ms.SelfView,r.KM.WaitReview,r.KM.RiskReviewing,r.KM.QualityReviewing,r.KM.CopyrightReviewing,r.Ms.HomepageOnline,r.KM.WaitReview,r.KM.RiskReviewing,r.KM.QualityReviewing,r.KM.CopyrightReviewing,r.KM.WaitReview,r.KM.RiskReviewing,r.KM.QualityReviewing,r.KM.CopyrightReviewing,r.Ms.HomepageOnline,r.Ms.SelfView,r.Ms.Banned,r.Ms.HomepageOnline,r.KM.Unknown,r.KM.RiskReviewFailed,r.KM.QualityReviewFailed,r.KM.CopyrightReviewFailed,r.Ms.SelfView,r.KM.Unknown,r.KM.RiskReviewFailed,r.KM.QualityReviewFailed,r.KM.CopyrightReviewFailed,r.KM.Passed,r.KM.Unknown,r.KM.RiskReviewFailed,r.KM.QualityReviewFailed,r.KM.CopyrightReviewFailed,r.Ms.HomepageOnline,r.KM.QualityReviewFailed,r.KM.CopyrightReviewFailed,r.Ms.SelfView,r.KM.QualityReviewFailed,r.KM.CopyrightReviewFailed,r.KM.Passed;let d=function(e){return e[e.Douyin=0]="Douyin",e[e.Heycon=1]="Heycon",e[e.VideoCut=2]="VideoCut",e[e.WebVideoCut=3]="WebVideoCut",e[e.Ulike=4]="Ulike",e[e.Effect=5]="Effect",e}({});d.Douyin,d.Heycon,d.VideoCut,d.WebVideoCut,d.Ulike,d.Effect,d.Douyin,d.Heycon,d.VideoCut,d.WebVideoCut,d.Ulike,d.Effect,d.Douyin,d.Heycon,d.VideoCut,d.WebVideoCut,d.Ulike,d.Effect,(0,a.Z)((()=>({zh:o("pc_text_tamplate_language_cn_web"),en:o("pc_text_tamplate_language_en_web"),ja:o("pc_text_tamplate_language_jp_web"),ko:o("pc_text_tamplate_language_kr_web")})))},67078:(e,t,i)=>{i.d(t,{$X:()=>r,pn:()=>l,sR:()=>s});var a=i(94435);function l({isVip:e,isBusiness:t,authFiles:i}){var l;const s=null!==(l=null==i?void 0:i.map((({uri:e})=>({uri:e}))))&&void 0!==l?l:[];return{root:{is_vip:!1,copyright:{copyright_info:[{scene:a.$x.Vip,auth_status:e?a.U9.Authorized:a.U9.Unauthorized,third_party_agreements:[]},{scene:a.$x.Business,auth_status:t?a.U9.Authorized:a.U9.Unauthorized,third_party_agreements:t?s:[]}]}},commonData:{is_business:!1,is_original:Boolean(e||t)}}}function s(e){const{isOriginal:t=!1,isVip:i=!1,isBusiness:a=!1,authFiles:s}=e;const{root:r}=l({isVip:i,isBusiness:a,authFiles:s});return{copyright:r.copyright}}function r(e,t){return Boolean(null==e?void 0:e.copyright_info.some((e=>e.scene===t&&e.auth_status===a.U9.Authorized)))}},9679:(e,t,i)=>{i.d(t,{$v:()=>p,Ad:()=>d,DV:()=>n,SB:()=>g,Sj:()=>c,_4:()=>m,ce:()=>u,iL:()=>r,j2:()=>o});var a=i(17095);function l(e){return void 0===e?e:String(Math.round(e/1024))}function s(e){const{material_category:t,material_type:i,collection_detail:a}=e;return{material_category:t,material_type:i,...a&&"collection"===i&&{collection_detail:a}}}function r(e){const{action:t,extra:i={}}=e;(0,a.g)({eventName:"personal_page_material_publish_page_action",params:{action:t,...s(e),...i}})}function o(e){const{error_report:t,upload_status:i,time:r,isCompressed:o,sizeBeforeCompress:n,sizeAfterCompress:c,resolutionBeforeCompress:p,resolutionAfterCompress:u,extra:d={}}=e;(0,a.g)({eventName:"personal_page_material_upload_status",params:{...s(e),error_report:t,upload_status:i,time:r,is_compressed:o?1:0,...o&&{material_size_before_compress:l(n),material_size_after_compress:l(c),material_resolution_before_compress:p,material_resolution_after_compress:u},...d}})}function n(e){const{error_report:t}=e;(0,a.g)({eventName:"personal_page_material_import_error_report",params:{...s(e),error_report:t}})}function c(e){if(0===e.length)return;const t=function(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,i])=>{const a=i||"";t[e]=t[e]?`${t[e]},${a}`:a}))})),t}(e),i=new Set(t.material_type.split(","));1===i.size&&(t.material_type=i.values().next().value),(0,a.g)({eventName:"personal_page_material_publish_error_report",params:t})}function p(e){const{status:t,material_type:i,material_category:s,title:r,description:o,isOriginal:n,tags:c,material_format:p,material_size:u,resolution:d,error_type:m,cover_type:g,time:f,extra:_={},authorize_range:b,isVipAuthorized:h,isBusinessAuthorized:T}=e;return(0,a.g)({eventName:"personal_page_material_publish_status",params:{status:t,material_type:i,material_category:s,material_title:r,material_introduction:o,is_original:n?"1":"0",hashtag:c.join(","),material_format:p,material_size:l(u),resolution:d,authorize_range:b,..."fail"===t&&{error_type:m},cover_type:g,time:f,is_subscription_authorized:h?1:0,is_commercial_authorized:T?1:0,..._}})}function u(e){const{action:t,material_category:i,material_type:l,entry_from:s}=e;return(0,a.g)({eventName:"ugc_material_subscription_original_statment",params:{action:t,material_category:i,material_type:l,entry_from:s}})}function d(e){const{action:t,material_category:i,material_type:l,entry_from:s,hasCopyrightAuthorization:r}=e;return(0,a.g)({eventName:"ugc_material_commercial_original_statment",params:{action:t,material_category:i,material_type:l,entry_from:s,..."boolean"==typeof r&&{has_copyright_authorization:r?"1":"0"}}})}function m(e){const{action:t,page_type:i,material_category:l,material_type:s,button_name:r}=e;return(0,a.g)({eventName:"ugc_material_creator_sign_agreement",params:{action:t,page_type:i,material_category:l,material_type:s,...r&&{button_name:r}}})}function g(e){const{caption_template_cnt:t,captionAnimationIds:i=[],text_template_cnt:l,material_type:s,text_special_effect_cnt:r}=e;return(0,a.g)({eventName:"material_tool_click_publish_confirm",params:{caption_template_cnt:t,caption_animation_id:i.join(","),text_template_cnt:l,material_type:s,text_special_effect_cnt:r}})}},48823:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Re});var a=i(23479),l=i(45599),s=i(50959),r=i(9608),o=i(11527);const n=(0,a.Pi)((e=>{const{className:t}=e,{t:i}=(0,l.$)(),a=(0,s.useMemo)((()=>[{key:"subtitleTemplate",title:i("pc_subtitle_template_description_web"),instructions:[{key:"",title:i("pc_subtitle_template_effect_release_web")}]}]),[]),n=(0,s.useMemo)((()=>()=>"init"),[]);return(0,o.jsx)(r.v,{className:t,groups:a,initGroup:"subtitleTemplate",activeGroup:"subtitleTemplate",resetExpandedGroupKey:"subtitleTemplate",getStatus:n})}));var c=i(26800),p=i(12390),u=i(72328),d=i(84875),m=i.n(d),g=i(36983),f=i(69836),_=i(91550),b=i(66589),h=i(97311),T=i(21423),w=i(45735),S=i(17941),v=i(33556),y=i(42983);function F(e){const{id:t,resourceId:i,isMultiLang:a}=e,l=e.languages.map(((e,t)=>function(e,t){const{lang:i,resourceId:a,templateZipData:l}=e,{coverFile:s,extraJson:r}=l.template;return{lang:i,resourceId:a,templateZipData:l,cover:(0,T.B4)({src:t.needSrc?(0,h.y8)(s):"",file:s}),staticFrame:(0,T.wt)({}),file:(0,b.LO)({...(0,T.Dz)({}),previewTime:0,extraJson:r},{extraJson:b.LO.ref}),publishType:a?"update":"create"}}(e,{needSrc:!0})));return(0,b.LO)({id:t,resourceId:a?i:l[0].resourceId,title:"",tags:[],isOriginal:!1,isBusiness:!1,isVip:(0,S.K)(v.YW.OriginalForSubscription),isHighPriority:!1,isMultiLang:a,languages:l,onlineData:{isOriginal:!1,isVip:!1,isBusiness:!1,resourceId:i,langResourceIds:[],langResourceIdMap:{}}},{onlineData:b.LO.ref})}function x(e){return Boolean(e.title&&e.tags.length&&e.languages[0].staticFrame.src)}function C(e){return e.languages[0]}const L="root-yJbCk1",k="statusBar-p1WeHS",P=(0,a.Pi)((e=>{const{className:t,subtitleTemplate:i,isSelected:a,onClick:l}=e,s=C(i),r=!s.staticFrame.src;return(0,o.jsxs)("div",{className:m()(L,t),onClick:()=>{l(i)},children:[(0,o.jsx)(g.Y,{src:r?"":s.cover.src,isInvalid:!1,isSelected:a,size:80,onContextMenu:e=>{e.preventDefault(),l(i)}}),(0,o.jsx)(f.ir,{className:k,loading:r,invalid:!1,errorToolip:"",isInfoComplete:x(i),title:i.title})]})}));var M=i(52918),U=i(84736),A=i(94435),I=i(31086),R=i(8129),D=i(57609),Z=i(2514),j=i(539),O=i(46309),N=i(3718),V=i(50366),z=i(86156),B=i(54847),K=i(82725),H=i(86324),E=i(1946);var $=i(35686),W=i(21130),J=i(25807),Q=i(84677),q=i(79668),G=i(2555),X=i(18370),Y=i(74575),ee=i(33372),te=i(9679);function ie(){const e=(0,j.G)({watch:()=>o.isAllUploaded}),t=(0,j.G)({watch:()=>o.isDepUploaded&&!o.isAllUploadedWatcher.isPromptingConfirmToCancel}),i=(0,Y.e)({watch:()=>o.subtitleTemplateList.materials.every((e=>e.languages.every((e=>e.staticFrame.src))))}),a=(0,s.useMemo)((()=>new V.w),[]),{t:r}=(0,l.$)(),o=(0,M.fv)((()=>({formApi:null,setFormApi:e=>{o.formApi=e},performanceTimingCollector:(0,X.uY)(),initOp:new z.q({fetchFirstPage:async()=>{B.appModel.isInited||await(0,K.cb)({throwOnError:!0}),o.performanceTimingCollector.addTiming("initFullAppInfoDone");const e=[],t=[],i=[await o.makeInitSubtitleTemplate(e,t)];o.performanceTimingCollector.addTiming("initSubtitleTemplateDone"),(0,R.c6)("[SingleStore] make init flowerText sticker start");const a=e.map((e=>(0,ee.Sv)(e))),l=t.map((e=>(0,ee.wu)(e)));return()=>{o.subtitleTemplateList.replaceByMap(i,(e=>e)),o.flowerTextList.replaceByMap(a,(e=>e)),o.stickers=l;const e=o.subtitleTemplateList.materials[0];o.subtitleTemplateList.select(e),o.initStaticFrame(o.subtitleTemplateList.materials),o.initUploadFiles(),o.performanceTimingCollector.addSetStateTiming(X.Pk)}},slardarErrorLog:(e,t)=>{(0,R.RF)(`[SingleStore] ${e} failed`,t),o.performanceTimingCollector.addSetStateTiming(X.Pk,{scene:"initFailed"})}}),async makeInitSubtitleTemplate(e,t){const i=[],a=(0,E.V)("subtitle-template");(0,R.c6)("[SingleStore] makeInitSubtitleTemplate start",{id:a});const l="en",s=new H.v({id:`${l}-${a}`,effectType:y.Ab.SubtitleTemplate,fetchZipBase64:async()=>{const{zipData:e}=await(0,O.ae)();return e}});await s.init(),i.push({lang:l,resourceId:"",templateZipData:s});for(const r of s.flowerTexts){const t=r.id;e.push({groupId:t,subFlowerTexts:[{lang:l,data:r}]})}for(const r of s.stickers)t.some((e=>e.id===r.id))||t.push(r);return(0,R.c6)("[SingleStore] makeInitSubtitleTemplate done",{id:a}),F({id:a,isMultiLang:!1,resourceId:"",languages:i})},get mainFormLayout(){const{fetchStatus:e}=o.initOp;return e.isFailed?"error":e.hasFetched?"mainForm":"loading"},get needConfirmModalOnClose(){return!0},get field(){return{canBusiness:J.$.permissions.includes(J.v.EffectSetBusiness),canVip:J.$.permissions.includes(J.v.EffectSetVip),canHighPrio:J.$.permissions.includes(J.v.EffectHighPrio)}},pubService:new I.Z,sendLogService:new W.D5({itemType:y.Ab.SubtitleTemplate}),authorSignService:new D.I({signScene:N.d.BusinessArtist}),authFileUploadServiceManager:new Z.r({}),isAllUploadedWatcher:e,fileOp:new T.N0({uploadConfigService:a}),subtitleTemplateList:new $.T({}),flowerTextList:new $.T({}),stickers:[],init(){o.initOp.initFetchFirstPage(null)},retryInit(){o.initOp.retryFetchFirstPage()},selectSubtitleTemplateCard(e){o.saveCurrentForm(),o.subtitleTemplateList.select(e),o.flowerTextList.select(null)},selectFlowerTextCard(e){o.saveCurrentForm(),o.flowerTextList.select(e),o.subtitleTemplateList.select(null)},initSubtitleTemplateForm(e){var t;null===(t=o.formApi)||void 0===t||t.setValues({subtitleTemplate:{title:e.title,tags:[...e.tags],isOriginal:e.isOriginal,isVip:e.isVip,isBusiness:e.isBusiness,isHighPriority:e.isHighPriority}})},saveSubtitleTemplateForm(e){var t;const i=null===(t=o.formApi)||void 0===t?void 0:t.getValues().subtitleTemplate;i&&(0,Q.L)(e,{title:i.title||"",tags:i.tags,isOriginal:i.isOriginal||!1,isVip:i.isVip||!1,isBusiness:i.isBusiness||!1,isHighPriority:i.isHighPriority||!1})},initFlowerTextForm(e){var t;null===(t=o.formApi)||void 0===t||t.setValues({flowerText:{title:e.title,tags:[...e.tags]}})},applyTagsToAll(e){o.flowerTextList.updateAll((t=>{t.tags=[...e]}))},saveFlowerTextForm(e){var t;const i=null===(t=o.formApi)||void 0===t?void 0:t.getValues().flowerText;i&&(0,Q.L)(e,{title:i.title||"",tags:i.tags})},saveCurrentForm(){o.subtitleTemplateList.selected?o.saveSubtitleTemplateForm(o.subtitleTemplateList.selected):o.flowerTextList.selected&&o.saveFlowerTextForm(o.flowerTextList.selected)},initStaticFrameTimer:new G.B,async initStaticFrame(e){for(const t of e){const{id:e,languages:i}=t;for(let a=0;a<i.length;a+=1){const l=i[a];await o.fileOp.initStaticFrame({id:`${l.lang}-${e}`,getInitIndex:()=>0===a?null:t.languages[0].staticFrame.index,staticFrame:l.staticFrame,templateZipData:l.templateZipData}),await o.initStaticFrameTimer.timeout(100)}}},async initUploadFiles(){try{await a.getUploadConfigs("initUploadFiles")}catch{}for(const e of o.subtitleTemplateList.materials)o.initUploadSubtitleTemplateFiles(e);(0,ee.er)(o.fileOp,{flowerTexts:o.flowerTextList.materials,stickers:o.stickers})},initUploadSubtitleTemplateFiles(e){for(const t of e.languages)o.fileOp.initUploadCover({getCover:()=>t.cover,getInitValues:()=>({id:(0,E.V)("subtitle-template-cover")})})},async retryUpload(){o.depPublishStatus.isCanceled=!1;try{await a.getUploadConfigs("retryUploadFiles")}catch{o.depPublishStatus.isFailed=!0}for(const e of o.subtitleTemplateList.materials)for(const t of e.languages)o.fileOp.retryUpload(t.cover,t.staticFrame,t.file);(0,ee.Id)(o.fileOp,{flowerTexts:o.flowerTextList.materials,stickers:o.stickers})},handleUploadCancel(){t.stop(),i.stop(),o.isAllUploadedWatcher.stop(),o.depPublishStatus.isCanceled=!0},async initUploadStaticFrame(e){await i.start();for(const t of e.languages)o.fileOp.initUploadCover({getCover:()=>t.staticFrame,getInitValues:()=>({id:(0,E.V)("subtitle-template-static-frame"),file:new File([(0,h.Jr)(t.staticFrame.src)],"icon.png",{type:"image/png"})})})},handleStaticFrameChange(e,t){for(const i of e.languages)o.fileOp.updateStaticFrame(i.staticFrame,t)},async publishDeps(){const{subtitleTemplateList:e,flowerTextList:t,stickers:i}=o,a=e.materials[0],l=(0,_.Z)(a,"isVip","isBusiness","isOriginal","isHighPriority"),s=(0,ee.Kl)(t.materials,l),r=(0,ee.Rd)(i,{...l,getTitle:(e,t)=>{const i=String(t+1).padStart(2,"0");return`${a.title}-${i}`}}),n=await o.pubService.batchPublish([...s,...r]),c=(0,ee.Wl)({flowerTexts:o.flowerTextList.materials,stickers:o.stickers}),p=n.map((e=>e.resource_id));return(0,R.c6)("[SingleStore] deps publish success",{resourceIdList:p,depResourceIdMap:c}),{depResourceIdMap:c}},clearSubtitleTemplateZip(){o.fileOp.templateZipCacheMap.clear();for(const e of o.subtitleTemplateList.materials)for(const t of e.languages)o.fileOp.saveTemplateZipCache(e.id,t.lang,t.file)},async initUploadSubtitleTemplateZip(e,t){const{subtitleTemplateList:i}=o;for(const a of i.materials)for(const i of a.languages){const{lang:l,staticFrame:s,templateZipData:r}=i;if(await o.fileOp.initUploadTemplateZip({id:a.id,lang:l,zipFile:i.file,staticFrame:s,templateZipData:r,depResourceIdMap:e,checkIsCanceled:()=>t.isCanceled}),t.isCanceled)return}},depPublishStatus:{isFailed:!1,isCanceled:!1,isDone:!1},async startUploadAndPublishDeps(e){try{for(const e of o.subtitleTemplateList.materials)o.initUploadStaticFrame(e);await t.start();const{depResourceIdMap:i}=await o.publishDeps();if(e.isCanceled)return;await o.initUploadSubtitleTemplateZip(i,e),(0,b.z)((()=>{e.isDone=!0}))}catch(i){(0,b.z)((()=>{e.isFailed=!0})),(0,R.RF)("[SingleStore] startUploadAndPublishDeps failed",i)}},get depUploadStats(){const e={pending:0,succeeded:0,failed:0};for(const t of o.flowerTextList.materials)for(const i of t.subFlowerTexts)(0,T.r)(e,i.cover,i.file);for(const t of o.stickers)(0,T.r)(e,t.cover);return e},get isDepUploaded(){const{pending:e,failed:t}=o.depUploadStats;return!e&&!t},get uploadStats(){const e={uninited:0,...o.depUploadStats};for(const a of o.subtitleTemplateList.materials)for(const t of a.languages)(0,T.r)(e,t.cover,t.staticFrame,t.file);const{isFailed:t,isDone:i}=o.depPublishStatus;return t?e.failed+=1:i?e.succeeded+=1:e.pending+=1,e},get isAllUploaded(){const{pending:e,failed:t}=o.uploadStats;return!e&&!t},get isReadyToPublish(){const{subtitleTemplateList:e,flowerTextList:t}=o;return e.length>0&&e.materials.every((e=>x(e)))&&t.materials.every((e=>(0,ee.QX)(e)))&&!o.isPublishSucceeded},async uploadAndPublish(e){o.saveCurrentForm(),o.sendMaterialToolClickPublishLog(),o.retryUploadAndPublishDeps(),null==e||e.show(),await o.isAllUploadedWatcher.start();try{await o.publish()}finally{null==e||e.hide()}},async retryUploadAndPublishDeps(){o.clearSubtitleTemplateZip(),o.depPublishStatus={isFailed:!1,isCanceled:!1,isDone:!1};const{depPublishStatus:e}=o;await o.retryUpload(),o.startUploadAndPublishDeps(e)},isPublishing:!1,isPublishSucceeded:!1,async publish(){o.isPublishing=!0;try{await o.publishImpl()}catch(e){return U.FN.error(r("pc_sticker_release_failed_retry_web")),(0,b.z)((()=>{o.isPublishing=!1})),void(0,R.RF)("[SingleStore] publish failed",e)}(0,b.z)((()=>{o.isPublishing=!1,o.isPublishSucceeded=!0})),U.FN.info({content:r("pc_subtitle_template_release_successful_check_web",{num:o.subtitleTemplateList.length}),textMaxWidth:"80vw"}),(0,R.c6)("[SingleStore] publish success"),setTimeout((()=>(0,O.gk)({showHomePage:!0})),3e3)},async publishImpl(){const e=o.subtitleTemplateList.materials.map((e=>{const{isMultiLang:t}=e,{authFileUploadServiceManager:i}=o;return e.languages.map((a=>{const l=`${a.lang}-${e.id}`,s=function(e,t){const i=C(e),a={...(0,_.Z)(e,["title","tags","isHighPriority","isVip","isBusiness","isOriginal"]),...(0,_.Z)(i,"cover","staticFrame","file"),authFiles:t.authFileUploadServiceManager.getUploadedFiles(e.id),baseSource:t.baseSource};return"update"===i.publishType?(0,w.xo)({id:i.resourceId,onlineData:e.onlineData,...a}):(0,w.Ob)({effectType:y.Ab.SubtitleTemplate,templateZipData:i.templateZipData,extraJson:i.file.extraJson,...a})}(e,{authFileUploadServiceManager:i,baseSource:"new_caption_template_tool"===B.appModel.appInfo.currentScene?A.r0.UserPostPcNewTool:A.r0.UserPostPc});return{id:l,req:s,onResult:(0,b.aD)((({req:i,resourceId:s,error:r,errorText:n,time:c})=>{o.sendLogService.sendMaterialPublishStatusLog({time:c,status:r?"fail":"success",error_type:n,publishParams:i,path:""}),r?(0,R.RF)(`[SingleStore] single publish failed {${l}}`,r):(a.resourceId=s,t||(e.resourceId=s),(0,R.c6)(`[SingleStore] single publish success {${l}}`,{resourceId:s}))})),onUpdateResult:(0,b.aD)((({req:e,resourceId:t,error:i,errorText:a,time:s})=>{i?(0,R.RF)(`[SingleStore] single update failed {${l}}`,i):(0,R.c6)(`[SingleStore] single update success {${l}}`,{resourceId:t})}))}}))})).flat();(0,R.c6)("[SingleStore] single publish start",{resourceIdList:e.map((e=>e.id))});const t=(await o.pubService.batchPublish(e)).map((e=>e.resource_id));(0,R.c6)("[SingleStore] single publish done",{resourceIdList:t});o.subtitleTemplateList.materials.some((e=>!e.onlineData.resourceId))?(await o.pubService.pollUntilAllInEffectList({ids:t.slice(-I.f),types:[y.Ab.SubtitleTemplate]}),(0,R.c6)("[SingleStore] poll done")):(0,R.c6)("[SingleStore] no need to poll")},async sendMaterialToolClickPublishLog(){const{subtitleTemplateList:e}=o,t=e.materials.map((e=>{var t;const i=e.languages[0].templateZipData.template.captionAnimationJson;return null!==(t=null==i?void 0:i.caption_animation.map((e=>e.resource_id)).filter((e=>Boolean(e))))&&void 0!==t?t:[]}));(0,R.c6)("[SingleStore] sendMaterialToolClickPublishConfirm",{caption_template_cnt:e.length,captionAnimationIds:t.flat()}),(0,te.SB)({caption_template_cnt:e.length,captionAnimationIds:t.flat(),material_type:"single"})},collectLogData(){const e=["id","uri","isUploadFailed"],t=o.subtitleTemplateList.materials.map((t=>({...(0,_.Z)(t,"id","resourceId","isMultiLang"),languages:t.languages.map((t=>({...(0,_.Z)(t,"lang","resourceId"),cover:(0,_.Z)(t.cover,e),staticFrame:(0,_.Z)(t.staticFrame,[...e,"index"]),file:(0,_.Z)(t.file,e),extraJson:t.file.extraJson})))}))),i=o.flowerTextList.materials.map((t=>({...(0,_.Z)(t,"id","isDepMaterial","sdkVersion"),subFlowerTexts:t.subFlowerTexts.map((t=>({...(0,_.Z)(t,"id","lang","resourceId"),cover:(0,_.Z)(t.cover,e),file:(0,_.Z)(t.file,e)})))}))),a=o.stickers.map((t=>({...(0,_.Z)(t,"id","resourceId","isDepMaterial","isSequence"),cover:(0,_.Z)(t.cover,e)}))),l={subtitleTemplates:t,subtitleTemplateCount:t.length,flowerTexts:i,stickers:a,isReadyToPublish:o.isReadyToPublish,depPublishStatus:{...o.depPublishStatus},uploadStats:{...o.uploadStats}};(0,R.c6)("[SingleStore] collectLogData",l)}})));return(0,q.L)({watch:()=>{o.uploadStats,o.isReadyToPublish},collect:o.collectLogData}),(0,s.useEffect)((()=>(window.store=o,o.init(),o.authorSignService.init(),()=>{o.initStaticFrameTimer.cancel()})),[]),o}const ae=(0,s.createContext)(null),le=()=>(0,s.useContext)(ae);var se=i(73008);const re=(0,a.Pi)((e=>{const{className:t}=e,i=le();return(0,o.jsx)("div",{className:m()(se.Z.root,t),children:(0,o.jsx)("div",{className:se.Z.container,children:i.subtitleTemplateList.materials.map(((e,t)=>(0,o.jsx)(P,{className:se.Z.card,subtitleTemplate:e,isSelected:i.subtitleTemplateList.selectedId===e.id,onClick:i.selectSubtitleTemplateCard},e.id)))})})}));var oe=i(89563);const ne=(0,a.Pi)((e=>{const{className:t}=e,i=le();return(0,o.jsx)("div",{className:m()(se.Z.root,t),children:(0,o.jsx)("div",{className:se.Z.container,children:i.flowerTextList.materials.map(((e,t)=>(0,o.jsx)(oe.M,{className:se.Z.card,flowerText:e,isSelected:i.flowerTextList.selectedId===e.id,onClick:i.selectFlowerTextCard},e.id)))})})}));var ce=i(91285),pe=i(28747),ue=i(37991),de=i(63541),me=(i(15443),i(76199)),ge=i(6858),fe=i(45033),_e=i(53803),be=i(56130);const he="root-pUimlh",Te="cover-UHqwrX",we="selectStaticFrame-QFz5WO",Se="titleField-ln4TF0",ve="businessCheckbox-GzKVjp",ye="highPriorityWrapper-mVBX2P",Fe=(0,a.Pi)((e=>{const{subtitleTemplate:t}=e,{t:i}=(0,l.$)(),a=le();(0,s.useLayoutEffect)((()=>a.initSubtitleTemplateForm(t)),[]);const{getDisplayLength:r}=(0,fe._)(),n=C(t),{openFramePicker:c}=(0,ue.v)(),p=(0,Y.e)({watch:()=>C(t).staticFrame.list.length>0}),u=Boolean(t.onlineData.resourceId);return(0,o.jsxs)("div",{className:he,children:[(0,o.jsx)(g.Y,{className:Te,src:n.staticFrame.src,isInvalid:!1,isSelected:!1,size:128}),(0,o.jsx)("div",{className:we,onClick:()=>{c({onOK:e=>a.handleStaticFrameChange(t,e),fetchData:async()=>{await p.start();const{list:e,index:t}=n.staticFrame;return{list:e,index:t}}})},children:i("pc_stickers_release_cover_edit_web")}),(0,o.jsx)(ce.l,{fieldClassName:Se,label:i("pc_text_template_name_n_web"),field:"subtitleTemplate.title",maxLength:40,allowEnter:!1,placeholder:i("pc_stickers_release_xy_name_web",{X:1,Y:r(40)}),rules:[{required:!0,message:""}],onChange:(0,b.aD)((e=>t.title=e))}),(0,o.jsx)(pe.u,{label:(0,o.jsx)("div",{className:be.Z.labelHeader,children:(0,o.jsx)(U.l0.Label,{required:!0,children:i("pc_text_template_tag_settings_web")})}),placeholder:i("please_enter_the_label_enter_key_to_confirm_the_input_web"),field:"subtitleTemplate.tags",itemType:y.Ab.SubtitleTemplate,recommendConfig:{title:t.title,uri:n.cover.uri},ignoreAddTagOnBlurSelector:`.${be.Z.applyToAll}`,onChange:(0,b.aD)((e=>t.tags=e))}),!1,(0,o.jsx)(de.Z,{children:(0,o.jsxs)("div",{className:_e.Z.authGroup,children:[(0,o.jsx)(de._,{text:i("pc_template_authorize_range_web")}),(0,o.jsxs)("div",{className:_e.Z.right,children:[(0,o.jsx)(me.l,{noLabel:!0,field:"subtitleTemplate.isVip",sendLogService:a.sendLogService}),(0,o.jsx)(ge.R,{fieldClassName:ve,noLabel:!0,field:"subtitleTemplate.isBusiness",vipField:"subtitleTemplate.isVip",authorSignService:a.authorSignService,getAuthFileUploadService:()=>a.authFileUploadServiceManager.ensure(t.id),sendLogService:a.sendLogService})]})]})}),a.field.canHighPrio&&(0,o.jsx)(de.Z,{className:ye,hiddenFieldLabel:!0,children:(0,o.jsxs)("div",{className:_e.Z.authGroup,children:[(0,o.jsx)(de._,{text:i("pc_text_template_release_settings_web")}),(0,o.jsx)("div",{className:_e.Z.right,children:(0,o.jsx)(U.z8,{noLabel:!0,field:"subtitleTemplate.isHighPriority",disabled:u,children:i("pc_text_template_release_priority_web")})})]})})]})}));var xe=i(88370);const Ce="topSectionHeader-FDUHM7",Le=(0,a.Pi)((e=>{const{className:t}=e,i=le(),{t:a}=(0,l.$)(),r=(0,c.Z)((()=>{})),n=(0,s.useRef)(null);return(0,p.O)({className:t,layout:i.mainFormLayout,uploadAreaProps:{titleForUploadArea:"",titleForMainForm:a("pc_subtitle_template_add_web"),subTitle:"",draggingTitle:"",draggingDisabled:!0,disabled:!0,disabledTooltip:"",onClick:r,onDrop:r},setFormApi:i.setFormApi,renderImportArea:e=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(u.S,{className:Ce,title:a("pc_subtitle_template_web",{X:i.subtitleTemplateList.length})}),(0,o.jsx)(re,{}),i.flowerTextList.length>0&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(u.S,{title:a("pc_subtitle_effect_web",{X:i.flowerTextList.length})}),(0,o.jsx)(ne,{})]})]}),renderFormArea:()=>i.subtitleTemplateList.selected?(0,o.jsx)(Fe,{subtitleTemplate:i.subtitleTemplateList.selected},i.subtitleTemplateList.selectedId):i.flowerTextList.selected?(0,o.jsx)(xe.p,{flowerText:i.flowerTextList.selected,initFlowerTextForm:i.initFlowerTextForm,applyTagsToAll:i.applyTagsToAll,maxTitleLength:40},i.flowerTextList.selectedId):null,scrollAreaRef:n,onRetry:i.retryInit})}));var ke=i(74502),Pe=i(36775);const Me=(0,a.Pi)((e=>{const{className:t}=e,i=le(),{t:a}=(0,l.$)(),r=(0,s.useRef)(null),n=()=>{i.uploadAndPublish(r.current)},{showModal:c}=(0,v.ZP)({handleBtnText:a("pc_i_see_web"),closeIcon:!0,needReview:!0,protocol:v.YW.Creator,onOk:()=>{(0,S.F)(v.YW.Creator),n()}});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ke.P,{className:t,leftText:"",isPublishDisabled:!i.isReadyToPublish,isPublishing:i.isPublishing,needConfirmModalOnClose:i.needConfirmModalOnClose,onPublish:()=>{(0,S.K)(v.YW.Creator)?n():c()},onCancel:()=>(0,O.gk)({showHomePage:!1})}),(0,o.jsx)(Pe.q,{ref:r,uploadStats:i.uploadStats,onRetryUpload:i.retryUploadAndPublishDeps,onCancel:i.handleUploadCancel,onShowUploadFail:()=>{},onPromptConfirmToCancel:i.isAllUploadedWatcher.handlePromptConfirmToCancel})]})}));var Ue=i(12904),Ae=i(65546),Ie=i(89100);const Re=(0,a.Pi)((e=>{const t=ie(),{t:i}=(0,l.$)();return(0,Ue.F)({title:i("pc_subtitle_template_item_release_web"),pid:"publish-subtitle-template-single"}),(0,Ae.d)(),(0,o.jsx)(ae.Provider,{value:t,children:(0,o.jsxs)("div",{className:Ie.Z.page,children:[(0,o.jsxs)("div",{className:Ie.Z.content,children:[(0,o.jsx)(n,{className:Ie.Z.instruction}),(0,o.jsx)(Le,{className:Ie.Z.mainForm})]}),(0,o.jsx)(Me,{className:Ie.Z.footer})]})})}))},97311:(e,t,i)=>{i.d(t,{C3:()=>o,Jr:()=>s,lm:()=>n,y8:()=>r});var a=i(96706),l=i.n(a);const s=(e,t="image/png")=>{let i=e;e.startsWith("data:")&&(i=e.split(",")[1]);const a=atob(i),l=new Array(a.length);for(let r=0;r<a.length;r++)l[r]=a.charCodeAt(r);const s=new Uint8Array(l);return new Blob([s],{type:t})},r=e=>URL.createObjectURL(e);const o=async e=>{const t=await e.arrayBuffer(),i=new Uint8Array(t);return l()(i)},n=e=>e.toLowerCase().split(".").pop()}}]);